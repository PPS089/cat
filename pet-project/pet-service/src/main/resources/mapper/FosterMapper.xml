<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.petservice.mapper.FosterMapper">
    <select id="getFostersInfo" resultType="com.example.petpojo.vo.FostersVo">
        SELECT
        f.fid AS id,  -- 寄养记录ID → VO 的 id
        f.start_date AS startDate,  -- 开始日期 → VO 的 startDate（驼峰映射）
        f.end_date AS endDate,  -- 结束日期 → VO 的 endDate（驼峰映射）
        CASE 
            WHEN f.end_date IS NULL THEN 'ongoing'
            ELSE 'ended'
        END AS status,  -- 寄养状态判断
        p.pid AS "pet.pid",  -- 宠物ID → pet对象的pid
        p.`name` AS "pet.name",  -- 宠物名称 → pet对象的name
        p.breed AS "pet.breed",  -- 宠物品种 → pet对象的breed
        p.age AS "pet.age",  -- 宠物年龄 → pet对象的age
        p.gender AS "pet.gender",  -- 宠物性别 → pet对象的gender
        p.img_url AS "pet.image",  -- 宠物图片URL → pet对象的image
        s.sid AS "shelter.sid",  -- 收容所ID → shelter对象的sid
        s.name AS "shelter.name",  -- 收容所名称 → shelter对象的name
        s.location AS "shelter.location"  -- 收容所位置 → shelter对象的location
        FROM `fosters` f
        JOIN pets p ON f.pid = p.pid  -- 关联宠物表（确保条件完整）
        JOIN shelters s ON f.sid = s.sid  -- 关联收容所表
        WHERE f.uid = #{id}
        LIMIT #{offset}, #{pageSize}
    </select>
    <select id="getFosterById" resultType="com.example.petpojo.vo.FostersVo">
        SELECT
        f.fid AS id,  -- 寄养记录ID → VO 的 id
        f.start_date AS startDate,  -- 开始日期 → VO 的 startDate（驼峰映射）
        f.end_date AS endDate,  -- 结束日期 → VO 的 endDate（驼峰映射）
        CASE 
            WHEN f.end_date IS NULL THEN 'ongoing'
            ELSE 'ended'
        END AS status,  -- 寄养状态判断
        p.pid AS "pet.pid",  -- 宠物ID → pet对象的pid
        p.`name` AS "pet.name",  -- 宠物名称 → pet对象的name
        p.breed AS "pet.breed",  -- 宠物品种 → pet对象的breed
        p.age AS "pet.age",  -- 宠物年龄 → pet对象的age
        p.gender AS "pet.gender",  -- 宠物性别 → pet对象的gender
        p.img_url AS "pet.image",  -- 宠物图片URL → pet对象的image
        s.sid AS "shelter.sid",  -- 收容所ID → shelter对象的sid
        s.name AS "shelter.name",  -- 收容所名称 → shelter对象的name
        s.location AS "shelter.location"  -- 收容所位置 → shelter对象的location
        FROM `fosters` f
        JOIN pets p ON f.pid = p.pid  -- 关联宠物表（确保条件完整）
        JOIN shelters s ON f.sid = s.sid  -- 关联收容所表
        WHERE f.fid = #{id}
        LIMIT 1
    </select>
</mapper>
