import{u as ee,h as V,j as G,v as W,E as g,a5 as se,d as te,c as P,o as S,a as t,t as l,l as e,e as s,w as a,U as ae,r as v,p as oe,g as y,D as ne,a6 as k,z as q,a7 as le,F as O,f as Q,G as ie,a8 as re,a9 as de,O as $,aa as ce,ab as ue,ac as ge,ad as J,ae as me,Q as _e,af as fe,n as pe,A as he}from"./index-n6QoKQtw.js";import{u as ve}from"./user-ML7mewxl.js";import{useThemeStore as ye}from"./theme-D8ZsPEis.js";import{s as K}from"./request-BS93o2BH.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./dog-DzFJ_7DI.js";const Se=()=>{const{t:r,locale:o}=ee(),L=ve(),h=ye(),b=V([]),H=V("login-history"),T=V(!1),w=V(!1),c=V(!1),U=V(!1),m=G({currentPassword:"",newPassword:"",confirmPassword:""}),x=[{name:"default",value:"#409EFF"},{name:"green",value:"#67C23A"},{name:"orange",value:"#E6A23C"},{name:"red",value:"#F56C6C"},{name:"purple",value:"#9B59B6"}],u=G({language:"zh-CN",theme:"light",primaryColor:"#409EFF",fontSize:14,animations:!0,compactMode:!1}),A=async()=>{if(!m.currentPassword||!m.newPassword||!m.confirmPassword){g.error(r("settings.passwordRequired"));return}if(m.newPassword!==m.confirmPassword){g.error(r("settings.passwordMismatch"));return}if(m.newPassword.length<6){g.error(r("settings.passwordLengthError"));return}T.value=!0;try{await L.changePassword(m),m.currentPassword="",m.newPassword="",m.confirmPassword="",g.success(r("settings.passwordChanged")),localStorage.removeItem("jwt_token"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("userId"),localStorage.removeItem("rememberedUsername"),localStorage.removeItem("rememberedPassword"),se.push("/login")}catch(n){g.error(r("settings.passwordChangeFailed")+(n.message?": "+n.message:""))}finally{T.value=!1}},z=async()=>{try{const n=await K.get("/login-history");n.code==200&&Array.isArray(n.data)?b.value=n.data.map(_=>({id:_.id,userId:_.userId,loginTime:_.loginTime,device:_.device||"Unknown Device",location:_.location||"Unknown Location",ipAddress:_.ipAddress||"0.0.0.0",status:_.status||"SUCCESS"})):b.value=[]}catch(n){b.value=[],n.message==="未授权"?g.warning(r("settings.pleaseLoginToViewHistory")||"请先登录后查看登录历史"):g.error(r("settings.networkErrorUnableToGetLoginHistory"))}},I=async()=>{try{const n=await K.delete("/login-history/clear");n.code===200?(g.success(r("settings.historyCleared")),b.value=[]):g.error(r("settings.clearHistoryFailed")+": "+n.message)}catch(n){console.error("清除登录历史错误:",n),g.error(r("settings.clearHistoryFailed"))}},M=async()=>{try{console.log(r("settings.loadingPreferences")),await h.loadPreferences(),console.log(r("settings.preferencesLoaded")),u.language=h.preferences.language,u.theme=h.preferences.theme,u.primaryColor=h.preferences.primaryColor,u.fontSize=h.preferences.fontSize,u.animations=h.preferences.animations,u.compactMode=h.preferences.compactMode,console.log(r("settings.preferencesSynced"))}catch(n){console.error("加载偏好设置错误:",n),g.error(r("settings.loadPreferencesFailed"))}},E=async()=>{w.value=!0;try{await h.updatePreference("language",u.language),o.value=u.language,g.success(r("settings.languageSaved"))}catch(n){console.error(r("languageSaveFailed"),n),g.error(r("settings.savePreferencesFailed")||r("saveFailed"))}finally{w.value=!1}},N=async()=>{c.value=!0;try{await h.updatePreferences({theme:u.theme,primaryColor:u.primaryColor}),g.success(r("settings.themeSaved"))}catch{g.error(r("settings.themeSaveFailed"))}finally{c.value=!1}},B=async()=>{U.value=!0;try{await h.updatePreferences({fontSize:u.fontSize,animations:u.animations,compactMode:u.compactMode}),g.success(r("settings.interfaceSettingsSaved"))}catch{g.error(r("settings.saveInterfaceSettingsFailed"))}finally{U.value=!1}},d=n=>{const _=new Date(n),p=new Date().getTime()-_.getTime();return p<6e4?r("settings.justNow"):p<36e5?`${Math.floor(p/6e4)}${r("settings.minutesAgo")}`:p<864e5?`${Math.floor(p/36e5)}${r("settings.hoursAgo")}`:p<6048e5?`${Math.floor(p/864e5)}${r("settings.daysAgo")}`:_.toLocaleDateString(u.language==="zh-CN"?"zh-CN":"en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})};return W(()=>{M(),z()}),{t:r,activeTab:H,passwordLoading:T,languageLoading:w,themeLoading:c,preferencesLoading:U,passwordForm:m,preferences:u,themeColors:x,loginHistory:b,changePassword:A,saveLanguage:E,saveThemeSettings:N,saveInterfaceSettings:B,clearLoginHistory:I,formatDateTime:d,loadPreferences:M,fetchLoginHistory:z}},be={class:"settings-container"},Ce={class:"page-header"},Pe={class:"settings-content"},ke={class:"tab-content"},Ve={class:"settings-section"},Le={class:"section-header"},Te={class:"section-title"},Ue={class:"settings-section"},Fe={class:"section-header"},ze={class:"section-title"},Ie={class:"security-tips"},Me={class:"tip-item"},He={class:"tip-item"},xe={class:"tip-item"},Ae={class:"tab-content"},Ee={class:"settings-section"},Ne={class:"section-header"},De={class:"section-title"},$e={class:"login-history-list"},Be={class:"history-main"},je={class:"history-time"},Re={class:"history-device"},Ge={class:"history-location"},qe={class:"history-side"},Oe={class:"history-ip"},Qe={key:0,class:"load-more"},Je={key:1,class:"load-more"},Ke={class:"tab-content"},We={class:"settings-section"},Xe={class:"section-header"},Ye={class:"section-title"},Ze={class:"settings-section"},es={class:"section-header"},ss={class:"section-title"},ts={class:"theme-colors"},as=["onClick"],os={class:"settings-section"},ns={class:"section-header"},ls={class:"section-title"},is={class:"form-hint"},rs=te({__name:"Setting",setup(r){const{t:o,activeTab:L,passwordLoading:h,languageLoading:b,themeLoading:H,preferencesLoading:T,passwordForm:w,preferences:c,themeColors:U,loginHistory:m,changePassword:x,saveLanguage:u,saveThemeSettings:A,saveInterfaceSettings:z,clearLoginHistory:I,formatDateTime:M,loadPreferences:E,fetchLoginHistory:N}=Se();return W(()=>{E(),N()}),(B,d)=>{const n=v("el-icon"),_=v("el-input"),f=v("el-form-item"),p=v("el-button"),C=v("el-form"),D=v("el-tab-pane"),X=v("el-tag"),F=v("el-radio"),j=v("el-radio-group"),Y=v("el-slider"),R=v("el-switch"),Z=v("el-tabs");return S(),P("div",be,[t("div",Ce,[t("h1",null,l(e(o)("settings.title")),1)]),t("div",Pe,[s(Z,{modelValue:e(L),"onUpdate:modelValue":d[8]||(d[8]=i=>ae(L)?L.value=i:null),class:"settings-tabs"},{default:a(()=>[s(D,{label:e(o)("settings.accountSecurity"),name:"security"},{default:a(()=>[t("div",ke,[t("div",Ve,[t("div",Le,[s(n,{class:"section-icon"},{default:a(()=>[s(e(oe))]),_:1}),t("div",Te,[t("h3",null,l(e(o)("settings.changePassword")),1),t("p",null,l(e(o)("settings.changePasswordTip")),1)])]),s(C,{model:e(w),"label-width":"120px",style:{"max-width":"500px"}},{default:a(()=>[s(f,{label:e(o)("settings.currentPassword")},{default:a(()=>[s(_,{modelValue:e(w).currentPassword,"onUpdate:modelValue":d[0]||(d[0]=i=>e(w).currentPassword=i),type:"password",placeholder:e(o)("settings.currentPasswordPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(f,{label:e(o)("settings.newPassword")},{default:a(()=>[s(_,{modelValue:e(w).newPassword,"onUpdate:modelValue":d[1]||(d[1]=i=>e(w).newPassword=i),type:"password",placeholder:e(o)("settings.newPasswordPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(f,{label:e(o)("settings.confirmPassword")},{default:a(()=>[s(_,{modelValue:e(w).confirmPassword,"onUpdate:modelValue":d[2]||(d[2]=i=>e(w).confirmPassword=i),type:"password",placeholder:e(o)("settings.confirmPasswordPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(f,null,{default:a(()=>[s(p,{type:"primary",onClick:e(x),loading:e(h)},{default:a(()=>[y(l(e(o)("settings.changePassword")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model"])]),t("div",Ue,[t("div",Fe,[s(n,{class:"section-icon"},{default:a(()=>[s(e(ne))]),_:1}),t("div",ze,[t("h3",null,l(e(o)("settings.securityTips")),1),t("p",null,l(e(o)("settings.securityTipsSubtitle")),1)])]),t("div",Ie,[t("div",Me,[s(n,null,{default:a(()=>[s(e(k))]),_:1}),t("span",null,l(e(o)("settings.securityTip1")),1)]),t("div",He,[s(n,null,{default:a(()=>[s(e(k))]),_:1}),t("span",null,l(e(o)("settings.securityTip2")),1)]),t("div",xe,[s(n,null,{default:a(()=>[s(e(k))]),_:1}),t("span",null,l(e(o)("settings.securityTip3")),1)])])])])]),_:1},8,["label"]),s(D,{label:e(o)("settings.loginHistory"),name:"login-history"},{default:a(()=>[t("div",Ae,[t("div",Ee,[t("div",Ne,[s(n,{class:"section-icon"},{default:a(()=>[s(e(le))]),_:1}),t("div",De,[t("h3",null,l(e(o)("settings.recentLoginRecords")),1),t("p",null,l(e(o)("settings.viewLoginHistory")),1)])]),t("div",$e,[(S(!0),P(O,null,Q(e(m),i=>(S(),P("div",{key:i.id,class:"history-item"},[t("div",Be,[t("div",je,[s(n,null,{default:a(()=>[s(e(ie))]),_:1}),t("span",null,l(e(M)(i.loginTime)),1)]),t("div",Re,[s(n,null,{default:a(()=>[s(e(re))]),_:1}),t("span",null,l(i.device),1)]),t("div",Ge,[s(n,null,{default:a(()=>[s(e(de))]),_:1}),t("span",null,l(i.location||e(o)("settings.unknownLocation")),1)])]),t("div",qe,[t("div",Oe,[t("span",null,"IP: "+l(i.ipAddress),1)]),s(X,{type:i.status==="SUCCESS"?"success":"danger",size:"small"},{default:a(()=>[s(n,null,{default:a(()=>[i.status==="SUCCESS"?(S(),$(e(ce),{key:0})):(S(),$(e(ue),{key:1}))]),_:2},1024),y(" "+l(i.status==="SUCCESS"?e(o)("settings.loginSuccess"):e(o)("settings.loginFailed")),1)]),_:2},1032,["type"])])]))),128))]),e(m).length>=10?(S(),P("div",Qe,[s(p,{text:"",type:"danger",onClick:e(I),style:{"margin-left":"1rem"}},{default:a(()=>[y(l(e(o)("settings.clearHistory")),1)]),_:1},8,["onClick"])])):e(m).length>0?(S(),P("div",Je,[s(p,{text:"",type:"danger",onClick:e(I)},{default:a(()=>[y(l(e(o)("settings.clearHistory")),1)]),_:1},8,["onClick"])])):q("",!0)])])]),_:1},8,["label"]),s(D,{label:e(o)("settings.preferences"),name:"preferences"},{default:a(()=>[t("div",Ke,[t("div",We,[t("div",Xe,[s(n,{class:"section-icon"},{default:a(()=>[s(e(ge))]),_:1}),t("div",Ye,[t("h3",null,l(e(o)("settings.languageSettings")),1),t("p",null,l(e(o)("settings.languageSettingsSubtitle")),1)])]),s(C,{"label-width":"120px"},{default:a(()=>[s(f,{label:e(o)("settings.interfaceLanguage")},{default:a(()=>[s(j,{modelValue:e(c).language,"onUpdate:modelValue":d[3]||(d[3]=i=>e(c).language=i)},{default:a(()=>[s(F,{label:"zh-CN"},{default:a(()=>[y(l(e(o)("settings.chineseSimplified")),1)]),_:1}),s(F,{label:"en-US"},{default:a(()=>[y(l(e(o)("settings.english")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(f,null,{default:a(()=>[s(p,{type:"primary",onClick:e(u),loading:e(b)},{default:a(()=>[s(n,null,{default:a(()=>[s(e(k))]),_:1}),y(" "+l(e(o)("settings.saveLanguageSettings")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),t("div",Ze,[t("div",es,[s(n,{class:"section-icon"},{default:a(()=>[s(e(J))]),_:1}),t("div",ss,[t("h3",null,l(e(o)("settings.themeAppearance")),1),t("p",null,l(e(o)("settings.themeAppearanceSubtitle")),1)])]),s(C,{"label-width":"120px"},{default:a(()=>[s(f,{label:e(o)("settings.themeMode")},{default:a(()=>[s(j,{modelValue:e(c).theme,"onUpdate:modelValue":d[4]||(d[4]=i=>e(c).theme=i)},{default:a(()=>[s(F,{label:"light"},{default:a(()=>[s(n,null,{default:a(()=>[s(e(J))]),_:1}),y(" "+l(e(o)("settings.lightTheme")),1)]),_:1}),s(F,{label:"dark"},{default:a(()=>[s(n,null,{default:a(()=>[s(e(me))]),_:1}),y(" "+l(e(o)("settings.darkTheme")),1)]),_:1}),s(F,{label:"auto"},{default:a(()=>[s(n,null,{default:a(()=>[s(e(_e))]),_:1}),y(" "+l(e(o)("settings.followSystem")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(f,{label:e(o)("settings.themeColor")},{default:a(()=>[t("div",ts,[(S(!0),P(O,null,Q(e(U),i=>(S(),P("div",{key:i.value,class:pe(["theme-color-item",{active:e(c).primaryColor===i.value}]),style:fe({backgroundColor:i.value}),onClick:ds=>e(c).primaryColor=i.value},[e(c).primaryColor===i.value?(S(),$(n,{key:0},{default:a(()=>[s(e(k))]),_:1})):q("",!0)],14,as))),128))])]),_:1},8,["label"]),s(f,null,{default:a(()=>[s(p,{type:"primary",onClick:e(A),loading:e(H)},{default:a(()=>[s(n,null,{default:a(()=>[s(e(k))]),_:1}),y(" "+l(e(o)("settings.saveThemeSettings")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),t("div",os,[t("div",ns,[s(n,{class:"section-icon"},{default:a(()=>[s(e(he))]),_:1}),t("div",ls,[t("h3",null,l(e(o)("settings.interfaceSettings")),1),t("p",null,l(e(o)("settings.interfaceSettingsSubtitle")),1)])]),s(C,{"label-width":"120px"},{default:a(()=>[s(f,{label:e(o)("settings.fontSize")},{default:a(()=>[s(Y,{modelValue:e(c).fontSize,"onUpdate:modelValue":d[5]||(d[5]=i=>e(c).fontSize=i),min:12,max:18,step:1,"show-input":"","show-stops":""},null,8,["modelValue"])]),_:1},8,["label"]),s(f,{label:e(o)("settings.animationEffects")},{default:a(()=>[s(R,{modelValue:e(c).animations,"onUpdate:modelValue":d[6]||(d[6]=i=>e(c).animations=i)},null,8,["modelValue"])]),_:1},8,["label"]),s(f,{label:e(o)("settings.compactMode")},{default:a(()=>[s(R,{modelValue:e(c).compactMode,"onUpdate:modelValue":d[7]||(d[7]=i=>e(c).compactMode=i)},null,8,["modelValue"]),t("span",is,l(e(o)("settings.compactModeHint")),1)]),_:1},8,["label"]),s(f,null,{default:a(()=>[s(p,{type:"primary",onClick:e(z),loading:e(T)},{default:a(()=>[s(n,null,{default:a(()=>[s(e(k))]),_:1}),y(" "+l(e(o)("settings.saveInterfaceSettings")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})])])]),_:1},8,["label"])]),_:1},8,["modelValue"])])])}}}),ps=we(rs,[["__scopeId","data-v-cae53402"]]);export{ps as default};
