import{s as D,i as I,O as J,u as z,h as ce,k as ue,E as k,P as _e,d as ve,l as ge,a3 as he,c as p,o as m,a as e,H as M,t as i,p as t,v as P,a2 as A,F as U,f as $,x as Z,g as ee,n as V,Y as fe,q as de,_ as ye}from"./index-vX8o4tFx.js";import{useThemeStore as ke}from"./theme-BuSJrrmb.js";const pe=async(r,o)=>{const c=new FormData;return r.forEach(_=>{c.append("files",_)}),c.append("recordId",String(o)),D.post("/media/upload",c)},Ee=()=>{const{t:r}=z();return{getMoodEmoji:c=>{const _={[r("happy")]:"ðŸ˜Š",[r("angry")]:"ðŸ˜ ",[r("tired")]:"ðŸ˜´",[r("active")]:"ðŸ•"};return c&&_[c]||"ðŸ˜"}}},we=()=>{const{t:r}=z();return{getMoodClass:c=>({happy:c===r("happy"),angry:c===r("angry"),tired:c===r("tired"),active:c===r("active")})}},be=()=>({formatDate:o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}),O={maxFileSize:52428800,supportedImageFormats:["image/jpeg","image/png","image/gif","image/webp","image/jpg"],supportedVideoFormats:["video/mp4","video/mpeg","video/quicktime","video/x-msvideo","video/webm"],thumbnailMaxWidth:200,thumbnailMaxHeight:200},Me=r=>new Promise((o,c)=>{const _=new FileReader;_.onload=v=>{const u=new Image;u.onload=()=>{const n=document.createElement("canvas"),a=n.getContext("2d");if(!a){o(v.target?.result);return}let g=u.width,d=u.height;const h=O.thumbnailMaxWidth,w=O.thumbnailMaxHeight;g>d?g>h&&(d=d*h/g,g=h):d>w&&(g=g*w/d,d=w),n.width=g,n.height=d,a.drawImage(u,0,0,g,d),o(n.toDataURL("image/jpeg",.7))},u.onerror=()=>{o(v.target?.result)},u.src=v.target?.result},_.onerror=()=>c(new Error("æ— æ³•è¯»å–æ–‡ä»¶")),_.readAsDataURL(r)}),Fe=r=>{if(r.size>O.maxFileSize)return{valid:!1,error:`æ–‡ä»¶è¿‡å¤§ï¼Œæœ€å¤§æ”¯æŒ${O.maxFileSize/1024/1024}MB`};const o=O.supportedImageFormats.includes(r.type),c=O.supportedVideoFormats.includes(r.type);return!o&&!c?{valid:!1,error:"ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œä»…æ”¯æŒå¸¸è§çš„å›¾ç‰‡å’Œè§†é¢‘æ ¼å¼"}:{valid:!0}},Ie=()=>{const r=I([]);return{filePreviews:r,handleFileUpload:async a=>{const g=a.target,d=Array.from(g.files||[]);if(r.value.length+d.length>5){k.error("æœ€å¤šåªèƒ½ä¸Šä¼ 5ä¸ªæ–‡ä»¶");return}for(const h of d){const w=Fe(h);if(!w.valid){k.error(`æ–‡ä»¶ "${h.name}" éªŒè¯å¤±è´¥ï¼š${w.error}`);continue}try{const b=h.type.startsWith("image/")?"image":"video";let E=URL.createObjectURL(h),T=E;b==="image"?T=await Me(h):T=E,r.value.push({file:h,previewUrl:E,thumbnailUrl:T,mediaType:b,isValid:!0}),k.success(`æ–‡ä»¶ "${h.name}" æ·»åŠ æˆåŠŸ`)}catch(b){k.error(`æ–‡ä»¶ "${h.name}" å¤„ç†å¤±è´¥ï¼š${b instanceof Error?b.message:"æœªçŸ¥é”™è¯¯"}`)}}g.value=""},removeFile:a=>{const g=r.value[a];g&&g.previewUrl.startsWith("blob:")&&URL.revokeObjectURL(g.previewUrl),r.value.splice(a,1),k.success("æ–‡ä»¶å·²åˆ é™¤")},clearAllFiles:()=>{r.value.forEach(a=>{a.previewUrl.startsWith("blob:")&&URL.revokeObjectURL(a.previewUrl)}),r.value=[]},getUploadFiles:()=>r.value.map(a=>a.file),getFileIcon:a=>a==="image"?"ðŸ–¼ï¸":a==="video"?"ðŸŽ¬":"ðŸ“„",formatFileSize:a=>{if(a===0)return"0 Bytes";const g=1024,d=["Bytes","KB","MB"],h=Math.floor(Math.log(a)/Math.log(g));return Math.round(a/Math.pow(g,h)*100)/100+" "+d[h]}}},Te=()=>{const r=I(!1),o=I([]),c=I(!1);return{showMediaModal:r,currentMediaList:o,mediaLoading:c,openMediaModal:async(u,n)=>{if(n){c.value=!0;try{const a=await D.get(`/media/record/${n}`);if(console.log("åŽç«¯è¿”å›žçš„åª’ä½“æ•°æ®:",a),a.code===200&&a.data){const g=Array.isArray(a.data)?a.data:[a.data];o.value=g.map(d=>({id:d.mid||d.id,media_url:`/api${d.filePath||d.mediaUrl||d.media_url}`,media_type:d.mediaType||d.media_type||"image",media_name:d.fileName||d.name||""})),console.log(`å·²åŠ è½½è®°å½• ${n} çš„åª’ä½“æ–‡ä»¶:`,o.value)}else o.value=[]}catch(a){console.error("åŠ è½½åª’ä½“æ–‡ä»¶å¤±è´¥:",a),k.error("åŠ è½½åª’ä½“æ–‡ä»¶å¤±è´¥"),o.value=[]}finally{c.value=!1}}else o.value=u||[];r.value=!0},closeMediaModal:()=>{r.value=!1,o.value=[]}}},me=()=>{const{t:r}=z(),o=I([]),c=I(!1);return{events:o,loading:c,fetchEvents:async()=>{console.log(r("fetchEventsFunctionStart")),c.value=!0;try{const v=await D.get("/events");if(console.log(r("fetchEventsApiResponse"),v),v.code===200&&v.data){console.log("fetchEvents: äº‹ä»¶æ•°é‡:",v.data.length);const u=v.data.map(n=>{const a=n.record_id||n.eid||n.id;if(!a)return console.warn("Event missing record_id:",n),null;const g=n.record_time||n.eventTime||n.event_time;return g?{record_id:a,pid:n.pid||0,event_type:n.eventType||n.event_type||"æœªçŸ¥",description:n.description||"",record_time:g,mood:n.mood||"",location:n.location||"",pet_name:n.pet_name||"",created_at:n.createdAt||n.created_at||g,media_list:n.mediaList&&Array.isArray(n.mediaList)?n.mediaList.map(d=>({id:d.mid||d.id||1,media_url:`/api${d.filePath||d.media_url||d.url}`,media_type:d.mediaType||d.media_type||"image",media_name:d.fileName||d.media_name||""})):n.mediaUrl?[{id:1,media_url:n.mediaUrl,media_type:n.mediaType||"image",media_name:""}]:[]}:(console.warn("Event missing record_time:",n),null)}).filter(Boolean);o.value=u,console.log("fetchEvents: æ›´æ–°äº‹ä»¶æ•°æ®åŽï¼Œæ–°äº‹ä»¶æ•°é‡:",o.value.length)}else o.value=[],console.warn(r("fetchEventsApiResponseFormatIncorrect"))}catch(v){console.error("fetchEvents: èŽ·å–äº‹ä»¶å¤±è´¥:",v),k.error(r("api.getEventsFailed")),o.value=[]}finally{c.value=!1}}}},Ce=()=>{const{t:r}=z(),o=ce(),c=I([]),_=I(!1);return{pets:c,loading:_,fetchPets:async()=>{_.value=!0;try{console.log(r("fetchPetsStartGettingPetData")),console.log(r("fetchPetsCurrentUserInfo"),{user_id:o.info.userId,userName:o.info.userName,token:localStorage.getItem("jwt_token")||localStorage.getItem("token")}),console.log(r("fetchPetsReadyToCallApiUserAdoptions"));const n=await D.get("/user/adoptions",{params:{current_page:1,per_page:100}});if(console.log("fetchPets: APIå“åº”æ•°æ®:",JSON.stringify(n,null,2)),n.code===200){const a=n.data.records;if(a&&Array.isArray(a)&&a.length>0){console.log(r("fetchPetsStartProcessingAdoptionRecords"));const g=a.map(d=>({pid:d.pid||d.id,name:d.name||d.petName,species:d.breed||d.species||"æœªçŸ¥",breed:d.breed||d.species||"æœªçŸ¥",type:"adoption",date:d.adoptionDate||d.adoptDate||d.date}));console.log("fetchPets: æ˜ å°„åŽçš„å® ç‰©æ•°ç»„:",g),c.value=g,console.log("fetchPets: æœ€ç»ˆpets.valueæ•°é‡:",c.value.length)}}else c.value=[],console.log("fetchPets: æ²¡æœ‰èŽ·å–åˆ°é¢†å…»è®°å½•æ•°æ®")}catch(n){k.error(r("api.getPetsFailed")),console.error("Error fetching pets:",n),c.value=[]}finally{_.value=!1,console.log("fetchPets: æœ€ç»ˆpets.value:",c.value)}},getPetName:(n,a)=>{console.log(`getPetName: æŸ¥æ‰¾PID ${n}, å¯ç”¨å® ç‰©æ•°é‡: ${c.value.length}, å® ç‰©åˆ—è¡¨:`,c.value.map(d=>({pid:d.pid,name:d.name})));const g=c.value.find(d=>d.pid===n);return g?(console.log(`getPetName: PID ${n} æ‰¾åˆ°å® ç‰©: ${g.name}`),g.name):a?(console.log(`getPetName: PID ${n} æœªæ‰¾åˆ°å® ç‰©ï¼Œä½¿ç”¨æä¾›çš„åå­—: ${a}`),a):(console.log(`getPetName: PID ${n} æœªæ‰¾åˆ°å® ç‰©ä¸”æ²¡æœ‰æä¾›åå­—ï¼Œè¿”å›žæœªçŸ¥å® ç‰©`),r("api.unknownPet"))}}},Pe=r=>{const{t:o}=z(),{fetchEvents:c}=r||me();return{deleteEvent:async u=>{try{if(!u||u===void 0||u<=0){console.error("Invalid recordId:",u),k.error("æ— æ•ˆçš„è®°å½•ID");return}await _e.confirm(o("common.confirmDeleteEvent"),o("common.deleteConfirmation"),{confirmButtonText:o("common.confirm"),cancelButtonText:o("common.cancel"),type:"warning"}),await D.delete(`/events/${u}`),k.success(o("api.deleteSuccess")),console.log("deleteEvent: å¼€å§‹é‡æ–°èŽ·å–äº‹ä»¶æ•°æ®..."),await c(),console.log("deleteEvent: äº‹ä»¶æ•°æ®é‡æ–°èŽ·å–å®Œæˆ")}catch(n){n!=="cancel"&&(k.error(o("api.deleteFailed")),console.error("Error deleting event:",n))}},saveEvent:async(u,n)=>{try{const a=u.record_time,g=a?a.replace("T"," ")+":00":"",d={pid:u.pid,eventType:u.event_type,recordTime:g,description:u.description,mood:u.mood||"",location:u.location||""};let h=null;if(n&&u.record_id)await D.put(`/events/${u.record_id}`,d),h=Number(u.record_id),k.success(o("api.updateSuccess"));else{const b=await D.post("/events",d);h=b.data?.eid||b.data?.record_id||b.data?.id,k.success(o("api.addSuccess"))}const w=[];if(w&&w.length>0&&h)try{console.log(`ä¸Šä¼ æµç¨‹ï¼šå¼€å§‹ä¸Šä¼ ${w.length}ä¸ªæ–‡ä»¶...`),await pe(w,h),k.success("æµç¨‹å®Œæˆï¼šäº‹ä»¶å’Œåª’ä½“æ–‡ä»¶ä¸Šä¼ æˆåŠŸ")}catch(b){console.warn("æµç¨‹è­¦å‘Šï¼šäº‹ä»¶ä¿å­˜æˆåŠŸï¼Œä½†åª’ä½“æ–‡ä»¶ä¸Šä¼ å¤±è´¥",b),k.warning("äº‹ä»¶ä¿å­˜æˆåŠŸï¼Œä½†åª’ä½“æ–‡ä»¶ä¸Šä¼ å¤±è´¥")}console.log("saveEvent: å¼€å§‹é‡æ–°èŽ·å–äº‹ä»¶æ•°æ®..."),setTimeout(async()=>{await c(),console.log("saveEvent: äº‹ä»¶æ•°æ®é‡æ–°èŽ·å–å®Œæˆ")},500)}catch(a){throw k.error(o(n?"api.updateFailed":"api.addFailed")),console.error("Error saving event:",a),a.response&&(console.error("Error response:",a.response.data),console.error("Error status:",a.response.status)),a}}}},Se=r=>{const o=ue({selectedPet:"",selectedEventType:"",selectedMood:"",selectedDate:""}),c=J(()=>{let _=[...r.value];return o.selectedPet&&(_=_.filter(v=>v.pid===Number(o.selectedPet))),o.selectedEventType&&(_=_.filter(v=>v.event_type===o.selectedEventType)),o.selectedMood&&(_=_.filter(v=>v.mood===o.selectedMood)),o.selectedDate&&(_=_.filter(v=>new Date(v.record_time).toDateString()===new Date(o.selectedDate).toDateString())),_});return{filters:o,filteredEvents:c}},Ue=r=>{const o=I("record_time"),c=J(()=>{const _=[...r.value];return _.sort((v,u)=>{switch(o.value){case"event_type":return v.event_type.localeCompare(u.event_type);case"mood":return(v.mood||"").localeCompare(u.mood||"");case"record_time":default:return new Date(u.record_time).getTime()-new Date(v.record_time).getTime()}}),_});return{sortBy:o,sortedEvents:c}},$e=r=>({groupedEvents:J(()=>{const c={};return r.value.forEach(_=>{const v=new Date(_.record_time).toDateString();c[v]||(c[v]=[]),c[v].push(_)}),c})}),De=()=>{const r=ue({record_id:"",pid:"",event_type:"",mood:"",description:"",location:"",record_time:""});return{formData:r,resetForm:()=>{Object.assign(r,{record_id:"",pid:"",event_type:"",mood:"",description:"",location:"",record_time:""})},populateForm:_=>{let v="";try{if(_.record_time){const u=_.record_time.replace(" ","T"),n=new Date(u);if(!isNaN(n.getTime()))v=n.toISOString().slice(0,16);else{console.warn("Invalid date format:",_.record_time);const a=_.record_time.split(" ");a.length===2&&(v=`${a[0]}T${a[1].slice(0,5)}`)}}}catch(u){console.error("Error parsing date:",u,_.record_time)}Object.assign(r,{..._,record_time:v})}}},xe=()=>{const{events:r,loading:o,fetchEvents:c}=me(),{pets:_,fetchPets:v,getPetName:u}=Ce(),{getMoodEmoji:n}=Ee(),{getMoodClass:a}=we(),{formatDate:g}=be(),{filePreviews:d,handleFileUpload:h,removeFile:w,clearAllFiles:b,getUploadFiles:E,getFileIcon:T,formatFileSize:K}=Ie(),{showMediaModal:te,currentMediaList:oe,mediaLoading:Y,openMediaModal:se,closeMediaModal:ie}=Te(),{filters:le,filteredEvents:L}=Se(r),{sortBy:H,sortedEvents:j}=Ue(L),{groupedEvents:N}=$e(j),{formData:F,resetForm:ne,populateForm:ae}=De(),{deleteEvent:re}=Pe({fetchEvents:c}),R=I(!1),S=I(!1),q=I("grid"),W=J(()=>r.value.length),Q=J(()=>r.value.reduce((s,f)=>s+(f.media_list?.length||0),0)),x=s=>{ae(s),S.value=!0},C=()=>{R.value=!1,S.value=!1,b(),ne()};return{events:r,pets:_,loading:o,filters:le,viewMode:q,sortBy:H,showAddModal:R,showEditModal:S,showMediaModal:te,mediaLoading:Y,formData:F,filePreviews:d,currentMediaList:oe,totalEvents:W,totalMedia:Q,filteredEvents:L,sortedEvents:j,groupedEvents:N,fetchEvents:c,fetchPets:v,getPetName:u,getMoodEmoji:n,getMoodClass:a,formatDate:g,handleFileUpload:h,removeFile:w,getFileIcon:T,formatFileSize:K,openMediaModal:se,closeMediaModal:ie,editEvent:x,deleteEvent:re,saveEvent:async()=>{try{const s=F.record_time,f=s?s.replace("T"," ")+":00":"",y={pid:F.pid,eventType:F.event_type,recordTime:f,description:F.description,mood:F.mood||"",location:F.location||""};let B=null;if(S.value&&F.record_id)await D.put(`/events/${F.record_id}`,y),B=Number(F.record_id),k.success("äº‹ä»¶æ›´æ–°æˆåŠŸ");else{const G=await D.post("/events",y);B=G.data?.eid||G.data?.record_id||G.data?.id,k.success("äº‹ä»¶æ·»åŠ æˆåŠŸ")}const X=E();if(X&&X.length>0&&B)try{console.log(`æµå¤´æ¨¡å…ƒï¼šå¼€å§‹ä¸Šä¼ ${X.length}ä¸ªæµä¼ æ–‡ä»¶...`),await pe(X,B),k.success("äº‹ä»¶ä¿å­˜æˆåŠŸï¼Œåª’ä½“æ–‡ä»¶ä¸Šä¼ å®Œæˆ")}catch(G){console.warn("æµå¤´æ¨¡å—è­¦å‘Šï¼šäº‹ä»¶æ·»åŠ æˆåŠŸï¼Œä½†æµä¼ æ–‡ä»¶ä¸Šä¼ å¤±è´¥",G),k.warning("äº‹ä»¶æ·»åŠ æˆåŠŸï¼Œä½†æµä¼ æ–‡ä»¶ä¸Šä¼ å¤±è´¥")}console.log("saveEventHandler: å¼€å§‹é‡æ–°èŽ·å–äº‹ä»¶æ•°æ®..."),setTimeout(async()=>{await c(),console.log("saveEventHandler: äº‹ä»¶æ•°æ®é‡æ–°èŽ·å–å®Œæˆ"),C()},500)}catch(s){k.error(S.value?"äº‹ä»¶æ›´æ–°å¤±è´¥":"äº‹ä»¶æ·»åŠ å¤±è´¥"),console.error("Error saving event:",s),s.response&&(console.error("Error response:",s.response.data),console.error("Error status:",s.response.status))}},closeModal:C}},Ne={class:"page-header"},Ae={class:"stats-grid"},Ve={class:"stat-card"},Le={class:"stat-content"},je={class:"stat-card"},Re={class:"stat-content"},Be={class:"stat-card"},Oe={class:"stat-content"},ze={class:"controls-section"},He={class:"filter-group"},qe={style:{position:"relative"}},We=["disabled"],Ge={value:""},Je=["value"],Ke={key:0,style:{position:"absolute",top:"-20px",left:"0",color:"#666"}},Ye={value:""},Qe={value:"å–‚é£Ÿ"},Xe={value:"æ´—æ¾¡"},Ze={value:"æ•£æ­¥"},et={value:"çœ‹å…½åŒ»"},tt={value:"çŽ©è€"},ot={value:"æ‰“ç–«è‹—"},st={value:""},it={value:"å¼€å¿ƒ"},lt={value:"ç”Ÿæ°”"},nt={value:"ç–²å€¦"},at={value:"æ´»è·ƒ"},rt=["placeholder"],dt={class:"view-controls"},ct={class:"view-toggle"},ut={class:"sort-controls"},pt={value:"record_time"},mt={value:"event_type"},_t={value:"mood"},vt={class:"events-content"},gt={key:0,class:"events-grid"},ht={class:"event-header"},ft={class:"pet-info"},yt={class:"event-type"},kt={key:0,class:"event-mood"},Et={class:"mood-emoji"},wt={class:"mood-text"},bt={class:"event-content"},Mt={class:"description"},Ft={key:0,class:"location"},It={key:0,class:"event-media"},Tt={class:"media-preview"},Ct=["src","alt","onClick"],Pt=["src","onClick"],St=["onClick"],Ut={class:"event-footer"},$t={class:"event-time"},Dt={class:"record-time"},xt={class:"created-time"},Nt={class:"event-actions"},At=["onClick"],Vt=["onClick","disabled"],Lt={key:1,class:"events-list"},jt={class:"list-header"},Rt={class:"col-pet"},Bt={class:"col-type"},Ot={class:"col-mood"},zt={class:"col-description"},Ht={class:"col-time"},qt={class:"col-actions"},Wt={class:"col-pet"},Gt={class:"pet-info"},Jt={class:"col-type"},Kt={class:"event-type-badge"},Yt={class:"col-mood"},Qt={key:0,class:"mood-indicator"},Xt={class:"mood-emoji"},Zt={class:"col-description"},eo={class:"description-text"},to={key:0,class:"location-small"},oo={class:"col-time"},so={class:"time-text"},io={class:"col-actions"},lo=["onClick"],no=["onClick","disabled"],ao={key:2,class:"timeline-view"},ro={class:"timeline"},co={class:"timeline-date"},uo={class:"timeline-items"},po={class:"timeline-content"},mo={class:"timeline-header"},_o={class:"event-type-badge"},vo={key:0,class:"mood-indicator"},go={class:"mood-emoji"},ho={class:"description"},fo={key:0,class:"location"},yo={class:"timeline-footer"},ko={class:"time-text"},Eo={class:"timeline-actions"},wo=["onClick"],bo=["onClick","disabled"],Mo={class:"modal-header"},Fo={class:"form-group"},Io={value:""},To=["value"],Co={class:"form-group"},Po={value:""},So={value:"å–‚é£Ÿ"},Uo={value:"æ´—æ¾¡"},$o={value:"æ•£æ­¥"},Do={value:"çœ‹å…½åŒ»"},xo={value:"çŽ©è€"},No={value:"æ‰“ç–«è‹—"},Ao={class:"form-group"},Vo={value:""},Lo={value:"å¼€å¿ƒ"},jo={value:"ç”Ÿæ°”"},Ro={value:"ç–²å€¦"},Bo={value:"æ´»è·ƒ"},Oo={class:"form-group"},zo={class:"form-group"},Ho=["placeholder"],qo={class:"form-group"},Wo=["placeholder"],Go={class:"form-group"},Jo={class:"media-upload"},Ko={class:"upload-area"},Yo={for:"media-file-input",class:"upload-label"},Qo={class:"upload-text"},Xo={class:"upload-hint"},Zo={key:0,class:"uploaded-files"},es={class:"uploaded-files-title"},ts={class:"file-preview-grid"},os={class:"preview-thumbnail"},ss=["src","alt"],is={key:1,class:"preview-video-placeholder"},ls={class:"file-info-full"},ns={class:"file-name-container"},as={class:"file-icon"},rs=["title"],ds={class:"file-size-type"},cs={class:"file-size"},us={class:"file-type"},ps=["onClick","title"],ms={class:"upload-hint-text"},_s={class:"modal-actions"},vs={type:"submit",class:"save-btn"},gs={class:"media-modal-header"},hs={key:0,class:"media-loading"},fs={key:1,class:"media-empty"},ys={key:2,class:"media-carousel"},ks=["src","alt"],Es=["src"],ws=ve({__name:"Records",setup(r){const{t:o}=z(),c=ce(),_=ke(),v=()=>{if(typeof window>"u")return;const C=localStorage.getItem("jwt_token")||localStorage.getItem("token"),l=localStorage.getItem("userName")||localStorage.getItem("username"),s=localStorage.getItem("userId")||localStorage.getItem("userid");console.log("åŒæ­¥ç”¨æˆ·çŠ¶æ€:",{token:!!C,username:l,userId:s}),C&&l&&s?(c.info.userName=l,c.info.userId=parseInt(s),console.log("ç”¨æˆ·çŠ¶æ€åŒæ­¥æˆåŠŸ:",{userName:l,userId:parseInt(s)})):(console.log("ç”¨æˆ·çŠ¶æ€ä¸å®Œæ•´ï¼Œéœ€è¦é‡æ–°ç™»å½•",{token:C,username:l,userId:s}),C||(localStorage.removeItem("userName"),localStorage.removeItem("userId"),localStorage.removeItem("username"),localStorage.removeItem("userid"),c.info.userName="",c.info.userId=0))},{pets:u,filters:n,viewMode:a,sortBy:g,showAddModal:d,showEditModal:h,showMediaModal:w,mediaLoading:b,formData:E,filePreviews:T,currentMediaList:K,totalEvents:te,totalMedia:oe,sortedEvents:Y,groupedEvents:se,fetchEvents:ie,fetchPets:le,getPetName:L,getMoodEmoji:H,getMoodClass:j,formatDate:N,handleFileUpload:F,removeFile:ne,getFileIcon:ae,formatFileSize:re,openMediaModal:R,closeMediaModal:S,editEvent:q,deleteEvent:W,saveEvent:Q,closeModal:x}=xe();return ge(async()=>{if(v(),!(typeof window<"u"&&!localStorage.getItem("jwt_token")))try{await le(),await he(),await ie()}catch(C){console.error("records.vue: æ•°æ®èŽ·å–å¤±è´¥:",C)}}),(C,l)=>(m(),p("div",{class:V(["events-container",{"dark-theme":t(_).preferences.theme==="dark"}])},[e("div",Ne,[e("h1",null,i(t(o)("records.pageTitle")),1),e("p",null,i(t(o)("records.pageSubtitle")),1)]),e("div",Ae,[e("div",Ve,[l[24]||(l[24]=e("div",{class:"stat-icon"},"ðŸ“…",-1)),e("div",Le,[e("h3",null,i(t(te)),1),e("p",null,i(t(o)("records.totalEvents")),1)])]),e("div",je,[l[25]||(l[25]=e("div",{class:"stat-icon"},"ðŸ•",-1)),e("div",Re,[e("h3",null,i(t(u).length),1),e("p",null,i(t(o)("records.totalPets")),1)])]),e("div",Be,[l[26]||(l[26]=e("div",{class:"stat-icon"},"ðŸ“¸",-1)),e("div",Oe,[e("h3",null,i(t(oe)),1),e("p",null,i(t(o)("records.totalMedia")),1)])])]),e("div",ze,[e("div",He,[e("div",qe,[P(e("select",{"onUpdate:modelValue":l[0]||(l[0]=s=>t(n).selectedPet=s),class:"filter-select",disabled:t(u).length===0},[e("option",Ge,i(t(u).length===0?t(o)("records.loading"):t(o)("records.allPets")),1),(m(!0),p(U,null,$(t(u),s=>(m(),p("option",{key:s.pid,value:s.pid},i(s.name),9,Je))),128))],8,We),[[A,t(n).selectedPet]]),t(u).length>0?(m(),p("small",Ke,i(t(o)("records.foundPets",{count:t(u).length})),1)):M("",!0)]),P(e("select",{"onUpdate:modelValue":l[1]||(l[1]=s=>t(n).selectedEventType=s),class:"filter-select"},[e("option",Ye,i(t(o)("records.allEvents")),1),e("option",Qe,i(t(o)("records.feeding")),1),e("option",Xe,i(t(o)("records.bathing")),1),e("option",Ze,i(t(o)("records.walking")),1),e("option",et,i(t(o)("records.veterinary")),1),e("option",tt,i(t(o)("records.playing")),1),e("option",ot,i(t(o)("records.vaccination")),1)],512),[[A,t(n).selectedEventType]]),P(e("select",{"onUpdate:modelValue":l[2]||(l[2]=s=>t(n).selectedMood=s),class:"filter-select"},[e("option",st,i(t(o)("records.allMood")),1),e("option",it,i(t(o)("records.happy")),1),e("option",lt,i(t(o)("records.angry")),1),e("option",nt,i(t(o)("records.tired")),1),e("option",at,i(t(o)("records.active")),1)],512),[[A,t(n).selectedMood]]),P(e("input",{type:"date","onUpdate:modelValue":l[3]||(l[3]=s=>t(n).selectedDate=s),class:"filter-input",placeholder:t(o)("records.selectDate")},null,8,rt),[[Z,t(n).selectedDate]])]),e("button",{class:"add-button",onClick:l[4]||(l[4]=s=>d.value=!0)},[l[27]||(l[27]=e("span",null,"+",-1)),ee(" "+i(t(o)("records.addEvent")),1)])]),e("div",dt,[e("div",ct,[e("button",{class:V({active:t(a)==="grid"}),onClick:l[5]||(l[5]=s=>a.value="grid")},i(t(o)("records.gridView")),3),e("button",{class:V({active:t(a)==="list"}),onClick:l[6]||(l[6]=s=>a.value="list")},i(t(o)("records.listView")),3),e("button",{class:V({active:t(a)==="timeline"}),onClick:l[7]||(l[7]=s=>a.value="timeline")},i(t(o)("records.timeline")),3)]),e("div",ut,[P(e("select",{"onUpdate:modelValue":l[8]||(l[8]=s=>fe(g)?g.value=s:null),class:"sort-select"},[e("option",pt,i(t(o)("records.sortByTime")),1),e("option",mt,i(t(o)("records.sortByType")),1),e("option",_t,i(t(o)("records.sortByMood")),1)],512),[[A,t(g)]])])]),e("div",vt,[t(a)==="grid"?(m(),p("div",gt,[(m(!0),p(U,null,$(t(Y),s=>(m(),p("div",{key:s.record_id,class:V(["event-card",s.mood?t(j)(s.mood):{}])},[e("div",ht,[e("div",ft,[e("h4",null,i(t(L)(s.pid,s.pet_name)),1),e("span",yt,i(s.event_type),1)]),s.mood?(m(),p("div",kt,[e("span",Et,i(t(H)(s.mood)),1),e("span",wt,i(s.mood),1)])):M("",!0)]),e("div",bt,[e("p",Mt,i(s.description),1),s.location?(m(),p("div",Ft,[l[28]||(l[28]=e("span",{class:"location-icon"},"ðŸ“",-1)),ee(" "+i(s.location),1)])):M("",!0)]),s.media_list&&s.media_list.length>0?(m(),p("div",It,[e("div",Tt,[(m(!0),p(U,null,$(s.media_list.slice(0,3),f=>(m(),p("div",{key:f.id,class:"media-item"},[f.media_type==="image"?(m(),p("img",{key:0,src:f.media_url,alt:s.event_type,onClick:y=>t(R)([],s.record_id),style:{cursor:"pointer"}},null,8,Ct)):f.media_type==="video"?(m(),p("video",{key:1,src:f.media_url,onClick:y=>t(R)([],s.record_id),style:{cursor:"pointer"}},null,8,Pt)):M("",!0)]))),128)),s.media_list.length>3?(m(),p("div",{key:0,class:"media-count",onClick:f=>t(R)([],s.record_id),style:{cursor:"pointer"}}," +"+i(s.media_list.length-3),9,St)):M("",!0)])])):M("",!0),e("div",Ut,[e("div",$t,[e("span",Dt,i(t(N)(s.record_time)),1),e("span",xt,i(t(o)("records.recordedAt"))+" "+i(t(N)(s.created_at)),1)]),e("div",Nt,[e("button",{class:"action-btn edit-btn",onClick:f=>t(q)(s)},i(t(o)("records.edit")),9,At),e("button",{class:"action-btn delete-btn",onClick:f=>t(W)(s.record_id),disabled:!s.record_id},i(t(o)("records.delete")),9,Vt)])])],2))),128))])):t(a)==="list"?(m(),p("div",Lt,[e("div",jt,[e("div",Rt,i(t(o)("records.pet")),1),e("div",Bt,i(t(o)("records.eventType")),1),e("div",Ot,i(t(o)("records.mood")),1),e("div",zt,i(t(o)("records.description")),1),e("div",Ht,i(t(o)("records.time")),1),e("div",qt,i(t(o)("records.actions")),1)]),(m(!0),p(U,null,$(t(Y),s=>(m(),p("div",{key:s.record_id,class:V(["list-item",s.mood?t(j)(s.mood):{}])},[e("div",Wt,[e("div",Gt,[e("h4",null,i(t(L)(s.pid,s.pet_name)),1)])]),e("div",Jt,[e("span",Kt,i(s.event_type),1)]),e("div",Yt,[s.mood?(m(),p("span",Qt,[e("span",Xt,i(t(H)(s.mood)),1),ee(" "+i(s.mood),1)])):M("",!0)]),e("div",Zt,[e("p",eo,i(s.description),1),s.location?(m(),p("div",to," ðŸ“ "+i(s.location),1)):M("",!0)]),e("div",oo,[e("span",so,i(t(N)(s.record_time)),1)]),e("div",io,[e("button",{class:"action-btn edit-btn",onClick:f=>t(q)(s)},i(t(o)("records.edit")),9,lo),e("button",{class:"action-btn delete-btn",onClick:f=>t(W)(s.record_id),disabled:!s.record_id},i(t(o)("records.delete")),9,no)])],2))),128))])):(m(),p("div",ao,[e("div",ro,[(m(!0),p(U,null,$(t(se),(s,f)=>(m(),p("div",{key:f,class:"timeline-group"},[e("div",co,i(t(N)(f)),1),e("div",uo,[(m(!0),p(U,null,$(s,y=>(m(),p("div",{key:y.record_id,class:V(["timeline-item",y.mood?t(j)(y.mood):{}])},[l[29]||(l[29]=e("div",{class:"timeline-marker"},null,-1)),e("div",po,[e("div",mo,[e("h4",null,i(t(L)(y.pid,y.pet_name)),1),e("span",_o,i(y.event_type),1),y.mood?(m(),p("span",vo,[e("span",go,i(t(H)(y.mood)),1),ee(" "+i(y.mood),1)])):M("",!0)]),e("p",ho,i(y.description),1),y.location?(m(),p("div",fo," ðŸ“ "+i(y.location),1)):M("",!0),e("div",yo,[e("span",ko,i(t(N)(y.record_time)),1),e("div",Eo,[e("button",{class:"action-btn edit-btn",onClick:B=>t(q)(y)},i(t(o)("records.edit")),9,wo),e("button",{class:"action-btn delete-btn",onClick:B=>t(W)(y.record_id),disabled:!y.record_id},i(t(o)("records.delete")),9,bo)])])])],2))),128))])]))),128))])]))]),t(d)||t(h)?(m(),p("div",{key:0,class:"modal-overlay",onClick:l[20]||(l[20]=(...s)=>t(x)&&t(x)(...s))},[e("div",{class:"modal-content",onClick:l[19]||(l[19]=de(()=>{},["stop"]))},[e("div",Mo,[e("h3",null,i(t(h)?t(o)("records.editEvent"):t(o)("records.addEvent")),1),e("button",{class:"close-btn",onClick:l[9]||(l[9]=(...s)=>t(x)&&t(x)(...s))},"Ã—")]),e("form",{onSubmit:l[18]||(l[18]=de((...s)=>t(Q)&&t(Q)(...s),["prevent"])),class:"modal-form"},[e("div",Fo,[e("label",null,i(t(o)("records.pet")),1),P(e("select",{"onUpdate:modelValue":l[10]||(l[10]=s=>t(E).pid=s),required:"",class:"form-select"},[e("option",Io,i(t(o)("records.selectPet")),1),(m(!0),p(U,null,$(t(u),s=>(m(),p("option",{key:s.pid,value:s.pid},i(s.name),9,To))),128))],512),[[A,t(E).pid]])]),e("div",Co,[e("label",null,i(t(o)("records.eventType")),1),P(e("select",{"onUpdate:modelValue":l[11]||(l[11]=s=>t(E).event_type=s),required:"",class:"form-select"},[e("option",Po,i(t(o)("records.selectType")),1),e("option",So,i(t(o)("records.feeding")),1),e("option",Uo,i(t(o)("records.bathing")),1),e("option",$o,i(t(o)("records.walking")),1),e("option",Do,i(t(o)("records.veterinary")),1),e("option",xo,i(t(o)("records.playing")),1),e("option",No,i(t(o)("records.vaccination")),1)],512),[[A,t(E).event_type]])]),e("div",Ao,[e("label",null,i(t(o)("records.mood")),1),P(e("select",{"onUpdate:modelValue":l[12]||(l[12]=s=>t(E).mood=s),class:"form-select"},[e("option",Vo,i(t(o)("records.selectMood")),1),e("option",Lo,i(t(o)("records.happy")),1),e("option",jo,i(t(o)("records.angry")),1),e("option",Ro,i(t(o)("records.tired")),1),e("option",Bo,i(t(o)("records.active")),1)],512),[[A,t(E).mood]])]),e("div",Oo,[e("label",null,i(t(o)("records.eventTime")),1),P(e("input",{type:"datetime-local","onUpdate:modelValue":l[13]||(l[13]=s=>t(E).record_time=s),required:"",class:"form-input"},null,512),[[Z,t(E).record_time]])]),e("div",zo,[e("label",null,i(t(o)("records.location")),1),P(e("input",{type:"text","onUpdate:modelValue":l[14]||(l[14]=s=>t(E).location=s),placeholder:t(o)("records.locationOptional"),class:"form-input"},null,8,Ho),[[Z,t(E).location]])]),e("div",qo,[e("label",null,i(t(o)("records.detailedDescription")),1),P(e("textarea",{"onUpdate:modelValue":l[15]||(l[15]=s=>t(E).description=s),rows:"4",placeholder:t(o)("records.pleaseEnterDescription"),required:"",class:"form-textarea"},null,8,Wo),[[Z,t(E).description]])]),e("div",Go,[e("label",null,i(t(o)("records.mediaFiles")),1),e("div",Jo,[e("div",Ko,[e("input",{type:"file",multiple:"",accept:"image/*,video/*",onChange:l[16]||(l[16]=(...s)=>t(F)&&t(F)(...s)),class:"file-input",id:"media-file-input"},null,32),e("label",Yo,[l[30]||(l[30]=e("div",{class:"upload-icon"},"ðŸ“",-1)),e("div",Qo,i(t(o)("records.clickToSelectOrDrag")),1),e("div",Xo,i(t(o)("records.supportedFormats")),1)])])]),t(T).length>0?(m(),p("div",Zo,[e("div",es,i(t(o)("records.uploadedFiles"))+" ("+i(t(T).length)+"/5)",1),e("div",ts,[(m(!0),p(U,null,$(t(T),(s,f)=>(m(),p("div",{key:f,class:"file-preview-item"},[e("div",os,[s.mediaType==="image"?(m(),p("img",{key:0,src:s.thumbnailUrl,alt:s.file.name,class:"preview-image"},null,8,ss)):(m(),p("div",is,[...l[31]||(l[31]=[e("span",{class:"video-icon"},"ðŸŽ¬",-1)])]))]),e("div",ls,[e("div",ns,[e("span",as,i(t(ae)(s.mediaType)),1),e("span",{class:"file-name",title:s.file.name},i(s.file.name),9,rs)]),e("div",ds,[e("span",cs,i(t(re)(s.file.size)),1),e("span",us,i(s.mediaType==="image"?"(å›¾ç‰‡)":"(è§†é¢‘)"),1)])]),e("button",{type:"button",onClick:y=>t(ne)(f),class:"remove-file-btn",title:t(o)("records.deleteFile")}," Ã— ",8,ps)]))),128))]),e("div",ms,i(t(T).length>=5?"å·²åˆ°è¾¾æœ€å¤§æ–‡ä»¶æ•°é™åˆ¶":`è¿˜å¯ä¸Šä¼  ${5-t(T).length} ä¸ªæ–‡ä»¶`),1)])):M("",!0)]),e("div",_s,[e("button",{type:"button",class:"cancel-btn",onClick:l[17]||(l[17]=(...s)=>t(x)&&t(x)(...s))},i(t(o)("records.cancel")),1),e("button",vs,i(t(h)?t(o)("records.update"):t(o)("records.save")),1)])],32)])])):M("",!0),t(w)?(m(),p("div",{key:1,class:"media-modal-overlay",onClick:l[23]||(l[23]=(...s)=>t(S)&&t(S)(...s))},[e("div",{class:"media-modal-content",onClick:l[22]||(l[22]=de(()=>{},["stop"]))},[e("div",gs,[e("h3",null,i(t(o)("records.mediaViewer")),1),e("button",{class:"close-btn",onClick:l[21]||(l[21]=(...s)=>t(S)&&t(S)(...s))},"Ã—")]),t(b)?(m(),p("div",hs,[...l[32]||(l[32]=[e("p",null,"æ­£åœ¨åŠ è½½åª’ä½“æ–‡ä»¶...",-1)])])):t(K).length===0?(m(),p("div",fs,[...l[33]||(l[33]=[e("p",null,"æ­¤äº‹ä»¶æ²¡æœ‰åª’ä½“æ–‡ä»¶",-1)])])):(m(),p("div",ys,[(m(!0),p(U,null,$(t(K),(s,f)=>(m(),p("div",{key:f,class:"media-item"},[s.media_type==="image"?(m(),p("img",{key:0,src:s.media_url,alt:`Media ${f+1}`},null,8,ks)):s.media_type==="video"?(m(),p("video",{key:1,src:s.media_url,controls:""},null,8,Es)):M("",!0)]))),128))]))])])):M("",!0)],2))}}),Fs=ye(ws,[["__scopeId","data-v-18f9be75"]]);export{Fs as default};
