import{u as A,k as I,h as _,E as g,J as E,d as T,v as M,c as C,o as h,a as s,t as n,l as a,O as V,z as S,F as $,f as L,e as b,w as y,r as w,n as O,g as z}from"./index-n6QoKQtw.js";import{useThemeStore as U}from"./theme-D8ZsPEis.js";import{s as x}from"./request-BS93o2BH.js";import{P as R}from"./Pagination-CmoWuIJY.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j=()=>{const{t:l}=A(),t=I();return{viewPetDetail:i=>{if(i)try{t.push({name:"user-pet-detail",params:{id:i}})}catch(c){g.error(l("message.loadPetDetailFailed")||"加载宠物详情失败"),console.error("跳转到宠物详情页失败:",c)}else g.error(l("message.petInfoIncomplete")),console.error("尝试查看宠物详情时，宠物ID不完整",i)}}},D=()=>{const l=_(!1),t=_([]),r=_(1),i=_(12),c=_(0),{t:o}=A(),d=async()=>{l.value=!0;try{const u=await x.get("/pets/info/available",{params:{current_page:r.value,per_page:i.value}});if(u.code===200){const m=u.data;t.value=m.records.map(e=>({pid:e.pid,name:e.name,species:e.species,breed:e.breed||o("message.unknown"),age:e.age,gender:e.gender==="公"?"male":e.gender==="母"?"female":e.gender,status:e.status==="UNADOPTED"?"available":e.status,shelterName:e.shelterName||o("message.unknownShelter"),shelterAddress:e.shelterAddress||o("message.unknownAddress")})),c.value=m.total,console.log("获取到未领养宠物数量:",t.value.length,"总数:",m.total)}else g.error(o("message.dataLoadFailed"))}catch(u){console.error("获取可领养宠物失败:",u),g.error(o("message.dataLoadFailedRetry"))}};return{loading:l,availablePets:t,currentPage:r,pageSize:i,total:c,fetchAvailablePets:d,handlePageChange:u=>{r.value=u,d()},handleSizeChange:u=>{i.value=u,r.value=1,d()}}},q=(l=null)=>{const{t}=A(),{fetchAvailablePets:r}=D();return{adoptPet:async c=>{try{await E.confirm(`${t("message.confirmAdoption")} ${c.name}？`,t("message.confirmAdoption"),{confirmButtonText:t("message.confirmButton"),cancelButtonText:t("message.cancelButton"),type:"warning"});const o=await x.post("/pets/adopt",null,{params:{petId:c.pid}});return o.code===200?(g.success(t("message.adoptionSuccess")),await r(),l&&l.value&&(l.value=l.value.filter(d=>d.pid!==c.pid)),!0):(g.error(o.message||t("message.adoptFailed")),!1)}catch(o){if(o!=="cancel"){const d=o.response?.data?.message;return d?.includes("已被领养")||d?.includes("已有领养记录")?(g.error(t("message.petAlreadyAdopted")||"该宠物已被其他人领养，页面将自动刷新"),await r()):g.error(d||t("message.adoptFailed")),!1}return!1}}}},G=()=>{const{viewPetDetail:l}=j(),{loading:t,availablePets:r,currentPage:i,pageSize:c,total:o,fetchAvailablePets:d,handlePageChange:v,handleSizeChange:f}=D(),{adoptPet:u}=q(r),m=U();return{viewPetDetail:l,loading:t,availablePets:r,currentPage:i,pageSize:c,total:o,fetchAvailablePets:d,handlePageChange:v,handleSizeChange:f,adoptPet:u,themeStore:m}},H={class:"adopt-pet-header"},K={class:"adopt-pet-main"},Q={class:"pets-grid"},W={class:"pet-header"},X={class:"pet-info"},Y={class:"info-item"},Z={class:"label"},ee={class:"value"},ae={class:"info-item"},se={class:"label"},te={class:"value"},ne={class:"info-item"},oe={class:"label"},re={class:"value"},le={class:"info-item"},ie={class:"label"},ce={class:"value"},de={class:"info-item"},pe={class:"label"},ue={class:"value"},ge={class:"pet-actions"},me={key:0,class:"no-pets"},_e={style:{"font-size":"14px",color:"var(--el-text-color-secondary)","margin-top":"10px"}},he=T({__name:"AdoptionsPets",setup(l){const{availablePets:t,currentPage:r,pageSize:i,total:c,themeStore:o,fetchAvailablePets:d,adoptPet:v,viewPetDetail:f,handlePageChange:u,handleSizeChange:m}=G(),{t:e}=A();return M(()=>{d()}),(ve,P)=>{const N=w("el-tag"),k=w("el-button"),B=w("el-empty");return h(),C("div",{class:O(["adopt-pet-container",{dark:a(o).preferences.theme==="dark"}])},[s("header",H,[s("h1",null,n(a(e)("nav.adoptCenter")),1)]),s("main",K,[s("div",Q,[(h(!0),C($,null,L(a(t),p=>(h(),C("div",{key:p.pid,class:"pet-card"},[s("div",W,[s("h3",null,n(p.name),1),b(N,{type:"success"},{default:y(()=>[z(n(a(e)("nav.adoptable")),1)]),_:1})]),s("div",X,[s("div",Y,[s("span",Z,n(a(e)("nav.breed"))+"：",1),s("span",ee,n(p.breed),1)]),s("div",ae,[s("span",se,n(a(e)("nav.age"))+"：",1),s("span",te,n(p.age)+" "+n(a(e)("message.yearsOld")),1)]),s("div",ne,[s("span",oe,n(a(e)("nav.gender"))+"：",1),s("span",re,n(p.gender==="male"?a(e)("message.male"):a(e)("message.female")),1)]),s("div",le,[s("span",ie,n(a(e)("nav.shelter"))+"：",1),s("span",ce,n(p.shelterName),1)]),s("div",de,[s("span",pe,n(a(e)("nav.address"))+"：",1),s("span",ue,n(p.shelterAddress),1)])]),s("div",ge,[b(k,{type:"primary",onClick:F=>a(v)(p)},{default:y(()=>[z(n(a(e)("nav.adoptNow")),1)]),_:1},8,["onClick"]),b(k,{onClick:F=>a(f)(p.pid)},{default:y(()=>[z(n(a(e)("nav.viewDetails")),1)]),_:1},8,["onClick"])])]))),128)),a(t).length===0?(h(),C("div",me,[b(B,{description:a(e)("nav.noPetsAvailable")},{description:y(()=>[s("p",null,n(a(e)("nav.noPetsAvailable")),1),s("p",_e,n(a(e)("nav.allPetsAdopted")),1)]),_:1},8,["description"])])):S("",!0)]),a(c)>0?(h(),V(R,{key:0,"current-page":a(r),"page-size":a(i),total:a(c),"page-sizes":[6,12,24,48],layout:"sizes, prev, pager, next, ->, total","onUpdate:currentPage":P[0]||(P[0]=p=>r.value=p),"onUpdate:pageSize":P[1]||(P[1]=p=>i.value=p),onPageChange:a(u),onSizeChange:a(m)},null,8,["current-page","page-size","total","onPageChange","onSizeChange"])):S("",!0)])],2)}}}),Ae=J(he,[["__scopeId","data-v-933f44b9"]]);export{Ae as default};
