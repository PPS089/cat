import{u as b,h as w,i as v,j as k,k as I,l as S,s as x,E as u,m as M,d as y,c as L,o as P,a as s,t as m,p as o,q as U,v as g,x as f,g as h,y as V,e as q,w as F,r as N,_ as C}from"./index-vX8o4tFx.js";const D=()=>{const p=M(),r=k(),{t}=b(),d=w(),i=v("/user");r.query.from?(i.value=r.query.from,console.log("检测到from参数，跳转到路径:",i.value)):console.log("没有from参数，使用默认路径:",i.value);const a=I({username:"",password:"",rememberMe:!1});return{t,form:a,routerPath:i,handleLogin:async()=>{try{const e=await x.post("/user/login",{username:a.username,password:a.password});console.log("登录响应数据:",e);const n=e.data;if(n.ok){const c=n.token;if(!c){console.error("登录响应中没有token字段"),u.error("登录失败：服务器未返回token");return}localStorage.setItem("userId",n.userId.toString()),localStorage.setItem("jwt_token",c),localStorage.setItem("token",c),localStorage.setItem("rememberedUsername",a.username),a.rememberMe&&localStorage.setItem("rememberedPassword",a.password),d.info.userId=n.userId,d.info.userName=n.userName||"",console.log("登录成功，开始获取完整用户资料..."),await d.fetchProfile(),console.log("用户登录成功，登录历史已记录到数据库，用户ID:",n.userId),await p.push(i.value),console.log(t("redirectSuccessTo"),i.value)}else u.error(n.message||t("loginFailed")),console.log(t("loginFailedServerReturn"),n.message)}catch(e){console.error("登录请求失败:",e),u.error(e.message||"网络错误，请检查网络连接")}},initForm:()=>{S(()=>{const e=localStorage.getItem("rememberedUsername"),n=localStorage.getItem("rememberedPassword");e&&n&&(a.username=e,a.password=n,a.rememberMe=!0)})}}},B={class:"login-container"},E={class:"login-box"},R={class:"login-header"},T={class:"form-group"},j={for:"username"},z=["placeholder"],A={class:"form-group"},G={for:"password"},H=["placeholder"],J={class:"form-group remember-me"},K={class:"checkbox-label"},O={type:"submit",class:"login-btn"},Q={class:"register-link"},W=y({__name:"Login",setup(p){const{t:r,form:t,handleLogin:d,initForm:i}=D();return i(),(a,l)=>{const _=N("router-link");return P(),L("div",B,[s("div",E,[s("div",R,[s("h2",null,m(o(r)("login.title")),1)]),s("form",{onSubmit:l[3]||(l[3]=U((...e)=>o(d)&&o(d)(...e),["prevent"])),class:"login-form"},[s("div",T,[s("label",j,m(o(r)("login.username"))+":",1),g(s("input",{type:"text",id:"username","onUpdate:modelValue":l[0]||(l[0]=e=>o(t).username=e),required:"",placeholder:o(r)("login.usernamePlaceholder")},null,8,z),[[f,o(t).username]])]),s("div",A,[s("label",G,m(o(r)("login.password"))+":",1),g(s("input",{type:"password",id:"password","onUpdate:modelValue":l[1]||(l[1]=e=>o(t).password=e),required:"",placeholder:o(r)("login.passwordPlaceholder")},null,8,H),[[f,o(t).password]])]),s("div",J,[s("label",K,[g(s("input",{type:"checkbox","onUpdate:modelValue":l[2]||(l[2]=e=>o(t).rememberMe=e)},null,512),[[V,o(t).rememberMe]]),h(" "+m(o(r)("login.rememberMe")),1)])]),s("button",O,m(o(r)("login.userLogin")),1),s("div",Q,[q(_,{to:"/register"},{default:F(()=>[h(m(o(r)("login.register")),1)]),_:1})])],32)])])}}}),Y=C(W,[["__scopeId","data-v-c251f3ac"]]);export{Y as default};
