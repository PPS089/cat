import{u as j,h as y,E as f,J as q,k as H,d as K,l as Q,x as W,c as g,o as i,a as n,O as R,z as b,e as w,m as t,F as $,f as G,n as X,w as k,U as J,r as P,g as M,t as d,_ as Y}from"./index-CrXZUvVt.js";import{s as D}from"./request-BfQTpaIP.js";import{useThemeStore as Z}from"./theme-JQFcjW0Q.js";import{P as ee}from"./Pagination-DJGTQf6N.js";function se(){const x=H(),{t:a}=j(),u=y([]),C=y([]),v=y(!1),p=y(null),_=y(null),h=y(1),S=y(5),c=y(0),m=y(0),N=()=>{x.push("/user/adoption-pets")},V=e=>{x.push(`pets/edit/${e}`)},E=async e=>{try{p.value=e,v.value=!0,_.value=null;const l=await D.get("/shelters");if(l.code===200){const r=l.data;C.value=r.map(o=>({sid:o.sid,shelterName:o.shelterName,shelterAddress:o.shelterAddress})),f.success(a("common.pleaseSelectShelter"))}}catch{f.error(a("getShelterListFailed"))}},z=async()=>{if(!_.value){f.warning(a("common.pleaseSelectShelter"));return}if(!p.value){f.warning(a("petNotSelected"));return}try{const e={shelterId:_.value,startDate:new Date().toISOString().split("T")[0]};if((await D.post(`/pets/${p.value.pid}/foster`,e)).code===200){f.success(a("fosterSuccess"));const r=p.value.pid;r&&(u.value=u.value.map(o=>o.pid===r?{...o,isFostering:!0}:o)),v.value=!1,p.value=null,_.value=null,await F()}else f.error(a("fosterFailed"))}catch(e){f.error(e.response?.data?.msg||a("fosterFailed"))}},I=async e=>{if(console.log("åˆ†é¡µåˆ‡æ¢è¯·æ±‚ - é¡µç :",e,"å½“å‰é¡µ:",h.value,"æ€»é¡µæ•°:",m.value),e<1||m.value>0&&e>m.value){console.log("åˆ†é¡µåˆ‡æ¢è¢«æ‹’ç» - é¡µç è¶…å‡ºèŒƒå›´");return}await F(e,S.value)},B=async e=>{console.log("æ¯é¡µæ•°é‡å˜æ›´ - æ–°å°ºå¯¸:",e),await F(1,e)},T=async e=>{try{if(await q.confirm(a("message.confirmEndFoster"),a("message.warning"),{confirmButtonText:a("message.confirm"),cancelButtonText:a("message.cancel"),type:"warning"}),console.log(a("callingSimplifiedEndFosterApi"),e.pid),(await D.post(`/pets/${e.pid}/foster/end`)).code===200){f.success(a("message.endFosterSuccess"));const r=e.pid;r&&(u.value=u.value.map(o=>o.pid===r?{...o,isFostering:!1}:o)),await F()}}catch(l){l!=="cancel"&&(console.error(a("endFosterApiFailed"),l),f.error(a("endFosterFailed")))}},F=async(e=h.value,l=S.value)=>{try{console.log(`å¼€å§‹è·å–ç”¨æˆ·é¢†å…»å® ç‰©æ•°æ® - é¡µç : ${e}, æ¯é¡µæ•°é‡: ${l}`),e<1&&(console.warn("é¡µç ä¸èƒ½å°äº1ï¼Œè‡ªåŠ¨è°ƒæ•´ä¸º1"),e=1),l<1&&(console.warn("æ¯é¡µæ•°é‡ä¸èƒ½å°äº1ï¼Œè‡ªåŠ¨è°ƒæ•´ä¸º5"),l=5);const r=await D.get(`/user/adoptions?current_page=${e}&per_page=${l}`);console.log("è·å–åˆ°ç”¨æˆ·é¢†å…»å® ç‰©åˆ†é¡µç»“æœ:",r);const o=r.data;console.log("å“åº”æ•°æ®ç»“æ„:",JSON.stringify(o,null,2)),!o.records||o.records.length===0?(console.log("ç”¨æˆ·è¿˜æ²¡æœ‰é¢†å…»ä»»ä½•å® ç‰©"),u.value=[],c.value=o.total||0,m.value=o.pages||0):(u.value=o.records||[],console.log("è·å–åˆ°ç”¨æˆ·é¢†å…»å® ç‰©æ•°é‡:",o.records?.length||0),c.value=o.total||0,m.value=o.pages||0),h.value=e,S.value=l,console.log(`åˆ†é¡µçŠ¶æ€æ›´æ–°å®Œæˆ - å½“å‰é¡µ: ${h.value}, æ¯é¡µ: ${S.value}, æ€»æ•°: ${c.value}, æ€»é¡µæ•°: ${m.value}`)}catch(r){if(console.error("è·å–å® ç‰©æ•°æ®å¤±è´¥:",r),r.name==="AbortError")return;u.value=[],c.value=0,m.value=0,f.error(a("getPetDataFailed")||"è·å–å® ç‰©æ•°æ®å¤±è´¥")}};return{pets:u,shelters:C,showFosterDialog:v,selectedShelter:_,currentPage:h,pageSize:S,total:c,t:a,addPet:N,editPet:V,startFoster:E,endFoster:T,confirmStartFoster:z,fetchPets:F,handlePageChange:I,handlePageSizeChange:B}}const te={class:"pets-main"},oe={class:"pets-list"},ae={key:0,class:"empty-state"},le={key:1,class:"pets-grid"},ne={class:"pet-image"},re=["src","alt"],ce={class:"pet-info"},ie={key:0,class:"fostering-indicator"},de={class:"pet-breed"},ue={class:"pet-age"},ge={key:0,class:"pet-date"},pe={key:1,class:"pet-shelter"},me={class:"pet-actions"},fe=["onClick"],ve={class:"foster-status"},_e=["onClick"],he=["onClick"],Se={class:"dialog-footer"},ye=K({__name:"Mypets",setup(x){const a=Z(),{pets:u,shelters:C,showFosterDialog:v,selectedShelter:p,currentPage:_,pageSize:h,total:S,t:c,addPet:m,editPet:N,startFoster:V,confirmStartFoster:E,endFoster:z,fetchPets:I,handlePageChange:B,handlePageSizeChange:T}=se();return Q(async()=>{I()}),W([_,h,S],([F,e,l],[r,o,A])=>{console.log("åˆ†é¡µçŠ¶æ€å˜åŒ–:",{currentPage:{old:r,new:F},pageSize:{old:o,new:e},total:{old:A,new:l}})}),(F,e)=>{const l=P("el-option"),r=P("el-select"),o=P("el-form-item"),A=P("el-form"),O=P("el-button"),L=P("el-dialog");return i(),g($,null,[n("div",{class:X(["pets-container",{dark:t(a).preferences.theme==="dark"}])},[e[8]||(e[8]=n("header",{class:"pets-header"},[n("h1",null,"æˆ‘çš„é¢†å…»å® ç‰©")],-1)),n("main",te,[n("div",oe,[t(u).length===0?(i(),g("div",ae,[e[6]||(e[6]=n("p",null,"æš‚æ— é¢†å…»çš„å® ç‰©",-1)),n("button",{onClick:e[0]||(e[0]=(...s)=>t(m)&&t(m)(...s)),class:"add-first-pet-btn"},"å»é¢†å…»å® ç‰©")])):(i(),g("div",le,[(i(!0),g($,null,G(t(u),s=>(i(),g("div",{key:s.pid,class:"pet-card"},[n("div",ne,[n("img",{src:s.image||"/src/assets/img/dog.jpg",alt:s.name},null,8,re),e[7]||(e[7]=n("div",{class:"pet-type-badge adoption"}," é¢†å…» ",-1))]),n("div",ce,[n("h3",null,[M(d(s.name)+" ",1),s.petStatus==="FOSTERING"||s.isFostering?(i(),g("span",ie,"(å¯„å…»ä¸­)")):b("",!0)]),n("p",de,d(s.breed),1),n("p",ue,d(s.age)+"å²",1),s.adoptionDate?(i(),g("p",ge,d(t(c)("message.adoptDate"))+": "+d(s.adoptionDate),1)):b("",!0),s.sname?(i(),g("p",pe,d(t(c)("message.shelter"))+": "+d(s.sname),1)):b("",!0),n("div",me,[s.petStatus==="FOSTERING"||s.isFostering?(i(),g($,{key:0},[n("button",{onClick:U=>t(z)(s),class:"end-foster-btn"},d(t(c)("message.endFoster")),9,fe),n("div",ve,"ğŸ  "+d(t(c)("message.fostering")),1)],64)):(i(),g("button",{key:1,onClick:U=>t(V)(s),class:"start-foster-btn"},d(t(c)("message.startFoster")),9,_e)),n("button",{onClick:U=>t(N)(s.pid),class:"edit-btn"},d(t(c)("message.edit")),9,he)])])]))),128))]))])])],2),t(S)>0?(i(),R(ee,{key:0,"current-page":t(_),"page-size":t(h),total:t(S),"page-sizes":[5,10,20,50],"onUpdate:currentPage":e[1]||(e[1]=s=>_.value=s),"onUpdate:pageSize":e[2]||(e[2]=s=>h.value=s),onPageChange:t(B),onSizeChange:t(T)},null,8,["current-page","page-size","total","onPageChange","onSizeChange"])):b("",!0),w(L,{modelValue:t(v),"onUpdate:modelValue":e[5]||(e[5]=s=>J(v)?v.value=s:null),title:t(c)("message.startFoster"),width:"500px","before-close":()=>v.value=!1},{footer:k(()=>[n("span",Se,[w(O,{onClick:e[4]||(e[4]=s=>v.value=!1)},{default:k(()=>[M(d(t(c)("message.cancel")),1)]),_:1}),w(O,{type:"primary",onClick:t(E)},{default:k(()=>[M(d(t(c)("message.confirm")),1)]),_:1},8,["onClick"])])]),default:k(()=>[w(A,{model:{selectedShelter:t(p)},"label-width":"120px"},{default:k(()=>[w(o,{label:t(c)("message.selectShelter")},{default:k(()=>[w(r,{modelValue:t(p),"onUpdate:modelValue":e[3]||(e[3]=s=>J(p)?p.value=s:null),placeholder:"è¯·é€‰æ‹©æ”¶å®¹æ‰€",style:{width:"100%"}},{default:k(()=>[w(l,{label:"è¯·é€‰æ‹©æ”¶å®¹æ‰€",value:null}),(i(!0),g($,null,G(t(C),s=>(i(),R(l,{key:s.sid,label:`${s.shelterName} - ${s.shelterAddress}`,value:s.sid},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title","before-close"])],64)}}}),Ce=Y(ye,[["__scopeId","data-v-3e7a0ff4"]]);export{Ce as default};
