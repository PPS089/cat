import{_ as P}from"./dog-CLIpk0wi.js";import{u as U,h as S,i as F,j as N,k as C,E as h,l as y,d as R,c as T,o as j,a as t,t as d,m as e,e as s,w as a,r as u,g as p,p as q,q as z,_ as B}from"./index-BSW2uGQz.js";import{u as E}from"./user-Q_984HoY.js";import{s as D}from"./request-qgYNvrL7.js";const A=()=>{const w=y(),_=F(),{t:m}=U(),o=E(),r=S("/user");_.query.from&&(r.value=_.query.from);const n=N({username:"",password:"",rememberMe:!1});return{t:m,form:n,routerPath:r,handleLogin:async()=>{try{const i=(await D.post("/user/login",{username:n.username,password:n.password})).data;if(i.ok){const l=i.token;if(!l){console.error("登录响应中没有token字段"),h.error("登录失败：服务器未返回token");return}localStorage.removeItem("jwt_token"),localStorage.removeItem("token"),localStorage.removeItem("userId"),localStorage.removeItem("userInfo"),localStorage.removeItem("userName"),localStorage.removeItem("username"),localStorage.setItem("userId",i.userId.toString()),localStorage.setItem("jwt_token",l),localStorage.setItem("token",l),localStorage.setItem("rememberedUsername",n.username),n.rememberMe&&localStorage.setItem("rememberedPassword",n.password),o.info.userId=i.userId,o.info.userName=i.userName||"",console.log("登录成功，开始获取完整用户资料..."),await o.fetchProfile(),await w.push(r.value),console.log(m("redirectSuccessTo"),r.value)}else h.error(i.message||m("loginFailed")),console.log(m("loginFailedServerReturn"),i.message)}catch(c){console.error("登录请求失败:",c),h.error(c.message||"网络错误，请检查网络连接")}},initForm:()=>{C(()=>{const c=localStorage.getItem("rememberedUsername"),i=localStorage.getItem("rememberedPassword");c&&i&&(n.username=c,n.password=i,n.rememberMe=!0)})}}},H={class:"login-container"},G={class:"login-card"},J={class:"login-left"},K={class:"image-container"},O={class:"image-overlay"},Q={class:"welcome-title"},W={class:"welcome-subtitle"},X={class:"login-right"},Y={class:"form-header"},Z={class:"form-title"},$={class:"form-subtitle"},ee={class:"form-footer"},oe={class:"register-text"},se=R({__name:"Login",setup(w){const _=y(),m=S(!1),{t:o,form:r,handleLogin:n,initForm:b}=A();b();const v=async()=>{m.value=!0;try{await n()}finally{m.value=!1}},c=()=>{_.push("/register")};return(i,l)=>{const k=u("el-icon"),I=u("el-input"),f=u("el-form-item"),V=u("el-checkbox"),x=u("el-button"),L=u("el-form"),M=u("el-link");return j(),T("div",H,[t("div",G,[t("div",J,[t("div",K,[l[3]||(l[3]=t("img",{src:P,alt:"宠物",class:"login-image"},null,-1)),t("div",O,[t("h1",Q,d(e(o)("login.welcomeTitle")||"欢迎回来"),1),t("p",W,d(e(o)("login.welcomeSubtitle")||"登录您的账户，继续您的宠物之旅"),1)])])]),t("div",X,[t("div",Y,[t("h2",Z,d(e(o)("login.title")),1),t("p",$,d(e(o)("login.subtitle")||"请输入您的账户信息"),1)]),s(L,{model:e(r),ref:"loginForm","label-width":"0",class:"login-form"},{default:a(()=>[s(f,null,{default:a(()=>[s(I,{modelValue:e(r).username,"onUpdate:modelValue":l[0]||(l[0]=g=>e(r).username=g),placeholder:e(o)("login.usernamePlaceholder"),size:"large"},{prefix:a(()=>[s(k,null,{default:a(()=>[s(e(q))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),s(f,null,{default:a(()=>[s(I,{modelValue:e(r).password,"onUpdate:modelValue":l[1]||(l[1]=g=>e(r).password=g),type:"password",placeholder:e(o)("login.passwordPlaceholder"),size:"large","show-password":""},{prefix:a(()=>[s(k,null,{default:a(()=>[s(e(z))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),s(f,{class:"remember-me-item"},{default:a(()=>[s(V,{modelValue:e(r).rememberMe,"onUpdate:modelValue":l[2]||(l[2]=g=>e(r).rememberMe=g),class:"remember-me-checkbox"},{default:a(()=>[p(d(e(o)("login.rememberMe")),1)]),_:1},8,["modelValue"])]),_:1}),s(f,null,{default:a(()=>[s(x,{type:"primary",onClick:v,size:"large",class:"submit-btn",loading:m.value},{default:a(()=>[p(d(e(o)("login.userLogin")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),t("div",ee,[t("p",oe,[p(d(e(o)("login.noAccount")||"还没有账户？")+" ",1),s(M,{type:"primary",onClick:c,underline:!1},{default:a(()=>[p(d(e(o)("login.registerLink")),1)]),_:1})])])])])])}}}),ne=B(se,[["__scopeId","data-v-a3c1f13f"]]);export{ne as default};
