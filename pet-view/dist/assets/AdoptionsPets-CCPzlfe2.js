import{u as A,m as I,i as _,E as u,s as x,P as T,d as E,l as M,c as b,o as h,a,t as o,p as s,T as V,H as k,F as $,f as L,e as C,w as y,r as w,n as U,g as z,_ as O}from"./index-vX8o4tFx.js";import{useThemeStore as R}from"./theme-BuSJrrmb.js";import{P as H}from"./Pagination-D5dvJ28X.js";const j=()=>{const{t:p}=A(),t=I();return{viewPetDetail:r=>{if(r)try{t.push({name:"user-pet-detail",params:{id:r}})}catch(c){u.error(p("message.loadPetDetailFailed")||"加载宠物详情失败"),console.error("跳转到宠物详情页失败:",c)}else u.error(p("message.petInfoIncomplete")),console.error("尝试查看宠物详情时，宠物ID不完整",r)}}},D=()=>{const p=_(!1),t=_([]),l=_(1),r=_(12),c=_(0),{t:n}=A(),i=async()=>{p.value=!0;try{const g=await x.get("/pets/info/available",{params:{current_page:l.value,per_page:r.value}});if(g.code===200){const m=g.data;t.value=m.records.map(e=>({pid:e.pid,name:e.name,species:e.species,breed:e.breed||n("message.unknown"),age:e.age,gender:e.gender==="公"?"male":e.gender==="母"?"female":e.gender,status:e.status==="UNADOPTED"?"available":e.status,shelterName:e.shelterName||n("message.unknownShelter"),shelterAddress:e.shelterAddress||n("message.unknownAddress")})),c.value=m.total,console.log("获取到未领养宠物数量:",t.value.length,"总数:",m.total)}else u.error(n("message.dataLoadFailed"))}catch(g){console.error("获取可领养宠物失败:",g),u.error(n("message.dataLoadFailedRetry"))}};return{loading:p,availablePets:t,currentPage:l,pageSize:r,total:c,fetchAvailablePets:i,handlePageChange:g=>{l.value=g,i()},handleSizeChange:g=>{r.value=g,l.value=1,i()}}},q=(p=null)=>{const{t}=A(),{fetchAvailablePets:l}=D();return{adoptPet:async c=>{try{await T.confirm(`${t("message.confirmAdoption")} ${c.name}？`,t("message.confirmAdoption"),{confirmButtonText:t("message.confirmButton"),cancelButtonText:t("message.cancelButton"),type:"warning"});const n=await x.post("/pets/adopt",null,{params:{petId:c.pid}});return n.code===200?(console.log("领养成功，开始显示成功消息"),u.success(t("message.adoptionSuccess")),await l(),p&&(p.value=p.value.filter(i=>i.pid!==c.pid)),!0):(console.log("领养失败，响应码:",n.code,"消息:",n.message),u.error(n.message||t("message.adoptFailed")),!1)}catch(n){if(n!=="cancel"){const i=n.response?.data?.msg||n.response?.data?.message;return i?.includes("已被领养")||i?.includes("已有领养记录")?(u.error(t("message.petAlreadyAdopted")||"该宠物已被其他人领养，页面将自动刷新"),await l()):u.error(i||t("message.adoptFailed")),!1}return!1}}}},G=()=>{const{viewPetDetail:p}=j(),{loading:t,availablePets:l,currentPage:r,pageSize:c,total:n,fetchAvailablePets:i,handlePageChange:v,handleSizeChange:f}=D(),{adoptPet:g}=q(l),m=R();return{viewPetDetail:p,loading:t,availablePets:l,currentPage:r,pageSize:c,total:n,fetchAvailablePets:i,handlePageChange:v,handleSizeChange:f,adoptPet:g,themeStore:m}},J={class:"adopt-pet-header"},K={class:"adopt-pet-main"},Q={class:"pets-grid"},W={class:"pet-header"},X={class:"pet-info"},Y={class:"info-item"},Z={class:"label"},ee={class:"value"},se={class:"info-item"},ae={class:"label"},te={class:"value"},ne={class:"info-item"},oe={class:"label"},le={class:"value"},re={class:"info-item"},ce={class:"label"},ie={class:"value"},de={class:"info-item"},pe={class:"label"},ge={class:"value"},ue={class:"pet-actions"},me={key:0,class:"no-pets"},_e={style:{"font-size":"14px",color:"var(--el-text-color-secondary)","margin-top":"10px"}},he=E({__name:"AdoptionsPets",setup(p){const{availablePets:t,currentPage:l,pageSize:r,total:c,themeStore:n,fetchAvailablePets:i,adoptPet:v,viewPetDetail:f,handlePageChange:g,handleSizeChange:m}=G(),{t:e}=A();return M(()=>{i()}),(ve,P)=>{const N=w("el-tag"),S=w("el-button"),B=w("el-empty");return h(),b("div",{class:U(["adopt-pet-container",{dark:s(n).preferences.theme==="dark"}])},[a("header",J,[a("h1",null,o(s(e)("nav.adoptCenter")),1)]),a("main",K,[a("div",Q,[(h(!0),b($,null,L(s(t),d=>(h(),b("div",{key:d.pid,class:"pet-card"},[a("div",W,[a("h3",null,o(d.name),1),C(N,{type:"success"},{default:y(()=>[z(o(s(e)("nav.adoptable")),1)]),_:1})]),a("div",X,[a("div",Y,[a("span",Z,o(s(e)("nav.breed"))+"：",1),a("span",ee,o(d.breed),1)]),a("div",se,[a("span",ae,o(s(e)("nav.age"))+"：",1),a("span",te,o(d.age)+" "+o(s(e)("message.yearsOld")),1)]),a("div",ne,[a("span",oe,o(s(e)("nav.gender"))+"：",1),a("span",le,o(d.gender==="male"?s(e)("message.male"):s(e)("message.female")),1)]),a("div",re,[a("span",ce,o(s(e)("nav.shelter"))+"：",1),a("span",ie,o(d.shelterName),1)]),a("div",de,[a("span",pe,o(s(e)("nav.address"))+"：",1),a("span",ge,o(d.shelterAddress),1)])]),a("div",ue,[C(S,{type:"primary",onClick:F=>s(v)(d)},{default:y(()=>[z(o(s(e)("nav.adoptNow")),1)]),_:1},8,["onClick"]),C(S,{onClick:F=>s(f)(d.pid)},{default:y(()=>[z(o(s(e)("nav.viewDetails")),1)]),_:1},8,["onClick"])])]))),128)),s(t).length===0?(h(),b("div",me,[C(B,{description:s(e)("nav.noPetsAvailable")},{description:y(()=>[a("p",null,o(s(e)("nav.noPetsAvailable")),1),a("p",_e,o(s(e)("nav.allPetsAdopted")),1)]),_:1},8,["description"])])):k("",!0)]),s(c)>0?(h(),V(H,{key:0,"current-page":s(l),"page-size":s(r),total:s(c),"page-sizes":[6,12,24,48],layout:"sizes, prev, pager, next, ->, total","onUpdate:currentPage":P[0]||(P[0]=d=>l.value=d),"onUpdate:pageSize":P[1]||(P[1]=d=>r.value=d),onPageChange:s(g),onSizeChange:s(m)},null,8,["current-page","page-size","total","onPageChange","onSizeChange"])):k("",!0)])],2)}}}),Ce=O(he,[["__scopeId","data-v-e6bd8d93"]]);export{Ce as default};
