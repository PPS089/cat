import{_ as L}from"./dog-CLIpk0wi.js";import{u as N,h as k,i as P,j as U,E as _,k as y,d as F,l as T,c as j,o as q,a,t as c,m as e,e as t,w as i,r as d,g as h,p as z,q as B,_ as E}from"./index-CrXZUvVt.js";import{u as R}from"./user-Dpyi1MhF.js";import{s as D}from"./request-BfQTpaIP.js";const A=()=>{const w=y(),f=P(),{t:u}=N(),s=R(),n=k("/user");f.query.from&&(n.value=f.query.from);const r=U({username:"",password:"",rememberMe:!1});return{t:u,form:r,routerPath:n,handleLogin:async()=>{try{if(!r.username.trim()){_.warning({message:"请输入用户名",showClose:!0,duration:3e3});return}if(!r.password.trim()){_.warning({message:"请输入密码",showClose:!0,duration:3e3});return}const l=(await D.post("/user/login",{username:r.username,password:r.password})).data;if(l.ok){const o=l.token;if(!o){_.error({message:"登录失败：服务器响应异常，请稍后重试",showClose:!0,duration:5e3});return}localStorage.removeItem("jwt_token"),localStorage.removeItem("userId"),localStorage.removeItem("rememberedUsername"),localStorage.removeItem("rememberedPassword"),localStorage.setItem("userId",l.userId.toString()),localStorage.setItem("jwt_token",o),r.rememberMe&&(localStorage.setItem("rememberedUsername",l.userName||""),localStorage.setItem("rememberedPassword",r.password)),s.info.userId=l.userId,s.info.userName=l.userName||"",localStorage.setItem("userInfo",JSON.stringify(s.info)),console.log("登录成功，开始获取完整用户资料..."),await s.fetchProfile(),_.success({message:`欢迎回来，${l.userName||"用户"}！`,showClose:!0,duration:2e3}),await w.push(n.value),console.log(u("redirectSuccessTo"),n.value)}}catch(m){console.error("登录请求失败:",m),_.error({message:"用户名或密码错误，请检查后重新输入",showClose:!0,duration:5e3})}},initForm:()=>{console.log("initForm called");try{const o="test";localStorage.setItem(o,"test"),localStorage.removeItem(o)}catch(o){console.error("localStorage is not available:",o);return}const m=localStorage.getItem("rememberedUsername"),l=localStorage.getItem("rememberedPassword");console.log("Checking localStorage for remembered credentials:",{rememberedUsername:m,rememberedPassword:l}),m&&l?(r.username=m,r.password=l,r.rememberMe=!0,console.log("Form populated with remembered credentials:",{username:r.username,hasPassword:!!r.password,rememberMe:r.rememberMe})):console.log("No remembered credentials found in localStorage")}}},H={class:"login-container"},J={class:"login-card"},K={class:"login-left"},O={class:"image-container"},$={class:"image-overlay"},G={class:"welcome-title"},Q={class:"welcome-subtitle"},W={class:"login-right"},X={class:"form-header"},Y={class:"form-title"},Z={class:"form-subtitle"},ee={class:"form-footer"},oe={class:"register-text"},se=F({__name:"Login",setup(w){const f=y(),u=k(!1),{t:s,form:n,handleLogin:r,initForm:b}=A();T(()=>{console.log("Login component mounted"),setTimeout(()=>{console.log("Calling initForm after delay"),b()},100)});const v=async()=>{u.value=!0;try{await r()}finally{u.value=!1}},m=()=>{f.push("/register")};return(l,o)=>{const S=d("el-icon"),I=d("el-input"),p=d("el-form-item"),C=d("el-checkbox"),M=d("el-button"),V=d("el-form"),x=d("el-link");return q(),j("div",H,[a("div",J,[a("div",K,[a("div",O,[o[3]||(o[3]=a("img",{src:L,alt:"宠物",class:"login-image"},null,-1)),a("div",$,[a("h1",G,c(e(s)("login.welcomeTitle")||"欢迎回来"),1),a("p",Q,c(e(s)("login.welcomeSubtitle")||"登录您的账户，继续您的宠物之旅"),1)])])]),a("div",W,[a("div",X,[a("h2",Y,c(e(s)("login.title")),1),a("p",Z,c(e(s)("login.subtitle")||"请输入您的账户信息"),1)]),t(V,{model:e(n),ref:"loginForm","label-width":"0",class:"login-form"},{default:i(()=>[t(p,null,{default:i(()=>[t(I,{modelValue:e(n).username,"onUpdate:modelValue":o[0]||(o[0]=g=>e(n).username=g),placeholder:e(s)("login.usernamePlaceholder"),size:"large"},{prefix:i(()=>[t(S,null,{default:i(()=>[t(e(z))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),t(p,null,{default:i(()=>[t(I,{modelValue:e(n).password,"onUpdate:modelValue":o[1]||(o[1]=g=>e(n).password=g),type:"password",placeholder:e(s)("login.passwordPlaceholder"),size:"large","show-password":""},{prefix:i(()=>[t(S,null,{default:i(()=>[t(e(B))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),t(p,{class:"remember-me-item"},{default:i(()=>[t(C,{modelValue:e(n).rememberMe,"onUpdate:modelValue":o[2]||(o[2]=g=>e(n).rememberMe=g),class:"remember-me-checkbox"},{default:i(()=>[h(c(e(s)("login.rememberMe")),1)]),_:1},8,["modelValue"])]),_:1}),t(p,null,{default:i(()=>[t(M,{type:"primary",onClick:v,size:"large",class:"submit-btn",loading:u.value},{default:i(()=>[h(c(e(s)("login.userLogin")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),a("div",ee,[a("p",oe,[h(c(e(s)("login.noAccount")||"还没有账户？")+" ",1),t(x,{type:"primary",onClick:m,underline:!1},{default:i(()=>[h(c(e(s)("login.registerLink")),1)]),_:1})])])])])])}}}),ne=E(se,[["__scopeId","data-v-69afe3f5"]]);export{ne as default};
