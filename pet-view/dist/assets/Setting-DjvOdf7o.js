import{u as ee,h as V,j as q,k as W,E as g,d as se,c as P,o as S,a as t,t as l,m as e,e as s,w as a,U as te,r as v,q as ae,g as y,D as ne,a3 as k,z as G,a4 as oe,F as O,f as Q,G as le,a5 as ie,a6 as re,O as $,a7 as de,a8 as ce,a9 as ue,aa as J,ab as ge,Q as _e,ac as me,n as fe,A as pe,_ as he}from"./index-C-QPrTeL.js";import{u as ve}from"./user-CgNrBVWj.js";import{useThemeStore as ye}from"./theme-DZbca66G.js";import{s as K}from"./request-C9ntlt9z.js";const we=()=>{const{t:r,locale:n}=ee(),L=ve(),h=ye(),b=V([]),x=V("login-history"),T=V(!1),w=V(!1),c=V(!1),U=V(!1),_=q({currentPassword:"",newPassword:"",confirmPassword:""}),E=[{name:"default",value:"#409EFF"},{name:"green",value:"#67C23A"},{name:"orange",value:"#E6A23C"},{name:"red",value:"#F56C6C"},{name:"purple",value:"#9B59B6"}],u=q({language:"zh-CN",theme:"light",primaryColor:"#409EFF",fontSize:14,animations:!0,compactMode:!1}),A=async()=>{if(!_.currentPassword||!_.newPassword||!_.confirmPassword){g.error(r("settings.passwordRequired"));return}if(_.newPassword!==_.confirmPassword){g.error(r("settings.passwordMismatch"));return}if(_.newPassword.length<6){g.error(r("settings.passwordLengthError"));return}T.value=!0;try{await L.changePassword(_),g.success(r("settings.passwordChanged")),_.currentPassword="",_.newPassword="",_.confirmPassword=""}catch(o){g.error(r("settings.passwordChangeFailed")+(o.message?": "+o.message:""))}finally{T.value=!1}},z=async()=>{try{const o=await K.get("/login-history");o.code==200?(b.value=o.data.map(m=>({id:m.id,userId:m.userId,loginTime:m.loginTime,device:m.device||"Unknown Device",location:m.location||"Unknown Location",ipAddress:m.ipAddress||"0.0.0.0",status:m.status||"SUCCESS"})),console.log("登录历史处理完成，记录数:",b.value.length)):(console.warn("登录历史数据不是数组格式，使用空数组"),b.value=[])}catch(o){console.error("获取登录历史失败:",o),b.value=[],o.message==="未授权"?g.warning(r("settings.pleaseLoginToViewHistory")||"请先登录后查看登录历史"):g.error(r("settings.networkErrorUnableToGetLoginHistory"))}},M=async()=>{try{const o=await K.delete("/login-history/clear");o.code===200?(g.success(r("settings.historyCleared")),b.value=[]):g.error(r("settings.clearHistoryFailed")+": "+o.message)}catch(o){console.error("清除登录历史错误:",o),g.error(r("settings.clearHistoryFailed"))}},H=async()=>{try{console.log(r("settings.loadingPreferences")),await h.loadPreferences(),console.log(r("settings.preferencesLoaded")),u.language=h.preferences.language,u.theme=h.preferences.theme,u.primaryColor=h.preferences.primaryColor,u.fontSize=h.preferences.fontSize,u.animations=h.preferences.animations,u.compactMode=h.preferences.compactMode,console.log(r("settings.preferencesSynced"))}catch(o){console.error("加载偏好设置错误:",o),g.error(r("settings.loadPreferencesFailed"))}},I=async()=>{w.value=!0;try{await h.updatePreference("language",u.language),n.value=u.language,g.success(r("settings.languageSaved"))}catch(o){console.error(r("languageSaveFailed"),o),g.error(r("settings.savePreferencesFailed")||r("saveFailed"))}finally{w.value=!1}},N=async()=>{c.value=!0;try{await h.updatePreferences({theme:u.theme,primaryColor:u.primaryColor}),g.success(r("settings.themeSaved"))}catch{g.error(r("settings.themeSaveFailed"))}finally{c.value=!1}},B=async()=>{U.value=!0;try{await h.updatePreferences({fontSize:u.fontSize,animations:u.animations,compactMode:u.compactMode}),g.success(r("settings.interfaceSettingsSaved"))}catch{g.error(r("settings.saveInterfaceSettingsFailed"))}finally{U.value=!1}},d=o=>{const m=new Date(o),p=new Date().getTime()-m.getTime();return p<6e4?r("settings.justNow"):p<36e5?`${Math.floor(p/6e4)}${r("settings.minutesAgo")}`:p<864e5?`${Math.floor(p/36e5)}${r("settings.hoursAgo")}`:p<6048e5?`${Math.floor(p/864e5)}${r("settings.daysAgo")}`:m.toLocaleDateString(u.language==="zh-CN"?"zh-CN":"en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})};return W(()=>{H(),z()}),{t:r,activeTab:x,passwordLoading:T,languageLoading:w,themeLoading:c,preferencesLoading:U,passwordForm:_,preferences:u,themeColors:E,loginHistory:b,changePassword:A,saveLanguage:I,saveThemeSettings:N,saveInterfaceSettings:B,clearLoginHistory:M,formatDateTime:d,loadPreferences:H,fetchLoginHistory:z}},Se={class:"settings-container"},be={class:"page-header"},Ce={class:"settings-content"},Pe={class:"tab-content"},ke={class:"settings-section"},Ve={class:"section-header"},Le={class:"section-title"},Te={class:"settings-section"},Ue={class:"section-header"},Fe={class:"section-title"},ze={class:"security-tips"},Me={class:"tip-item"},He={class:"tip-item"},xe={class:"tip-item"},Ee={class:"tab-content"},Ae={class:"settings-section"},Ie={class:"section-header"},Ne={class:"section-title"},De={class:"login-history-list"},$e={class:"history-main"},Be={class:"history-time"},Re={class:"history-device"},je={class:"history-location"},qe={class:"history-side"},Ge={class:"history-ip"},Oe={key:0,class:"load-more"},Qe={key:1,class:"load-more"},Je={class:"tab-content"},Ke={class:"settings-section"},We={class:"section-header"},Xe={class:"section-title"},Ye={class:"settings-section"},Ze={class:"section-header"},es={class:"section-title"},ss={class:"theme-colors"},ts=["onClick"],as={class:"settings-section"},ns={class:"section-header"},os={class:"section-title"},ls={class:"form-hint"},is=se({__name:"Setting",setup(r){const{t:n,activeTab:L,passwordLoading:h,languageLoading:b,themeLoading:x,preferencesLoading:T,passwordForm:w,preferences:c,themeColors:U,loginHistory:_,changePassword:E,saveLanguage:u,saveThemeSettings:A,saveInterfaceSettings:z,clearLoginHistory:M,formatDateTime:H,loadPreferences:I,fetchLoginHistory:N}=we();return W(()=>{I(),N()}),(B,d)=>{const o=v("el-icon"),m=v("el-input"),f=v("el-form-item"),p=v("el-button"),C=v("el-form"),D=v("el-tab-pane"),X=v("el-tag"),F=v("el-radio"),R=v("el-radio-group"),Y=v("el-slider"),j=v("el-switch"),Z=v("el-tabs");return S(),P("div",Se,[t("div",be,[t("h1",null,l(e(n)("settings.title")),1)]),t("div",Ce,[s(Z,{modelValue:e(L),"onUpdate:modelValue":d[8]||(d[8]=i=>te(L)?L.value=i:null),class:"settings-tabs"},{default:a(()=>[s(D,{label:e(n)("settings.accountSecurity"),name:"security"},{default:a(()=>[t("div",Pe,[t("div",ke,[t("div",Ve,[s(o,{class:"section-icon"},{default:a(()=>[s(e(ae))]),_:1}),t("div",Le,[t("h3",null,l(e(n)("settings.changePassword")),1),t("p",null,l(e(n)("settings.changePasswordTip")),1)])]),s(C,{model:e(w),"label-width":"120px",style:{"max-width":"500px"}},{default:a(()=>[s(f,{label:e(n)("settings.currentPassword")},{default:a(()=>[s(m,{modelValue:e(w).currentPassword,"onUpdate:modelValue":d[0]||(d[0]=i=>e(w).currentPassword=i),type:"password",placeholder:e(n)("settings.currentPasswordPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(f,{label:e(n)("settings.newPassword")},{default:a(()=>[s(m,{modelValue:e(w).newPassword,"onUpdate:modelValue":d[1]||(d[1]=i=>e(w).newPassword=i),type:"password",placeholder:e(n)("settings.newPasswordPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(f,{label:e(n)("settings.confirmPassword")},{default:a(()=>[s(m,{modelValue:e(w).confirmPassword,"onUpdate:modelValue":d[2]||(d[2]=i=>e(w).confirmPassword=i),type:"password",placeholder:e(n)("settings.confirmPasswordPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(f,null,{default:a(()=>[s(p,{type:"primary",onClick:e(E),loading:e(h)},{default:a(()=>[y(l(e(n)("settings.changePassword")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model"])]),t("div",Te,[t("div",Ue,[s(o,{class:"section-icon"},{default:a(()=>[s(e(ne))]),_:1}),t("div",Fe,[t("h3",null,l(e(n)("settings.securityTips")),1),t("p",null,l(e(n)("settings.securityTipsSubtitle")),1)])]),t("div",ze,[t("div",Me,[s(o,null,{default:a(()=>[s(e(k))]),_:1}),t("span",null,l(e(n)("settings.securityTip1")),1)]),t("div",He,[s(o,null,{default:a(()=>[s(e(k))]),_:1}),t("span",null,l(e(n)("settings.securityTip2")),1)]),t("div",xe,[s(o,null,{default:a(()=>[s(e(k))]),_:1}),t("span",null,l(e(n)("settings.securityTip3")),1)])])])])]),_:1},8,["label"]),s(D,{label:e(n)("settings.loginHistory"),name:"login-history"},{default:a(()=>[t("div",Ee,[t("div",Ae,[t("div",Ie,[s(o,{class:"section-icon"},{default:a(()=>[s(e(oe))]),_:1}),t("div",Ne,[t("h3",null,l(e(n)("settings.recentLoginRecords")),1),t("p",null,l(e(n)("settings.viewLoginHistory")),1)])]),t("div",De,[(S(!0),P(O,null,Q(e(_),i=>(S(),P("div",{key:i.id,class:"history-item"},[t("div",$e,[t("div",Be,[s(o,null,{default:a(()=>[s(e(le))]),_:1}),t("span",null,l(e(H)(i.loginTime)),1)]),t("div",Re,[s(o,null,{default:a(()=>[s(e(ie))]),_:1}),t("span",null,l(i.device),1)]),t("div",je,[s(o,null,{default:a(()=>[s(e(re))]),_:1}),t("span",null,l(i.location||e(n)("settings.unknownLocation")),1)])]),t("div",qe,[t("div",Ge,[t("span",null,"IP: "+l(i.ipAddress),1)]),s(X,{type:i.status==="SUCCESS"?"success":"danger",size:"small"},{default:a(()=>[s(o,null,{default:a(()=>[i.status==="SUCCESS"?(S(),$(e(de),{key:0})):(S(),$(e(ce),{key:1}))]),_:2},1024),y(" "+l(i.status==="SUCCESS"?e(n)("settings.loginSuccess"):e(n)("settings.loginFailed")),1)]),_:2},1032,["type"])])]))),128))]),e(_).length>=10?(S(),P("div",Oe,[s(p,{text:"",type:"danger",onClick:e(M),style:{"margin-left":"1rem"}},{default:a(()=>[y(l(e(n)("settings.clearHistory")),1)]),_:1},8,["onClick"])])):e(_).length>0?(S(),P("div",Qe,[s(p,{text:"",type:"danger",onClick:e(M)},{default:a(()=>[y(l(e(n)("settings.clearHistory")),1)]),_:1},8,["onClick"])])):G("",!0)])])]),_:1},8,["label"]),s(D,{label:e(n)("settings.preferences"),name:"preferences"},{default:a(()=>[t("div",Je,[t("div",Ke,[t("div",We,[s(o,{class:"section-icon"},{default:a(()=>[s(e(ue))]),_:1}),t("div",Xe,[t("h3",null,l(e(n)("settings.languageSettings")),1),t("p",null,l(e(n)("settings.languageSettingsSubtitle")),1)])]),s(C,{"label-width":"120px"},{default:a(()=>[s(f,{label:e(n)("settings.interfaceLanguage")},{default:a(()=>[s(R,{modelValue:e(c).language,"onUpdate:modelValue":d[3]||(d[3]=i=>e(c).language=i)},{default:a(()=>[s(F,{label:"zh-CN"},{default:a(()=>[y(l(e(n)("settings.chineseSimplified")),1)]),_:1}),s(F,{label:"en-US"},{default:a(()=>[y(l(e(n)("settings.english")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(f,null,{default:a(()=>[s(p,{type:"primary",onClick:e(u),loading:e(b)},{default:a(()=>[s(o,null,{default:a(()=>[s(e(k))]),_:1}),y(" "+l(e(n)("settings.saveLanguageSettings")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),t("div",Ye,[t("div",Ze,[s(o,{class:"section-icon"},{default:a(()=>[s(e(J))]),_:1}),t("div",es,[t("h3",null,l(e(n)("settings.themeAppearance")),1),t("p",null,l(e(n)("settings.themeAppearanceSubtitle")),1)])]),s(C,{"label-width":"120px"},{default:a(()=>[s(f,{label:e(n)("settings.themeMode")},{default:a(()=>[s(R,{modelValue:e(c).theme,"onUpdate:modelValue":d[4]||(d[4]=i=>e(c).theme=i)},{default:a(()=>[s(F,{label:"light"},{default:a(()=>[s(o,null,{default:a(()=>[s(e(J))]),_:1}),y(" "+l(e(n)("settings.lightTheme")),1)]),_:1}),s(F,{label:"dark"},{default:a(()=>[s(o,null,{default:a(()=>[s(e(ge))]),_:1}),y(" "+l(e(n)("settings.darkTheme")),1)]),_:1}),s(F,{label:"auto"},{default:a(()=>[s(o,null,{default:a(()=>[s(e(_e))]),_:1}),y(" "+l(e(n)("settings.followSystem")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(f,{label:e(n)("settings.themeColor")},{default:a(()=>[t("div",ss,[(S(!0),P(O,null,Q(e(U),i=>(S(),P("div",{key:i.value,class:fe(["theme-color-item",{active:e(c).primaryColor===i.value}]),style:me({backgroundColor:i.value}),onClick:rs=>e(c).primaryColor=i.value},[e(c).primaryColor===i.value?(S(),$(o,{key:0},{default:a(()=>[s(e(k))]),_:1})):G("",!0)],14,ts))),128))])]),_:1},8,["label"]),s(f,null,{default:a(()=>[s(p,{type:"primary",onClick:e(A),loading:e(x)},{default:a(()=>[s(o,null,{default:a(()=>[s(e(k))]),_:1}),y(" "+l(e(n)("settings.saveThemeSettings")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),t("div",as,[t("div",ns,[s(o,{class:"section-icon"},{default:a(()=>[s(e(pe))]),_:1}),t("div",os,[t("h3",null,l(e(n)("settings.interfaceSettings")),1),t("p",null,l(e(n)("settings.interfaceSettingsSubtitle")),1)])]),s(C,{"label-width":"120px"},{default:a(()=>[s(f,{label:e(n)("settings.fontSize")},{default:a(()=>[s(Y,{modelValue:e(c).fontSize,"onUpdate:modelValue":d[5]||(d[5]=i=>e(c).fontSize=i),min:12,max:18,step:1,"show-input":"","show-stops":""},null,8,["modelValue"])]),_:1},8,["label"]),s(f,{label:e(n)("settings.animationEffects")},{default:a(()=>[s(j,{modelValue:e(c).animations,"onUpdate:modelValue":d[6]||(d[6]=i=>e(c).animations=i)},null,8,["modelValue"])]),_:1},8,["label"]),s(f,{label:e(n)("settings.compactMode")},{default:a(()=>[s(j,{modelValue:e(c).compactMode,"onUpdate:modelValue":d[7]||(d[7]=i=>e(c).compactMode=i)},null,8,["modelValue"]),t("span",ls,l(e(n)("settings.compactModeHint")),1)]),_:1},8,["label"]),s(f,null,{default:a(()=>[s(p,{type:"primary",onClick:e(z),loading:e(T)},{default:a(()=>[s(o,null,{default:a(()=>[s(e(k))]),_:1}),y(" "+l(e(n)("settings.saveInterfaceSettings")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})])])]),_:1},8,["label"])]),_:1},8,["modelValue"])])])}}}),_s=he(is,[["__scopeId","data-v-cae53402"]]);export{_s as default};
