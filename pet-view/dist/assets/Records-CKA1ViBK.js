import{h as T,I as ee,u as j,j as De,E as D,J as Ee,d as xe,X as $e,v as Ue,a0 as Se,c as n,o as l,a as t,z as M,O as Le,t as a,l as e,N as $,Z as O,F as V,f as P,$ as re,g as ce,n as A,U as Ve,_ as G,e as ke,w as we,a1 as Fe,a2 as Pe,a3 as Me}from"./index-CdkwbEeW.js";import{s as I}from"./request-AZOEAvTT.js";import{useThemeStore as Ae}from"./theme-B9BnWpRM.js";const Ie=async(c,o)=>{if(!c||c.length===0)return{success:!0,message:"æ²¡æœ‰æ–‡ä»¶éœ€è¦ä¸Šä¼ "};const u=new FormData;c.forEach(d=>{u.append("files",d)}),u.append("recordId",String(o)),u.append("batchUpload","true");try{return await I.post("/media/upload",u)}catch(d){throw console.error("ä¸Šä¼ åª’ä½“æ–‡ä»¶å¤±è´¥:",d),d}},Ne=()=>{const{t:c}=j();return{getMoodEmoji:u=>{const d={[c("happy")]:"ðŸ˜Š",[c("angry")]:"ðŸ˜ ",[c("tired")]:"ðŸ˜´",[c("active")]:"ðŸ•"};return u&&d[u]||"ðŸ˜"}}},Be=()=>{const{t:c}=j();return{getMoodClass:u=>({happy:u===c("happy"),angry:u===c("angry"),tired:u===c("tired"),active:u===c("active")})}},Oe=()=>({formatDate:o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}),J={maxFileSize:524288500,supportedImageFormats:["image/jpeg","image/png","image/gif","image/webp","image/jpg"],supportedVideoFormats:["video/mp4","video/mpeg","video/quicktime","video/x-msvideo","video/webm"],thumbnailMaxWidth:200,thumbnailMaxHeight:200},je=c=>new Promise((o,u)=>{const d=new FileReader;d.onload=m=>{const r=new Image;r.onload=()=>{const p=document.createElement("canvas"),k=p.getContext("2d");if(!k){o(m.target?.result);return}let E=r.width,w=r.height;const F=J.thumbnailMaxWidth,v=J.thumbnailMaxHeight;E>w?E>F&&(w=w*F/E,E=F):w>v&&(E=E*v/w,w=v),p.width=E,p.height=w,k.drawImage(r,0,0,E,w),o(p.toDataURL("image/jpeg",.7))},r.onerror=()=>{o(m.target?.result)},r.src=m.target?.result},d.onerror=()=>u(new Error("æ— æ³•è¯»å–æ–‡ä»¶")),d.readAsDataURL(c)}),ze=c=>{if(c.size>J.maxFileSize)return{valid:!1,error:`æ–‡ä»¶è¿‡å¤§ï¼Œæœ€å¤§æ”¯æŒ${J.maxFileSize/1024/1024}MB`};const o=J.supportedImageFormats.includes(c.type),u=J.supportedVideoFormats.includes(c.type);return!o&&!u?{valid:!1,error:"ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œä»…æ”¯æŒå¸¸è§çš„å›¾ç‰‡å’Œè§†é¢‘æ ¼å¼"}:{valid:!0}},Re=()=>{const{t:c}=j(),o=T([]),u=T(!1),d=async _=>{const g=_.target,h=Array.from(g.files||[]);await m(h),g.value=""},m=async _=>{if(o.value.length+_.length>5){D.error(c("common.maxFilesExceeded"));return}for(const g of _){const h=ze(g);if(!h.valid){D.error(`${c("records.uploadFailed")}: ${h.error}`);continue}try{const U=g.type.startsWith("image/")?"image":"video";let z=URL.createObjectURL(g),R=U==="image"?await je(g):z;o.value.push({file:g,previewUrl:z,thumbnailUrl:R,mediaType:U,isValid:!0}),D.success(c("records.uploadSuccess"))}catch{D.error(c("records.uploadFailed"))}}};return{filePreviews:o,isDragOver:u,handleFileUpload:d,handleDragOver:_=>{_.preventDefault(),u.value=!0},handleDragLeave:()=>{u.value=!1},handleDrop:async _=>{_.preventDefault(),u.value=!1;const g=Array.from(_.dataTransfer?.files||[]);g.length!==0&&await m(g)},removeFile:_=>{const g=o.value[_];g&&g.previewUrl.startsWith("blob:")&&URL.revokeObjectURL(g.previewUrl),o.value.splice(_,1),D.success(c("common.deleteSuccess"))},clearAllFiles:()=>{o.value.forEach(_=>{_.previewUrl.startsWith("blob:")&&URL.revokeObjectURL(_.previewUrl)}),o.value=[]},getUploadFiles:()=>o.value.map(g=>g.file),getFileIcon:_=>_==="image"?"ðŸ–¼ï¸":_==="video"?"ðŸŽ¬":"ðŸ“„",formatFileSize:_=>{if(_===0)return"0 Bytes";const g=1024,h=["Bytes","KB","MB"],U=Math.floor(Math.log(_)/Math.log(g));return Math.round(_/Math.pow(g,U)*100)/100+" "+h[U]}}},We=()=>{const c=T(!1),o=T([]),u=T(!1),d=T(0);return{showMediaModal:c,currentMediaList:o,mediaLoading:u,currentMediaIndex:d,openMediaModal:async(F,v)=>{if(d.value=0,v){u.value=!0;try{const f=await I.get(`/media/record/${v}`);if(f.code===200&&f.data){const _=Array.isArray(f.data)?f.data:[f.data];o.value=_.map(g=>({id:g.mid,media_url:g.filePath,media_type:g.mediaType,media_name:g.fileName,updated_at:g.updatedAt}))}else o.value=[]}catch{D.error("åŠ è½½åª’ä½“æ–‡ä»¶å¤±è´¥"),o.value=[]}finally{u.value=!1}}else o.value=F||[];c.value=!0,setTimeout(()=>{console.log("åª’ä½“æŸ¥çœ‹å™¨å·²æ‰“å¼€"),console.log("åª’ä½“åˆ—è¡¨:",o.value),console.log("å½“å‰ç´¢å¼•:",d.value)},100)},refreshMediaList:async F=>{if(!F||F<=0){o.value=[];return}u.value=!0;try{const v=await I.get(`/media/record/${F}`);if(v.code===200&&v.data){const f=Array.isArray(v.data)?v.data:[v.data];o.value=f.map(_=>({id:_.mid,media_url:_.filePath,media_type:_.mediaType,media_name:_.fileName,updated_at:_.updatedAt}))}else o.value=[]}catch{o.value=[]}finally{u.value=!1}},closeMediaModal:()=>{c.value=!1,o.value=[],d.value=0},nextMedia:()=>{o.value.length>1&&(d.value=(d.value+1)%o.value.length)},prevMedia:()=>{o.value.length>1&&(d.value=(d.value-1+o.value.length)%o.value.length)},selectMedia:F=>{F>=0&&F<o.value.length&&(d.value=F)}}},Ce=()=>{const{t:c}=j(),o=T([]),u=T(!1);return{events:o,loading:u,fetchEvents:async()=>{u.value=!0;try{const m=await I.get("/events");m.code===200&&m.data?o.value=m.data.map(r=>({record_id:r.eid,pid:r.pid,event_type:r.eventType,description:r.description,record_time:r.eventTime,mood:r.mood,location:r.location,pet_name:r.pet_name||"",created_at:r.createdAt||r.eventTime,updated_at:r.updatedAt||r.createdAt||r.eventTime,media_list:r.mediaList?r.mediaList.map(p=>({id:p.mid,media_url:p.filePath,media_type:p.mediaType,media_name:p.fileName,updated_at:p.updatedAt})):[]})):o.value=[]}catch{D.error(c("api.getEventsFailed")),o.value=[]}finally{u.value=!1}}}},qe=()=>{const{t:c}=j(),o=T([]),u=T(!1);return{pets:o,loading:u,fetchPets:async()=>{u.value=!0;try{const r=await I.get("/user/adoptions",{params:{current_page:1,per_page:100}});r.code===200&&r.data?.records?o.value=r.data.records.map(p=>({pid:p.pid||p.id,name:p.name||p.petName,species:p.breed||p.species||"æœªçŸ¥",breed:p.breed||p.species||"æœªçŸ¥",type:"adoption",date:p.adoptionDate||p.adoptDate||p.date})):o.value=[]}catch{D.error(c("api.getPetsFailed")),o.value=[]}finally{u.value=!1}},getPetName:(r,p)=>{const k=o.value.find(E=>E.pid===r);return k?k.name:p||c("api.unknownPet")}}},He=c=>{const{t:o}=j(),{fetchEvents:u}=c||Ce();return{deleteEvent:async r=>{try{if(!r||r<=0){D.error(o("common.operationFailed"));return}await Ee.confirm(o("common.confirmDeleteEvent"),o("common.deleteConfirmation"),{confirmButtonText:o("common.confirm"),cancelButtonText:o("common.cancel"),type:"warning"}),await I.delete(`/events/${r}`),D.success(o("api.deleteSuccess")),await u()}catch(p){p!=="cancel"&&console.error("åˆ é™¤è®°å½•å¤±è´¥:",p)}},deleteMediaFile:async r=>{try{await I.delete(`/media/${r}`),D.success(o("records.deleteMediaSuccess"))}catch(p){const k=p?.response?.data?.msg||p?.message||o("records.deleteMediaFailed");throw D.error(k),p}}}},Ke=c=>{const o=De({selectedPet:"",selectedEventType:"",selectedMood:"",selectedDate:""}),u=ee(()=>{let d=[...c.value];return o.selectedPet&&(d=d.filter(m=>m.pid===Number(o.selectedPet))),o.selectedEventType&&(d=d.filter(m=>m.event_type===o.selectedEventType)),o.selectedMood&&(d=d.filter(m=>m.mood===o.selectedMood)),o.selectedDate&&(d=d.filter(m=>new Date(m.record_time).toDateString()===new Date(o.selectedDate).toDateString())),d});return{filters:o,filteredEvents:u}},Ge=c=>{const o=T("record_time"),u=ee(()=>{const d=[...c.value];return d.sort((m,r)=>{switch(o.value){case"event_type":return m.event_type.localeCompare(r.event_type);case"mood":return(m.mood||"").localeCompare(r.mood||"");case"record_time":default:return new Date(r.record_time).getTime()-new Date(m.record_time).getTime()}}),d});return{sortBy:o,sortedEvents:u}},Je=c=>({groupedEvents:ee(()=>{const u={};return c.value.forEach(d=>{const m=new Date(d.record_time).toDateString();u[m]||(u[m]=[]),u[m].push(d)}),u})}),Xe=()=>{const c=De({record_id:"",pid:"",event_type:"",mood:"",description:"",location:"",record_time:""});return{formData:c,resetForm:()=>{Object.assign(c,{record_id:"",pid:"",event_type:"",mood:"",description:"",location:"",record_time:""})},populateForm:d=>{let m="";if(d.record_time){const r=d.record_time.replace(" ","T"),p=new Date(r);if(!isNaN(p.getTime()))m=p.toISOString().slice(0,16);else{const k=d.record_time.split(" ");k.length===2&&(m=`${k[0]}T${k[1].slice(0,5)}`)}}Object.assign(c,{...d,record_time:m})}}},Ze=()=>{const{events:c,loading:o,fetchEvents:u}=Ce(),{pets:d,fetchPets:m,getPetName:r}=qe(),{getMoodEmoji:p}=Ne(),{getMoodClass:k}=Be(),{formatDate:E}=Oe(),{filePreviews:w,isDragOver:F,handleFileUpload:v,handleDragOver:f,handleDragLeave:_,handleDrop:g,removeFile:h,clearAllFiles:U,getUploadFiles:z,getFileIcon:R,formatFileSize:ue}=Re(),{showMediaModal:te,currentMediaList:me,mediaLoading:X,currentMediaIndex:Z,openMediaModal:Q,refreshMediaList:S,closeMediaModal:oe,nextMedia:se,prevMedia:ie,selectMedia:ae}=We(),{filters:pe,filteredEvents:de}=Ke(c),{sortBy:_e,sortedEvents:B}=Ge(de),{groupedEvents:ve}=Je(B),{formData:C,resetForm:W,populateForm:q}=Xe(),{deleteEvent:he,deleteMediaFile:Y}=He({fetchEvents:u}),H=T(!1),N=T(!1),le=T("grid"),x=T(!1),ge=ee(()=>c.value.length),fe=ee(()=>c.value.reduce((i,s)=>i+(s.media_list?.length||0),0)),ye=i=>{q(i),S(i.record_id),N.value=!0},ne=()=>{H.value=!1,N.value=!1,U(),W()};return{events:c,pets:d,loading:o,filters:pe,viewMode:le,sortBy:_e,isSubmitting:x,showAddModal:H,showEditModal:N,showMediaModal:te,mediaLoading:X,currentMediaIndex:Z,formData:C,filePreviews:w,isDragOver:F,currentMediaList:me,totalEvents:ge,totalMedia:fe,filteredEvents:de,sortedEvents:B,groupedEvents:ve,fetchEvents:u,fetchPets:m,getPetName:r,getMoodEmoji:p,getMoodClass:k,formatDate:E,handleFileUpload:v,handleDragOver:f,handleDragLeave:_,handleDrop:g,removeFile:h,getFileIcon:R,formatFileSize:ue,openMediaModal:Q,refreshMediaList:S,closeMediaModal:oe,nextMedia:se,prevMedia:ie,selectMedia:ae,editEvent:ye,deleteEvent:he,deleteMediaFile:Y,saveEvent:async()=>{if(x.value){D.warning("æ­£åœ¨ä¿å­˜ä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤");return}x.value=!0;try{const i=C.record_time,s=i?i.replace("T"," ")+":00":"",y={pid:C.pid,eventType:C.event_type,recordTime:s,description:C.description,mood:C.mood||"",location:C.location||""};let b=null;if(N.value&&C.record_id?(await I.put(`/events/${C.record_id}`,y),b=Number(C.record_id)):b=(await I.post("/events",y)).data?.eid,b){const K=z();if(K&&K.length>0)try{D.info("æ­£åœ¨ä¸Šä¼ åª’ä½“æ–‡ä»¶ï¼Œè¯·ç¨å€™..."),await Ie(K,b)}catch(be){console.error("åª’ä½“æ–‡ä»¶ä¸Šä¼ å¤±è´¥:",be);const Te=be?.response?.data?.msg||be?.message||"åª’ä½“æ–‡ä»¶ä¸Šä¼ å¤±è´¥";D.error(`äº‹ä»¶ä¿å­˜æˆåŠŸï¼Œä½†åª’ä½“æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ${Te}`)}D.success(N.value?"äº‹ä»¶æ›´æ–°æˆåŠŸ":"äº‹ä»¶æ·»åŠ æˆåŠŸ")}await u(),ne()}catch(i){console.error("ä¿å­˜äº‹ä»¶å¤±è´¥:",i);const s=i?.response?.data?.msg||i?.message||(N.value?"äº‹ä»¶æ›´æ–°å¤±è´¥":"äº‹ä»¶æ·»åŠ å¤±è´¥");D.error(s)}finally{x.value=!1}},closeModal:ne}},Qe={class:"page-header"},Ye={class:"stats-grid"},et={class:"stat-card"},tt={class:"stat-content"},ot={class:"stat-card"},st={class:"stat-content"},it={class:"stat-card"},at={class:"stat-content"},dt={class:"controls-section"},lt={class:"filter-group"},nt={style:{position:"relative"}},rt=["disabled"],ct={value:""},ut=["value"],mt={key:0,style:{position:"absolute",top:"-20px",left:"0",color:"#666"}},pt={value:""},_t={value:"å–‚é£Ÿ"},vt={value:"æ´—æ¾¡"},ht={value:"æ•£æ­¥"},gt={value:"çœ‹å…½åŒ»"},ft={value:"çŽ©è€"},yt={value:"æ‰“ç–«è‹—"},bt={value:""},Mt={value:"å¼€å¿ƒ"},kt={value:"ç”Ÿæ°”"},wt={value:"ç–²å€¦"},Ft={value:"æ´»è·ƒ"},Dt=["placeholder"],Et={class:"view-controls"},Ct={class:"view-toggle"},Tt={class:"sort-controls"},xt={value:"record_time"},$t={value:"event_type"},Ut={value:"mood"},St={class:"events-content"},Lt={key:0,class:"events-grid"},Vt={class:"event-header"},Pt={class:"pet-info"},At={class:"event-type"},It={key:0,class:"event-mood"},Nt={class:"mood-emoji"},Bt={class:"mood-text"},Ot={class:"event-content"},jt={class:"description"},zt={key:0,class:"location"},Rt={key:0,class:"event-media"},Wt={class:"media-preview"},qt=["src","alt","onClick"],Ht=["onClick"],Kt=["onClick"],Gt={class:"event-footer"},Jt={class:"event-time"},Xt={class:"record-time"},Zt={class:"created-time"},Qt={key:0,class:"updated-time"},Yt={class:"event-actions"},eo=["onClick"],to=["onClick","disabled"],oo={key:1,class:"events-list"},so={class:"list-header"},io={class:"col-pet"},ao={class:"col-type"},lo={class:"col-mood"},no={class:"col-description"},ro={class:"col-time"},co={class:"col-actions"},uo={class:"col-pet"},mo={class:"pet-info"},po={class:"col-type"},_o={class:"event-type-badge"},vo={class:"col-mood"},ho={key:0,class:"mood-indicator"},go={class:"mood-emoji"},fo={class:"col-description"},yo={class:"description-text"},bo={key:0,class:"location-small"},Mo={class:"col-time"},ko={class:"time-text"},wo={class:"col-actions"},Fo=["onClick"],Do=["onClick","disabled"],Eo={key:2,class:"timeline-view"},Co={class:"timeline"},To={class:"timeline-date"},xo={class:"timeline-items"},$o={class:"timeline-content"},Uo={class:"timeline-header"},So={class:"event-type-badge"},Lo={key:0,class:"mood-indicator"},Vo={class:"mood-emoji"},Po={class:"description"},Ao={key:0,class:"location"},Io={class:"timeline-footer"},No={class:"time-text"},Bo={class:"timeline-actions"},Oo=["onClick"],jo=["onClick","disabled"],zo={class:"modal-header"},Ro={class:"modal-form"},Wo={class:"form-group"},qo={value:""},Ho=["value"],Ko={class:"form-group"},Go={value:""},Jo={value:"å–‚é£Ÿ"},Xo={value:"æ´—æ¾¡"},Zo={value:"æ•£æ­¥"},Qo={value:"çœ‹å…½åŒ»"},Yo={value:"çŽ©è€"},es={value:"æ‰“ç–«è‹—"},ts={class:"form-group"},os={value:""},ss={value:"å¼€å¿ƒ"},is={value:"ç”Ÿæ°”"},as={value:"ç–²å€¦"},ds={value:"æ´»è·ƒ"},ls={class:"form-group"},ns={class:"form-group"},rs=["placeholder"],cs={class:"form-group"},us=["placeholder"],ms={key:0,class:"form-group"},ps={class:"existing-media-grid"},_s=["src","alt"],vs={key:1,class:"video-placeholder"},hs={class:"media-actions"},gs=["onClick","title"],fs={class:"form-group"},ys={class:"media-upload"},bs={for:"media-file-input",class:"upload-label"},Ms={class:"upload-text"},ks={class:"upload-hint"},ws={key:0,class:"uploaded-files"},Fs={class:"uploaded-files-title"},Ds={class:"file-preview-grid"},Es={class:"preview-thumbnail"},Cs=["src","alt"],Ts={key:1,class:"preview-video-placeholder"},xs={class:"file-info-full"},$s={class:"file-name-container"},Us={class:"file-icon"},Ss=["title"],Ls={class:"file-size-type"},Vs={class:"file-size"},Ps={class:"file-type"},As=["onClick","title"],Is={class:"upload-hint-text"},Ns={class:"modal-actions"},Bs=["disabled"],Os=["disabled"],js={key:0,class:"media-viewer-main"},zs=["aria-label"],Rs={class:"media-display"},Ws=["src","alt"],qs=["src"],Hs=["aria-label"],Ks={key:1,class:"media-viewer-footer"},Gs={class:"media-info"},Js={key:0},Xs={key:1},Zs={key:0,class:"media-thumbnails"},Qs=["onClick","aria-label"],Ys=["src","alt"],ei={key:1,class:"video-thumbnail"},ti={key:2,class:"media-empty"},ai=xe({__name:"Records",setup(c){const{t:o}=j(),u=Ae(),{pets:d,filters:m,viewMode:r,sortBy:p,isSubmitting:k,showAddModal:E,showEditModal:w,showMediaModal:F,currentMediaIndex:v,formData:f,filePreviews:_,isDragOver:g,currentMediaList:h,totalEvents:U,totalMedia:z,sortedEvents:R,groupedEvents:ue,fetchEvents:te,fetchPets:me,getPetName:X,getMoodEmoji:Z,getMoodClass:Q,formatDate:S,handleFileUpload:oe,handleDragOver:se,handleDragLeave:ie,handleDrop:ae,removeFile:pe,getFileIcon:de,formatFileSize:_e,openMediaModal:B,refreshMediaList:ve,closeMediaModal:C,nextMedia:W,prevMedia:q,selectMedia:he,editEvent:Y,deleteEvent:H,deleteMediaFile:N,saveEvent:le,closeModal:x}=Ze(),ge=async L=>{try{await Ee.confirm(o("records.confirmDeleteMedia"),o("common.deleteConfirmation"),{confirmButtonText:o("common.confirm"),cancelButtonText:o("common.cancel"),type:"warning"}),await N(L),f.record_id&&await ve(Number(f.record_id)),await te()}catch(i){i!=="cancel"&&console.error(i)}},fe=L=>{const i=L.target;console.log("è§†é¢‘åŠ è½½å®Œæˆ:",i.src);const s=localStorage.getItem("videoVolume");s&&(i.volume=parseFloat(s)),i.autoplay=!1},ye=L=>{const i=L.target;console.error("è§†é¢‘æ’­æ”¾å‡ºé”™:",i.src,L),D.error("è§†é¢‘æ’­æ”¾å‡ºé”™ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼æˆ–ç½‘ç»œè¿žæŽ¥")},ne=L=>{const i=L.target;console.log("è§†é¢‘éŸ³é‡å˜åŒ–:",i.volume),localStorage.setItem("videoVolume",i.volume.toString())};return $e(()=>{localStorage.removeItem("videoVolume")}),Ue(async()=>{await me(),await Se(),await te()}),(L,i)=>(l(),n("div",{class:A(["events-container",{"dark-theme":e(u).preferences.theme==="dark"}])},[t("div",Qe,[t("h1",null,a(e(o)("records.pageTitle")),1),t("p",null,a(e(o)("records.pageSubtitle")),1)]),t("div",Ye,[t("div",et,[i[33]||(i[33]=t("div",{class:"stat-icon"},"ðŸ“…",-1)),t("div",tt,[t("h3",null,a(e(U)),1),t("p",null,a(e(o)("records.totalEvents")),1)])]),t("div",ot,[i[34]||(i[34]=t("div",{class:"stat-icon"},"ðŸ•",-1)),t("div",st,[t("h3",null,a(e(d).length),1),t("p",null,a(e(o)("records.totalPets")),1)])]),t("div",it,[i[35]||(i[35]=t("div",{class:"stat-icon"},"ðŸ“¸",-1)),t("div",at,[t("h3",null,a(e(z)),1),t("p",null,a(e(o)("records.totalMedia")),1)])])]),t("div",dt,[t("div",lt,[t("div",nt,[$(t("select",{"onUpdate:modelValue":i[0]||(i[0]=s=>e(m).selectedPet=s),class:"filter-select",disabled:e(d).length===0},[t("option",ct,a(e(d).length===0?e(o)("records.loading"):e(o)("records.allPets")),1),(l(!0),n(V,null,P(e(d),s=>(l(),n("option",{key:s.pid,value:s.pid},a(s.name),9,ut))),128))],8,rt),[[O,e(m).selectedPet]]),e(d).length>0?(l(),n("small",mt,a(e(o)("records.foundPets",{count:e(d).length})),1)):M("",!0)]),$(t("select",{"onUpdate:modelValue":i[1]||(i[1]=s=>e(m).selectedEventType=s),class:"filter-select"},[t("option",pt,a(e(o)("records.allEvents")),1),t("option",_t,a(e(o)("records.feeding")),1),t("option",vt,a(e(o)("records.bathing")),1),t("option",ht,a(e(o)("records.walking")),1),t("option",gt,a(e(o)("records.veterinary")),1),t("option",ft,a(e(o)("records.playing")),1),t("option",yt,a(e(o)("records.vaccination")),1)],512),[[O,e(m).selectedEventType]]),$(t("select",{"onUpdate:modelValue":i[2]||(i[2]=s=>e(m).selectedMood=s),class:"filter-select"},[t("option",bt,a(e(o)("records.allMood")),1),t("option",Mt,a(e(o)("records.happy")),1),t("option",kt,a(e(o)("records.angry")),1),t("option",wt,a(e(o)("records.tired")),1),t("option",Ft,a(e(o)("records.active")),1)],512),[[O,e(m).selectedMood]]),$(t("input",{type:"date","onUpdate:modelValue":i[3]||(i[3]=s=>e(m).selectedDate=s),class:"filter-input",placeholder:e(o)("records.selectDate")},null,8,Dt),[[re,e(m).selectedDate]])]),t("button",{class:"add-button",onClick:i[4]||(i[4]=s=>E.value=!0)},[i[36]||(i[36]=t("span",null,"+",-1)),ce(" "+a(e(o)("records.addEvent")),1)])]),t("div",Et,[t("div",Ct,[t("button",{class:A({active:e(r)==="grid"}),onClick:i[5]||(i[5]=s=>r.value="grid")},a(e(o)("records.gridView")),3),t("button",{class:A({active:e(r)==="list"}),onClick:i[6]||(i[6]=s=>r.value="list")},a(e(o)("records.listView")),3),t("button",{class:A({active:e(r)==="timeline"}),onClick:i[7]||(i[7]=s=>r.value="timeline")},a(e(o)("records.timeline")),3)]),t("div",Tt,[$(t("select",{"onUpdate:modelValue":i[8]||(i[8]=s=>Ve(p)?p.value=s:null),class:"sort-select"},[t("option",xt,a(e(o)("records.sortByTime")),1),t("option",$t,a(e(o)("records.sortByType")),1),t("option",Ut,a(e(o)("records.sortByMood")),1)],512),[[O,e(p)]])])]),t("div",St,[e(r)==="grid"?(l(),n("div",Lt,[(l(!0),n(V,null,P(e(R),s=>(l(),n("div",{key:s.record_id,class:A(["event-card",s.mood?e(Q)(s.mood):{}])},[t("div",Vt,[t("div",Pt,[t("h4",null,a(e(X)(s.pid,s.pet_name)),1),t("span",At,a(s.event_type),1)]),s.mood?(l(),n("div",It,[t("span",Nt,a(e(Z)(s.mood)),1),t("span",Bt,a(s.mood),1)])):M("",!0)]),t("div",Ot,[t("p",jt,a(s.description),1),s.location?(l(),n("div",zt,[i[37]||(i[37]=t("span",{class:"location-icon"},"ðŸ“",-1)),ce(" "+a(s.location),1)])):M("",!0)]),s.media_list&&s.media_list.length>0?(l(),n("div",Rt,[t("div",Wt,[(l(!0),n(V,null,P(s.media_list.slice(0,3),y=>(l(),n("div",{key:y.id,class:"media-item"},[y.media_type==="image"?(l(),n("img",{key:0,src:y.media_url,alt:s.event_type,onClick:b=>e(B)([],s.record_id),style:{cursor:"pointer"}},null,8,qt)):y.media_type==="video"?(l(),n("div",{key:1,class:"video-thumbnail",onClick:b=>e(B)([],s.record_id),style:{cursor:"pointer"}},[...i[38]||(i[38]=[t("span",{class:"video-icon"},"ðŸŽ¬",-1)])],8,Ht)):M("",!0)]))),128)),s.media_list.length>3?(l(),n("div",{key:0,class:"media-count",onClick:y=>e(B)([],s.record_id),style:{cursor:"pointer"}}," +"+a(s.media_list.length-3),9,Kt)):M("",!0)])])):M("",!0),t("div",Gt,[t("div",Jt,[t("span",Xt,a(e(S)(s.record_time)),1),t("span",Zt,a(e(o)("records.recordedAt"))+" "+a(e(S)(s.created_at)),1),s.updated_at&&s.updated_at!==s.created_at?(l(),n("span",Qt,a(e(o)("records.updatedAt"))+" "+a(e(S)(s.updated_at)),1)):M("",!0)]),t("div",Yt,[t("button",{class:"action-btn edit-btn",onClick:y=>e(Y)(s)},a(e(o)("records.edit")),9,eo),t("button",{class:"action-btn delete-btn",onClick:y=>e(H)(s.record_id),disabled:!s.record_id},a(e(o)("records.delete")),9,to)])])],2))),128))])):e(r)==="list"?(l(),n("div",oo,[t("div",so,[t("div",io,a(e(o)("records.pet")),1),t("div",ao,a(e(o)("records.eventType")),1),t("div",lo,a(e(o)("records.mood")),1),t("div",no,a(e(o)("records.description")),1),t("div",ro,a(e(o)("records.time")),1),t("div",co,a(e(o)("records.actions")),1)]),(l(!0),n(V,null,P(e(R),s=>(l(),n("div",{key:s.record_id,class:A(["list-item",s.mood?e(Q)(s.mood):{}])},[t("div",uo,[t("div",mo,[t("h4",null,a(e(X)(s.pid,s.pet_name)),1)])]),t("div",po,[t("span",_o,a(s.event_type),1)]),t("div",vo,[s.mood?(l(),n("span",ho,[t("span",go,a(e(Z)(s.mood)),1),ce(" "+a(s.mood),1)])):M("",!0)]),t("div",fo,[t("p",yo,a(s.description),1),s.location?(l(),n("div",bo," ðŸ“ "+a(s.location),1)):M("",!0)]),t("div",Mo,[t("span",ko,a(e(S)(s.record_time)),1)]),t("div",wo,[t("button",{class:"action-btn edit-btn",onClick:y=>e(Y)(s)},a(e(o)("records.edit")),9,Fo),t("button",{class:"action-btn delete-btn",onClick:y=>e(H)(s.record_id),disabled:!s.record_id},a(e(o)("records.delete")),9,Do)])],2))),128))])):(l(),n("div",Eo,[t("div",Co,[(l(!0),n(V,null,P(e(ue),(s,y)=>(l(),n("div",{key:y,class:"timeline-group"},[t("div",To,a(y),1),t("div",xo,[(l(!0),n(V,null,P(s,b=>(l(),n("div",{key:b.record_id,class:A(["timeline-item",b.mood?e(Q)(b.mood):{}])},[i[39]||(i[39]=t("div",{class:"timeline-marker"},null,-1)),t("div",$o,[t("div",Uo,[t("h4",null,a(e(X)(b.pid,b.pet_name)),1),t("span",So,a(b.event_type),1),b.mood?(l(),n("span",Lo,[t("span",Vo,a(e(Z)(b.mood)),1),ce(" "+a(b.mood),1)])):M("",!0)]),t("p",Po,a(b.description),1),b.location?(l(),n("div",Ao," ðŸ“ "+a(b.location),1)):M("",!0),t("div",Io,[t("span",No,a(e(S)(b.record_time)),1),t("div",Bo,[t("button",{class:"action-btn edit-btn",onClick:K=>e(Y)(b)},a(e(o)("records.edit")),9,Oo),t("button",{class:"action-btn delete-btn",onClick:K=>e(H)(b.record_id),disabled:!b.record_id},a(e(o)("records.delete")),9,jo)])])])],2))),128))])]))),128))])]))]),e(E)||e(w)?(l(),n("div",{key:0,class:"modal-overlay",onClick:i[24]||(i[24]=(...s)=>e(x)&&e(x)(...s))},[t("div",{class:"modal-content",onClick:i[23]||(i[23]=G(()=>{},["stop"]))},[t("div",zo,[t("h3",null,a(e(w)?e(o)("records.editEvent"):e(o)("records.addEvent")),1),t("button",{class:"close-btn",onClick:i[9]||(i[9]=(...s)=>e(x)&&e(x)(...s))},"Ã—")]),t("form",Ro,[t("div",Wo,[t("label",null,a(e(o)("records.pet")),1),$(t("select",{"onUpdate:modelValue":i[10]||(i[10]=s=>e(f).pid=s),required:"",class:"form-select"},[t("option",qo,a(e(o)("records.selectPet")),1),(l(!0),n(V,null,P(e(d),s=>(l(),n("option",{key:s.pid,value:s.pid},a(s.name),9,Ho))),128))],512),[[O,e(f).pid]])]),t("div",Ko,[t("label",null,a(e(o)("records.eventType")),1),$(t("select",{"onUpdate:modelValue":i[11]||(i[11]=s=>e(f).event_type=s),required:"",class:"form-select"},[t("option",Go,a(e(o)("records.selectType")),1),t("option",Jo,a(e(o)("records.feeding")),1),t("option",Xo,a(e(o)("records.bathing")),1),t("option",Zo,a(e(o)("records.walking")),1),t("option",Qo,a(e(o)("records.veterinary")),1),t("option",Yo,a(e(o)("records.playing")),1),t("option",es,a(e(o)("records.vaccination")),1)],512),[[O,e(f).event_type]])]),t("div",ts,[t("label",null,a(e(o)("records.mood")),1),$(t("select",{"onUpdate:modelValue":i[12]||(i[12]=s=>e(f).mood=s),class:"form-select"},[t("option",os,a(e(o)("records.selectMood")),1),t("option",ss,a(e(o)("records.happy")),1),t("option",is,a(e(o)("records.angry")),1),t("option",as,a(e(o)("records.tired")),1),t("option",ds,a(e(o)("records.active")),1)],512),[[O,e(f).mood]])]),t("div",ls,[t("label",null,a(e(o)("records.eventTime")),1),$(t("input",{type:"datetime-local","onUpdate:modelValue":i[13]||(i[13]=s=>e(f).record_time=s),required:"",class:"form-input"},null,512),[[re,e(f).record_time]])]),t("div",ns,[t("label",null,a(e(o)("records.location")),1),$(t("input",{type:"text","onUpdate:modelValue":i[14]||(i[14]=s=>e(f).location=s),placeholder:e(o)("records.locationOptional"),class:"form-input"},null,8,rs),[[re,e(f).location]])]),t("div",cs,[t("label",null,a(e(o)("records.detailedDescription")),1),$(t("textarea",{"onUpdate:modelValue":i[15]||(i[15]=s=>e(f).description=s),rows:"4",placeholder:e(o)("records.pleaseEnterDescription"),required:"",class:"form-textarea"},null,8,us),[[re,e(f).description]])]),e(w)&&e(f).record_id&&e(h).length?(l(),n("div",ms,[t("label",null,a(e(o)("records.existingMedia")),1),t("div",ps,[(l(!0),n(V,null,P(e(h),s=>(l(),n("div",{key:s.id,class:"existing-media-item"},[t("div",{class:"media-thumb",onClick:i[16]||(i[16]=y=>e(B)(e(h),Number(e(f).record_id)))},[s.media_type==="image"?(l(),n("img",{key:0,src:s.media_url,alt:s.media_name},null,8,_s)):(l(),n("div",vs,[...i[40]||(i[40]=[t("span",null,"ðŸŽ¬",-1)])]))]),t("div",hs,[t("button",{type:"button",class:"delete-media-btn",onClick:y=>ge(s.id),title:e(o)("records.deleteMedia")}," Ã— ",8,gs)])]))),128))])])):M("",!0),t("div",fs,[t("label",null,a(e(o)("records.mediaFiles")),1),t("div",ys,[t("div",{class:A(["upload-area",{"drag-over":e(g)}]),onDrop:i[18]||(i[18]=(...s)=>e(ae)&&e(ae)(...s)),onDragover:i[19]||(i[19]=G((...s)=>e(se)&&e(se)(...s),["prevent"])),onDragleave:i[20]||(i[20]=(...s)=>e(ie)&&e(ie)(...s))},[t("input",{type:"file",multiple:"",accept:"image/*,video/*",onChange:i[17]||(i[17]=(...s)=>e(oe)&&e(oe)(...s)),class:"file-input",id:"media-file-input"},null,32),t("label",bs,[i[41]||(i[41]=t("div",{class:"upload-icon"},"ðŸ“",-1)),t("div",Ms,a(e(o)("records.clickToSelectOrDrag")),1),t("div",ks,a(e(o)("records.supportedFormats")),1)])],34)]),e(_).length>0?(l(),n("div",ws,[t("div",Fs,a(e(o)("records.uploadedFiles"))+" ("+a(e(_).length)+"/5)",1),t("div",Ds,[(l(!0),n(V,null,P(e(_),(s,y)=>(l(),n("div",{key:y,class:"file-preview-item"},[t("div",Es,[s.mediaType==="image"?(l(),n("img",{key:0,src:s.thumbnailUrl,alt:s.file.name,class:"preview-image"},null,8,Cs)):(l(),n("div",Ts,[...i[42]||(i[42]=[t("span",{class:"video-icon"},"ðŸŽ¬",-1)])]))]),t("div",xs,[t("div",$s,[t("span",Us,a(e(de)(s.mediaType)),1),t("span",{class:"file-name",title:s.file.name},a(s.file.name),9,Ss)]),t("div",Ls,[t("span",Vs,a(e(_e)(s.file.size)),1),t("span",Ps,a(s.mediaType==="image"?"(å›¾ç‰‡)":"(è§†é¢‘)"),1)])]),t("button",{type:"button",onClick:b=>e(pe)(y),class:"remove-file-btn",title:e(o)("records.deleteFile")}," Ã— ",8,As)]))),128))]),t("div",Is,a(e(_).length>=5?e(o)("common.maxFilesExceeded"):e(o)("records.supportedFormats")),1)])):M("",!0)]),t("div",Ns,[t("button",{type:"button",class:"cancel-btn",onClick:i[21]||(i[21]=(...s)=>e(x)&&e(x)(...s)),disabled:e(k)},a(e(o)("records.cancel")),9,Bs),t("button",{type:"button",class:"save-btn",onClick:i[22]||(i[22]=(...s)=>e(le)&&e(le)(...s)),disabled:e(k)},a(e(k)?e(w)?e(o)("records.updating"):e(o)("records.saving"):e(w)?e(o)("records.update"):e(o)("records.save")),9,Os)])])])])):M("",!0),(l(),Le(Pe,{to:"body"},[ke(Fe,{name:"media-viewer"},{default:we(()=>[e(F)?(l(),n("div",{key:0,class:"media-viewer-overlay",onClick:i[29]||(i[29]=(...s)=>e(C)&&e(C)(...s)),onKeydown:[i[30]||(i[30]=Me((...s)=>e(C)&&e(C)(...s),["esc"])),i[31]||(i[31]=Me((...s)=>e(q)&&e(q)(...s),["left"])),i[32]||(i[32]=Me((...s)=>e(W)&&e(W)(...s),["right"]))],tabindex:"-1"},[t("div",{class:"media-viewer-content",onClick:i[28]||(i[28]=G(()=>{},["stop"]))},[t("button",{class:"media-viewer-close",onClick:i[25]||(i[25]=(...s)=>e(C)&&e(C)(...s))},"Ã—"),e(h).length>0?(l(),n("div",js,[e(h).length>1?(l(),n("button",{key:0,class:"media-nav-btn media-nav-prev",onClick:i[26]||(i[26]=G((...s)=>e(q)&&e(q)(...s),["stop"])),"aria-label":e(o)("records.previousMedia")}," â€¹ ",8,zs)):M("",!0),t("div",Rs,[ke(Fe,{name:"media-fade",mode:"out-in"},{default:we(()=>[e(h)[e(v)]?.media_type==="image"?(l(),n("img",{key:`img-${e(v)}`,src:e(h)[e(v)].media_url,alt:e(h)[e(v)].media_name||`${e(o)("records.media")} ${e(v)+1}`,class:"media-image"},null,8,Ws)):e(h)[e(v)]?.media_type==="video"?(l(),n("video",{key:`video-${e(v)}`,src:e(h)[e(v)].media_url,controls:"",controlsList:"nodownload noplaybackrate",class:"media-video",preload:"metadata",onLoadedmetadata:fe,onError:ye,onVolumechange:ne},null,40,qs)):M("",!0)]),_:1})]),e(h).length>1?(l(),n("button",{key:1,class:"media-nav-btn media-nav-next",onClick:i[27]||(i[27]=G((...s)=>e(W)&&e(W)(...s),["stop"])),"aria-label":e(o)("records.nextMedia")}," â€º ",8,Hs)):M("",!0)])):M("",!0),e(h).length>0?(l(),n("div",Ks,[t("div",Gs,[t("h4",null,a(e(h)[e(v)]?.media_name||`${e(o)("records.media")} ${e(v)+1}`),1),e(h)[e(v)]?.created_at?(l(),n("p",Js,a(e(o)("records.createdAt"))+": "+a(e(S)(e(h)[e(v)].created_at||"")),1)):M("",!0),e(h)[e(v)]?.updated_at&&e(h)[e(v)].updated_at!==(e(h)[e(v)].created_at||"")?(l(),n("p",Xs,a(e(o)("records.updatedAt"))+": "+a(e(S)(e(h)[e(v)].updated_at||"")),1)):M("",!0),t("p",null,a(e(o)("records.mediaIndex",{current:e(v)+1,total:e(h).length})),1)]),e(h).length>1?(l(),n("div",Zs,[(l(!0),n(V,null,P(e(h),(s,y)=>(l(),n("div",{key:y,class:A(["thumbnail-item",{active:y===e(v)}]),onClick:G(b=>e(he)(y),["stop"]),"aria-label":`${e(o)("records.media")} ${y+1}`},[s.media_type==="image"?(l(),n("img",{key:0,src:s.media_url,alt:s.media_name||`${e(o)("records.media")} ${y+1}`},null,8,Ys)):(l(),n("div",ei,[...i[43]||(i[43]=[t("span",{class:"video-icon"},"ðŸŽ¬",-1)])]))],10,Qs))),128))])):M("",!0)])):(l(),n("div",ti,[t("p",null,a(e(o)("records.noMediaFiles")),1)]))])],32)):M("",!0)]),_:1})]))],2))}});export{ai as default};
