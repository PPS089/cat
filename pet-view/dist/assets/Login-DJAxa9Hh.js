import{d as L}from"./dog-DzFJ_7DI.js";import{u as P,h as v,i as M,j as T,E as h,k as S,d as U,c as N,o as j,a,t as i,l as o,e as t,w as n,r as c,g as w,m as q,p as E}from"./index-DfLUD8D4.js";import{u as z}from"./user-QLKkhJka.js";import{s as B}from"./request-G9cUwcFm.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";const F=()=>{const I=S(),u=M(),{t:m}=P(),s=z(),l=v("/user");u.query.from?l.value=u.query.from:u.query.redirect&&(l.value=u.query.redirect);const r=T({username:"",password:"",rememberMe:!1});return(()=>{const g=localStorage.getItem("rememberedUsername"),e=localStorage.getItem("rememberedPassword");g&&e&&(r.username=g,r.password=e,r.rememberMe=!0)})(),{t:m,form:r,routerPath:l,handleLogin:async()=>{try{if(!r.username.trim()){h.warning({message:m("login.usernamePlaceholder"),showClose:!0,duration:3e3});return}if(!r.password.trim()){h.warning({message:m("login.passwordPlaceholder"),showClose:!0,duration:3e3});return}const e=(await B.post("/user/login",{username:r.username,password:r.password})).data;if(e.ok){const _=e.accessToken??e.token,f=e.refreshToken??null;if(!_){h.error({message:m("login.networkError"),showClose:!0,duration:5e3});return}localStorage.removeItem("jwt_token"),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("userId"),r.rememberMe||(localStorage.removeItem("rememberedUsername"),localStorage.removeItem("rememberedPassword")),localStorage.setItem("userId",e.userId.toString()),localStorage.setItem("jwt_token",_),f?(localStorage.setItem("refresh_token",f),console.log("已存储refresh token")):console.warn("服务器未返回refresh token，将使用单token模式"),r.rememberMe&&(localStorage.setItem("rememberedUsername",r.username),localStorage.setItem("rememberedPassword",r.password)),s.info.userId=e.userId,s.info.userName=e.username||"",localStorage.setItem("userInfo",JSON.stringify(s.info)),localStorage.setItem("userId",e.userId.toString()),localStorage.setItem("userName",e.username||"");try{await s.fetchProfile()}catch(d){console.error("获取用户资料失败，但继续跳转:",d),s.info.userId=e.userId,s.info.userName=e.username||""}h.success({message:`欢迎回来，${e.username||"用户"}！`,showClose:!0,duration:2e3}),console.log("登录成功，准备跳转到:",l.value),console.log("当前用户ID:",localStorage.getItem("userId")),console.log("当前Token:",localStorage.getItem("jwt_token")),await I.push(l.value)}}catch{let e=m("login.error");h.error({message:e,showClose:!0,duration:5e3})}}}},R={class:"login-container"},A={class:"login-card"},H={class:"login-left"},J={class:"image-container"},O={class:"image-overlay"},$={class:"welcome-title"},G={class:"welcome-subtitle"},K={class:"login-right"},Q={class:"form-header"},W={class:"form-title"},X={class:"form-subtitle"},Y={class:"form-footer"},Z={class:"register-text"},ee=U({__name:"Login",setup(I){const u=S(),m=v(!1),{t:s,form:l,handleLogin:r}=F(),b=async()=>{m.value=!0;try{await r()}finally{m.value=!1}},k=()=>{u.push("/register")};return(g,e)=>{const _=c("el-icon"),f=c("el-input"),d=c("el-form-item"),y=c("el-checkbox"),V=c("el-button"),x=c("el-form"),C=c("el-link");return j(),N("div",R,[a("div",A,[a("div",H,[a("div",J,[e[3]||(e[3]=a("img",{src:L,alt:"宠物",class:"login-image"},null,-1)),a("div",O,[a("h1",$,i(o(s)("login.welcomeTitle")||"欢迎回来"),1),a("p",G,i(o(s)("login.welcomeSubtitle")||"登录您的账户，继续您的宠物之旅"),1)])])]),a("div",K,[a("div",Q,[a("h2",W,i(o(s)("login.title")),1),a("p",X,i(o(s)("login.subtitle")||"请输入您的账户信息"),1)]),t(x,{model:o(l),ref:"loginForm","label-width":"0",class:"login-form"},{default:n(()=>[t(d,null,{default:n(()=>[t(f,{modelValue:o(l).username,"onUpdate:modelValue":e[0]||(e[0]=p=>o(l).username=p),placeholder:o(s)("login.usernamePlaceholder"),size:"large"},{prefix:n(()=>[t(_,null,{default:n(()=>[t(o(q))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),t(d,null,{default:n(()=>[t(f,{modelValue:o(l).password,"onUpdate:modelValue":e[1]||(e[1]=p=>o(l).password=p),type:"password",placeholder:o(s)("login.passwordPlaceholder"),size:"large","show-password":""},{prefix:n(()=>[t(_,null,{default:n(()=>[t(o(E))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),t(d,{class:"remember-me-item"},{default:n(()=>[t(y,{modelValue:o(l).rememberMe,"onUpdate:modelValue":e[2]||(e[2]=p=>o(l).rememberMe=p),class:"remember-me-checkbox"},{default:n(()=>[w(i(o(s)("login.rememberMe")),1)]),_:1},8,["modelValue"])]),_:1}),t(d,null,{default:n(()=>[t(V,{type:"primary",onClick:b,size:"large",class:"submit-btn",loading:m.value},{default:n(()=>[w(i(o(s)("login.userLogin")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),a("div",Y,[a("p",Z,[w(i(o(s)("login.noAccount")||"还没有账户？")+" ",1),t(C,{type:"primary",onClick:k,underline:!1},{default:n(()=>[w(i(o(s)("login.registerLink")),1)]),_:1})])])])])])}}}),ae=D(ee,[["__scopeId","data-v-e63c4b5b"]]);export{ae as default};
