import{u as b,h as w,i as v,j as k,k as S,E as u,l as I,d as x,c as M,o as y,a as o,t as d,m as e,p as L,q as g,v as f,g as h,s as P,e as U,w as V,r as q,_ as F}from"./index-CzjmnDZ-.js";import{u as N}from"./user-BSv0veCE.js";import{s as C}from"./request-Dybetxu6.js";const B=()=>{const p=I(),r=v(),{t}=b(),i=N(),m=w("/user");r.query.from&&(m.value=r.query.from);const a=k({username:"",password:"",rememberMe:!1});return{t,form:a,routerPath:m,handleLogin:async()=>{try{const n=(await C.post("/user/login",{username:a.username,password:a.password})).data;if(n.ok){const c=n.token;if(!c){console.error("登录响应中没有token字段"),u.error("登录失败：服务器未返回token");return}localStorage.setItem("userId",n.userId.toString()),localStorage.setItem("jwt_token",c),localStorage.setItem("token",c),localStorage.setItem("rememberedUsername",a.username),a.rememberMe&&localStorage.setItem("rememberedPassword",a.password),i.info.userId=n.userId,i.info.userName=n.userName||"",console.log("登录成功，开始获取完整用户资料..."),await i.fetchProfile(),await p.push(m.value),console.log(t("redirectSuccessTo"),m.value)}else u.error(n.message||t("loginFailed")),console.log(t("loginFailedServerReturn"),n.message)}catch(s){console.error("登录请求失败:",s),u.error(s.message||"网络错误，请检查网络连接")}},initForm:()=>{S(()=>{const s=localStorage.getItem("rememberedUsername"),n=localStorage.getItem("rememberedPassword");s&&n&&(a.username=s,a.password=n,a.rememberMe=!0)})}}},D={class:"login-container"},E={class:"login-box"},R={class:"login-header"},T={class:"form-group"},j={for:"username"},z=["placeholder"],A={class:"form-group"},G={for:"password"},H=["placeholder"],J={class:"form-group remember-me"},K={class:"checkbox-label"},O={type:"submit",class:"login-btn"},Q={class:"register-link"},W=x({__name:"Login",setup(p){const{t:r,form:t,handleLogin:i,initForm:m}=B();return m(),(a,l)=>{const _=q("router-link");return y(),M("div",D,[o("div",E,[o("div",R,[o("h2",null,d(e(r)("login.title")),1)]),o("form",{onSubmit:l[3]||(l[3]=L((...s)=>e(i)&&e(i)(...s),["prevent"])),class:"login-form"},[o("div",T,[o("label",j,d(e(r)("login.username"))+":",1),g(o("input",{type:"text",id:"username","onUpdate:modelValue":l[0]||(l[0]=s=>e(t).username=s),required:"",placeholder:e(r)("login.usernamePlaceholder")},null,8,z),[[f,e(t).username]])]),o("div",A,[o("label",G,d(e(r)("login.password"))+":",1),g(o("input",{type:"password",id:"password","onUpdate:modelValue":l[1]||(l[1]=s=>e(t).password=s),required:"",placeholder:e(r)("login.passwordPlaceholder")},null,8,H),[[f,e(t).password]])]),o("div",J,[o("label",K,[g(o("input",{type:"checkbox","onUpdate:modelValue":l[2]||(l[2]=s=>e(t).rememberMe=s)},null,512),[[P,e(t).rememberMe]]),h(" "+d(e(r)("login.rememberMe")),1)])]),o("button",O,d(e(r)("login.userLogin")),1),o("div",Q,[U(_,{to:"/register"},{default:V(()=>[h(d(e(r)("login.register")),1)]),_:1})])],32)])])}}}),$=F(W,[["__scopeId","data-v-6a3b722f"]]);export{$ as default};
