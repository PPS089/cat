import{_ as L}from"./dog-CLIpk0wi.js";import{u as M,h as k,i as P,j as U,k as F,E as g,l as y,d as q,c as E,o as R,a as n,t as c,m as s,e as a,w as m,r as d,g as h,p as T,q as j,_ as z}from"./index-C-QPrTeL.js";import{u as B}from"./user-CgNrBVWj.js";import{s as D}from"./request-C9ntlt9z.js";const A=()=>{const w=y(),_=P(),{t:u}=M(),t=B(),i=k("/user");_.query.from&&(i.value=_.query.from);const l=U({username:"",password:"",rememberMe:!1});return{t:u,form:l,routerPath:i,handleLogin:async()=>{try{if(!l.username.trim()){g.warning({message:"请输入用户名",showClose:!0,duration:3e3});return}if(!l.password.trim()){g.warning({message:"请输入密码",showClose:!0,duration:3e3});return}const e=(await D.post("/user/login",{username:l.username,password:l.password})).data;if(e.ok){const r=e.token;if(!r){g.error({message:"登录失败：服务器响应异常，请稍后重试",showClose:!0,duration:5e3});return}localStorage.removeItem("jwt_token"),localStorage.removeItem("userId"),localStorage.removeItem("userName"),localStorage.removeItem("rememberedUsername"),localStorage.removeItem("rememberedPassword"),localStorage.setItem("userId",e.userId.toString()),localStorage.setItem("jwt_token",r),localStorage.setItem("userName",e.userName||""),localStorage.setItem("rememberedUsername",l.username),l.rememberMe&&localStorage.setItem("rememberedPassword",l.password),t.info.userId=e.userId,t.info.userName=e.userName||"",localStorage.setItem("userInfo",JSON.stringify(t.info)),console.log("登录成功，开始获取完整用户资料..."),await t.fetchProfile(),g.success({message:`欢迎回来，${e.userName||"用户"}！`,showClose:!0,duration:2e3}),await w.push(i.value),console.log(u("redirectSuccessTo"),i.value)}else{let r="登录失败";e.message&&(e.message.includes("用户名")||e.message.includes("密码")?r="用户名或密码错误，请检查后重新输入":e.message.includes("不存在")?r="用户不存在，请检查用户名或注册新账号":r=e.message),g.error({message:r,showClose:!0,duration:5e3}),console.log(u("loginFailedServerReturn"),e.message)}}catch(o){console.error("登录请求失败:",o);let e="登录失败，请稍后重试";o.response?o.response.status===401?e="用户名或密码错误，请检查后重新输入":o.response.status===403?e="账号已被禁用，请联系管理员":o.response.status===404?e="用户不存在，请检查用户名或注册新账号":o.response.status>=500&&(e="服务器内部错误，请稍后重试"):o.request?e="网络连接失败，请检查网络设置":o.message&&(o.message.includes("Network Error")?e="网络连接失败，请检查网络设置":o.message.includes("timeout")&&(e="请求超时，请稍后重试")),g.error({message:e,showClose:!0,duration:5e3})}},initForm:()=>{F(()=>{const o=localStorage.getItem("rememberedUsername"),e=localStorage.getItem("rememberedPassword");o&&e&&(l.username=o,l.password=e,l.rememberMe=!0)})}}},H={class:"login-container"},J={class:"login-card"},O={class:"login-left"},$={class:"image-container"},G={class:"image-overlay"},K={class:"welcome-title"},Q={class:"welcome-subtitle"},W={class:"login-right"},X={class:"form-header"},Y={class:"form-title"},Z={class:"form-subtitle"},ee={class:"form-footer"},se={class:"register-text"},oe=q({__name:"Login",setup(w){const _=y(),u=k(!1),{t,form:i,handleLogin:l,initForm:b}=A();b();const v=async()=>{u.value=!0;try{await l()}finally{u.value=!1}},o=()=>{_.push("/register")};return(e,r)=>{const I=d("el-icon"),S=d("el-input"),p=d("el-form-item"),V=d("el-checkbox"),x=d("el-button"),C=d("el-form"),N=d("el-link");return R(),E("div",H,[n("div",J,[n("div",O,[n("div",$,[r[3]||(r[3]=n("img",{src:L,alt:"宠物",class:"login-image"},null,-1)),n("div",G,[n("h1",K,c(s(t)("login.welcomeTitle")||"欢迎回来"),1),n("p",Q,c(s(t)("login.welcomeSubtitle")||"登录您的账户，继续您的宠物之旅"),1)])])]),n("div",W,[n("div",X,[n("h2",Y,c(s(t)("login.title")),1),n("p",Z,c(s(t)("login.subtitle")||"请输入您的账户信息"),1)]),a(C,{model:s(i),ref:"loginForm","label-width":"0",class:"login-form"},{default:m(()=>[a(p,null,{default:m(()=>[a(S,{modelValue:s(i).username,"onUpdate:modelValue":r[0]||(r[0]=f=>s(i).username=f),placeholder:s(t)("login.usernamePlaceholder"),size:"large"},{prefix:m(()=>[a(I,null,{default:m(()=>[a(s(T))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),a(p,null,{default:m(()=>[a(S,{modelValue:s(i).password,"onUpdate:modelValue":r[1]||(r[1]=f=>s(i).password=f),type:"password",placeholder:s(t)("login.passwordPlaceholder"),size:"large","show-password":""},{prefix:m(()=>[a(I,null,{default:m(()=>[a(s(j))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),a(p,{class:"remember-me-item"},{default:m(()=>[a(V,{modelValue:s(i).rememberMe,"onUpdate:modelValue":r[2]||(r[2]=f=>s(i).rememberMe=f),class:"remember-me-checkbox"},{default:m(()=>[h(c(s(t)("login.rememberMe")),1)]),_:1},8,["modelValue"])]),_:1}),a(p,null,{default:m(()=>[a(x,{type:"primary",onClick:v,size:"large",class:"submit-btn",loading:u.value},{default:m(()=>[h(c(s(t)("login.userLogin")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),n("div",ee,[n("p",se,[h(c(s(t)("login.noAccount")||"还没有账户？")+" ",1),a(N,{type:"primary",onClick:o,underline:!1},{default:m(()=>[h(c(s(t)("login.registerLink")),1)]),_:1})])])])])])}}}),ne=z(oe,[["__scopeId","data-v-a3c1f13f"]]);export{ne as default};
