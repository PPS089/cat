import{u as $,h as T,E as N,k as G,d as R,V as W,x as H,O as V,o as _,w as v,l as e,U as Y,r as y,N as q,P as J,c as C,e as m,F,f as B,a as t,z as E,t as n,g as z,C as K,v as Q,n as X,B as Z,W as ee}from"./index-n6QoKQtw.js";import{s as I}from"./request-BS93o2BH.js";import{useThemeStore as te}from"./theme-D8ZsPEis.js";import{u as oe,g as se}from"./index-D6ote5Do.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as ne}from"./Pagination-CmoWuIJY.js";import"./genderConverter-BYQQyR-S.js";const U=()=>{const{t:l}=$(),o=T([]),r=T(!1),g=T(!1),c=T(null),h=T("");return{timeline:o,loading:r,dialogVisible:g,selectedPetId:c,selectedPetName:h,loadAdoptionTimeline:async(i,b)=>{try{r.value=!0,c.value=i,h.value=b;const p=await I.get(`/pets/${i}/adoption-timeline`);if(p.code===200&&p.data.timeline!==void 0){const u=p.data;o.value=u.timeline,g.value=!0}else N.error(p.message||l("user.loadTimelineFailed"))}catch{N.error(l("user.loadTimelineFailed"))}finally{r.value=!1}},closeDialog:()=>{g.value=!1,o.value=[],c.value=null,h.value=""},getActionTypeText:i=>({adopted:l("user.adopted"),fostered:l("user.fostered"),foster_ended:l("user.fosterEnded"),returned:l("user.returned")})[i]||i}},ae=()=>{const l=G();return{browsePets:()=>{l.push("/user/adoption-pets")}}},ie=()=>{const l=T([]),o=T(1),r=T(10),g=T(0),c=T(!1),{t:h}=$(),d=async(i=1,b=10)=>{try{o.value=i,r.value=b;const p=await I.get("/user/adoptions",{params:{current_page:i,per_page:b}});if(p.code==200){const u=p.data;g.value=u.total;const S=u.records.map(s=>({id:s.aid,adoptDate:s.adoptionDate,foster_status:"available",pet:{pid:s.pid,name:s.name,species:s.species||"",breed:s.breed,age:s.age,gender:s.gender,image:s.image?s.image.startsWith("http")?s.image:`/api/images/${s.image}`:"/src/assets/img/dog.jpg",petStatus:s.petStatus||""},shelter:{sid:s.sid,sname:s.sname||"",location:s.location||""}}));l.value=S}}catch{N.error(h("user.loadAdoptionsFailed"))}};return{adoptions:l,currentPage:o,pageSize:r,total:g,loading:c,loadAdoptions:d,handlePageChange:i=>{d(i,r.value)},handleSizeChange:i=>{d(1,i)}}},le=()=>{const{browsePets:l}=ae(),{adoptions:o,loadAdoptions:r,currentPage:g,pageSize:c,total:h,handlePageChange:d,handleSizeChange:P}=ie(),A=te();return{adoptions:o,themeStore:A,currentPage:g,pageSize:c,total:h,browsePets:l,loadAdoptions:r,handlePageChange:d,handleSizeChange:P}},re={class:"timeline-container"},de={key:0,class:"empty-state"},ce={key:1,class:"timeline"},pe={class:"timeline-item-content"},ue={class:"item-header"},_e={class:"item-description"},ge={key:0,class:"item-shelter"},me={class:"dialog-footer"},he=R({__name:"Dialog",setup(l){const{t:o}=$(),r=oe().formatDate,g=W("adoptionTimeline")||U(),{timeline:c,loading:h,dialogVisible:d,selectedPetName:P,closeDialog:A,getActionTypeText:i}=g;H(d,u=>{console.log("弹窗状态变化:",u)});const b=u=>({adopted:"primary",fostered:"warning",foster_ended:"info",returned:"danger"})[u]||"info",p=u=>({adopted:"success",fostered:"warning",foster_ended:"info",returned:"danger"})[u]||"info";return(u,S)=>{const s=y("el-empty"),D=y("el-tag"),k=y("el-icon"),x=y("el-card"),w=y("el-timeline-item"),a=y("el-timeline"),M=y("el-button"),L=y("el-dialog"),O=J("loading");return _(),V(L,{modelValue:e(d),"onUpdate:modelValue":S[0]||(S[0]=f=>Y(d)?d.value=f:null),title:`${e(o)("user.adoptionTimeline")} - ${e(P)}`,width:"60%","close-on-click-modal":!1,onClose:e(A)},{footer:v(()=>[t("span",me,[m(M,{onClick:e(A)},{default:v(()=>[z(n(e(o)("common.close")),1)]),_:1},8,["onClick"])])]),default:v(()=>[q((_(),C("div",re,[e(c).length===0?(_(),C("div",de,[m(s,{description:e(o)("user.noTimelineRecords")},null,8,["description"])])):(_(),C("div",ce,[m(a,null,{default:v(()=>[(_(!0),C(F,null,B(e(c),f=>(_(),V(w,{key:f.id,timestamp:e(r)(f.actionDate),type:b(f.action),placement:"top"},{default:v(()=>[m(x,null,{default:v(()=>[t("div",pe,[t("div",ue,[t("h4",null,n(e(i)(f.action)),1),m(D,{type:p(f.action),size:"small"},{default:v(()=>[z(n(f.status),1)]),_:2},1032,["type"])]),t("p",_e,n(f.description),1),f.shelterName?(_(),C("div",ge,[m(k,null,{default:v(()=>[m(e(K))]),_:1}),t("span",null,n(f.shelterName),1)])):E("",!0)])]),_:2},1024)]),_:2},1032,["timestamp","type"]))),128))]),_:1})]))])),[[O,e(h)]])]),_:1},8,["modelValue","title","onClose"])}}}),fe=j(he,[["__scopeId","data-v-93afa61f"]]),ve={class:"page-header"},ye={class:"adoptions-content"},Te={key:0,class:"empty-state"},Ce={key:1,class:"adoptions-list"},Ae={class:"pet-image"},be=["src","alt"],ke={class:"adoption-details"},Pe={class:"pet-info"},Se={class:"pet-breed"},De={class:"pet-age"},we={class:"adoption-info"},ze={class:"label"},$e={class:"value"},xe={class:"adoption-info"},Ne={class:"label"},Ve={class:"value"},Fe={class:"adoption-actions"},Me=R({__name:"Adoptions",setup(l){const{t:o}=$(),r=U(),{loadAdoptionTimeline:g}=r;ee("adoptionTimeline",r);const{adoptions:c,themeStore:h,currentPage:d,pageSize:P,total:A,browsePets:i,loadAdoptions:b,handlePageChange:p,handleSizeChange:u}=le(),S=(D,k)=>{console.log(`点击查看领养时间线 - 宠物ID: ${D}, 名称: ${k}`),g(D,k)},s=D=>o(D==="FOSTERING"?"user.adoptionStatusFostering":"user.adoptionStatusNormal");return Q(()=>{b()}),(D,k)=>{const x=y("el-icon"),w=y("el-button");return _(),C(F,null,[t("div",{class:X(["adoptions-container",{dark:e(h).preferences.theme==="dark"}])},[t("div",ve,[t("h1",null,n(e(o)("user.adoptionRecords")),1),t("p",null,n(e(o)("user.viewAdoptionHistory")),1)]),t("div",ye,[e(c).length===0?(_(),C("div",Te,[m(x,null,{default:v(()=>[m(e(Z))]),_:1}),t("h3",null,n(e(o)("user.noAdoptionRecords")),1),t("p",null,n(e(o)("user.noAdoptionYet")),1),m(w,{type:"primary",onClick:e(i)},{default:v(()=>[z(n(e(o)("user.browseAdoptablePets")),1)]),_:1},8,["onClick"])])):(_(),C("div",Ce,[(_(!0),C(F,null,B(e(c),a=>(_(),C("div",{key:a.id,class:"adoption-card"},[t("div",Ae,[t("img",{src:a.pet.image||"/src/assets/img/dog.jpg",alt:a.pet.name},null,8,be)]),t("div",ke,[t("div",Pe,[t("h3",null,n(a.pet.name),1),t("p",Se,n(a.pet.breed),1),t("p",De,n(a.pet.age)+n(e(o)("user.yearsOld"))+" · "+n(e(se)(a.pet.gender)),1)]),t("div",we,[t("span",ze,n(e(o)("user.shelter"))+":",1),t("span",$e,n(a.shelter.sname),1)]),t("div",xe,[t("span",Ne,n(e(o)("user.status"))+":",1),t("span",Ve,n(s(a.pet.petStatus)),1)]),t("div",Fe,[m(w,{type:"primary",size:"small",onClick:M=>S(a.pet.pid,a.pet.name)},{default:v(()=>[z(n(e(o)("user.viewAdoptionTimeline")),1)]),_:1},8,["onClick"])])])]))),128)),e(A)>0?(_(),V(ne,{key:0,"current-page":e(d),"page-size":e(P),total:e(A),"page-sizes":[5,10,20,50],layout:"total, sizes, prev, pager, next, jumper","onUpdate:currentPage":k[0]||(k[0]=a=>d.value=a),"onUpdate:pageSize":k[1]||(k[1]=a=>P.value=a),onPageChange:e(p),onSizeChange:e(u)},null,8,["current-page","page-size","total","onPageChange","onSizeChange"])):E("",!0)]))])],2),m(fe)],64)}}}),Oe=j(Me,[["__scopeId","data-v-3a4e5926"]]);export{Oe as default};
