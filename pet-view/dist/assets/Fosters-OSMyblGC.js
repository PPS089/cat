import{I,u as b,h as v,J as N,E as z,d as M,v as V,c as F,o as h,a as s,t as o,l as e,O as R,z as $,e as y,w as D,r as C,F as L,f as O,n as U,C as j,g as S,_ as G}from"./index-BrRsyrLM.js";import{s as x}from"./request-DVyWtN3q.js";import{useThemeStore as H}from"./theme-nJHyLohD.js";import{d as J}from"./dog-DzFJ_7DI.js";import{u as W,g as Y}from"./genderDisplay-DkcuqKsU.js";import{P as q}from"./Pagination-0xkjxAsg.js";import"./genderConverter-CAxqKJGy.js";const A=()=>{const{t:i}=b();return{deleteFoster:async(d,c,r,m,u)=>{try{const p=Number(d);if(await N.confirm(i("user.confirmDeleteFoster"),i("user.confirmDeleteFosterTitle"),{confirmButtonText:i("common.confirm"),cancelButtonText:i("common.cancel"),type:"warning"}),(await x.delete(`/fosters/delete/${p}`)).code===200){const l=c.value.findIndex(g=>g.id===p);l!==-1&&(c.value.splice(l,1),r.value=Math.max(0,r.value-1)),z.success(i("user.fosterDeleted")),c.value.length===0&&m.value>1&&m.value--,setTimeout(()=>u(),500)}}catch{z.error(i("user.deleteFosterFailed"))}}}},K=()=>{const{t:i}=b(),t=v([]),d=v(1),c=v(10),r=v(0),m=v(!1),u=async()=>{try{let g=(await x.get("/user/fosters",{params:{current_page:d.value,per_page:c.value}})).data;g.records&&g.total!==void 0?(r.value=g.total,t.value=g.records.map(n=>({id:n.fid||n.id,pet:{pid:n.pet?.pid,name:n.pet?.name,breed:n.pet?.breed,age:n.pet?.age,gender:n.pet?.gender,image:n.pet?.image?n.pet.image.startsWith("http")?n.pet.image:`/api/images/${n.pet.image}`:J},shelter:{sid:n.shelter?.sid,name:n.shelter?.name,location:n.shelter?.location},startDate:n.startDate,endDate:n.endDate,status:n.endDate?"ended":"ongoing"}))):t.value=[]}catch{t.value=[],r.value=0,z.error(i("user.loadFosterFailed"))}finally{m.value=!1}};return{fosters:t,loadFosters:u,currentPage:d,pageSize:c,total:r,loading:m,handlePageChange:l=>{d.value=l,u()},handleSizeChange:l=>{c.value=l,d.value=1,u()}}},Q=()=>{const{deleteFoster:i}=A(),{fosters:t,loadFosters:d,currentPage:c,pageSize:r,total:m,loading:u,handlePageChange:p,handleSizeChange:_}=K(),l=H(),g=I(()=>l.preferences.theme==="dark");return{fosters:t,isDark:g,currentPage:c,pageSize:r,total:m,loading:u,deleteFoster:i,loadFosters:d,handlePageChange:p,handleSizeChange:_,applyTheme:()=>{l.applyTheme()}}},X={class:"page-header"},Z={class:"fosters-content"},ee={key:0,class:"empty-state"},se={key:1,class:"fosters-list"},te={class:"pet-image"},ae=["src","alt"],ne={class:"foster-details"},oe={class:"pet-info"},le={class:"pet-breed"},re={class:"pet-age"},ie={class:"foster-info"},de={class:"info-item"},ce={class:"label"},ue={class:"value"},pe={class:"info-item"},ge={class:"label"},me={class:"value"},_e={class:"info-item"},he={class:"label"},ve={class:"value"},Fe={class:"info-item"},fe={class:"label"},ye={class:"foster-actions"},De=M({__name:"Fosters",setup(i){const{t}=b(),d=W().formatDate,{deleteFoster:c,fosters:r,isDark:m,loadFosters:u,currentPage:p,pageSize:_,total:l,handlePageChange:g,handleSizeChange:n,applyTheme:P}=Q(),w=async k=>{await c(k,r,l,p,u)};return V(()=>{u(),P()}),(k,f)=>{const T=C("el-icon"),B=C("el-tag"),E=C("el-button");return h(),F("div",{class:U(["fosters-container",{dark:e(m)}])},[s("div",X,[s("h1",null,o(e(t)("user.fosterRecords")),1),s("p",null,o(e(t)("user.viewFosterHistory")),1)]),s("div",Z,[e(r).length===0?(h(),F("div",ee,[y(T,null,{default:D(()=>[y(e(j))]),_:1}),s("h3",null,o(e(t)("user.noFosterRecords")),1),s("p",null,o(e(t)("user.noFosterYet")),1)])):(h(),F("div",se,[(h(!0),F(L,null,O(e(r),a=>(h(),F("div",{key:a.id,class:"foster-card"},[s("div",te,[s("img",{src:a.pet.image,alt:a.pet.name},null,8,ae)]),s("div",ne,[s("div",oe,[s("h3",null,o(a.pet.name),1),s("p",le,o(a.pet.breed),1),s("p",re,o(a.pet.age)+o(e(t)("user.yearsOld"))+" · "+o(e(Y)(a.pet.gender)),1)]),s("div",ie,[s("div",de,[s("span",ce,o(e(t)("user.fosterStart"))+"：",1),s("span",ue,o(e(d)(a.startDate)),1)]),s("div",pe,[s("span",ge,o(e(t)("user.fosterEnd"))+"：",1),s("span",me,o(a.endDate?e(d)(a.endDate):e(t)("user.ongoing")),1)]),s("div",_e,[s("span",he,o(e(t)("user.shelter"))+"：",1),s("span",ve,o(a.shelter?a.shelter.name:e(t)("user.unknown")),1)]),s("div",Fe,[s("span",fe,o(e(t)("user.status"))+"：",1),y(B,{type:a.status==="ongoing"?"warning":"success"},{default:D(()=>[S(o(a.status==="ongoing"?e(t)("user.ongoing"):e(t)("user.fosterEnded")),1)]),_:2},1032,["type"])])]),s("div",ye,[y(E,{type:"danger",size:"small",onClick:Ce=>w(a.id),disabled:!a.id||a.id===void 0||a.id===null},{default:D(()=>[S(o(e(t)("user.deleteRecord")),1)]),_:1},8,["onClick","disabled"])])])]))),128))])),e(l)>0?(h(),R(q,{key:2,"current-page":e(p),"page-size":e(_),total:e(l),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper","onUpdate:currentPage":f[0]||(f[0]=a=>p.value=a),"onUpdate:pageSize":f[1]||(f[1]=a=>_.value=a),onPageChange:e(g),onSizeChange:e(n)},null,8,["current-page","page-size","total","onPageChange","onSizeChange"])):$("",!0)])],2)}}}),Te=G(De,[["__scopeId","data-v-1d30feb0"]]);export{Te as default};
