import{u as A,k as I,h as _,E as g,J as E,d as T,v as M,c as C,o as h,a,t as n,l as s,O as V,z as S,F as $,f as L,e as b,w as y,r as w,n as O,g as z,_ as U}from"./index-BrRsyrLM.js";import{useThemeStore as R}from"./theme-nJHyLohD.js";import{s as x}from"./request-DVyWtN3q.js";import{P as J}from"./Pagination-0xkjxAsg.js";const j=()=>{const{t:l}=A(),t=I();return{viewPetDetail:c=>{if(c)try{t.push({name:"user-pet-detail",params:{id:c}})}catch(i){g.error(l("message.loadPetDetailFailed")||"加载宠物详情失败"),console.error("跳转到宠物详情页失败:",i)}else g.error(l("message.petInfoIncomplete")),console.error("尝试查看宠物详情时，宠物ID不完整",c)}}},D=()=>{const l=_(!1),t=_([]),r=_(1),c=_(12),i=_(0),{t:o}=A(),d=async()=>{l.value=!0;try{const u=await x.get("/pets/info/available",{params:{current_page:r.value,per_page:c.value}});if(u.code===200){const m=u.data;t.value=m.records.map(e=>({pid:e.pid,name:e.name,species:e.species,breed:e.breed||o("message.unknown"),age:e.age,gender:e.gender==="公"?"male":e.gender==="母"?"female":e.gender,status:e.status==="UNADOPTED"?"available":e.status,shelterName:e.shelterName||o("message.unknownShelter"),shelterAddress:e.shelterAddress||o("message.unknownAddress")})),i.value=m.total,console.log("获取到未领养宠物数量:",t.value.length,"总数:",m.total)}else g.error(o("message.dataLoadFailed"))}catch(u){console.error("获取可领养宠物失败:",u),g.error(o("message.dataLoadFailedRetry"))}};return{loading:l,availablePets:t,currentPage:r,pageSize:c,total:i,fetchAvailablePets:d,handlePageChange:u=>{r.value=u,d()},handleSizeChange:u=>{c.value=u,r.value=1,d()}}},q=(l=null)=>{const{t}=A(),{fetchAvailablePets:r}=D();return{adoptPet:async i=>{try{await E.confirm(`${t("message.confirmAdoption")} ${i.name}？`,t("message.confirmAdoption"),{confirmButtonText:t("message.confirmButton"),cancelButtonText:t("message.cancelButton"),type:"warning"});const o=await x.post("/pets/adopt",null,{params:{petId:i.pid}});return o.code===200?(g.success(t("message.adoptionSuccess")),await r(),l&&l.value&&(l.value=l.value.filter(d=>d.pid!==i.pid)),!0):(console.log("领养失败，响应码:",o.code,"消息:",o.message),g.error(o.message||t("message.adoptFailed")),!1)}catch(o){if(o!=="cancel"){const d=o.response?.data?.message;return d?.includes("已被领养")||d?.includes("已有领养记录")?(g.error(t("message.petAlreadyAdopted")||"该宠物已被其他人领养，页面将自动刷新"),await r()):g.error(d||t("message.adoptFailed")),!1}return!1}}}},G=()=>{const{viewPetDetail:l}=j(),{loading:t,availablePets:r,currentPage:c,pageSize:i,total:o,fetchAvailablePets:d,handlePageChange:v,handleSizeChange:f}=D(),{adoptPet:u}=q(r),m=R();return{viewPetDetail:l,loading:t,availablePets:r,currentPage:c,pageSize:i,total:o,fetchAvailablePets:d,handlePageChange:v,handleSizeChange:f,adoptPet:u,themeStore:m}},H={class:"adopt-pet-header"},K={class:"adopt-pet-main"},Q={class:"pets-grid"},W={class:"pet-header"},X={class:"pet-info"},Y={class:"info-item"},Z={class:"label"},ee={class:"value"},se={class:"info-item"},ae={class:"label"},te={class:"value"},ne={class:"info-item"},oe={class:"label"},re={class:"value"},le={class:"info-item"},ce={class:"label"},ie={class:"value"},de={class:"info-item"},pe={class:"label"},ue={class:"value"},ge={class:"pet-actions"},me={key:0,class:"no-pets"},_e={style:{"font-size":"14px",color:"var(--el-text-color-secondary)","margin-top":"10px"}},he=T({__name:"AdoptionsPets",setup(l){const{availablePets:t,currentPage:r,pageSize:c,total:i,themeStore:o,fetchAvailablePets:d,adoptPet:v,viewPetDetail:f,handlePageChange:u,handleSizeChange:m}=G(),{t:e}=A();return M(()=>{d()}),(ve,P)=>{const N=w("el-tag"),k=w("el-button"),B=w("el-empty");return h(),C("div",{class:O(["adopt-pet-container",{dark:s(o).preferences.theme==="dark"}])},[a("header",H,[a("h1",null,n(s(e)("nav.adoptCenter")),1)]),a("main",K,[a("div",Q,[(h(!0),C($,null,L(s(t),p=>(h(),C("div",{key:p.pid,class:"pet-card"},[a("div",W,[a("h3",null,n(p.name),1),b(N,{type:"success"},{default:y(()=>[z(n(s(e)("nav.adoptable")),1)]),_:1})]),a("div",X,[a("div",Y,[a("span",Z,n(s(e)("nav.breed"))+"：",1),a("span",ee,n(p.breed),1)]),a("div",se,[a("span",ae,n(s(e)("nav.age"))+"：",1),a("span",te,n(p.age)+" "+n(s(e)("message.yearsOld")),1)]),a("div",ne,[a("span",oe,n(s(e)("nav.gender"))+"：",1),a("span",re,n(p.gender==="male"?s(e)("message.male"):s(e)("message.female")),1)]),a("div",le,[a("span",ce,n(s(e)("nav.shelter"))+"：",1),a("span",ie,n(p.shelterName),1)]),a("div",de,[a("span",pe,n(s(e)("nav.address"))+"：",1),a("span",ue,n(p.shelterAddress),1)])]),a("div",ge,[b(k,{type:"primary",onClick:F=>s(v)(p)},{default:y(()=>[z(n(s(e)("nav.adoptNow")),1)]),_:1},8,["onClick"]),b(k,{onClick:F=>s(f)(p.pid)},{default:y(()=>[z(n(s(e)("nav.viewDetails")),1)]),_:1},8,["onClick"])])]))),128)),s(t).length===0?(h(),C("div",me,[b(B,{description:s(e)("nav.noPetsAvailable")},{description:y(()=>[a("p",null,n(s(e)("nav.noPetsAvailable")),1),a("p",_e,n(s(e)("nav.allPetsAdopted")),1)]),_:1},8,["description"])])):S("",!0)]),s(i)>0?(h(),V(J,{key:0,"current-page":s(r),"page-size":s(c),total:s(i),"page-sizes":[6,12,24,48],layout:"sizes, prev, pager, next, ->, total","onUpdate:currentPage":P[0]||(P[0]=p=>r.value=p),"onUpdate:pageSize":P[1]||(P[1]=p=>c.value=p),onPageChange:s(u),onSizeChange:s(m)},null,8,["current-page","page-size","total","onPageChange","onSizeChange"])):S("",!0)])],2)}}}),ye=U(he,[["__scopeId","data-v-933f44b9"]]);export{ye as default};
