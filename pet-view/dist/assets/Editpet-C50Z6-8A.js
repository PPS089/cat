import{h as c,E as f,d as $,u as G,v as T,c as L,o as P,a as v,t as p,l as a,N as M,P as O,O as z,w as n,r as i,n as A,e as o,g as b,k as j,i as H}from"./index-n6QoKQtw.js";import{useThemeStore as J}from"./theme-D8ZsPEis.js";import{s as F}from"./request-BS93o2BH.js";import{a as N,s as K}from"./genderConverter-BYQQyR-S.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";c();const x=c(!1);c(!1);const s=c({name:"",species:"",breed:"",age:0,gender:"male"}),W=async(u,e,t)=>{const l=Number(t.params.id);try{const r=K(s.value.gender,"frontend","backend"),_={name:s.value.name,species:s.value.species,breed:s.value.breed,age:s.value.age,gender:r};if(l&&l>0)await X(l,_),f.success(u("message.updateSuccess"));else{f.warning(u("message.pleaseAdoptPetInstead")||"请通过领养方式获取宠物，而不是直接添加"),e.push("/user/adoptions");return}e.push("/user/pets")}catch(r){throw console.error("操作宠物失败:",r),f.error(r.response?.data?.message||u("message.operationFailed")||"操作失败"),r}},X=async(u,e)=>{try{return(await F.put(`/pets/${u}`,e)).data}catch(t){throw console.error("更新宠物失败:",t),t}},Y=async u=>{try{const e=await F.get(`/pets/details/${u}`);if(e&&e.data){const t=e.data,l=N(t.gender);return{pid:t.pid,name:t.name,species:t.species,breed:t.breed,age:t.age,gender:l}}return null}catch(e){throw e}},C=async(u,e,t)=>{const l=Number(t.params.id);if(!l||l===0){s.value={name:"",species:"",breed:"",age:0,gender:"male"};return}x.value=!0;try{const r=await Y(l);if(!r){f.error(u("message.petNotFound")),e.push("/user/adoption-pets");return}const _=N(r.gender);s.value={name:r.name,species:r.species,breed:r.breed,age:r.age,gender:_}}catch(r){f.error(r.response?.data?.message||u("message.loadPetDetailFailed")),e.push("/user/adoption-pets")}finally{x.value=!1}},Z={class:"edit-pet-header"},ee={class:"edit-pet-main"},ae={style:{"margin-left":"10px"}},re=$({__name:"Editpet",setup(u){const{t:e}=G(),t=J(),l=H(),r=j(),_=c(!1),h=c(!1),y=c(),S={name:[{required:!0,message:e("common.pleaseEnter"),trigger:"blur"},{min:2,max:20,message:e("message.nameLengthError"),trigger:"blur"}],species:[{required:!0,message:e("common.pleaseEnter"),trigger:"blur"}],breed:[{required:!0,message:e("common.pleaseEnter"),trigger:"blur"}],age:[{required:!0,message:e("common.pleaseEnter"),trigger:"blur"},{type:"number",min:0,max:30,message:e("message.ageRangeError"),trigger:"blur"}],gender:[{required:!0,message:e("message.pleaseSelectGender"),trigger:"change"}]},B=async()=>{y.value&&await y.value.validate(async V=>{if(V){h.value=!0;try{await W(e,r,l)}finally{h.value=!1}}else f.warning(e("message.pleaseCompleteForm"))})},D=()=>{C(e,r,l)};return T(()=>{C(e,r,l)}),(V,d)=>{const w=i("el-input"),g=i("el-form-item"),I=i("el-input-number"),k=i("el-radio"),R=i("el-radio-group"),E=i("el-button"),q=i("el-form"),U=O("loading");return P(),L("div",{class:A(["edit-pet-container",{dark:a(t).preferences.theme==="dark"}])},[v("header",Z,[v("h1",null,p(a(e)("pets.editPet")),1)]),v("main",ee,[M((P(),z(q,{ref_key:"petFormRef",ref:y,model:a(s),rules:S,"label-width":"120px",class:"pet-form"},{default:n(()=>[o(g,{label:a(e)("user.name"),prop:"name"},{default:n(()=>[o(w,{modelValue:a(s).name,"onUpdate:modelValue":d[0]||(d[0]=m=>a(s).name=m),placeholder:a(e)("user.pleaseEnterPetName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(g,{label:a(e)("user.species"),prop:"species"},{default:n(()=>[o(w,{modelValue:a(s).species,"onUpdate:modelValue":d[1]||(d[1]=m=>a(s).species=m),placeholder:a(e)("user.pleaseEnterSpecies")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(g,{label:a(e)("user.breed"),prop:"breed"},{default:n(()=>[o(w,{modelValue:a(s).breed,"onUpdate:modelValue":d[2]||(d[2]=m=>a(s).breed=m),placeholder:a(e)("user.pleaseEnterBreed")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(g,{label:a(e)("user.age"),prop:"age"},{default:n(()=>[o(I,{modelValue:a(s).age,"onUpdate:modelValue":d[3]||(d[3]=m=>a(s).age=m),min:0,max:30},null,8,["modelValue"]),v("span",ae,p(a(e)("user.yearsOld")),1)]),_:1},8,["label"]),o(g,{label:a(e)("user.gender"),prop:"gender"},{default:n(()=>[o(R,{modelValue:a(s).gender,"onUpdate:modelValue":d[4]||(d[4]=m=>a(s).gender=m)},{default:n(()=>[o(k,{label:"male"},{default:n(()=>[b(p(a(e)("user.male")),1)]),_:1}),o(k,{label:"female"},{default:n(()=>[b(p(a(e)("user.female")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(g,null,{default:n(()=>[o(E,{type:"primary",onClick:B,loading:h.value},{default:n(()=>[b(p(a(e)("common.save")),1)]),_:1},8,["loading"]),o(E,{onClick:D},{default:n(()=>[b(p(a(e)("common.reset")),1)]),_:1}),o(E,{onClick:d[5]||(d[5]=m=>V.$router.back())},{default:n(()=>[b(p(a(e)("common.cancel")),1)]),_:1})]),_:1})]),_:1},8,["model"])),[[U,_.value]])])],2)}}}),de=Q(re,[["__scopeId","data-v-a860a677"]]);export{de as default};
