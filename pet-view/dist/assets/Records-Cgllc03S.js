import{h as U,M as K,j as _e,E as T,d as he,u as ge,k as fe,a1 as ye,c as d,o as r,a as e,D as M,t as i,m as t,q as F,a0 as R,F as I,f as S,v as oe,g as se,n as N,W as ke,p as ce,_ as be}from"./index-CzjmnDZ-.js";import{s as H}from"./request-Dybetxu6.js";import{u as Me}from"./user-BSv0veCE.js";import{useThemeStore as we}from"./theme-BvsCIQ48.js";const Ee=10*1024*1024,ie=200,ue=.8,Fe=500,Te={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"},me={happy:{emoji:"ðŸ˜Š",class:"mood-happy"},calm:{emoji:"ðŸ˜Œ",class:"mood-calm"},excited:{emoji:"ðŸ¤—",class:"mood-excited"},sad:{emoji:"ðŸ˜¢",class:"mood-sad"},sick:{emoji:"ðŸ˜·",class:"mood-sick"},angry:{emoji:"ðŸ˜ ",class:"mood-angry"}},L={image:{icon:"el-icon-picture",types:["image/jpeg","image/png","image/gif","image/webp"]},video:{icon:"el-icon-video-play",types:["video/mp4","video/webm","video/ogg"]},default:{icon:"el-icon-document"}},pe={record_id:"",pid:"",event_type:"",mood:"",description:"",location:"",record_time:""},Ue=()=>({getMoodEmoji:m=>me[m]?.emoji||"ðŸ˜",getMoodClass:m=>{const l=m;return{[me[l]?.class||"mood-default"]:!0,"mood-default":!m||!l}}}),ve=()=>({formatDate:l=>{if(!l)return"æœªçŸ¥æ—¶é—´";try{const a=new Date(l);return isNaN(a.getTime())?"æ— æ•ˆæ—¥æœŸ":a.toLocaleString("zh-CN",Te)}catch(a){return console.error("æ—¥æœŸæ ¼å¼åŒ–é”™è¯¯:",a),"æ ¼å¼é”™è¯¯"}},formatDateTimeForAPI:l=>l?l.replace("T"," ")+":00":"",formatDateTimeFromAPI:l=>{if(!l)return"";try{const a=l.replace(" ","T"),h=new Date(a);if(!isNaN(h.getTime()))return h.toISOString().slice(0,16);const y=l.split(" ");return y.length===2?`${y[0]}T${y[1].slice(0,5)}`:""}catch(a){return console.error("Error parsing date:",a,l),""}}}),Ce=()=>{const c=U([]),s=u=>L.image.types.includes(u.type)||L.video.types.includes(u.type),m=u=>L.image.types.includes(u.type)?"image":L.video.types.includes(u.type)?"video":"image",l=u=>L.image.types.includes(u)?L.image.icon:L.video.types.includes(u)?L.video.icon:L.default.icon,a=u=>u<1024?u+" B":u<1024*1024?(u/1024).toFixed(1)+" KB":(u/(1024*1024)).toFixed(1)+" MB",h=u=>new Promise(p=>{const v=document.createElement("canvas"),k=v.getContext("2d"),g=new Image;g.onload=()=>{const E=Math.min(ie/g.width,ie/g.height);v.width=g.width*E,v.height=g.height*E,k?.drawImage(g,0,0,v.width,v.height),p(v.toDataURL("image/jpeg",ue))},g.src=URL.createObjectURL(u)}),y=u=>new Promise(p=>{const v=document.createElement("video"),k=document.createElement("canvas"),g=k.getContext("2d");v.onloadeddata=()=>{v.currentTime=1},v.onseeked=()=>{const E=Math.min(ie/v.videoWidth,ie/v.videoHeight);k.width=v.videoWidth*E,k.height=v.videoHeight*E,g?.drawImage(v,0,0,k.width,k.height),p(k.toDataURL("image/jpeg",ue))},v.src=URL.createObjectURL(u)}),b=async u=>{const p=m(u);return p==="image"?h(u):p==="video"?y(u):""};return{filePreviews:c,handleFileUpload:async u=>{const p=u.target.files;if(!p)return;const v=[];for(let k=0;k<p.length;k++){const g=p[k];if(g.size>Ee){T.warning(`æ–‡ä»¶ ${g.name} è¶…è¿‡10MBé™åˆ¶`);continue}if(!s(g)){T.warning(`æ–‡ä»¶ ${g.name} æ ¼å¼ä¸æ”¯æŒ`);continue}const E=await b(g);v.push({file:g,previewUrl:URL.createObjectURL(g),thumbnailUrl:E||"",mediaType:m(g),validationError:void 0,isValid:!0})}c.value=[...c.value,...v]},removeFile:u=>{const p=c.value[u];p&&(URL.revokeObjectURL(p.previewUrl),p.thumbnailUrl&&URL.revokeObjectURL(p.thumbnailUrl)),c.value.splice(u,1)},clearAllFiles:()=>{c.value.forEach(u=>{URL.revokeObjectURL(u.previewUrl),u.thumbnailUrl&&URL.revokeObjectURL(u.thumbnailUrl)}),c.value=[]},getUploadFiles:()=>c.value.map(u=>u.file),getFileIcon:l,formatFileSize:a}},De=()=>{const c=U(!1),s=U([]),m=U(!1);return{showMediaModal:c,currentMediaList:s,mediaLoading:m,openMediaModal:async h=>{s.value=h,c.value=!0},closeMediaModal:()=>{c.value=!1,s.value=[]}}},Ie=()=>{const c=U([]),s=U(!1);return{events:c,loading:s,fetchEvents:async()=>{s.value=!0;try{const l=await H.get("/events");c.value=l.data||[]}catch(l){console.error("èŽ·å–äº‹ä»¶åˆ—è¡¨å¤±è´¥:",l),T.error("èŽ·å–äº‹ä»¶åˆ—è¡¨å¤±è´¥"),c.value=[]}finally{s.value=!1}}}},Se=()=>{const c=U([]);return{pets:c,fetchPets:async()=>{try{const l=await H.get("/pets");c.value=l.data||[]}catch(l){console.error("èŽ·å–å® ç‰©åˆ—è¡¨å¤±è´¥:",l),T.error("èŽ·å–å® ç‰©åˆ—è¡¨å¤±è´¥"),c.value=[]}},getPetName:l=>{const a=c.value.find(h=>h.pid===Number(l));return a?a.name:"æœªçŸ¥å® ç‰©"}}},Le=c=>({deleteEvent:async l=>{try{await H.delete(`/events/${l}`),T.success("åˆ é™¤æˆåŠŸ"),await c.fetchEvents()}catch(a){console.error("åˆ é™¤äº‹ä»¶å¤±è´¥:",a),T.error("åˆ é™¤äº‹ä»¶å¤±è´¥")}},uploadMediaFiles:async(l,a)=>{const h=new FormData;l.forEach(b=>{h.append("files",b)}),h.append("recordId",a.toString());const y=await H.post("/events/upload",h,{headers:{"Content-Type":"multipart/form-data"}});if(!y.data?.success)throw new Error(y.data?.message||"ä¸Šä¼ å¤±è´¥")}}),Pe=c=>{const s=_e({selectedPet:"",selectedEventType:"",selectedMood:"",selectedDate:""}),m=K(()=>{let l=[...c.value];return s.selectedPet&&(l=l.filter(a=>a.pid.toString()===s.selectedPet)),s.selectedEventType&&(l=l.filter(a=>a.event_type===s.selectedEventType)),s.selectedMood&&(l=l.filter(a=>a.mood===s.selectedMood)),s.selectedDate&&(l=l.filter(a=>new Date(a.record_time).toDateString()===new Date(s.selectedDate).toDateString())),l});return{filters:s,filteredEvents:m}},je=c=>{const s=U("record_time"),m=K(()=>{const l=[...c.value];return l.sort((a,h)=>{switch(s.value){case"event_type":return a.event_type.localeCompare(h.event_type);case"mood":return(a.mood||"").localeCompare(h.mood||"");case"record_time":default:return new Date(h.record_time).getTime()-new Date(a.record_time).getTime()}}),l});return{sortBy:s,sortedEvents:m}},Re=c=>({groupedEvents:K(()=>{const m={};return c.value.forEach(l=>{const a=new Date(l.record_time).toDateString();m[a]||(m[a]=[]),m[a].push(l)}),m})}),Ne=()=>{const c=_e({...pe}),s=()=>{Object.assign(c,pe)},{formatDateTimeFromAPI:m}=ve();return{formData:c,resetForm:s,populateForm:a=>{Object.assign(c,{...a,record_time:m(a.record_time)})}}},$e=()=>{const{events:c,loading:s,fetchEvents:m}=Ie(),{pets:l,fetchPets:a,getPetName:h}=Se(),{getMoodEmoji:y,getMoodClass:b}=Ue(),{formatDate:$,formatDateTimeForAPI:q}=ve(),{filePreviews:A,handleFileUpload:Q,removeFile:u,clearAllFiles:p,getUploadFiles:v,getFileIcon:k,formatFileSize:g}=Ce(),{showMediaModal:E,currentMediaList:X,mediaLoading:ne,openMediaModal:le,closeMediaModal:de}=De(),{filters:z,filteredEvents:x}=Pe(c),{sortBy:W,sortedEvents:P}=je(x),{groupedEvents:Z}=Re(P),{formData:w,resetForm:re,populateForm:ae}=Ne(),{deleteEvent:G,uploadMediaFiles:O}=Le({fetchEvents:m}),V=U(!1),D=U(!1),J=U("grid"),j=K(()=>c.value.length),C=K(()=>c.value.reduce((_,B)=>_+(B.media_list?.length||0),0)),n=_=>{ae(_),D.value=!0},o=()=>{V.value=!1,D.value=!1,p(),re()};return{events:c,pets:l,loading:s,filters:z,viewMode:J,sortBy:W,showAddModal:V,showEditModal:D,showMediaModal:E,mediaLoading:ne,formData:w,filePreviews:A,currentMediaList:X,totalEvents:j,totalMedia:C,filteredEvents:x,sortedEvents:P,groupedEvents:Z,fetchEvents:m,fetchPets:a,getPetName:h,getMoodEmoji:y,getMoodClass:b,formatDate:$,handleFileUpload:Q,removeFile:u,getFileIcon:k,formatFileSize:g,openMediaModal:le,closeMediaModal:de,editEvent:n,deleteEvent:G,saveEvent:async()=>{try{const _=q(w.record_time),B={pid:w.pid,eventType:w.event_type,recordTime:_,description:w.description,mood:w.mood||"",location:w.location||""};let ee=null;if(D.value&&w.record_id)await H.put(`/events/${w.record_id}`,B),ee=Number(w.record_id),T.success("äº‹ä»¶æ›´æ–°æˆåŠŸ");else{const Y=await H.post("/events",B);ee=Y.data?.eid||Y.data?.record_id||Y.data?.id,T.success("äº‹ä»¶æ·»åŠ æˆåŠŸ")}const te=v();if(te&&te.length>0&&ee)try{console.log(`å¼€å§‹ä¸Šä¼ ${te.length}ä¸ªæ–‡ä»¶...`),await O(te,ee),T.success("äº‹ä»¶ä¿å­˜æˆåŠŸï¼Œåª’ä½“æ–‡ä»¶ä¸Šä¼ å®Œæˆ")}catch(Y){console.warn("äº‹ä»¶æ·»åŠ æˆåŠŸï¼Œä½†æ–‡ä»¶ä¸Šä¼ å¤±è´¥",Y),T.warning("äº‹ä»¶æ·»åŠ æˆåŠŸï¼Œä½†æ–‡ä»¶ä¸Šä¼ å¤±è´¥")}console.log("saveEventHandler: å¼€å§‹é‡æ–°èŽ·å–äº‹ä»¶æ•°æ®..."),setTimeout(async()=>{await m(),console.log("saveEventHandler: äº‹ä»¶æ•°æ®é‡æ–°èŽ·å–å®Œæˆ"),o()},Fe)}catch(_){T.error(D.value?"äº‹ä»¶æ›´æ–°å¤±è´¥":"äº‹ä»¶æ·»åŠ å¤±è´¥"),console.error("Error saving event:",_),_.response&&(console.error("Error response:",_.response.data),console.error("Error status:",_.response.status))}},closeModal:o}},Ae={class:"page-header"},xe={class:"stats-grid"},Oe={class:"stat-card"},Ve={class:"stat-content"},Be={class:"stat-card"},He={class:"stat-content"},qe={class:"stat-card"},ze={class:"stat-content"},We={class:"controls-section"},Ge={class:"filter-group"},Ye={style:{position:"relative"}},Ke=["disabled"],Qe={value:""},Xe=["value"],Ze={key:0,style:{position:"absolute",top:"-20px",left:"0",color:"#666"}},Je={value:""},et={value:"å–‚é£Ÿ"},tt={value:"æ´—æ¾¡"},ot={value:"æ•£æ­¥"},st={value:"çœ‹å…½åŒ»"},it={value:"çŽ©è€"},nt={value:"æ‰“ç–«è‹—"},lt={value:""},dt={value:"å¼€å¿ƒ"},rt={value:"ç”Ÿæ°”"},at={value:"ç–²å€¦"},ct={value:"æ´»è·ƒ"},ut=["placeholder"],mt={class:"view-controls"},pt={class:"view-toggle"},_t={class:"sort-controls"},vt={value:"record_time"},ht={value:"event_type"},gt={value:"mood"},ft={class:"events-content"},yt={key:0,class:"events-grid"},kt={class:"event-header"},bt={class:"pet-info"},Mt={class:"event-type"},wt={key:0,class:"event-mood"},Et={class:"mood-emoji"},Ft={class:"mood-text"},Tt={class:"event-content"},Ut={class:"description"},Ct={key:0,class:"location"},Dt={key:0,class:"event-media"},It={class:"media-preview"},St=["src","alt","onClick"],Lt=["src","onClick"],Pt=["onClick"],jt={class:"event-footer"},Rt={class:"event-time"},Nt={class:"record-time"},$t={class:"created-time"},At={class:"event-actions"},xt=["onClick"],Ot=["onClick","disabled"],Vt={key:1,class:"events-list"},Bt={class:"list-header"},Ht={class:"col-pet"},qt={class:"col-type"},zt={class:"col-mood"},Wt={class:"col-description"},Gt={class:"col-time"},Yt={class:"col-actions"},Kt={class:"col-pet"},Qt={class:"pet-info"},Xt={class:"col-type"},Zt={class:"event-type-badge"},Jt={class:"col-mood"},eo={key:0,class:"mood-indicator"},to={class:"mood-emoji"},oo={class:"col-description"},so={class:"description-text"},io={key:0,class:"location-small"},no={class:"col-time"},lo={class:"time-text"},ro={class:"col-actions"},ao=["onClick"],co=["onClick","disabled"],uo={key:2,class:"timeline-view"},mo={class:"timeline"},po={class:"timeline-date"},_o={class:"timeline-items"},vo={class:"timeline-content"},ho={class:"timeline-header"},go={class:"event-type-badge"},fo={key:0,class:"mood-indicator"},yo={class:"mood-emoji"},ko={class:"description"},bo={key:0,class:"location"},Mo={class:"timeline-footer"},wo={class:"time-text"},Eo={class:"timeline-actions"},Fo=["onClick"],To=["onClick","disabled"],Uo={class:"modal-header"},Co={class:"form-group"},Do={value:""},Io=["value"],So={class:"form-group"},Lo={value:""},Po={value:"å–‚é£Ÿ"},jo={value:"æ´—æ¾¡"},Ro={value:"æ•£æ­¥"},No={value:"çœ‹å…½åŒ»"},$o={value:"çŽ©è€"},Ao={value:"æ‰“ç–«è‹—"},xo={class:"form-group"},Oo={value:""},Vo={value:"å¼€å¿ƒ"},Bo={value:"ç”Ÿæ°”"},Ho={value:"ç–²å€¦"},qo={value:"æ´»è·ƒ"},zo={class:"form-group"},Wo={class:"form-group"},Go=["placeholder"],Yo={class:"form-group"},Ko=["placeholder"],Qo={class:"form-group"},Xo={class:"media-upload"},Zo={class:"upload-area"},Jo={for:"media-file-input",class:"upload-label"},es={class:"upload-text"},ts={class:"upload-hint"},os={key:0,class:"uploaded-files"},ss={class:"uploaded-files-title"},is={class:"file-preview-grid"},ns={class:"preview-thumbnail"},ls=["src","alt"],ds={key:1,class:"preview-video-placeholder"},rs={class:"file-info-full"},as={class:"file-name-container"},cs={class:"file-icon"},us=["title"],ms={class:"file-size-type"},ps={class:"file-size"},_s={class:"file-type"},vs=["onClick","title"],hs={class:"upload-hint-text"},gs={class:"modal-actions"},fs={type:"submit",class:"save-btn"},ys={class:"media-modal-header"},ks={key:0,class:"media-loading"},bs={key:1,class:"media-empty"},Ms={key:2,class:"media-carousel"},ws=["src","alt"],Es=["src"],Fs=he({__name:"Records",setup(c){const{t:s}=ge(),m=Me(),l=we(),a=()=>{if(typeof window>"u")return;const C=localStorage.getItem("jwt_token")||localStorage.getItem("token"),n=localStorage.getItem("userName")||localStorage.getItem("username"),o=localStorage.getItem("userId")||localStorage.getItem("userid");console.log("åŒæ­¥ç”¨æˆ·çŠ¶æ€:",{token:!!C,username:n,userId:o}),C&&n&&o?(m.info.userName=n,m.info.userId=parseInt(o),console.log("ç”¨æˆ·çŠ¶æ€åŒæ­¥æˆåŠŸ:",{userName:n,userId:parseInt(o)})):(console.log("ç”¨æˆ·çŠ¶æ€ä¸å®Œæ•´ï¼Œéœ€è¦é‡æ–°ç™»å½•",{token:C,username:n,userId:o}),C||(localStorage.removeItem("userName"),localStorage.removeItem("userId"),localStorage.removeItem("username"),localStorage.removeItem("userid"),m.info.userName="",m.info.userId=0))},{pets:h,filters:y,viewMode:b,sortBy:$,showAddModal:q,showEditModal:A,showMediaModal:Q,mediaLoading:u,formData:p,filePreviews:v,currentMediaList:k,totalEvents:g,totalMedia:E,sortedEvents:X,groupedEvents:ne,fetchEvents:le,fetchPets:de,getPetName:z,getMoodEmoji:x,getMoodClass:W,formatDate:P,handleFileUpload:Z,removeFile:w,getFileIcon:re,formatFileSize:ae,openMediaModal:G,closeMediaModal:O,editEvent:V,deleteEvent:D,saveEvent:J,closeModal:j}=$e();return fe(async()=>{if(a(),!(typeof window<"u"&&!localStorage.getItem("jwt_token")))try{await de(),await ye(),await le()}catch(C){console.error("records.vue: æ•°æ®èŽ·å–å¤±è´¥:",C)}}),(C,n)=>(r(),d("div",{class:N(["events-container",{"dark-theme":t(l).preferences.theme==="dark"}])},[e("div",Ae,[e("h1",null,i(t(s)("records.pageTitle")),1),e("p",null,i(t(s)("records.pageSubtitle")),1)]),e("div",xe,[e("div",Oe,[n[24]||(n[24]=e("div",{class:"stat-icon"},"ðŸ“…",-1)),e("div",Ve,[e("h3",null,i(t(g)),1),e("p",null,i(t(s)("records.totalEvents")),1)])]),e("div",Be,[n[25]||(n[25]=e("div",{class:"stat-icon"},"ðŸ•",-1)),e("div",He,[e("h3",null,i(t(h).length),1),e("p",null,i(t(s)("records.totalPets")),1)])]),e("div",qe,[n[26]||(n[26]=e("div",{class:"stat-icon"},"ðŸ“¸",-1)),e("div",ze,[e("h3",null,i(t(E)),1),e("p",null,i(t(s)("records.totalMedia")),1)])])]),e("div",We,[e("div",Ge,[e("div",Ye,[F(e("select",{"onUpdate:modelValue":n[0]||(n[0]=o=>t(y).selectedPet=o),class:"filter-select",disabled:t(h).length===0},[e("option",Qe,i(t(h).length===0?t(s)("records.loading"):t(s)("records.allPets")),1),(r(!0),d(I,null,S(t(h),o=>(r(),d("option",{key:o.pid,value:o.pid},i(o.name),9,Xe))),128))],8,Ke),[[R,t(y).selectedPet]]),t(h).length>0?(r(),d("small",Ze,i(t(s)("records.foundPets",{count:t(h).length})),1)):M("",!0)]),F(e("select",{"onUpdate:modelValue":n[1]||(n[1]=o=>t(y).selectedEventType=o),class:"filter-select"},[e("option",Je,i(t(s)("records.allEvents")),1),e("option",et,i(t(s)("records.feeding")),1),e("option",tt,i(t(s)("records.bathing")),1),e("option",ot,i(t(s)("records.walking")),1),e("option",st,i(t(s)("records.veterinary")),1),e("option",it,i(t(s)("records.playing")),1),e("option",nt,i(t(s)("records.vaccination")),1)],512),[[R,t(y).selectedEventType]]),F(e("select",{"onUpdate:modelValue":n[2]||(n[2]=o=>t(y).selectedMood=o),class:"filter-select"},[e("option",lt,i(t(s)("records.allMood")),1),e("option",dt,i(t(s)("records.happy")),1),e("option",rt,i(t(s)("records.angry")),1),e("option",at,i(t(s)("records.tired")),1),e("option",ct,i(t(s)("records.active")),1)],512),[[R,t(y).selectedMood]]),F(e("input",{type:"date","onUpdate:modelValue":n[3]||(n[3]=o=>t(y).selectedDate=o),class:"filter-input",placeholder:t(s)("records.selectDate")},null,8,ut),[[oe,t(y).selectedDate]])]),e("button",{class:"add-button",onClick:n[4]||(n[4]=o=>q.value=!0)},[n[27]||(n[27]=e("span",null,"+",-1)),se(" "+i(t(s)("records.addEvent")),1)])]),e("div",mt,[e("div",pt,[e("button",{class:N({active:t(b)==="grid"}),onClick:n[5]||(n[5]=o=>b.value="grid")},i(t(s)("records.gridView")),3),e("button",{class:N({active:t(b)==="list"}),onClick:n[6]||(n[6]=o=>b.value="list")},i(t(s)("records.listView")),3),e("button",{class:N({active:t(b)==="timeline"}),onClick:n[7]||(n[7]=o=>b.value="timeline")},i(t(s)("records.timeline")),3)]),e("div",_t,[F(e("select",{"onUpdate:modelValue":n[8]||(n[8]=o=>ke($)?$.value=o:null),class:"sort-select"},[e("option",vt,i(t(s)("records.sortByTime")),1),e("option",ht,i(t(s)("records.sortByType")),1),e("option",gt,i(t(s)("records.sortByMood")),1)],512),[[R,t($)]])])]),e("div",ft,[t(b)==="grid"?(r(),d("div",yt,[(r(!0),d(I,null,S(t(X),o=>(r(),d("div",{key:o.record_id,class:N(["event-card",o.mood?t(W)(o.mood):{}])},[e("div",kt,[e("div",bt,[e("h4",null,i(t(z)(o.pid,o.pet_name)),1),e("span",Mt,i(o.event_type),1)]),o.mood?(r(),d("div",wt,[e("span",Et,i(t(x)(o.mood)),1),e("span",Ft,i(o.mood),1)])):M("",!0)]),e("div",Tt,[e("p",Ut,i(o.description),1),o.location?(r(),d("div",Ct,[n[28]||(n[28]=e("span",{class:"location-icon"},"ðŸ“",-1)),se(" "+i(o.location),1)])):M("",!0)]),o.media_list&&o.media_list.length>0?(r(),d("div",Dt,[e("div",It,[(r(!0),d(I,null,S(o.media_list.slice(0,3),f=>(r(),d("div",{key:f.id,class:"media-item"},[f.media_type==="image"?(r(),d("img",{key:0,src:f.media_url,alt:o.event_type,onClick:_=>t(G)([],o.record_id),style:{cursor:"pointer"}},null,8,St)):f.media_type==="video"?(r(),d("video",{key:1,src:f.media_url,onClick:_=>t(G)([],o.record_id),style:{cursor:"pointer"}},null,8,Lt)):M("",!0)]))),128)),o.media_list.length>3?(r(),d("div",{key:0,class:"media-count",onClick:f=>t(G)([],o.record_id),style:{cursor:"pointer"}}," +"+i(o.media_list.length-3),9,Pt)):M("",!0)])])):M("",!0),e("div",jt,[e("div",Rt,[e("span",Nt,i(t(P)(o.record_time)),1),e("span",$t,i(t(s)("records.recordedAt"))+" "+i(t(P)(o.created_at)),1)]),e("div",At,[e("button",{class:"action-btn edit-btn",onClick:f=>t(V)(o)},i(t(s)("records.edit")),9,xt),e("button",{class:"action-btn delete-btn",onClick:f=>t(D)(o.record_id),disabled:!o.record_id},i(t(s)("records.delete")),9,Ot)])])],2))),128))])):t(b)==="list"?(r(),d("div",Vt,[e("div",Bt,[e("div",Ht,i(t(s)("records.pet")),1),e("div",qt,i(t(s)("records.eventType")),1),e("div",zt,i(t(s)("records.mood")),1),e("div",Wt,i(t(s)("records.description")),1),e("div",Gt,i(t(s)("records.time")),1),e("div",Yt,i(t(s)("records.actions")),1)]),(r(!0),d(I,null,S(t(X),o=>(r(),d("div",{key:o.record_id,class:N(["list-item",o.mood?t(W)(o.mood):{}])},[e("div",Kt,[e("div",Qt,[e("h4",null,i(t(z)(o.pid,o.pet_name)),1)])]),e("div",Xt,[e("span",Zt,i(o.event_type),1)]),e("div",Jt,[o.mood?(r(),d("span",eo,[e("span",to,i(t(x)(o.mood)),1),se(" "+i(o.mood),1)])):M("",!0)]),e("div",oo,[e("p",so,i(o.description),1),o.location?(r(),d("div",io," ðŸ“ "+i(o.location),1)):M("",!0)]),e("div",no,[e("span",lo,i(t(P)(o.record_time)),1)]),e("div",ro,[e("button",{class:"action-btn edit-btn",onClick:f=>t(V)(o)},i(t(s)("records.edit")),9,ao),e("button",{class:"action-btn delete-btn",onClick:f=>t(D)(o.record_id),disabled:!o.record_id},i(t(s)("records.delete")),9,co)])],2))),128))])):(r(),d("div",uo,[e("div",mo,[(r(!0),d(I,null,S(t(ne),(o,f)=>(r(),d("div",{key:f,class:"timeline-group"},[e("div",po,i(t(P)(f)),1),e("div",_o,[(r(!0),d(I,null,S(o,_=>(r(),d("div",{key:_.record_id,class:N(["timeline-item",_.mood?t(W)(_.mood):{}])},[n[29]||(n[29]=e("div",{class:"timeline-marker"},null,-1)),e("div",vo,[e("div",ho,[e("h4",null,i(t(z)(_.pid,_.pet_name)),1),e("span",go,i(_.event_type),1),_.mood?(r(),d("span",fo,[e("span",yo,i(t(x)(_.mood)),1),se(" "+i(_.mood),1)])):M("",!0)]),e("p",ko,i(_.description),1),_.location?(r(),d("div",bo," ðŸ“ "+i(_.location),1)):M("",!0),e("div",Mo,[e("span",wo,i(t(P)(_.record_time)),1),e("div",Eo,[e("button",{class:"action-btn edit-btn",onClick:B=>t(V)(_)},i(t(s)("records.edit")),9,Fo),e("button",{class:"action-btn delete-btn",onClick:B=>t(D)(_.record_id),disabled:!_.record_id},i(t(s)("records.delete")),9,To)])])])],2))),128))])]))),128))])]))]),t(q)||t(A)?(r(),d("div",{key:0,class:"modal-overlay",onClick:n[20]||(n[20]=(...o)=>t(j)&&t(j)(...o))},[e("div",{class:"modal-content",onClick:n[19]||(n[19]=ce(()=>{},["stop"]))},[e("div",Uo,[e("h3",null,i(t(A)?t(s)("records.editEvent"):t(s)("records.addEvent")),1),e("button",{class:"close-btn",onClick:n[9]||(n[9]=(...o)=>t(j)&&t(j)(...o))},"Ã—")]),e("form",{onSubmit:n[18]||(n[18]=ce((...o)=>t(J)&&t(J)(...o),["prevent"])),class:"modal-form"},[e("div",Co,[e("label",null,i(t(s)("records.pet")),1),F(e("select",{"onUpdate:modelValue":n[10]||(n[10]=o=>t(p).pid=o),required:"",class:"form-select"},[e("option",Do,i(t(s)("records.selectPet")),1),(r(!0),d(I,null,S(t(h),o=>(r(),d("option",{key:o.pid,value:o.pid},i(o.name),9,Io))),128))],512),[[R,t(p).pid]])]),e("div",So,[e("label",null,i(t(s)("records.eventType")),1),F(e("select",{"onUpdate:modelValue":n[11]||(n[11]=o=>t(p).event_type=o),required:"",class:"form-select"},[e("option",Lo,i(t(s)("records.selectType")),1),e("option",Po,i(t(s)("records.feeding")),1),e("option",jo,i(t(s)("records.bathing")),1),e("option",Ro,i(t(s)("records.walking")),1),e("option",No,i(t(s)("records.veterinary")),1),e("option",$o,i(t(s)("records.playing")),1),e("option",Ao,i(t(s)("records.vaccination")),1)],512),[[R,t(p).event_type]])]),e("div",xo,[e("label",null,i(t(s)("records.mood")),1),F(e("select",{"onUpdate:modelValue":n[12]||(n[12]=o=>t(p).mood=o),class:"form-select"},[e("option",Oo,i(t(s)("records.selectMood")),1),e("option",Vo,i(t(s)("records.happy")),1),e("option",Bo,i(t(s)("records.angry")),1),e("option",Ho,i(t(s)("records.tired")),1),e("option",qo,i(t(s)("records.active")),1)],512),[[R,t(p).mood]])]),e("div",zo,[e("label",null,i(t(s)("records.eventTime")),1),F(e("input",{type:"datetime-local","onUpdate:modelValue":n[13]||(n[13]=o=>t(p).record_time=o),required:"",class:"form-input"},null,512),[[oe,t(p).record_time]])]),e("div",Wo,[e("label",null,i(t(s)("records.location")),1),F(e("input",{type:"text","onUpdate:modelValue":n[14]||(n[14]=o=>t(p).location=o),placeholder:t(s)("records.locationOptional"),class:"form-input"},null,8,Go),[[oe,t(p).location]])]),e("div",Yo,[e("label",null,i(t(s)("records.detailedDescription")),1),F(e("textarea",{"onUpdate:modelValue":n[15]||(n[15]=o=>t(p).description=o),rows:"4",placeholder:t(s)("records.pleaseEnterDescription"),required:"",class:"form-textarea"},null,8,Ko),[[oe,t(p).description]])]),e("div",Qo,[e("label",null,i(t(s)("records.mediaFiles")),1),e("div",Xo,[e("div",Zo,[e("input",{type:"file",multiple:"",accept:"image/*,video/*",onChange:n[16]||(n[16]=(...o)=>t(Z)&&t(Z)(...o)),class:"file-input",id:"media-file-input"},null,32),e("label",Jo,[n[30]||(n[30]=e("div",{class:"upload-icon"},"ðŸ“",-1)),e("div",es,i(t(s)("records.clickToSelectOrDrag")),1),e("div",ts,i(t(s)("records.supportedFormats")),1)])])]),t(v).length>0?(r(),d("div",os,[e("div",ss,i(t(s)("records.uploadedFiles"))+" ("+i(t(v).length)+"/5)",1),e("div",is,[(r(!0),d(I,null,S(t(v),(o,f)=>(r(),d("div",{key:f,class:"file-preview-item"},[e("div",ns,[o.mediaType==="image"?(r(),d("img",{key:0,src:o.thumbnailUrl,alt:o.file.name,class:"preview-image"},null,8,ls)):(r(),d("div",ds,[...n[31]||(n[31]=[e("span",{class:"video-icon"},"ðŸŽ¬",-1)])]))]),e("div",rs,[e("div",as,[e("span",cs,i(t(re)(o.mediaType)),1),e("span",{class:"file-name",title:o.file.name},i(o.file.name),9,us)]),e("div",ms,[e("span",ps,i(t(ae)(o.file.size)),1),e("span",_s,i(o.mediaType==="image"?"(å›¾ç‰‡)":"(è§†é¢‘)"),1)])]),e("button",{type:"button",onClick:_=>t(w)(f),class:"remove-file-btn",title:t(s)("records.deleteFile")}," Ã— ",8,vs)]))),128))]),e("div",hs,i(t(v).length>=5?"å·²åˆ°è¾¾æœ€å¤§æ–‡ä»¶æ•°é™åˆ¶":`è¿˜å¯ä¸Šä¼  ${5-t(v).length} ä¸ªæ–‡ä»¶`),1)])):M("",!0)]),e("div",gs,[e("button",{type:"button",class:"cancel-btn",onClick:n[17]||(n[17]=(...o)=>t(j)&&t(j)(...o))},i(t(s)("records.cancel")),1),e("button",fs,i(t(A)?t(s)("records.update"):t(s)("records.save")),1)])],32)])])):M("",!0),t(Q)?(r(),d("div",{key:1,class:"media-modal-overlay",onClick:n[23]||(n[23]=(...o)=>t(O)&&t(O)(...o))},[e("div",{class:"media-modal-content",onClick:n[22]||(n[22]=ce(()=>{},["stop"]))},[e("div",ys,[e("h3",null,i(t(s)("records.mediaViewer")),1),e("button",{class:"close-btn",onClick:n[21]||(n[21]=(...o)=>t(O)&&t(O)(...o))},"Ã—")]),t(u)?(r(),d("div",ks,[...n[32]||(n[32]=[e("p",null,"æ­£åœ¨åŠ è½½åª’ä½“æ–‡ä»¶...",-1)])])):t(k).length===0?(r(),d("div",bs,[...n[33]||(n[33]=[e("p",null,"æ­¤äº‹ä»¶æ²¡æœ‰åª’ä½“æ–‡ä»¶",-1)])])):(r(),d("div",Ms,[(r(!0),d(I,null,S(t(k),(o,f)=>(r(),d("div",{key:f,class:"media-item"},[o.media_type==="image"?(r(),d("img",{key:0,src:o.media_url,alt:`Media ${f+1}`},null,8,ws)):o.media_type==="video"?(r(),d("video",{key:1,src:o.media_url,controls:""},null,8,Es)):M("",!0)]))),128))]))])])):M("",!0)],2))}}),Is=be(Fs,[["__scopeId","data-v-0329fafa"]]);export{Is as default};
