import{u as q,h,E as g,J,k as H,d as K,v as Q,x as W,c as p,o as d,a as n,O as U,z as C,e as k,t as l,l as e,F as D,f as G,n as X,w as P,U as L,r as w,g as M,_ as Y}from"./index-BrRsyrLM.js";import{s as x}from"./request-DVyWtN3q.js";import{useThemeStore as Z}from"./theme-nJHyLohD.js";import{P as ee}from"./Pagination-0xkjxAsg.js";function te(){const $=H(),{t:r}=q(),u=h([]),b=h([]),f=h(!1),m=h(null),_=h(null),F=h(1),v=h(5),a=h(0),S=h(0),z=()=>{$.push("/user/adoption-pets")},N=t=>{$.push(`pets/edit/${t}`)},V=async t=>{try{m.value=t,f.value=!0,_.value=null;const c=await x.get("/shelters");if(c.code===200){const i=c.data;b.value=i.map(o=>({sid:o.sid,shelterName:o.shelterName,shelterAddress:o.shelterAddress})),g.success(r("common.pleaseSelectShelter"))}}catch{g.error(r("getShelterListFailed"))}},E=async()=>{if(!_.value){g.warning(r("common.pleaseSelectShelter"));return}if(!m.value){g.warning(r("petNotSelected"));return}try{const t={shelterId:_.value,startDate:new Date().toISOString().split("T")[0]};if((await x.post(`/pets/${m.value.pid}/foster`,t)).code===200){g.success(r("fosterSuccess"));const i=m.value.pid;i&&(u.value=u.value.map(o=>o.pid===i?{...o,isFostering:!0}:o)),f.value=!1,m.value=null,_.value=null,await y()}else g.error(r("fosterFailed"))}catch(t){g.error(t.response?.data?.msg||r("fosterFailed"))}},I=async t=>{t<1||S.value>0&&t>S.value||await y(t,v.value)},B=async t=>{await y(1,t)},T=async t=>{try{if(await J.confirm(r("message.confirmEndFoster"),r("message.warning"),{confirmButtonText:r("message.confirm"),cancelButtonText:r("message.cancel"),type:"warning"}),(await x.post(`/pets/${t.pid}/foster/end`)).code===200){g.success(r("message.endFosterSuccess"));const i=t.pid;i&&(u.value=u.value.map(o=>o.pid===i?{...o,isFostering:!1}:o)),await y()}}catch(c){c!=="cancel"&&g.error(r("endFosterFailed"))}},y=async(t=F.value,c=v.value)=>{try{t<1&&(t=1),c<1&&(c=5);const o=(await x.get(`/user/adoptions?current_page=${t}&per_page=${c}`)).data;!o.records||o.records.length===0?(u.value=[],a.value=o.total||0,S.value=o.pages||0):(u.value=o.records||[],a.value=o.total||0,S.value=o.pages||0),F.value=t,v.value=c}catch(i){if(i.name==="AbortError")return;u.value=[],a.value=0,S.value=0,g.error(r("getPetDataFailed")||"èŽ·å–å® ç‰©æ•°æ®å¤±è´¥")}};return{pets:u,shelters:b,showFosterDialog:f,selectedShelter:_,currentPage:F,pageSize:v,total:a,t:r,addPet:z,editPet:N,startFoster:V,endFoster:T,confirmStartFoster:E,fetchPets:y,handlePageChange:I,handlePageSizeChange:B}}const se={class:"pets-header"},ae={class:"pets-main"},oe={class:"pets-list"},ne={key:0,class:"empty-state"},le={key:1,class:"pets-grid"},re={class:"pet-image"},ce=["src","alt"],ie={class:"pet-type-badge adoption"},de={class:"pet-info"},ue={key:0,class:"fostering-indicator"},pe={class:"pet-breed"},me={class:"pet-age"},ge={key:0,class:"pet-date"},fe={key:1,class:"pet-shelter"},_e={class:"pet-actions"},he=["onClick"],ve={class:"foster-status"},Se=["onClick"],ye=["onClick"],Fe={class:"dialog-footer"},ke=K({__name:"Mypets",setup($){const r=Z(),{pets:u,shelters:b,showFosterDialog:f,selectedShelter:m,currentPage:_,pageSize:F,total:v,t:a,addPet:S,editPet:z,startFoster:N,confirmStartFoster:V,endFoster:E,fetchPets:I,handlePageChange:B,handlePageSizeChange:T}=te();return Q(async()=>{I()}),W([_,F,v],([y,t,c],[i,o,A])=>{console.log("åˆ†é¡µçŠ¶æ€å˜åŒ–:",{currentPage:{old:i,new:y},pageSize:{old:o,new:t},total:{old:A,new:c}})}),(y,t)=>{const c=w("el-option"),i=w("el-select"),o=w("el-form-item"),A=w("el-form"),O=w("el-button"),j=w("el-dialog");return d(),p(D,null,[n("div",{class:X(["pets-container",{dark:e(r).preferences.theme==="dark"}])},[n("header",se,[n("h1",null,l(e(a)("nav.myPets")),1)]),n("main",ae,[n("div",oe,[e(u).length===0?(d(),p("div",ne,[n("p",null,l(e(a)("user.noAdoptionRecords")),1),n("button",{onClick:t[0]||(t[0]=(...s)=>e(S)&&e(S)(...s)),class:"add-first-pet-btn"},l(e(a)("user.goAdoptPet")),1)])):(d(),p("div",le,[(d(!0),p(D,null,G(e(u),s=>(d(),p("div",{key:s.pid,class:"pet-card"},[n("div",re,[n("img",{src:s.image||"/src/assets/img/dog.jpg",alt:s.name},null,8,ce),n("div",ie,l(e(a)("message.adoption")),1)]),n("div",de,[n("h3",null,[M(l(s.name)+" ",1),s.petStatus==="FOSTERING"||s.isFostering?(d(),p("span",ue,"("+l(e(a)("message.fostering"))+")",1)):C("",!0)]),n("p",pe,l(s.breed),1),n("p",me,l(s.age)+l(e(a)("message.yearsOld")),1),s.adoptionDate?(d(),p("p",ge,l(e(a)("message.adoptDate"))+": "+l(s.adoptionDate),1)):C("",!0),s.sname?(d(),p("p",fe,l(e(a)("message.shelter"))+": "+l(s.sname),1)):C("",!0),n("div",_e,[s.petStatus==="FOSTERING"||s.isFostering?(d(),p(D,{key:0},[n("button",{onClick:R=>e(E)(s),class:"end-foster-btn"},l(e(a)("message.endFoster")),9,he),n("div",ve,"ðŸ  "+l(e(a)("message.fostering")),1)],64)):(d(),p("button",{key:1,onClick:R=>e(N)(s),class:"start-foster-btn"},l(e(a)("message.startFoster")),9,Se)),n("button",{onClick:R=>e(z)(s.pid),class:"edit-btn"},l(e(a)("message.edit")),9,ye)])])]))),128))]))])])],2),e(v)>0?(d(),U(ee,{key:0,"current-page":e(_),"page-size":e(F),total:e(v),"page-sizes":[5,10,20,50],"onUpdate:currentPage":t[1]||(t[1]=s=>_.value=s),"onUpdate:pageSize":t[2]||(t[2]=s=>F.value=s),onPageChange:e(B),onSizeChange:e(T)},null,8,["current-page","page-size","total","onPageChange","onSizeChange"])):C("",!0),k(j,{modelValue:e(f),"onUpdate:modelValue":t[5]||(t[5]=s=>L(f)?f.value=s:null),title:e(a)("message.startFoster"),width:"500px","before-close":()=>f.value=!1},{footer:P(()=>[n("span",Fe,[k(O,{onClick:t[4]||(t[4]=s=>f.value=!1)},{default:P(()=>[M(l(e(a)("message.cancel")),1)]),_:1}),k(O,{type:"primary",onClick:e(V)},{default:P(()=>[M(l(e(a)("message.confirm")),1)]),_:1},8,["onClick"])])]),default:P(()=>[k(A,{model:{selectedShelter:e(m)},"label-width":"120px"},{default:P(()=>[k(o,{label:e(a)("message.selectShelter")},{default:P(()=>[k(i,{modelValue:e(m),"onUpdate:modelValue":t[3]||(t[3]=s=>L(m)?m.value=s:null),placeholder:e(a)("message.selectShelter"),style:{width:"100%"}},{default:P(()=>[k(c,{label:e(a)("message.selectShelter"),value:null},null,8,["label"]),(d(!0),p(D,null,G(e(b),s=>(d(),U(c,{key:s.sid,label:`${s.shelterName} - ${s.shelterAddress}`,value:s.sid},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title","before-close"])],64)}}}),De=Y(ke,[["__scopeId","data-v-003931c6"]]);export{De as default};
