import{u as $,h as T,E as F,l as W,d as B,V as H,x as Y,O as M,o as _,w as f,m as e,U as q,r as y,N as J,P as K,c as C,e as g,F as I,f as E,a as t,z as j,t as s,g as w,C as Q,_ as U,k as X,n as Z,B as ee,W as te}from"./index-C-QPrTeL.js";import{s as L}from"./request-C9ntlt9z.js";import{useThemeStore as oe}from"./theme-DZbca66G.js";import{u as G,g as se}from"./genderDisplay-biGsAX5C.js";import{P as ne}from"./Pagination-B0Zm-mWW.js";import"./genderConverter-CAxqKJGy.js";const O=()=>{const{t:r}=$(),o=T([]),c=T(!1),d=T(!1),m=T(null),h=T("");return{timeline:o,loading:c,dialogVisible:d,selectedPetId:m,selectedPetName:h,loadAdoptionTimeline:async(a,b)=>{try{c.value=!0,m.value=a,h.value=b,console.log(`开始获取宠物 ${a} 的领养时间线...`);const i=await L.get(`/pets/${a}/adoption-timeline`);if(console.log("API响应:",i),i.code===200&&i.data.timeline!==void 0){const u=i.data;o.value=u.timeline,d.value=!0}else console.error("API返回错误:",i.message),F.error(i.message||r("user.loadTimelineFailed"))}catch(i){console.error("获取领养记录时间线失败:",i),F.error(r("user.loadTimelineFailed"))}finally{c.value=!1}},closeDialog:()=>{d.value=!1,o.value=[],m.value=null,h.value=""},getActionTypeText:a=>({adopted:r("user.adopted"),fostered:r("user.fostered"),foster_ended:r("user.fosterEnded"),returned:r("user.returned")})[a]||a}},ae=()=>{const r=W();return{browsePets:()=>{r.push("/user/adoption-pets")}}},le=()=>{const r=T([]),o=T(1),c=T(10),d=T(0),m=T(!1),{t:h}=$(),p=async(a=1,b=10)=>{try{o.value=a,c.value=b;const i=await L.get("/user/adoptions",{params:{current_page:a,per_page:b}});if(i.code==200){const u=i.data;d.value=u.total;const P=u.records.map(n=>({id:n.aid,adoptDate:n.adoptionDate,foster_status:"available",pet:{id:n.pid,name:n.name,breed:n.breed,age:n.age,gender:n.gender,image:n.image?n.image.startsWith("http")?n.image:`http://localhost:8082/api/images/${n.image}`:"/src/assets/img/dog.jpg",status:n.petStatus},shelter:{id:n.sid,name:n.sname,location:n.location}}));console.log("转换后的数组领养记录:",P),r.value=P}}catch(i){console.error("加载领养记录失败:",i),F.error(h("user.loadAdoptionsFailed"))}};return{adoptions:r,currentPage:o,pageSize:c,total:d,loading:m,loadAdoptions:p,handlePageChange:a=>{p(a,c.value)},handleSizeChange:a=>{p(1,a)}}},ie=()=>{const{browsePets:r}=ae(),{adoptions:o,loadAdoptions:c,currentPage:d,pageSize:m,total:h,handlePageChange:p,handleSizeChange:k}=le(),A=oe();return{adoptions:o,themeStore:A,currentPage:d,pageSize:m,total:h,browsePets:r,loadAdoptions:c,handlePageChange:p,handleSizeChange:k}},re={class:"timeline-container"},ce={key:0,class:"empty-state"},de={key:1,class:"timeline"},pe={class:"timeline-item-content"},ue={class:"item-header"},_e={class:"item-description"},ge={key:0,class:"item-shelter"},me={class:"dialog-footer"},he=B({__name:"Dialog",setup(r){const{t:o}=$(),c=G().formatDate,d=H("adoptionTimeline")||O(),{timeline:m,loading:h,dialogVisible:p,selectedPetName:k,closeDialog:A,getActionTypeText:a}=d;Y(p,u=>{console.log("弹窗状态变化:",u)});const b=u=>({adopted:"primary",fostered:"warning",foster_ended:"info",returned:"danger"})[u]||"info",i=u=>({adopted:"success",fostered:"warning",foster_ended:"info",returned:"danger"})[u]||"info";return(u,P)=>{const n=y("el-empty"),x=y("el-tag"),S=y("el-icon"),D=y("el-card"),N=y("el-timeline-item"),z=y("el-timeline"),V=y("el-button"),l=y("el-dialog"),R=K("loading");return _(),M(l,{modelValue:e(p),"onUpdate:modelValue":P[0]||(P[0]=v=>q(p)?p.value=v:null),title:`${e(o)("user.adoptionTimeline")} - ${e(k)}`,width:"60%","close-on-click-modal":!1,onClose:e(A)},{footer:f(()=>[t("span",me,[g(V,{onClick:e(A)},{default:f(()=>[w(s(e(o)("common.close")),1)]),_:1},8,["onClick"])])]),default:f(()=>[J((_(),C("div",re,[e(m).length===0?(_(),C("div",ce,[g(n,{description:e(o)("user.noTimelineRecords")},null,8,["description"])])):(_(),C("div",de,[g(z,null,{default:f(()=>[(_(!0),C(I,null,E(e(m),v=>(_(),M(N,{key:v.id,timestamp:e(c)(v.actionDate),type:b(v.action),placement:"top"},{default:f(()=>[g(D,null,{default:f(()=>[t("div",pe,[t("div",ue,[t("h4",null,s(e(a)(v.action)),1),g(x,{type:i(v.action),size:"small"},{default:f(()=>[w(s(v.status),1)]),_:2},1032,["type"])]),t("p",_e,s(v.description),1),v.shelterName?(_(),C("div",ge,[g(S,null,{default:f(()=>[g(e(Q))]),_:1}),t("span",null,s(v.shelterName),1)])):j("",!0)])]),_:2},1024)]),_:2},1032,["timestamp","type"]))),128))]),_:1})]))])),[[R,e(h)]])]),_:1},8,["modelValue","title","onClose"])}}}),fe=U(he,[["__scopeId","data-v-93afa61f"]]),ve={class:"page-header"},ye={class:"adoptions-content"},Te={key:0,class:"empty-state"},Ce={key:1,class:"adoptions-list"},Ae={class:"pet-image"},be=["src","alt"],Pe={class:"adoption-details"},De={class:"pet-info"},ke={class:"pet-breed"},Se={class:"pet-age"},we={class:"adoption-info"},ze={class:"info-item"},$e={class:"label"},xe={class:"value"},Ne={class:"info-item"},Ve={class:"label"},Fe={class:"value"},Me={class:"info-item"},Ie={class:"label"},Re={class:"adoption-actions"},Be=B({__name:"Adoptions",setup(r){const{t:o}=$(),c=G().formatDate,d=O(),{loadAdoptionTimeline:m}=d;te("adoptionTimeline",d);const{adoptions:h,themeStore:p,currentPage:k,pageSize:A,total:a,browsePets:b,loadAdoptions:i,handlePageChange:u,handleSizeChange:P}=ie(),n=(S,D)=>{console.log(`点击查看领养时间线 - 宠物ID: ${S}, 名称: ${D}`),m(S,D)},x=S=>o(S==="FOSTERING"?"user.adoptionStatusFostering":"user.adoptionStatusNormal");return X(()=>{i()}),(S,D)=>{const N=y("el-icon"),z=y("el-button"),V=y("el-tag");return _(),C(I,null,[t("div",{class:Z(["adoptions-container",{dark:e(p).preferences.theme==="dark"}])},[t("div",ve,[t("h1",null,s(e(o)("user.adoptionRecords")),1),t("p",null,s(e(o)("user.viewAdoptionHistory")),1)]),t("div",ye,[e(h).length===0?(_(),C("div",Te,[g(N,null,{default:f(()=>[g(e(ee))]),_:1}),t("h3",null,s(e(o)("user.noAdoptionRecords")),1),t("p",null,s(e(o)("user.noAdoptionYet")),1),g(z,{type:"primary",onClick:e(b)},{default:f(()=>[w(s(e(o)("user.browseAdoptablePets")),1)]),_:1},8,["onClick"])])):(_(),C("div",Ce,[(_(!0),C(I,null,E(e(h),l=>(_(),C("div",{key:l.id,class:"adoption-card"},[t("div",Ae,[t("img",{src:l.pet.image||"/src/assets/img/dog.jpg",alt:l.pet.name},null,8,be)]),t("div",Pe,[t("div",De,[t("h3",null,s(l.pet.name),1),t("p",ke,s(l.pet.breed),1),t("p",Se,s(l.pet.age)+"岁 · "+s(e(se)(l.pet.gender)),1)]),t("div",we,[t("div",ze,[t("span",$e,s(e(o)("user.adoptionDate"))+"：",1),t("span",xe,s(e(c)(l.adoptDate)),1)]),t("div",Ne,[t("span",Ve,s(e(o)("user.shelter"))+"：",1),t("span",Fe,s(l.shelter.name),1)]),t("div",Me,[t("span",Ie,s(e(o)("user.status"))+"：",1),g(V,{type:"warning"},{default:f(()=>[w(s(x(l.pet.status)),1)]),_:2},1024)])]),t("div",Re,[g(z,{type:"primary",size:"small",onClick:R=>n(l.pet.id,l.pet.name)},{default:f(()=>[w(s(e(o)("user.viewAdoptionTimeline")),1)]),_:1},8,["onClick"])])])]))),128)),e(a)>0?(_(),M(ne,{key:0,"current-page":e(k),"page-size":e(A),total:e(a),"page-sizes":[5,10,20,50],layout:"total, sizes, prev, pager, next, jumper","onUpdate:currentPage":D[0]||(D[0]=l=>k.value=l),"onUpdate:pageSize":D[1]||(D[1]=l=>A.value=l),onPageChange:e(u),onSizeChange:e(P)},null,8,["current-page","page-size","total","onPageChange","onSizeChange"])):j("",!0)]))])],2),g(fe)],64)}}}),We=U(Be,[["__scopeId","data-v-95396f8b"]]);export{We as default};
