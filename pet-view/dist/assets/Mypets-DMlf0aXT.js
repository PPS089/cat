import{u as q,h as v,E as h,J,k as H,d as K,v as Q,x as W,c as p,o as u,a as n,O as M,z as D,e as b,t as l,l as e,F as N,f as G,n as X,w,U as L,r as F,g as O}from"./index-n6QoKQtw.js";import{s as x}from"./request-BS93o2BH.js";import{c as Y}from"./genderConverter-BYQQyR-S.js";import{useThemeStore as Z}from"./theme-D8ZsPEis.js";import{P as ee}from"./Pagination-CmoWuIJY.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";function te(){const z=H(),{t:r}=q(),m=v([]),C=v([]),_=v(!1),g=v(null),f=v(null),P=v(1),S=v(5),a=v(0),y=v(0),E=()=>{z.push("/user/adoption-pets")},T=s=>{z.push(`/user/pets/edit/${s}`)},V=async s=>{try{g.value=s,_.value=!0,f.value=null;const c=await x.get("/shelters");if(c.code===200){const i=c.data;C.value=i.map(o=>({sid:o.sid,shelterName:o.shelterName,shelterAddress:o.shelterAddress})),h.success(r("common.pleaseSelectShelter"))}}catch{h.error(r("getShelterListFailed"))}},I=async()=>{if(!f.value){h.warning(r("common.pleaseSelectShelter"));return}if(!g.value){h.warning(r("petNotSelected"));return}try{const s={shelterId:f.value,startDate:new Date().toISOString().split("T")[0]};if((await x.post(`/pets/${g.value.pid}/foster`,s)).code===200){h.success(r("fosterSuccess"));const i=g.value.pid;i&&(m.value=m.value.map(o=>o.pid===i?{...o,status:"FOSTERING"}:o)),_.value=!1,g.value=null,f.value=null,await k()}else h.error(r("fosterFailed"))}catch(s){h.error(s.response?.data?.msg||r("fosterFailed"))}},$=async s=>{s<1||y.value>0&&s>y.value||await k(s,S.value)},A=async s=>{await k(1,s)},B=async s=>{try{if(await J.confirm(r("message.confirmEndFoster"),r("message.warning"),{confirmButtonText:r("message.confirm"),cancelButtonText:r("message.cancel"),type:"warning"}),(await x.post(`/pets/${s.pid}/foster/end`)).code===200){h.success(r("message.endFosterSuccess"));const i=s.pid;i&&(m.value=m.value.map(o=>o.pid===i?{...o,status:"ADOPTED"}:o)),await k()}}catch(c){c!=="cancel"&&h.error(r("endFosterFailed"))}},k=async(s=P.value,c=S.value)=>{try{s<1&&(s=1),c<1&&(c=5);const i=await x.get("/user/adoptions",{params:{current_page:s,per_page:c}});console.log("åŽç«¯è¿”å›žçš„å® ç‰©æ•°æ®:",i);const o=i.data;!o.records||o.records.length===0?(m.value=[],a.value=o.total||0,y.value=o.pages||0):(m.value=o.records.map(d=>({pid:d.pid,name:d.name,species:d.species,breed:d.breed,age:d.age,gender:Y(d.gender),status:d.status||d.petStatus,imgUrl:d.image,shelterName:d.sname,shelterAddress:d.location}))||[],console.log("å¤„ç†åŽçš„å® ç‰©æ•°æ®:",m.value),a.value=o.total||0,y.value=o.pages||0),P.value=s,S.value=c}catch(i){if(i.name==="AbortError")return;m.value=[],a.value=0,y.value=0,h.error(r("getPetDataFailed")||"èŽ·å–å® ç‰©æ•°æ®å¤±è´¥")}};return{pets:m,shelters:C,showFosterDialog:_,selectedShelter:f,currentPage:P,pageSize:S,total:a,t:r,addPet:E,editPet:T,startFoster:V,endFoster:B,confirmStartFoster:I,fetchPets:k,handlePageChange:$,handlePageSizeChange:A}}const ae={class:"pets-header"},oe={class:"pets-main"},ne={class:"pets-list"},le={key:0,class:"empty-state"},re={key:1,class:"pets-grid"},ce={class:"pet-image"},ie=["src","alt"],de={class:"pet-type-badge adoption"},ue={class:"pet-info"},me={key:0,class:"fostering-indicator"},pe={class:"pet-breed"},ge={class:"pet-age"},he={class:"pet-gender"},_e={key:0,class:"pet-date"},fe={key:1,class:"pet-shelter"},ve={class:"pet-actions"},Se=["onClick"],ye={class:"foster-status"},ke=["onClick"],Pe=["onClick"],be={class:"dialog-footer"},we=K({__name:"Mypets",setup(z){const r=Z(),{pets:m,shelters:C,showFosterDialog:_,selectedShelter:g,currentPage:f,pageSize:P,total:S,t:a,addPet:y,editPet:E,startFoster:T,confirmStartFoster:V,endFoster:I,fetchPets:$,handlePageChange:A,handlePageSizeChange:B}=te();return Q(async()=>{$()}),W([f,P,S],([k,s,c],[i,o,d])=>{console.log("åˆ†é¡µçŠ¶æ€å˜åŒ–:",{currentPage:{old:i,new:k},pageSize:{old:o,new:s},total:{old:d,new:c}})}),(k,s)=>{const c=F("el-option"),i=F("el-select"),o=F("el-form-item"),d=F("el-form"),U=F("el-button"),j=F("el-dialog");return u(),p(N,null,[n("div",{class:X(["pets-container",{dark:e(r).preferences.theme==="dark"}])},[n("header",ae,[n("h1",null,l(e(a)("nav.myPets")),1)]),n("main",oe,[n("div",ne,[e(m).length===0?(u(),p("div",le,[n("p",null,l(e(a)("user.noAdoptionRecords")),1),n("button",{onClick:s[0]||(s[0]=(...t)=>e(y)&&e(y)(...t)),class:"add-first-pet-btn"},l(e(a)("user.goAdoptPet")),1)])):(u(),p("div",re,[(u(!0),p(N,null,G(e(m),t=>(u(),p("div",{key:t.pid,class:"pet-card"},[n("div",ce,[n("img",{src:t.imgUrl||"/src/assets/img/dog.jpg",alt:t.name},null,8,ie),n("div",de,l(e(a)("message.adoption")),1)]),n("div",ue,[n("h3",null,[O(l(t.name)+" ",1),t.status==="FOSTERING"?(u(),p("span",me,"("+l(e(a)("message.fostering"))+")",1)):D("",!0)]),n("p",pe,l(t.breed),1),n("p",ge,l(t.age)+l(e(a)("message.yearsOld")),1),n("p",he,l(e(a)("user."+t.gender)),1),t.adoptionDate?(u(),p("p",_e,l(e(a)("message.adoptDate"))+": "+l(t.adoptionDate),1)):D("",!0),t.shelterName?(u(),p("p",fe,l(e(a)("message.shelter"))+": "+l(t.shelterName),1)):D("",!0),n("div",ve,[t.status==="FOSTERING"?(u(),p(N,{key:0},[n("button",{onClick:R=>e(I)(t),class:"end-foster-btn"},l(e(a)("message.endFoster")),9,Se),n("div",ye,"ðŸ  "+l(e(a)("message.fostering")),1)],64)):(u(),p("button",{key:1,onClick:R=>e(T)(t),class:"start-foster-btn"},l(e(a)("message.startFoster")),9,ke)),n("button",{onClick:R=>e(E)(t.pid),class:"edit-btn"},l(e(a)("message.edit")),9,Pe)])])]))),128))]))])])],2),e(S)>0?(u(),M(ee,{key:0,"current-page":e(f),"page-size":e(P),total:e(S),"page-sizes":[5,10,20,50],"onUpdate:currentPage":s[1]||(s[1]=t=>f.value=t),"onUpdate:pageSize":s[2]||(s[2]=t=>P.value=t),onPageChange:e(A),onSizeChange:e(B)},null,8,["current-page","page-size","total","onPageChange","onSizeChange"])):D("",!0),b(j,{modelValue:e(_),"onUpdate:modelValue":s[5]||(s[5]=t=>L(_)?_.value=t:null),title:e(a)("message.startFoster"),width:"500px","before-close":()=>_.value=!1},{footer:w(()=>[n("span",be,[b(U,{onClick:s[4]||(s[4]=t=>_.value=!1)},{default:w(()=>[O(l(e(a)("message.cancel")),1)]),_:1}),b(U,{type:"primary",onClick:e(V)},{default:w(()=>[O(l(e(a)("message.confirm")),1)]),_:1},8,["onClick"])])]),default:w(()=>[b(d,{model:{selectedShelter:e(g)},"label-width":"120px"},{default:w(()=>[b(o,{label:e(a)("message.selectShelter")},{default:w(()=>[b(i,{modelValue:e(g),"onUpdate:modelValue":s[3]||(s[3]=t=>L(g)?g.value=t:null),placeholder:e(a)("message.selectShelter"),style:{width:"100%"}},{default:w(()=>[b(c,{label:e(a)("message.selectShelter"),value:null},null,8,["label"]),(u(!0),p(N,null,G(e(C),t=>(u(),M(c,{key:t.sid,label:`${t.shelterName} - ${t.shelterAddress}`,value:t.sid},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title","before-close"])],64)}}}),Ee=se(we,[["__scopeId","data-v-b624da91"]]);export{Ee as default};
