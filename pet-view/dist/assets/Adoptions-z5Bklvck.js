import{u as z,i as T,s as E,E as F,m as Y,d as j,Z as J,D as K,T as M,o as _,w as f,p as e,Y as O,r as y,v as W,U as Z,c as A,e as g,F as I,f as B,a as t,H as U,t as s,g as $,K as q,_ as L,l as Q,n as X,J as ee,$ as te}from"./index-vX8o4tFx.js";import{useThemeStore as oe}from"./theme-BuSJrrmb.js";import{u as G,g as se}from"./genderDisplay-Go8gYC-j.js";import{P as ne}from"./Pagination-D5dvJ28X.js";import"./genderConverter-CAxqKJGy.js";const H=()=>{const{t:r}=z(),o=T([]),p=T(!1),c=T(!1),m=T(null),h=T("");return{timeline:o,loading:p,dialogVisible:c,selectedPetId:m,selectedPetName:h,loadAdoptionTimeline:async(a,b)=>{try{p.value=!0,m.value=a,h.value=b,console.log(`开始获取宠物 ${a} 的领养时间线...`);const i=await E.get(`/pets/${a}/adoption-timeline`);if(console.log("API响应:",i),i.code===200&&i.data.timeline!==void 0){const d=i.data;o.value=d.timeline,c.value=!0,console.log(`成功获取时间线数据，共 ${d.timeline.length} 条记录`),console.log("设置dialogVisible为true:",c.value)}else console.error("API返回错误:",i.message),F.error(i.message||r("user.loadTimelineFailed"))}catch(i){console.error("获取领养记录时间线失败:",i),F.error(r("user.loadTimelineFailed"))}finally{p.value=!1}},closeDialog:()=>{c.value=!1,o.value=[],m.value=null,h.value=""},getActionTypeText:a=>({adopted:r("user.adopted"),fostered:r("user.fostered"),foster_ended:r("user.fosterEnded"),returned:r("user.returned")})[a]||a}},ae=()=>{const r=Y();return{browsePets:()=>{r.push("/user/adoption-pets")}}},le=()=>{const r=T([]),o=T(1),p=T(10),c=T(0),m=T(!1),{t:h}=z(),u=async(a=1,b=10)=>{try{o.value=a,p.value=b;const i=await E.get("/user/adoptions",{params:{current_page:a,per_page:b}});if(i.code==200){const d=i.data;c.value=d.total;const D=d.records.map(n=>({id:n.aid,adoptDate:n.adoptionDate,foster_status:"available",pet:{id:n.pid,name:n.name,breed:n.breed,age:n.age,gender:n.gender,image:n.image?n.image.startsWith("http")?n.image:`http://localhost:8082/api/images/${n.image}`:"/src/assets/img/dog.jpg",status:n.petStatus},shelter:{id:n.sid,name:n.sname,location:n.location}}));console.log("转换后的数组领养记录:",D),r.value=D}}catch(i){console.error("加载领养记录失败:",i),F.error(h("user.loadAdoptionsFailed"))}};return{adoptions:r,currentPage:o,pageSize:p,total:c,loading:m,loadAdoptions:u,handlePageChange:a=>{u(a,p.value)},handleSizeChange:a=>{u(1,a)}}},ie=()=>{const{browsePets:r}=ae(),{adoptions:o,loadAdoptions:p,currentPage:c,pageSize:m,total:h,handlePageChange:u,handleSizeChange:k}=le(),C=oe();return{adoptions:o,themeStore:C,currentPage:c,pageSize:m,total:h,browsePets:r,loadAdoptions:p,handlePageChange:u,handleSizeChange:k}},re={class:"timeline-container"},ce={key:0,class:"empty-state"},de={key:1,class:"timeline"},pe={class:"timeline-item-content"},ue={class:"item-header"},_e={class:"item-description"},ge={key:0,class:"item-shelter"},me={class:"dialog-footer"},he=j({__name:"Dialog",setup(r){const{t:o}=z(),p=G().formatDate,c=J("adoptionTimeline")||H(),{timeline:m,loading:h,dialogVisible:u,selectedPetName:k,closeDialog:C,getActionTypeText:a}=c;K(u,d=>{console.log("弹窗状态变化:",d)});const b=d=>({adopted:"primary",fostered:"warning",foster_ended:"info",returned:"danger"})[d]||"info",i=d=>({adopted:"success",fostered:"warning",foster_ended:"info",returned:"danger"})[d]||"info";return(d,D)=>{const n=y("el-empty"),x=y("el-tag"),S=y("el-icon"),P=y("el-card"),V=y("el-timeline-item"),w=y("el-timeline"),N=y("el-button"),l=y("el-dialog"),R=Z("loading");return _(),M(l,{modelValue:e(u),"onUpdate:modelValue":D[0]||(D[0]=v=>O(u)?u.value=v:null),title:`${e(o)("user.adoptionTimeline")} - ${e(k)}`,width:"60%","close-on-click-modal":!1,onClose:e(C)},{footer:f(()=>[t("span",me,[g(N,{onClick:e(C)},{default:f(()=>[$(s(e(o)("common.close")),1)]),_:1},8,["onClick"])])]),default:f(()=>[W((_(),A("div",re,[e(m).length===0?(_(),A("div",ce,[g(n,{description:e(o)("user.noTimelineRecords")},null,8,["description"])])):(_(),A("div",de,[g(w,null,{default:f(()=>[(_(!0),A(I,null,B(e(m),v=>(_(),M(V,{key:v.id,timestamp:e(p)(v.actionDate),type:b(v.action),placement:"top"},{default:f(()=>[g(P,null,{default:f(()=>[t("div",pe,[t("div",ue,[t("h4",null,s(e(a)(v.action)),1),g(x,{type:i(v.action),size:"small"},{default:f(()=>[$(s(v.status),1)]),_:2},1032,["type"])]),t("p",_e,s(v.description),1),v.shelterName?(_(),A("div",ge,[g(S,null,{default:f(()=>[g(e(q))]),_:1}),t("span",null,s(v.shelterName),1)])):U("",!0)])]),_:2},1024)]),_:2},1032,["timestamp","type"]))),128))]),_:1})]))])),[[R,e(h)]])]),_:1},8,["modelValue","title","onClose"])}}}),fe=L(he,[["__scopeId","data-v-b606cf01"]]),ve={class:"page-header"},ye={class:"adoptions-content"},Te={key:0,class:"empty-state"},Ae={key:1,class:"adoptions-list"},Ce={class:"pet-image"},be=["src","alt"],De={class:"adoption-details"},Pe={class:"pet-info"},ke={class:"pet-breed"},Se={class:"pet-age"},$e={class:"adoption-info"},we={class:"info-item"},ze={class:"label"},xe={class:"value"},Ve={class:"info-item"},Ne={class:"label"},Fe={class:"value"},Me={class:"info-item"},Ie={class:"label"},Re={class:"adoption-actions"},Ee=j({__name:"Adoptions",setup(r){const{t:o}=z(),p=G().formatDate,c=H(),{loadAdoptionTimeline:m}=c;te("adoptionTimeline",c);const{adoptions:h,themeStore:u,currentPage:k,pageSize:C,total:a,browsePets:b,loadAdoptions:i,handlePageChange:d,handleSizeChange:D}=ie(),n=(S,P)=>{console.log(`点击查看领养时间线 - 宠物ID: ${S}, 名称: ${P}`),m(S,P)},x=S=>o(S==="FOSTERING"?"user.adoptionStatusFostering":"user.adoptionStatusNormal");return Q(()=>{i()}),(S,P)=>{const V=y("el-icon"),w=y("el-button"),N=y("el-tag");return _(),A(I,null,[t("div",{class:X(["adoptions-container",{dark:e(u).preferences.theme==="dark"}])},[t("div",ve,[t("h1",null,s(e(o)("user.adoptionRecords")),1),t("p",null,s(e(o)("user.viewAdoptionHistory")),1)]),t("div",ye,[e(h).length===0?(_(),A("div",Te,[g(V,null,{default:f(()=>[g(e(ee))]),_:1}),t("h3",null,s(e(o)("user.noAdoptionRecords")),1),t("p",null,s(e(o)("user.noAdoptionYet")),1),g(w,{type:"primary",onClick:e(b)},{default:f(()=>[$(s(e(o)("user.browseAdoptablePets")),1)]),_:1},8,["onClick"])])):(_(),A("div",Ae,[(_(!0),A(I,null,B(e(h),l=>(_(),A("div",{key:l.id,class:"adoption-card"},[t("div",Ce,[t("img",{src:l.pet.image||"/src/assets/img/dog.jpg",alt:l.pet.name},null,8,be)]),t("div",De,[t("div",Pe,[t("h3",null,s(l.pet.name),1),t("p",ke,s(l.pet.breed),1),t("p",Se,s(l.pet.age)+"岁 · "+s(e(se)(l.pet.gender)),1)]),t("div",$e,[t("div",we,[t("span",ze,s(e(o)("user.adoptionDate"))+"：",1),t("span",xe,s(e(p)(l.adoptDate)),1)]),t("div",Ve,[t("span",Ne,s(e(o)("user.shelter"))+"：",1),t("span",Fe,s(l.shelter.name),1)]),t("div",Me,[t("span",Ie,s(e(o)("user.status"))+"：",1),g(N,{type:"warning"},{default:f(()=>[$(s(x(l.pet.status)),1)]),_:2},1024)])]),t("div",Re,[g(w,{type:"primary",size:"small",onClick:R=>n(l.pet.id,l.pet.name)},{default:f(()=>[$(s(e(o)("user.viewAdoptionTimeline")),1)]),_:1},8,["onClick"])])])]))),128)),e(a)>0?(_(),M(ne,{key:0,"current-page":e(k),"page-size":e(C),total:e(a),"page-sizes":[5,10,20,50],layout:"total, sizes, prev, pager, next, jumper","onUpdate:currentPage":P[0]||(P[0]=l=>k.value=l),"onUpdate:pageSize":P[1]||(P[1]=l=>C.value=l),onPageChange:e(d),onSizeChange:e(D)},null,8,["current-page","page-size","total","onPageChange","onSizeChange"])):U("",!0)]))])],2),g(fe)],64)}}}),He=L(Ee,[["__scopeId","data-v-0c9461a6"]]);export{He as default};
