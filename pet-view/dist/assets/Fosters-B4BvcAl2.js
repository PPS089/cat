import{I,u as b,h as v,J as N,E as z,d as M,v as V,c as F,o as h,a as s,t as o,l as e,O as R,z as U,e as y,w as D,r as C,F as $,f as j,n as G,C as L,g as S,_ as O}from"./index-BIX1Ehmq.js";import{s as x}from"./request-DUfzvZFe.js";import{useThemeStore as H}from"./theme-cTCRAQz8.js";import{u as J,g as W}from"./genderDisplay-CHcdmY73.js";import{P as Y}from"./Pagination-DLPedht-.js";import"./genderConverter-CAxqKJGy.js";const q=()=>{const{t:r}=b();return{deleteFoster:async(c,d,i,m,p)=>{try{const u=Number(c);if(await N.confirm(r("user.confirmDeleteFoster"),r("user.confirmDeleteFosterTitle"),{confirmButtonText:r("common.confirm"),cancelButtonText:r("common.cancel"),type:"warning"}),(await x.delete(`/fosters/delete/${u}`)).code===200){const l=d.value.findIndex(g=>g.id===u);l!==-1&&(d.value.splice(l,1),i.value=Math.max(0,i.value-1)),z.success(r("user.fosterDeleted")),d.value.length===0&&m.value>1&&m.value--,setTimeout(()=>p(),500)}}catch(u){console.error(r("user.deleteFosterFailed"),u),z.error(r("user.deleteFosterFailed"))}}}},A=()=>{const{t:r}=b(),t=v([]),c=v(1),d=v(10),i=v(0),m=v(!1),p=async()=>{try{let g=(await x.get("/user/fosters",{params:{current_page:c.value,per_page:d.value}})).data;g.records&&g.total!==void 0?(i.value=g.total,t.value=g.records.map(n=>({id:n.fid||n.id,pet:{pid:n.pet?.pid,name:n.pet?.name,breed:n.pet?.breed,age:n.pet?.age,gender:n.pet?.gender,image:n.pet?.image?n.pet.image.startsWith("http")?n.pet.image:`http://localhost:8082/api/images/${n.pet.image}`:"/src/assets/img/dog.jpg"},shelter:{sid:n.shelter?.sid,name:n.shelter?.name,location:n.shelter?.location},startDate:n.startDate,endDate:n.endDate,status:n.endDate?"ended":"ongoing"})),console.log("DEBUG: 转换后的数据:",t.value)):t.value=[]}catch{t.value=[],i.value=0,z.error(r("user.loadFosterFailed"))}finally{m.value=!1}};return{fosters:t,loadFosters:p,currentPage:c,pageSize:d,total:i,loading:m,handlePageChange:l=>{c.value=l,p()},handleSizeChange:l=>{d.value=l,c.value=1,p()}}},K=()=>{const{deleteFoster:r}=q(),{fosters:t,loadFosters:c,currentPage:d,pageSize:i,total:m,loading:p,handlePageChange:u,handleSizeChange:_}=A(),l=H(),g=I(()=>l.preferences.theme==="dark");return{fosters:t,isDark:g,currentPage:d,pageSize:i,total:m,loading:p,deleteFoster:r,loadFosters:c,handlePageChange:u,handleSizeChange:_,applyTheme:()=>{l.applyTheme()}}},Q={class:"page-header"},X={class:"fosters-content"},Z={key:0,class:"empty-state"},ee={key:1,class:"fosters-list"},se={class:"pet-image"},te=["src","alt"],ae={class:"foster-details"},ne={class:"pet-info"},oe={class:"pet-breed"},le={class:"pet-age"},re={class:"foster-info"},ie={class:"info-item"},ce={class:"label"},de={class:"value"},ue={class:"info-item"},pe={class:"label"},ge={class:"value"},me={class:"info-item"},_e={class:"label"},he={class:"value"},ve={class:"info-item"},Fe={class:"label"},fe={class:"foster-actions"},ye=M({__name:"Fosters",setup(r){const{t}=b(),c=J().formatDate,{deleteFoster:d,fosters:i,isDark:m,loadFosters:p,currentPage:u,pageSize:_,total:l,handlePageChange:g,handleSizeChange:n,applyTheme:P}=K(),w=async k=>{await d(k,i,l,u,p)};return V(()=>{p(),P()}),(k,f)=>{const T=C("el-icon"),B=C("el-tag"),E=C("el-button");return h(),F("div",{class:G(["fosters-container",{dark:e(m)}])},[s("div",Q,[s("h1",null,o(e(t)("user.fosterRecords")),1),s("p",null,o(e(t)("user.viewFosterHistory")),1)]),s("div",X,[e(i).length===0?(h(),F("div",Z,[y(T,null,{default:D(()=>[y(e(L))]),_:1}),s("h3",null,o(e(t)("user.noFosterRecords")),1),s("p",null,o(e(t)("user.noFosterYet")),1)])):(h(),F("div",ee,[(h(!0),F($,null,j(e(i),a=>(h(),F("div",{key:a.id,class:"foster-card"},[s("div",se,[s("img",{src:a.pet.image,alt:a.pet.name},null,8,te)]),s("div",ae,[s("div",ne,[s("h3",null,o(a.pet.name),1),s("p",oe,o(a.pet.breed),1),s("p",le,o(a.pet.age)+o(e(t)("user.yearsOld"))+" · "+o(e(W)(a.pet.gender)),1)]),s("div",re,[s("div",ie,[s("span",ce,o(e(t)("user.fosterStart"))+"：",1),s("span",de,o(e(c)(a.startDate)),1)]),s("div",ue,[s("span",pe,o(e(t)("user.fosterEnd"))+"：",1),s("span",ge,o(a.endDate?e(c)(a.endDate):e(t)("user.ongoing")),1)]),s("div",me,[s("span",_e,o(e(t)("user.shelter"))+"：",1),s("span",he,o(a.shelter?a.shelter.name:e(t)("user.unknown")),1)]),s("div",ve,[s("span",Fe,o(e(t)("user.status"))+"：",1),y(B,{type:a.status==="ongoing"?"warning":"success"},{default:D(()=>[S(o(a.status==="ongoing"?e(t)("user.ongoing"):e(t)("user.fosterEnded")),1)]),_:2},1032,["type"])])]),s("div",fe,[y(E,{type:"danger",size:"small",onClick:De=>w(a.id),disabled:!a.id||a.id===void 0||a.id===null},{default:D(()=>[S(o(e(t)("user.deleteRecord")),1)]),_:1},8,["onClick","disabled"])])])]))),128))])),e(l)>0?(h(),R(Y,{key:2,"current-page":e(u),"page-size":e(_),total:e(l),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper","onUpdate:currentPage":f[0]||(f[0]=a=>u.value=a),"onUpdate:pageSize":f[1]||(f[1]=a=>_.value=a),onPageChange:e(g),onSizeChange:e(n)},null,8,["current-page","page-size","total","onPageChange","onSizeChange"])):U("",!0)])],2)}}}),Pe=O(ye,[["__scopeId","data-v-1d30feb0"]]);export{Pe as default};
