import{u as ee,h as se,i as V,k as q,l as Q,E as g,s as G,d as te,c as P,o as S,a as t,t as l,p as e,e as s,w as a,Y as ae,r as y,A as ne,g as v,L as oe,a6 as k,H as Y,a7 as le,F as J,f as K,M as ie,a8 as re,a9 as de,T as $,aa as ce,ab as ue,ac as ge,ad as O,ae as _e,V as fe,af as me,n as pe,I as he,_ as ye}from"./index-vX8o4tFx.js";import{useThemeStore as ve}from"./theme-BuSJrrmb.js";const we=()=>{const{t:r,locale:n}=ee(),L=se(),h=ve(),b=V([]),x=V("login-history"),T=V(!1),w=V(!1),c=V(!1),F=V(!1),_=q({currentPassword:"",newPassword:"",confirmPassword:""}),I=[{name:"default",value:"#409EFF"},{name:"green",value:"#67C23A"},{name:"orange",value:"#E6A23C"},{name:"red",value:"#F56C6C"},{name:"purple",value:"#9B59B6"}],u=q({language:"zh-CN",theme:"light",primaryColor:"#409EFF",fontSize:14,animations:!0,compactMode:!1}),A=async()=>{if(!_.currentPassword||!_.newPassword||!_.confirmPassword){g.error(r("settings.passwordRequired"));return}if(_.newPassword!==_.confirmPassword){g.error(r("settings.passwordMismatch"));return}if(_.newPassword.length<6){g.error(r("settings.passwordLengthError"));return}T.value=!0;try{await L.changePassword(_),g.success(r("settings.passwordChanged")),_.currentPassword="",_.newPassword="",_.confirmPassword=""}catch(o){g.error(r("settings.passwordChangeFailed")+(o.message?": "+o.message:""))}finally{T.value=!1}},M=async()=>{try{console.log("开始获取登录历史..."),console.log("当前用户ID:",localStorage.getItem("userId")),console.log("当前token:",localStorage.getItem("token")?.substring(0,10)+"...");const o=await G.get("/login-history");console.log("登录历史响应:",o),o.code==200?(console.log("登录历史数据:",o.data),console.log("数据类型:",Array.isArray(o.data)?"数组":typeof o.data),b.value=o.data.map(f=>({id:f.id,userId:f.userId,loginTime:f.loginTime,device:f.device||"Unknown Device",location:f.location||"Unknown Location",ipAddress:f.ipAddress||"0.0.0.0",status:f.status||"SUCCESS"})),console.log("登录历史处理完成，记录数:",b.value.length)):(console.warn("登录历史数据不是数组格式，使用空数组"),b.value=[])}catch(o){console.error("获取登录历史失败:",o),b.value=[],o.message==="未授权"?g.warning(r("settings.pleaseLoginToViewHistory")||"请先登录后查看登录历史"):g.error(r("settings.networkErrorUnableToGetLoginHistory"))}},H=async()=>{try{const o=await G.delete("/login-history/clear");o.code===200?(g.success(r("settings.historyCleared")),b.value=[]):g.error(r("settings.clearHistoryFailed")+": "+o.message)}catch(o){console.error("清除登录历史错误:",o),g.error(r("settings.clearHistoryFailed"))}},z=async()=>{try{console.log(r("settings.loadingPreferences")),await h.loadPreferences(),console.log(r("settings.preferencesLoaded")),u.language=h.preferences.language,u.theme=h.preferences.theme,u.primaryColor=h.preferences.primaryColor,u.fontSize=h.preferences.fontSize,u.animations=h.preferences.animations,u.compactMode=h.preferences.compactMode,console.log(r("settings.preferencesSynced"))}catch(o){console.error("加载偏好设置错误:",o),g.error(r("settings.loadPreferencesFailed"))}},E=async()=>{w.value=!0;try{await h.updatePreference("language",u.language),n.value=u.language,g.success(r("settings.languageSaved"))}catch(o){console.error(r("languageSaveFailed"),o),g.error(r("settings.savePreferencesFailed")||r("saveFailed"))}finally{w.value=!1}},N=async()=>{c.value=!0;try{await h.updatePreferences({theme:u.theme,primaryColor:u.primaryColor}),g.success(r("settings.themeSaved"))}catch{g.error(r("settings.themeSaveFailed"))}finally{c.value=!1}},B=async()=>{F.value=!0;try{await h.updatePreferences({fontSize:u.fontSize,animations:u.animations,compactMode:u.compactMode}),g.success(r("settings.interfaceSettingsSaved"))}catch{g.error(r("settings.saveInterfaceSettingsFailed"))}finally{F.value=!1}},d=o=>{const f=new Date(o),p=new Date().getTime()-f.getTime();return p<6e4?r("settings.justNow"):p<36e5?`${Math.floor(p/6e4)}${r("settings.minutesAgo")}`:p<864e5?`${Math.floor(p/36e5)}${r("settings.hoursAgo")}`:p<6048e5?`${Math.floor(p/864e5)}${r("settings.daysAgo")}`:f.toLocaleDateString(u.language==="zh-CN"?"zh-CN":"en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})};return Q(()=>{z(),M()}),{t:r,activeTab:x,passwordLoading:T,languageLoading:w,themeLoading:c,preferencesLoading:F,passwordForm:_,preferences:u,themeColors:I,loginHistory:b,changePassword:A,saveLanguage:E,saveThemeSettings:N,saveInterfaceSettings:B,clearLoginHistory:H,formatDateTime:d,loadPreferences:z,fetchLoginHistory:M}},Se={class:"settings-container"},be={class:"page-header"},Ce={class:"settings-content"},Pe={class:"tab-content"},ke={class:"settings-section"},Ve={class:"section-header"},Le={class:"section-title"},Te={class:"settings-section"},Fe={class:"section-header"},Ue={class:"section-title"},Me={class:"security-tips"},He={class:"tip-item"},ze={class:"tip-item"},xe={class:"tip-item"},Ie={class:"tab-content"},Ae={class:"settings-section"},Ee={class:"section-header"},Ne={class:"section-title"},De={class:"login-history-list"},$e={class:"history-main"},Be={class:"history-time"},Re={class:"history-device"},je={class:"history-location"},qe={class:"history-side"},Ge={class:"history-ip"},Ye={key:0,class:"load-more"},Je={key:1,class:"load-more"},Ke={class:"tab-content"},Oe={class:"settings-section"},Qe={class:"section-header"},We={class:"section-title"},Xe={class:"settings-section"},Ze={class:"section-header"},es={class:"section-title"},ss={class:"theme-colors"},ts=["onClick"],as={class:"settings-section"},ns={class:"section-header"},os={class:"section-title"},ls={class:"form-hint"},is=te({__name:"Setting",setup(r){const{t:n,activeTab:L,passwordLoading:h,languageLoading:b,themeLoading:x,preferencesLoading:T,passwordForm:w,preferences:c,themeColors:F,loginHistory:_,changePassword:I,saveLanguage:u,saveThemeSettings:A,saveInterfaceSettings:M,clearLoginHistory:H,formatDateTime:z,loadPreferences:E,fetchLoginHistory:N}=we();return Q(()=>{E(),N()}),(B,d)=>{const o=y("el-icon"),f=y("el-input"),m=y("el-form-item"),p=y("el-button"),C=y("el-form"),D=y("el-tab-pane"),W=y("el-tag"),U=y("el-radio"),R=y("el-radio-group"),X=y("el-slider"),j=y("el-switch"),Z=y("el-tabs");return S(),P("div",Se,[t("div",be,[t("h1",null,l(e(n)("settings.title")),1)]),t("div",Ce,[s(Z,{modelValue:e(L),"onUpdate:modelValue":d[8]||(d[8]=i=>ae(L)?L.value=i:null),class:"settings-tabs"},{default:a(()=>[s(D,{label:e(n)("settings.accountSecurity"),name:"security"},{default:a(()=>[t("div",Pe,[t("div",ke,[t("div",Ve,[s(o,{class:"section-icon"},{default:a(()=>[s(e(ne))]),_:1}),t("div",Le,[t("h3",null,l(e(n)("settings.changePassword")),1),t("p",null,l(e(n)("settings.changePasswordTip")),1)])]),s(C,{model:e(w),"label-width":"120px",style:{"max-width":"500px"}},{default:a(()=>[s(m,{label:e(n)("settings.currentPassword")},{default:a(()=>[s(f,{modelValue:e(w).currentPassword,"onUpdate:modelValue":d[0]||(d[0]=i=>e(w).currentPassword=i),type:"password",placeholder:e(n)("settings.currentPasswordPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(m,{label:e(n)("settings.newPassword")},{default:a(()=>[s(f,{modelValue:e(w).newPassword,"onUpdate:modelValue":d[1]||(d[1]=i=>e(w).newPassword=i),type:"password",placeholder:e(n)("settings.newPasswordPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(m,{label:e(n)("settings.confirmPassword")},{default:a(()=>[s(f,{modelValue:e(w).confirmPassword,"onUpdate:modelValue":d[2]||(d[2]=i=>e(w).confirmPassword=i),type:"password",placeholder:e(n)("settings.confirmPasswordPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(m,null,{default:a(()=>[s(p,{type:"primary",onClick:e(I),loading:e(h)},{default:a(()=>[v(l(e(n)("settings.changePassword")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model"])]),t("div",Te,[t("div",Fe,[s(o,{class:"section-icon"},{default:a(()=>[s(e(oe))]),_:1}),t("div",Ue,[t("h3",null,l(e(n)("settings.securityTips")),1),t("p",null,l(e(n)("settings.securityTipsSubtitle")),1)])]),t("div",Me,[t("div",He,[s(o,null,{default:a(()=>[s(e(k))]),_:1}),t("span",null,l(e(n)("settings.securityTip1")),1)]),t("div",ze,[s(o,null,{default:a(()=>[s(e(k))]),_:1}),t("span",null,l(e(n)("settings.securityTip2")),1)]),t("div",xe,[s(o,null,{default:a(()=>[s(e(k))]),_:1}),t("span",null,l(e(n)("settings.securityTip3")),1)])])])])]),_:1},8,["label"]),s(D,{label:e(n)("settings.loginHistory"),name:"login-history"},{default:a(()=>[t("div",Ie,[t("div",Ae,[t("div",Ee,[s(o,{class:"section-icon"},{default:a(()=>[s(e(le))]),_:1}),t("div",Ne,[t("h3",null,l(e(n)("settings.recentLoginRecords")),1),t("p",null,l(e(n)("settings.viewLoginHistory")),1)])]),t("div",De,[(S(!0),P(J,null,K(e(_),i=>(S(),P("div",{key:i.id,class:"history-item"},[t("div",$e,[t("div",Be,[s(o,null,{default:a(()=>[s(e(ie))]),_:1}),t("span",null,l(e(z)(i.loginTime)),1)]),t("div",Re,[s(o,null,{default:a(()=>[s(e(re))]),_:1}),t("span",null,l(i.device),1)]),t("div",je,[s(o,null,{default:a(()=>[s(e(de))]),_:1}),t("span",null,l(i.location||e(n)("settings.unknownLocation")),1)])]),t("div",qe,[t("div",Ge,[t("span",null,"IP: "+l(i.ipAddress),1)]),s(W,{type:i.status==="SUCCESS"?"success":"danger",size:"small"},{default:a(()=>[s(o,null,{default:a(()=>[i.status==="SUCCESS"?(S(),$(e(ce),{key:0})):(S(),$(e(ue),{key:1}))]),_:2},1024),v(" "+l(i.status==="SUCCESS"?e(n)("settings.loginSuccess"):e(n)("settings.loginFailed")),1)]),_:2},1032,["type"])])]))),128))]),e(_).length>=10?(S(),P("div",Ye,[s(p,{text:"",type:"danger",onClick:e(H),style:{"margin-left":"1rem"}},{default:a(()=>[v(l(e(n)("settings.clearHistory")),1)]),_:1},8,["onClick"])])):e(_).length>0?(S(),P("div",Je,[s(p,{text:"",type:"danger",onClick:e(H)},{default:a(()=>[v(l(e(n)("settings.clearHistory")),1)]),_:1},8,["onClick"])])):Y("",!0)])])]),_:1},8,["label"]),s(D,{label:e(n)("settings.preferences"),name:"preferences"},{default:a(()=>[t("div",Ke,[t("div",Oe,[t("div",Qe,[s(o,{class:"section-icon"},{default:a(()=>[s(e(ge))]),_:1}),t("div",We,[t("h3",null,l(e(n)("settings.languageSettings")),1),t("p",null,l(e(n)("settings.languageSettingsSubtitle")),1)])]),s(C,{"label-width":"120px"},{default:a(()=>[s(m,{label:e(n)("settings.interfaceLanguage")},{default:a(()=>[s(R,{modelValue:e(c).language,"onUpdate:modelValue":d[3]||(d[3]=i=>e(c).language=i)},{default:a(()=>[s(U,{label:"zh-CN"},{default:a(()=>[v(l(e(n)("settings.chineseSimplified")),1)]),_:1}),s(U,{label:"en-US"},{default:a(()=>[v(l(e(n)("settings.english")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(m,null,{default:a(()=>[s(p,{type:"primary",onClick:e(u),loading:e(b)},{default:a(()=>[s(o,null,{default:a(()=>[s(e(k))]),_:1}),v(" "+l(e(n)("settings.saveLanguageSettings")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),t("div",Xe,[t("div",Ze,[s(o,{class:"section-icon"},{default:a(()=>[s(e(O))]),_:1}),t("div",es,[t("h3",null,l(e(n)("settings.themeAppearance")),1),t("p",null,l(e(n)("settings.themeAppearanceSubtitle")),1)])]),s(C,{"label-width":"120px"},{default:a(()=>[s(m,{label:e(n)("settings.themeMode")},{default:a(()=>[s(R,{modelValue:e(c).theme,"onUpdate:modelValue":d[4]||(d[4]=i=>e(c).theme=i)},{default:a(()=>[s(U,{label:"light"},{default:a(()=>[s(o,null,{default:a(()=>[s(e(O))]),_:1}),v(" "+l(e(n)("settings.lightTheme")),1)]),_:1}),s(U,{label:"dark"},{default:a(()=>[s(o,null,{default:a(()=>[s(e(_e))]),_:1}),v(" "+l(e(n)("settings.darkTheme")),1)]),_:1}),s(U,{label:"auto"},{default:a(()=>[s(o,null,{default:a(()=>[s(e(fe))]),_:1}),v(" "+l(e(n)("settings.followSystem")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(m,{label:e(n)("settings.themeColor")},{default:a(()=>[t("div",ss,[(S(!0),P(J,null,K(e(F),i=>(S(),P("div",{key:i.value,class:pe(["theme-color-item",{active:e(c).primaryColor===i.value}]),style:me({backgroundColor:i.value}),onClick:rs=>e(c).primaryColor=i.value},[e(c).primaryColor===i.value?(S(),$(o,{key:0},{default:a(()=>[s(e(k))]),_:1})):Y("",!0)],14,ts))),128))])]),_:1},8,["label"]),s(m,null,{default:a(()=>[s(p,{type:"primary",onClick:e(A),loading:e(x)},{default:a(()=>[s(o,null,{default:a(()=>[s(e(k))]),_:1}),v(" "+l(e(n)("settings.saveThemeSettings")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),t("div",as,[t("div",ns,[s(o,{class:"section-icon"},{default:a(()=>[s(e(he))]),_:1}),t("div",os,[t("h3",null,l(e(n)("settings.interfaceSettings")),1),t("p",null,l(e(n)("settings.interfaceSettingsSubtitle")),1)])]),s(C,{"label-width":"120px"},{default:a(()=>[s(m,{label:e(n)("settings.fontSize")},{default:a(()=>[s(X,{modelValue:e(c).fontSize,"onUpdate:modelValue":d[5]||(d[5]=i=>e(c).fontSize=i),min:12,max:18,step:1,"show-input":"","show-stops":""},null,8,["modelValue"])]),_:1},8,["label"]),s(m,{label:e(n)("settings.animationEffects")},{default:a(()=>[s(j,{modelValue:e(c).animations,"onUpdate:modelValue":d[6]||(d[6]=i=>e(c).animations=i)},null,8,["modelValue"])]),_:1},8,["label"]),s(m,{label:e(n)("settings.compactMode")},{default:a(()=>[s(j,{modelValue:e(c).compactMode,"onUpdate:modelValue":d[7]||(d[7]=i=>e(c).compactMode=i)},null,8,["modelValue"]),t("span",ls,l(e(n)("settings.compactModeHint")),1)]),_:1},8,["label"]),s(m,null,{default:a(()=>[s(p,{type:"primary",onClick:e(M),loading:e(T)},{default:a(()=>[s(o,null,{default:a(()=>[s(e(k))]),_:1}),v(" "+l(e(n)("settings.saveInterfaceSettings")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})])])]),_:1},8,["label"])]),_:1},8,["modelValue"])])])}}}),us=ye(is,[["__scopeId","data-v-b427f244"]]);export{us as default};
