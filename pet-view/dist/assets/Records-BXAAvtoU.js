import{h as w,I as J,u as z,j as ue,E as k,J as _e,d as me,k as ve,a1 as he,c as u,o as p,a as e,z as M,t as i,m as t,N as C,Z as L,F as U,f as x,a0 as X,g as Y,n as I,U as ge,$ as ce,_ as fe}from"./index-C-QPrTeL.js";import{s as j}from"./request-C9ntlt9z.js";import{useThemeStore as ye}from"./theme-DZbca66G.js";const be=async(a,o)=>{if(!a||a.length===0)return console.warn("æ²¡æœ‰æ–‡ä»¶éœ€è¦ä¸Šä¼ "),{success:!0,message:"æ²¡æœ‰æ–‡ä»¶éœ€è¦ä¸Šä¼ "};const c=new FormData;a.forEach(n=>{c.append("files",n)}),c.append("recordId",String(o)),c.append("batchUpload","true"),console.log(`å¼€å§‹æ‰¹é‡ä¸Šä¼  ${a.length} ä¸ªæ–‡ä»¶åˆ°è®°å½• ${o}`);try{const n=await j.post("/media/upload",c);return console.log("æ‰¹é‡ä¸Šä¼ å®Œæˆï¼Œå“åº”:",n),n}catch(n){throw console.error("æ‰¹é‡ä¸Šä¼ å¤±è´¥:",n),n}},ke=()=>{const{t:a}=z();return{getMoodEmoji:c=>{const n={[a("happy")]:"ðŸ˜Š",[a("angry")]:"ðŸ˜ ",[a("tired")]:"ðŸ˜´",[a("active")]:"ðŸ•"};return c&&n[c]||"ðŸ˜"}}},Me=()=>{const{t:a}=z();return{getMoodClass:c=>({happy:c===a("happy"),angry:c===a("angry"),tired:c===a("tired"),active:c===a("active")})}},we=()=>({formatDate:o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}),R={maxFileSize:52428800,supportedImageFormats:["image/jpeg","image/png","image/gif","image/webp","image/jpg"],supportedVideoFormats:["video/mp4","video/mpeg","video/quicktime","video/x-msvideo","video/webm"],thumbnailMaxWidth:200,thumbnailMaxHeight:200},Ee=a=>new Promise((o,c)=>{const n=new FileReader;n.onload=r=>{const d=new Image;d.onload=()=>{const m=document.createElement("canvas"),_=m.getContext("2d");if(!_){o(r.target?.result);return}let v=d.width,g=d.height;const f=R.thumbnailMaxWidth,D=R.thumbnailMaxHeight;v>g?v>f&&(g=g*f/v,v=f):g>D&&(v=v*D/g,g=D),m.width=v,m.height=g,_.drawImage(d,0,0,v,g),o(m.toDataURL("image/jpeg",.7))},d.onerror=()=>{o(r.target?.result)},d.src=r.target?.result},n.onerror=()=>c(new Error("æ— æ³•è¯»å–æ–‡ä»¶")),n.readAsDataURL(a)}),Fe=a=>{if(a.size>R.maxFileSize)return{valid:!1,error:`æ–‡ä»¶è¿‡å¤§ï¼Œæœ€å¤§æ”¯æŒ${R.maxFileSize/1024/1024}MB`};const o=R.supportedImageFormats.includes(a.type),c=R.supportedVideoFormats.includes(a.type);return!o&&!c?{valid:!1,error:"ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œä»…æ”¯æŒå¸¸è§çš„å›¾ç‰‡å’Œè§†é¢‘æ ¼å¼"}:{valid:!0}},Ce=()=>{const a=w([]);return{filePreviews:a,handleFileUpload:async _=>{const v=_.target,g=Array.from(v.files||[]);if(console.log(`ç”¨æˆ·é€‰æ‹©äº† ${g.length} ä¸ªæ–‡ä»¶`),a.value.length+g.length>5){k.error("æœ€å¤šåªèƒ½ä¸Šä¼ 5ä¸ªæ–‡ä»¶");return}for(const f of g){console.log(`å¤„ç†æ–‡ä»¶: ${f.name}, å¤§å°: ${f.size}, ç±»åž‹: ${f.type}`);const D=Fe(f);if(!D.valid){k.error(`æ–‡ä»¶ "${f.name}" éªŒè¯å¤±è´¥ï¼š${D.error}`);continue}try{const y=f.type.startsWith("image/")?"image":"video";let T=URL.createObjectURL(f),A=y==="image"?await Ee(f):T;a.value.push({file:f,previewUrl:T,thumbnailUrl:A,mediaType:y,isValid:!0}),console.log(`æ–‡ä»¶ "${f.name}" å·²æ·»åŠ åˆ°é¢„è§ˆåˆ—è¡¨`),k.success(`æ–‡ä»¶ "${f.name}" æ·»åŠ æˆåŠŸ`)}catch(y){console.error(`å¤„ç†æ–‡ä»¶ "${f.name}" å¤±è´¥:`,y),k.error(`æ–‡ä»¶ "${f.name}" å¤„ç†å¤±è´¥ï¼š${y instanceof Error?y.message:"æœªçŸ¥é”™è¯¯"}`)}}v.value="",console.log(`å½“å‰é¢„è§ˆåˆ—è¡¨ä¸­å…±æœ‰ ${a.value.length} ä¸ªæ–‡ä»¶`)},removeFile:_=>{const v=a.value[_];v&&v.previewUrl.startsWith("blob:")&&URL.revokeObjectURL(v.previewUrl),a.value.splice(_,1),k.success("æ–‡ä»¶å·²åˆ é™¤")},clearAllFiles:()=>{a.value.forEach(_=>{_.previewUrl.startsWith("blob:")&&URL.revokeObjectURL(_.previewUrl)}),a.value=[]},getUploadFiles:()=>{const _=a.value.map(v=>v.file);return console.log(`èŽ·å–ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨ï¼Œå…± ${_.length} ä¸ªæ–‡ä»¶`),_},getFileIcon:_=>_==="image"?"ðŸ–¼ï¸":_==="video"?"ðŸŽ¬":"ðŸ“„",formatFileSize:_=>{if(_===0)return"0 Bytes";const v=1024,g=["Bytes","KB","MB"],f=Math.floor(Math.log(_)/Math.log(v));return Math.round(_/Math.pow(v,f)*100)/100+" "+g[f]}}},De=()=>{const a=w(!1),o=w([]),c=w(!1);return{showMediaModal:a,currentMediaList:o,mediaLoading:c,openMediaModal:async(d,m)=>{if(m){c.value=!0;try{const _=await j.get(`/media/record/${m}`);if(_.code===200&&_.data){const v=Array.isArray(_.data)?_.data:[_.data];o.value=v.map(g=>({id:g.mid,media_url:`/api${g.filePath}`,media_type:g.mediaType,media_name:g.fileName,updated_at:g.updatedAt}))}else o.value=[]}catch(_){console.error("åŠ è½½åª’ä½“æ–‡ä»¶å¤±è´¥:",_),k.error("åŠ è½½åª’ä½“æ–‡ä»¶å¤±è´¥"),o.value=[]}finally{c.value=!1}}else o.value=d||[];a.value=!0},closeMediaModal:()=>{a.value=!1,o.value=[]}}},pe=()=>{const{t:a}=z(),o=w([]),c=w(!1);return{events:o,loading:c,fetchEvents:async()=>{c.value=!0;try{const r=await j.get("/events");r.code===200&&r.data?o.value=r.data.map(d=>({record_id:d.eid,pid:d.pid,event_type:d.eventType,description:d.description,record_time:d.eventTime,mood:d.mood,location:d.location,pet_name:d.pet_name||"",created_at:d.createdAt||d.eventTime,updated_at:d.updatedAt||d.createdAt||d.eventTime,media_list:d.mediaList?d.mediaList.map(m=>({id:m.mid,media_url:`/api${m.filePath}`,media_type:m.mediaType,media_name:m.fileName,updated_at:m.updatedAt})):[]})):o.value=[]}catch(r){console.error("èŽ·å–äº‹ä»¶å¤±è´¥:",r),k.error(a("api.getEventsFailed")),o.value=[]}finally{c.value=!1}}}},Te=()=>{const{t:a}=z(),o=w([]),c=w(!1);return{pets:o,loading:c,fetchPets:async()=>{c.value=!0;try{const d=await j.get("/user/adoptions",{params:{current_page:1,per_page:100}});d.code===200&&d.data?.records?o.value=d.data.records.map(m=>({pid:m.pid||m.id,name:m.name||m.petName,species:m.breed||m.species||"æœªçŸ¥",breed:m.breed||m.species||"æœªçŸ¥",type:"adoption",date:m.adoptionDate||m.adoptDate||m.date})):o.value=[]}catch(d){k.error(a("api.getPetsFailed")),console.error("Error fetching pets:",d),o.value=[]}finally{c.value=!1}},getPetName:(d,m)=>{const _=o.value.find(v=>v.pid===d);return _?_.name:m||a("api.unknownPet")}}},$e=a=>{const{t:o}=z(),{fetchEvents:c}=a||pe();return{deleteEvent:async r=>{try{if(!r||r<=0){console.error("Invalid recordId:",r),k.error("æ— æ•ˆçš„è®°å½•ID");return}await _e.confirm(o("common.confirmDeleteEvent"),o("common.deleteConfirmation"),{confirmButtonText:o("common.confirm"),cancelButtonText:o("common.cancel"),type:"warning"}),await j.delete(`/events/${r}`),k.success(o("api.deleteSuccess")),await c()}catch(d){d!=="cancel"&&(k.error(o("api.deleteFailed")),console.error("Error deleting event:",d))}}}},Ue=a=>{const o=ue({selectedPet:"",selectedEventType:"",selectedMood:"",selectedDate:""}),c=J(()=>{let n=[...a.value];return o.selectedPet&&(n=n.filter(r=>r.pid===Number(o.selectedPet))),o.selectedEventType&&(n=n.filter(r=>r.event_type===o.selectedEventType)),o.selectedMood&&(n=n.filter(r=>r.mood===o.selectedMood)),o.selectedDate&&(n=n.filter(r=>new Date(r.record_time).toDateString()===new Date(o.selectedDate).toDateString())),n});return{filters:o,filteredEvents:c}},xe=a=>{const o=w("record_time"),c=J(()=>{const n=[...a.value];return n.sort((r,d)=>{switch(o.value){case"event_type":return r.event_type.localeCompare(d.event_type);case"mood":return(r.mood||"").localeCompare(d.mood||"");case"record_time":default:return new Date(d.record_time).getTime()-new Date(r.record_time).getTime()}}),n});return{sortBy:o,sortedEvents:c}},Pe=a=>({groupedEvents:J(()=>{const c={};return a.value.forEach(n=>{const r=new Date(n.record_time).toDateString();c[r]||(c[r]=[]),c[r].push(n)}),c})}),Se=()=>{const a=ue({record_id:"",pid:"",event_type:"",mood:"",description:"",location:"",record_time:""});return{formData:a,resetForm:()=>{Object.assign(a,{record_id:"",pid:"",event_type:"",mood:"",description:"",location:"",record_time:""})},populateForm:n=>{let r="";try{if(n.record_time){const d=n.record_time.replace(" ","T"),m=new Date(d);if(!isNaN(m.getTime()))r=m.toISOString().slice(0,16);else{const _=n.record_time.split(" ");_.length===2&&(r=`${_[0]}T${_[1].slice(0,5)}`)}}}catch(d){console.error("Error parsing date:",d,n.record_time)}Object.assign(a,{...n,record_time:r})}}},Ve=()=>{const{events:a,loading:o,fetchEvents:c}=pe(),{pets:n,fetchPets:r,getPetName:d}=Te(),{getMoodEmoji:m}=ke(),{getMoodClass:_}=Me(),{formatDate:v}=we(),{filePreviews:g,handleFileUpload:f,removeFile:D,clearAllFiles:y,getUploadFiles:T,getFileIcon:A,formatFileSize:ee}=Ce(),{showMediaModal:te,currentMediaList:K,mediaLoading:oe,openMediaModal:se,closeMediaModal:ie}=De(),{filters:O,filteredEvents:B}=Ue(a),{sortBy:W,sortedEvents:F}=xe(B),{groupedEvents:Z}=Pe(F),{formData:E,resetForm:le,populateForm:ae}=Se(),{deleteEvent:q}=$e({fetchEvents:c}),S=w(!1),$=w(!1),H=w("grid"),V=w(!1),P=J(()=>a.value.length),ne=J(()=>a.value.reduce((h,G)=>h+(G.media_list?.length||0),0)),l=h=>{ae(h),$.value=!0},s=()=>{S.value=!1,$.value=!1,y(),le()};return{events:a,pets:n,loading:o,filters:O,viewMode:H,sortBy:W,isSubmitting:V,showAddModal:S,showEditModal:$,showMediaModal:te,mediaLoading:oe,formData:E,filePreviews:g,currentMediaList:K,totalEvents:P,totalMedia:ne,filteredEvents:B,sortedEvents:F,groupedEvents:Z,fetchEvents:c,fetchPets:r,getPetName:d,getMoodEmoji:m,getMoodClass:_,formatDate:v,handleFileUpload:f,removeFile:D,getFileIcon:A,formatFileSize:ee,openMediaModal:se,closeMediaModal:ie,editEvent:l,deleteEvent:q,saveEvent:async()=>{if(V.value){k.warning("æ­£åœ¨ä¿å­˜ä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤");return}V.value=!0;try{const h=E.record_time,G=h?h.replace("T"," ")+":00":"",re={pid:E.pid,eventType:E.event_type,recordTime:G,description:E.description,mood:E.mood||"",location:E.location||""};let Q=null;if($.value&&E.record_id?(await j.put(`/events/${E.record_id}`,re),Q=Number(E.record_id),k.success("äº‹ä»¶æ›´æ–°æˆåŠŸ")):(Q=(await j.post("/events",re)).data?.eid,k.success("äº‹ä»¶æ·»åŠ æˆåŠŸ")),Q){const N=T();if(console.log(`å‡†å¤‡ä¸Šä¼ çš„æ–‡ä»¶æ•°é‡: ${N?N.length:0}`),N&&N.length>0)try{console.log("å¼€å§‹ä¸Šä¼ åª’ä½“æ–‡ä»¶...");const de=await be(N,Q);console.log("åª’ä½“æ–‡ä»¶ä¸Šä¼ ç»“æžœ:",de),k.success("äº‹ä»¶ä¿å­˜æˆåŠŸï¼Œåª’ä½“æ–‡ä»¶ä¸Šä¼ å®Œæˆ")}catch(de){console.warn("æµç¨‹è­¦å‘Šï¼šäº‹ä»¶ä¿å­˜æˆåŠŸï¼Œä½†åª’ä½“æ–‡ä»¶ä¸Šä¼ å¤±è´¥",de),k.warning("äº‹ä»¶ä¿å­˜æˆåŠŸï¼Œä½†åª’ä½“æ–‡ä»¶ä¸Šä¼ å¤±è´¥")}else console.log("æ²¡æœ‰æ–‡ä»¶éœ€è¦ä¸Šä¼ ")}await c(),s()}catch(h){k.error($.value?"äº‹ä»¶æ›´æ–°å¤±è´¥":"äº‹ä»¶æ·»åŠ å¤±è´¥"),console.error("Error saving event:",h)}finally{V.value=!1}},closeModal:s}},Le={class:"page-header"},Ie={class:"stats-grid"},je={class:"stat-card"},Ae={class:"stat-content"},Be={class:"stat-card"},Ne={class:"stat-content"},Re={class:"stat-card"},ze={class:"stat-content"},Oe={class:"controls-section"},We={class:"filter-group"},qe={style:{position:"relative"}},He=["disabled"],Ge={value:""},Je=["value"],Ke={key:0,style:{position:"absolute",top:"-20px",left:"0",color:"#666"}},Ze={value:""},Qe={value:"å–‚é£Ÿ"},Xe={value:"æ´—æ¾¡"},Ye={value:"æ•£æ­¥"},et={value:"çœ‹å…½åŒ»"},tt={value:"çŽ©è€"},ot={value:"æ‰“ç–«è‹—"},st={value:""},it={value:"å¼€å¿ƒ"},lt={value:"ç”Ÿæ°”"},at={value:"ç–²å€¦"},dt={value:"æ´»è·ƒ"},nt=["placeholder"],rt={class:"view-controls"},ct={class:"view-toggle"},ut={class:"sort-controls"},pt={value:"record_time"},_t={value:"event_type"},mt={value:"mood"},vt={class:"events-content"},ht={key:0,class:"events-grid"},gt={class:"event-header"},ft={class:"pet-info"},yt={class:"event-type"},bt={key:0,class:"event-mood"},kt={class:"mood-emoji"},Mt={class:"mood-text"},wt={class:"event-content"},Et={class:"description"},Ft={key:0,class:"location"},Ct={key:0,class:"event-media"},Dt={class:"media-preview"},Tt=["src","alt","onClick"],$t=["src","onClick"],Ut=["onClick"],xt={class:"event-footer"},Pt={class:"event-time"},St={class:"record-time"},Vt={class:"created-time"},Lt={key:0,class:"updated-time"},It={class:"event-actions"},jt=["onClick"],At=["onClick","disabled"],Bt={key:1,class:"events-list"},Nt={class:"list-header"},Rt={class:"col-pet"},zt={class:"col-type"},Ot={class:"col-mood"},Wt={class:"col-description"},qt={class:"col-time"},Ht={class:"col-actions"},Gt={class:"col-pet"},Jt={class:"pet-info"},Kt={class:"col-type"},Zt={class:"event-type-badge"},Qt={class:"col-mood"},Xt={key:0,class:"mood-indicator"},Yt={class:"mood-emoji"},eo={class:"col-description"},to={class:"description-text"},oo={key:0,class:"location-small"},so={class:"col-time"},io={class:"time-text"},lo={class:"col-actions"},ao=["onClick"],no=["onClick","disabled"],ro={key:2,class:"timeline-view"},co={class:"timeline"},uo={class:"timeline-date"},po={class:"timeline-items"},_o={class:"timeline-content"},mo={class:"timeline-header"},vo={class:"event-type-badge"},ho={key:0,class:"mood-indicator"},go={class:"mood-emoji"},fo={class:"description"},yo={key:0,class:"location"},bo={class:"timeline-footer"},ko={class:"time-text"},Mo={class:"timeline-actions"},wo=["onClick"],Eo=["onClick","disabled"],Fo={class:"modal-header"},Co={class:"modal-form"},Do={class:"form-group"},To={value:""},$o=["value"],Uo={class:"form-group"},xo={value:""},Po={value:"å–‚é£Ÿ"},So={value:"æ´—æ¾¡"},Vo={value:"æ•£æ­¥"},Lo={value:"çœ‹å…½åŒ»"},Io={value:"çŽ©è€"},jo={value:"æ‰“ç–«è‹—"},Ao={class:"form-group"},Bo={value:""},No={value:"å¼€å¿ƒ"},Ro={value:"ç”Ÿæ°”"},zo={value:"ç–²å€¦"},Oo={value:"æ´»è·ƒ"},Wo={class:"form-group"},qo={class:"form-group"},Ho=["placeholder"],Go={class:"form-group"},Jo=["placeholder"],Ko={class:"form-group"},Zo={class:"media-upload"},Qo={class:"upload-area"},Xo={for:"media-file-input",class:"upload-label"},Yo={class:"upload-text"},es={class:"upload-hint"},ts={key:0,class:"uploaded-files"},os={class:"uploaded-files-title"},ss={class:"file-preview-grid"},is={class:"preview-thumbnail"},ls=["src","alt"],as={key:1,class:"preview-video-placeholder"},ds={class:"file-info-full"},ns={class:"file-name-container"},rs={class:"file-icon"},cs=["title"],us={class:"file-size-type"},ps={class:"file-size"},_s={class:"file-type"},ms=["onClick","title"],vs={class:"upload-hint-text"},hs={class:"modal-actions"},gs=["disabled"],fs=["disabled"],ys={class:"media-modal-header"},bs={key:0,class:"media-loading"},ks={key:1,class:"media-empty"},Ms={key:2,class:"media-carousel"},ws=["src","alt"],Es=["src"],Fs={class:"media-info"},Cs={class:"media-name"},Ds={class:"media-time"},Ts={key:0,class:"media-time"},$s=me({__name:"Records",setup(a){const{t:o}=z(),c=ye(),{pets:n,filters:r,viewMode:d,sortBy:m,isSubmitting:_,showAddModal:v,showEditModal:g,showMediaModal:f,mediaLoading:D,formData:y,filePreviews:T,currentMediaList:A,totalEvents:ee,totalMedia:te,sortedEvents:K,groupedEvents:oe,fetchEvents:se,fetchPets:ie,getPetName:O,getMoodEmoji:B,getMoodClass:W,formatDate:F,handleFileUpload:Z,removeFile:E,getFileIcon:le,formatFileSize:ae,openMediaModal:q,closeMediaModal:S,editEvent:$,deleteEvent:H,saveEvent:V,closeModal:P}=Ve();return ve(async()=>{await ie(),await he(),await se()}),(ne,l)=>(p(),u("div",{class:I(["events-container",{"dark-theme":t(c).preferences.theme==="dark"}])},[e("div",Le,[e("h1",null,i(t(o)("records.pageTitle")),1),e("p",null,i(t(o)("records.pageSubtitle")),1)]),e("div",Ie,[e("div",je,[l[24]||(l[24]=e("div",{class:"stat-icon"},"ðŸ“…",-1)),e("div",Ae,[e("h3",null,i(t(ee)),1),e("p",null,i(t(o)("records.totalEvents")),1)])]),e("div",Be,[l[25]||(l[25]=e("div",{class:"stat-icon"},"ðŸ•",-1)),e("div",Ne,[e("h3",null,i(t(n).length),1),e("p",null,i(t(o)("records.totalPets")),1)])]),e("div",Re,[l[26]||(l[26]=e("div",{class:"stat-icon"},"ðŸ“¸",-1)),e("div",ze,[e("h3",null,i(t(te)),1),e("p",null,i(t(o)("records.totalMedia")),1)])])]),e("div",Oe,[e("div",We,[e("div",qe,[C(e("select",{"onUpdate:modelValue":l[0]||(l[0]=s=>t(r).selectedPet=s),class:"filter-select",disabled:t(n).length===0},[e("option",Ge,i(t(n).length===0?t(o)("records.loading"):t(o)("records.allPets")),1),(p(!0),u(U,null,x(t(n),s=>(p(),u("option",{key:s.pid,value:s.pid},i(s.name),9,Je))),128))],8,He),[[L,t(r).selectedPet]]),t(n).length>0?(p(),u("small",Ke,i(t(o)("records.foundPets",{count:t(n).length})),1)):M("",!0)]),C(e("select",{"onUpdate:modelValue":l[1]||(l[1]=s=>t(r).selectedEventType=s),class:"filter-select"},[e("option",Ze,i(t(o)("records.allEvents")),1),e("option",Qe,i(t(o)("records.feeding")),1),e("option",Xe,i(t(o)("records.bathing")),1),e("option",Ye,i(t(o)("records.walking")),1),e("option",et,i(t(o)("records.veterinary")),1),e("option",tt,i(t(o)("records.playing")),1),e("option",ot,i(t(o)("records.vaccination")),1)],512),[[L,t(r).selectedEventType]]),C(e("select",{"onUpdate:modelValue":l[2]||(l[2]=s=>t(r).selectedMood=s),class:"filter-select"},[e("option",st,i(t(o)("records.allMood")),1),e("option",it,i(t(o)("records.happy")),1),e("option",lt,i(t(o)("records.angry")),1),e("option",at,i(t(o)("records.tired")),1),e("option",dt,i(t(o)("records.active")),1)],512),[[L,t(r).selectedMood]]),C(e("input",{type:"date","onUpdate:modelValue":l[3]||(l[3]=s=>t(r).selectedDate=s),class:"filter-input",placeholder:t(o)("records.selectDate")},null,8,nt),[[X,t(r).selectedDate]])]),e("button",{class:"add-button",onClick:l[4]||(l[4]=s=>v.value=!0)},[l[27]||(l[27]=e("span",null,"+",-1)),Y(" "+i(t(o)("records.addEvent")),1)])]),e("div",rt,[e("div",ct,[e("button",{class:I({active:t(d)==="grid"}),onClick:l[5]||(l[5]=s=>d.value="grid")},i(t(o)("records.gridView")),3),e("button",{class:I({active:t(d)==="list"}),onClick:l[6]||(l[6]=s=>d.value="list")},i(t(o)("records.listView")),3),e("button",{class:I({active:t(d)==="timeline"}),onClick:l[7]||(l[7]=s=>d.value="timeline")},i(t(o)("records.timeline")),3)]),e("div",ut,[C(e("select",{"onUpdate:modelValue":l[8]||(l[8]=s=>ge(m)?m.value=s:null),class:"sort-select"},[e("option",pt,i(t(o)("records.sortByTime")),1),e("option",_t,i(t(o)("records.sortByType")),1),e("option",mt,i(t(o)("records.sortByMood")),1)],512),[[L,t(m)]])])]),e("div",vt,[t(d)==="grid"?(p(),u("div",ht,[(p(!0),u(U,null,x(t(K),s=>(p(),u("div",{key:s.record_id,class:I(["event-card",s.mood?t(W)(s.mood):{}])},[e("div",gt,[e("div",ft,[e("h4",null,i(t(O)(s.pid,s.pet_name)),1),e("span",yt,i(s.event_type),1)]),s.mood?(p(),u("div",bt,[e("span",kt,i(t(B)(s.mood)),1),e("span",Mt,i(s.mood),1)])):M("",!0)]),e("div",wt,[e("p",Et,i(s.description),1),s.location?(p(),u("div",Ft,[l[28]||(l[28]=e("span",{class:"location-icon"},"ðŸ“",-1)),Y(" "+i(s.location),1)])):M("",!0)]),s.media_list&&s.media_list.length>0?(p(),u("div",Ct,[e("div",Dt,[(p(!0),u(U,null,x(s.media_list.slice(0,3),b=>(p(),u("div",{key:b.id,class:"media-item"},[b.media_type==="image"?(p(),u("img",{key:0,src:b.media_url,alt:s.event_type,onClick:h=>t(q)([],s.record_id),style:{cursor:"pointer"}},null,8,Tt)):b.media_type==="video"?(p(),u("video",{key:1,src:b.media_url,onClick:h=>t(q)([],s.record_id),style:{cursor:"pointer"}},null,8,$t)):M("",!0)]))),128)),s.media_list.length>3?(p(),u("div",{key:0,class:"media-count",onClick:b=>t(q)([],s.record_id),style:{cursor:"pointer"}}," +"+i(s.media_list.length-3),9,Ut)):M("",!0)])])):M("",!0),e("div",xt,[e("div",Pt,[e("span",St,i(t(F)(s.record_time)),1),e("span",Vt,i(t(o)("records.recordedAt"))+" "+i(t(F)(s.created_at)),1),s.updated_at&&s.updated_at!==s.created_at?(p(),u("span",Lt,i(t(o)("records.updatedAt"))+" "+i(t(F)(s.updated_at)),1)):M("",!0)]),e("div",It,[e("button",{class:"action-btn edit-btn",onClick:b=>t($)(s)},i(t(o)("records.edit")),9,jt),e("button",{class:"action-btn delete-btn",onClick:b=>t(H)(s.record_id),disabled:!s.record_id},i(t(o)("records.delete")),9,At)])])],2))),128))])):t(d)==="list"?(p(),u("div",Bt,[e("div",Nt,[e("div",Rt,i(t(o)("records.pet")),1),e("div",zt,i(t(o)("records.eventType")),1),e("div",Ot,i(t(o)("records.mood")),1),e("div",Wt,i(t(o)("records.description")),1),e("div",qt,i(t(o)("records.time")),1),e("div",Ht,i(t(o)("records.actions")),1)]),(p(!0),u(U,null,x(t(K),s=>(p(),u("div",{key:s.record_id,class:I(["list-item",s.mood?t(W)(s.mood):{}])},[e("div",Gt,[e("div",Jt,[e("h4",null,i(t(O)(s.pid,s.pet_name)),1)])]),e("div",Kt,[e("span",Zt,i(s.event_type),1)]),e("div",Qt,[s.mood?(p(),u("span",Xt,[e("span",Yt,i(t(B)(s.mood)),1),Y(" "+i(s.mood),1)])):M("",!0)]),e("div",eo,[e("p",to,i(s.description),1),s.location?(p(),u("div",oo," ðŸ“ "+i(s.location),1)):M("",!0)]),e("div",so,[e("span",io,i(t(F)(s.record_time)),1)]),e("div",lo,[e("button",{class:"action-btn edit-btn",onClick:b=>t($)(s)},i(t(o)("records.edit")),9,ao),e("button",{class:"action-btn delete-btn",onClick:b=>t(H)(s.record_id),disabled:!s.record_id},i(t(o)("records.delete")),9,no)])],2))),128))])):(p(),u("div",ro,[e("div",co,[(p(!0),u(U,null,x(t(oe),(s,b)=>(p(),u("div",{key:b,class:"timeline-group"},[e("div",uo,i(t(F)(b)),1),e("div",po,[(p(!0),u(U,null,x(s,h=>(p(),u("div",{key:h.record_id,class:I(["timeline-item",h.mood?t(W)(h.mood):{}])},[l[29]||(l[29]=e("div",{class:"timeline-marker"},null,-1)),e("div",_o,[e("div",mo,[e("h4",null,i(t(O)(h.pid,h.pet_name)),1),e("span",vo,i(h.event_type),1),h.mood?(p(),u("span",ho,[e("span",go,i(t(B)(h.mood)),1),Y(" "+i(h.mood),1)])):M("",!0)]),e("p",fo,i(h.description),1),h.location?(p(),u("div",yo," ðŸ“ "+i(h.location),1)):M("",!0),e("div",bo,[e("span",ko,i(t(F)(h.record_time)),1),e("div",Mo,[e("button",{class:"action-btn edit-btn",onClick:G=>t($)(h)},i(t(o)("records.edit")),9,wo),e("button",{class:"action-btn delete-btn",onClick:G=>t(H)(h.record_id),disabled:!h.record_id},i(t(o)("records.delete")),9,Eo)])])])],2))),128))])]))),128))])]))]),t(v)||t(g)?(p(),u("div",{key:0,class:"modal-overlay",onClick:l[20]||(l[20]=(...s)=>t(P)&&t(P)(...s))},[e("div",{class:"modal-content",onClick:l[19]||(l[19]=ce(()=>{},["stop"]))},[e("div",Fo,[e("h3",null,i(t(g)?t(o)("records.editEvent"):t(o)("records.addEvent")),1),e("button",{class:"close-btn",onClick:l[9]||(l[9]=(...s)=>t(P)&&t(P)(...s))},"Ã—")]),e("form",Co,[e("div",Do,[e("label",null,i(t(o)("records.pet")),1),C(e("select",{"onUpdate:modelValue":l[10]||(l[10]=s=>t(y).pid=s),required:"",class:"form-select"},[e("option",To,i(t(o)("records.selectPet")),1),(p(!0),u(U,null,x(t(n),s=>(p(),u("option",{key:s.pid,value:s.pid},i(s.name),9,$o))),128))],512),[[L,t(y).pid]])]),e("div",Uo,[e("label",null,i(t(o)("records.eventType")),1),C(e("select",{"onUpdate:modelValue":l[11]||(l[11]=s=>t(y).event_type=s),required:"",class:"form-select"},[e("option",xo,i(t(o)("records.selectType")),1),e("option",Po,i(t(o)("records.feeding")),1),e("option",So,i(t(o)("records.bathing")),1),e("option",Vo,i(t(o)("records.walking")),1),e("option",Lo,i(t(o)("records.veterinary")),1),e("option",Io,i(t(o)("records.playing")),1),e("option",jo,i(t(o)("records.vaccination")),1)],512),[[L,t(y).event_type]])]),e("div",Ao,[e("label",null,i(t(o)("records.mood")),1),C(e("select",{"onUpdate:modelValue":l[12]||(l[12]=s=>t(y).mood=s),class:"form-select"},[e("option",Bo,i(t(o)("records.selectMood")),1),e("option",No,i(t(o)("records.happy")),1),e("option",Ro,i(t(o)("records.angry")),1),e("option",zo,i(t(o)("records.tired")),1),e("option",Oo,i(t(o)("records.active")),1)],512),[[L,t(y).mood]])]),e("div",Wo,[e("label",null,i(t(o)("records.eventTime")),1),C(e("input",{type:"datetime-local","onUpdate:modelValue":l[13]||(l[13]=s=>t(y).record_time=s),required:"",class:"form-input"},null,512),[[X,t(y).record_time]])]),e("div",qo,[e("label",null,i(t(o)("records.location")),1),C(e("input",{type:"text","onUpdate:modelValue":l[14]||(l[14]=s=>t(y).location=s),placeholder:t(o)("records.locationOptional"),class:"form-input"},null,8,Ho),[[X,t(y).location]])]),e("div",Go,[e("label",null,i(t(o)("records.detailedDescription")),1),C(e("textarea",{"onUpdate:modelValue":l[15]||(l[15]=s=>t(y).description=s),rows:"4",placeholder:t(o)("records.pleaseEnterDescription"),required:"",class:"form-textarea"},null,8,Jo),[[X,t(y).description]])]),e("div",Ko,[e("label",null,i(t(o)("records.mediaFiles")),1),e("div",Zo,[e("div",Qo,[e("input",{type:"file",multiple:"",accept:"image/*,video/*",onChange:l[16]||(l[16]=(...s)=>t(Z)&&t(Z)(...s)),class:"file-input",id:"media-file-input"},null,32),e("label",Xo,[l[30]||(l[30]=e("div",{class:"upload-icon"},"ðŸ“",-1)),e("div",Yo,i(t(o)("records.clickToSelectOrDrag")),1),e("div",es,i(t(o)("records.supportedFormats")),1)])])]),t(T).length>0?(p(),u("div",ts,[e("div",os,i(t(o)("records.uploadedFiles"))+" ("+i(t(T).length)+"/5)",1),e("div",ss,[(p(!0),u(U,null,x(t(T),(s,b)=>(p(),u("div",{key:b,class:"file-preview-item"},[e("div",is,[s.mediaType==="image"?(p(),u("img",{key:0,src:s.thumbnailUrl,alt:s.file.name,class:"preview-image"},null,8,ls)):(p(),u("div",as,[...l[31]||(l[31]=[e("span",{class:"video-icon"},"ðŸŽ¬",-1)])]))]),e("div",ds,[e("div",ns,[e("span",rs,i(t(le)(s.mediaType)),1),e("span",{class:"file-name",title:s.file.name},i(s.file.name),9,cs)]),e("div",us,[e("span",ps,i(t(ae)(s.file.size)),1),e("span",_s,i(s.mediaType==="image"?"(å›¾ç‰‡)":"(è§†é¢‘)"),1)])]),e("button",{type:"button",onClick:h=>t(E)(b),class:"remove-file-btn",title:t(o)("records.deleteFile")}," Ã— ",8,ms)]))),128))]),e("div",vs,i(t(T).length>=5?"å·²åˆ°è¾¾æœ€å¤§æ–‡ä»¶æ•°é™åˆ¶":`è¿˜å¯ä¸Šä¼  ${5-t(T).length} ä¸ªæ–‡ä»¶`),1)])):M("",!0)]),e("div",hs,[e("button",{type:"button",class:"cancel-btn",onClick:l[17]||(l[17]=(...s)=>t(P)&&t(P)(...s)),disabled:t(_)},i(t(o)("records.cancel")),9,gs),e("button",{type:"button",class:"save-btn",onClick:l[18]||(l[18]=(...s)=>t(V)&&t(V)(...s)),disabled:t(_)},i(t(_)?t(g)?t(o)("records.updating"):t(o)("records.saving"):t(g)?t(o)("records.update"):t(o)("records.save")),9,fs)])])])])):M("",!0),t(f)?(p(),u("div",{key:1,class:"media-modal-overlay",onClick:l[23]||(l[23]=(...s)=>t(S)&&t(S)(...s))},[e("div",{class:"media-modal-content",onClick:l[22]||(l[22]=ce(()=>{},["stop"]))},[e("div",ys,[e("h3",null,i(t(o)("records.mediaViewer")),1),e("button",{class:"close-btn",onClick:l[21]||(l[21]=(...s)=>t(S)&&t(S)(...s))},"Ã—")]),t(D)?(p(),u("div",bs,[...l[32]||(l[32]=[e("p",null,"æ­£åœ¨åŠ è½½åª’ä½“æ–‡ä»¶...",-1)])])):t(A).length===0?(p(),u("div",ks,[...l[33]||(l[33]=[e("p",null,"æ­¤äº‹ä»¶æ²¡æœ‰åª’ä½“æ–‡ä»¶",-1)])])):(p(),u("div",Ms,[(p(!0),u(U,null,x(t(A),(s,b)=>(p(),u("div",{key:b,class:"media-item"},[s.media_type==="image"?(p(),u("img",{key:0,src:s.media_url,alt:`Media ${b+1}`},null,8,ws)):s.media_type==="video"?(p(),u("video",{key:1,src:s.media_url,controls:""},null,8,Es)):M("",!0),e("div",Fs,[e("p",Cs,i(s.media_name||`åª’ä½“æ–‡ä»¶ ${b+1}`),1),e("p",Ds,"åˆ›å»ºæ—¶é—´: "+i(t(F)(s.created_at||"")),1),s.updated_at&&s.updated_at!==(s.created_at||"")?(p(),u("p",Ts,"æ›´æ–°æ—¶é—´: "+i(t(F)(s.updated_at||"")),1)):M("",!0)])]))),128))]))])])):M("",!0)],2))}}),Ss=fe($s,[["__scopeId","data-v-77910372"]]);export{Ss as default};
