import{h as i,E as f,d as q,u as T,k as A,c as G,o as F,a as b,t as c,m as a,N as L,P as M,O,w as d,n as z,r as p,e as l,g as _,l as j,i as H,_ as J}from"./index-C-QPrTeL.js";import{useThemeStore as K}from"./theme-DZbca66G.js";import{s as D}from"./request-C9ntlt9z.js";import{c as x,a as Q}from"./genderConverter-CAxqKJGy.js";i();const I=i(!1);i(!1);const o=i({name:"",species:"",breed:"",age:0,gender:"male"}),W=async(n,e,t)=>{const r=Number(t.params.id);try{const s={name:o.value.name,species:o.value.species,breed:o.value.breed,age:o.value.age,gender:o.value.gender};if(r&&r>0)await X(r,s),f.success(n("message.updateSuccess"));else{f.warning(n("message.pleaseAdoptPetInstead")||"请通过领养方式获取宠物，而不是直接添加"),e.push("/user/adoptions");return}e.push("/user/pets")}catch(s){throw console.error("操作宠物失败:",s),f.error(s.response?.data?.message||n("message.operationFailed")||"操作失败"),s}},X=async(n,e)=>{try{const t={...e,gender:Q(e.gender)};return(await D.put(`/pets/${n}`,t)).data}catch(t){throw console.error("更新宠物失败:",t),t}},Y=async n=>{try{console.log(`Fetching pet with ID: ${n}`),console.log("Using custom pet details API...");const e=await D.get(`/pets/details/${n}`);if(console.log("Custom pet details response:",e),e&&e.data){const t=e.data;console.log("Found custom pet:",t);const r={pid:t.pid,name:t.name,species:t.species,breed:t.breed,age:t.age,gender:x(t.gender)};return console.log("Successfully converted custom pet data:",r),r}return console.log(`Pet with ID ${n} not found in custom pets`),null}catch(e){throw console.error("获取宠物信息失败:",e),e}},P=async(n,e,t)=>{const r=Number(t.params.id);if(console.log("获取宠物详情，ID:",r),!r||r===0){console.log("添加新宠物模式，不获取宠物详情"),o.value={name:"",species:"",breed:"",age:0,gender:"male"};return}I.value=!0;try{const s=await Y(r);if(console.log("宠物API响应:",s),!s){console.error(`未找到ID为 ${r} 的宠物`),f.error(n("message.petNotFound")),e.push("/user/adoption-pets");return}const v=x(s.gender);o.value={name:s.name,species:s.species,breed:s.breed,age:s.age,gender:v},console.log("表单数据填充完成:",o.value)}catch(s){console.error("获取宠物详情失败:",s),f.error(s.response?.data?.message||n("message.loadPetDetailFailed")),e.push("/user/adoption-pets")}finally{I.value=!1}},Z={class:"edit-pet-header"},ee={class:"edit-pet-main"},ae={style:{"margin-left":"10px"}},se=q({__name:"Editpet",setup(n){const{t:e}=T(),t=K(),r=H(),s=j(),v=i(!1),h=i(!1),y=i(),C={name:[{required:!0,message:e("common.pleaseEnter"),trigger:"blur"},{min:2,max:20,message:e("message.nameLengthError"),trigger:"blur"}],species:[{required:!0,message:e("common.pleaseEnter"),trigger:"blur"}],breed:[{required:!0,message:e("common.pleaseEnter"),trigger:"blur"}],age:[{required:!0,message:e("common.pleaseEnter"),trigger:"blur"},{type:"number",min:0,max:30,message:e("message.ageRangeError"),trigger:"blur"}],gender:[{required:!0,message:e("message.pleaseSelectGender"),trigger:"change"}]},B=async()=>{y.value&&await y.value.validate(async V=>{if(V){h.value=!0;try{await W(e,s,r)}finally{h.value=!1}}else f.warning(e("message.pleaseCompleteForm"))})},N=()=>{P(e,s,r)};return A(()=>{P(e,s,r)}),(V,u)=>{const w=p("el-input"),g=p("el-form-item"),S=p("el-input-number"),E=p("el-radio"),$=p("el-radio-group"),k=p("el-button"),R=p("el-form"),U=M("loading");return F(),G("div",{class:z(["edit-pet-container",{dark:a(t).preferences.theme==="dark"}])},[b("header",Z,[b("h1",null,c(a(e)("pets.editPet")),1)]),b("main",ee,[L((F(),O(R,{ref_key:"petFormRef",ref:y,model:a(o),rules:C,"label-width":"120px",class:"pet-form"},{default:d(()=>[l(g,{label:a(e)("user.name"),prop:"name"},{default:d(()=>[l(w,{modelValue:a(o).name,"onUpdate:modelValue":u[0]||(u[0]=m=>a(o).name=m),placeholder:a(e)("user.pleaseEnterPetName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(g,{label:a(e)("user.species"),prop:"species"},{default:d(()=>[l(w,{modelValue:a(o).species,"onUpdate:modelValue":u[1]||(u[1]=m=>a(o).species=m),placeholder:a(e)("user.pleaseEnterSpecies")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(g,{label:a(e)("user.breed"),prop:"breed"},{default:d(()=>[l(w,{modelValue:a(o).breed,"onUpdate:modelValue":u[2]||(u[2]=m=>a(o).breed=m),placeholder:a(e)("user.pleaseEnterBreed")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(g,{label:a(e)("user.age"),prop:"age"},{default:d(()=>[l(S,{modelValue:a(o).age,"onUpdate:modelValue":u[3]||(u[3]=m=>a(o).age=m),min:0,max:30},null,8,["modelValue"]),b("span",ae,c(a(e)("user.yearsOld")),1)]),_:1},8,["label"]),l(g,{label:a(e)("user.gender"),prop:"gender"},{default:d(()=>[l($,{modelValue:a(o).gender,"onUpdate:modelValue":u[4]||(u[4]=m=>a(o).gender=m)},{default:d(()=>[l(E,{label:"male"},{default:d(()=>[_(c(a(e)("user.male")),1)]),_:1}),l(E,{label:"female"},{default:d(()=>[_(c(a(e)("user.female")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(g,null,{default:d(()=>[l(k,{type:"primary",onClick:B,loading:h.value},{default:d(()=>[_(c(a(e)("common.save")),1)]),_:1},8,["loading"]),l(k,{onClick:N},{default:d(()=>[_(c(a(e)("common.reset")),1)]),_:1}),l(k,{onClick:u[5]||(u[5]=m=>V.$router.back())},{default:d(()=>[_(c(a(e)("common.cancel")),1)]),_:1})]),_:1})]),_:1},8,["model"])),[[U,v.value]])])],2)}}}),ne=J(se,[["__scopeId","data-v-a860a677"]]);export{ne as default};
