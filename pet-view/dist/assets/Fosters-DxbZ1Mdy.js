import{M as N,u as k,h as v,N as I,E as z,d as M,k as R,c as f,o as h,a as t,t as o,m as e,R as V,D as U,e as y,w as D,r as C,F as $,f as j,n as G,I as L,g as b,_ as H}from"./index-CzjmnDZ-.js";import{s as x}from"./request-Dybetxu6.js";import{useThemeStore as O}from"./theme-BvsCIQ48.js";import{u as W,g as Y}from"./genderDisplay-D49x0qo_.js";import{P as q}from"./Pagination-DDL7dCiL.js";import"./genderConverter-CAxqKJGy.js";const A=()=>{const{t:r}=k();return{deleteFoster:async(c,d,i,m,p)=>{try{const u=Number(c);if(await I.confirm(r("user.confirmDeleteFoster"),r("user.confirmDeleteFosterTitle"),{confirmButtonText:r("confirm"),cancelButtonText:r("cancel"),type:"warning"}),(await x.delete(`/fosters/delete/${u}`)).code===200){const l=d.value.findIndex(g=>g.id===u);l!==-1&&(d.value.splice(l,1),i.value=Math.max(0,i.value-1)),z.success(r("user.fosterDeleted")),d.value.length===0&&m.value>1&&m.value--,setTimeout(()=>p(),500)}}catch(u){console.error(r("user.deleteFosterFailed"),u),z.error(r("user.deleteFosterFailed"))}}}},J=()=>{const{t:r}=k(),s=v([]),c=v(1),d=v(10),i=v(0),m=v(!1),p=async()=>{try{let g=(await x.get("/user/fosters",{params:{current_page:c.value,per_page:d.value}})).data;g.records&&g.total!==void 0?(i.value=g.total,s.value=g.records.map(n=>({id:n.fid||n.id,pet:{pid:n.pet?.pid,name:n.pet?.name,breed:n.pet?.breed,age:n.pet?.age,gender:n.pet?.gender,image:n.pet?.image?n.pet.image.startsWith("http")?n.pet.image:`http://localhost:8082/api/images/${n.pet.image}`:"/src/assets/img/dog.jpg"},startDate:n.startDate,endDate:n.endDate,status:n.endDate?"ended":"ongoing"})),console.log("DEBUG: 转换后的数据:",s.value)):s.value=[]}catch{s.value=[],i.value=0,z.error(r("user.loadFosterFailed"))}finally{m.value=!1}};return{fosters:s,loadFosters:p,currentPage:c,pageSize:d,total:i,loading:m,handlePageChange:l=>{c.value=l,p()},handleSizeChange:l=>{d.value=l,c.value=1,p()}}},K=()=>{const{deleteFoster:r}=A(),{fosters:s,loadFosters:c,currentPage:d,pageSize:i,total:m,loading:p,handlePageChange:u,handleSizeChange:_}=J(),l=O(),g=N(()=>l.preferences.theme==="dark");return{fosters:s,isDark:g,currentPage:d,pageSize:i,total:m,loading:p,deleteFoster:r,loadFosters:c,handlePageChange:u,handleSizeChange:_,applyTheme:()=>{l.applyTheme()}}},Q={class:"page-header"},X={class:"fosters-content"},Z={key:0,class:"empty-state"},ee={key:1,class:"fosters-list"},te={class:"pet-image"},se=["src","alt"],ae={class:"foster-details"},ne={class:"pet-info"},oe={class:"pet-breed"},le={class:"pet-age"},re={class:"foster-info"},ie={class:"info-item"},ce={class:"label"},de={class:"value"},ue={class:"info-item"},pe={class:"label"},ge={class:"value"},me={class:"info-item"},_e={class:"label"},he={class:"foster-actions"},ve=M({__name:"Fosters",setup(r){const{t:s}=k(),c=W().formatDate,{deleteFoster:d,fosters:i,isDark:m,loadFosters:p,currentPage:u,pageSize:_,total:l,handlePageChange:g,handleSizeChange:n,applyTheme:P}=K(),T=async S=>{await d(S,i,l,u,p)};return R(()=>{p(),P()}),(S,F)=>{const w=C("el-icon"),B=C("el-tag"),E=C("el-button");return h(),f("div",{class:G(["fosters-container",{dark:e(m)}])},[t("div",Q,[t("h1",null,o(e(s)("user.fosterRecords")),1),t("p",null,o(e(s)("user.viewFosterHistory")),1)]),t("div",X,[e(i).length===0?(h(),f("div",Z,[y(w,null,{default:D(()=>[y(e(L))]),_:1}),t("h3",null,o(e(s)("user.noFosterRecords")),1),t("p",null,o(e(s)("user.noFosterYet")),1)])):(h(),f("div",ee,[(h(!0),f($,null,j(e(i),a=>(h(),f("div",{key:a.id,class:"foster-card"},[t("div",te,[t("img",{src:a.pet.image,alt:a.pet.name},null,8,se)]),t("div",ae,[t("div",ne,[t("h3",null,o(a.pet.name),1),t("p",oe,o(a.pet.breed),1),t("p",le,o(a.pet.age)+o(e(s)("user.yearsOld"))+" · "+o(e(Y)(a.pet.gender)),1)]),t("div",re,[t("div",ie,[t("span",ce,o(e(s)("user.fosterStart"))+"：",1),t("span",de,o(e(c)(a.startDate)),1)]),t("div",ue,[t("span",pe,o(e(s)("user.fosterEnd"))+"：",1),t("span",ge,o(a.endDate?e(c)(a.endDate):e(s)("user.ongoing")),1)]),t("div",me,[t("span",_e,o(e(s)("user.status"))+"：",1),y(B,{type:a.status==="ongoing"?"warning":"success"},{default:D(()=>[b(o(a.status==="ongoing"?e(s)("user.ongoing"):e(s)("user.fosterEnded")),1)]),_:2},1032,["type"])])]),t("div",he,[y(E,{type:"danger",size:"small",onClick:fe=>T(a.id),disabled:!a.id||a.id===void 0||a.id===null},{default:D(()=>[b(o(e(s)("user.deleteRecord")),1)]),_:1},8,["onClick","disabled"])])])]))),128))])),e(l)>0?(h(),V(q,{key:2,"current-page":e(u),"page-size":e(_),total:e(l),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper","onUpdate:currentPage":F[0]||(F[0]=a=>u.value=a),"onUpdate:pageSize":F[1]||(F[1]=a=>_.value=a),onPageChange:e(g),onSizeChange:e(n)},null,8,["current-page","page-size","total","onPageChange","onSizeChange"])):U("",!0)])],2)}}}),Se=H(ve,[["__scopeId","data-v-1fc524e0"]]);export{Se as default};
