import{d as L}from"./dog-DzFJ_7DI.js";import{u as P,h as k,i as M,j as U,E as _,k as S,d as N,c as E,o as j,a,t as m,l as o,e as t,w as l,r as c,g as h,m as z,p as B,_ as F}from"./index-BrRsyrLM.js";import{u as R}from"./user-fUdRYWgh.js";import{s as T}from"./request-DVyWtN3q.js";const q=()=>{const w=S(),f=M(),{t:i}=P(),s=R(),n=k("/user");f.query.from&&(n.value=f.query.from);const r=U({username:"",password:"",rememberMe:!1});return(()=>{const d=localStorage.getItem("rememberedUsername"),e=localStorage.getItem("rememberedPassword");d&&e&&(r.username=d,r.password=e,r.rememberMe=!0)})(),{t:i,form:r,routerPath:n,handleLogin:async()=>{try{if(!r.username.trim()){_.warning({message:i("login.usernamePlaceholder"),showClose:!0,duration:3e3});return}if(!r.password.trim()){_.warning({message:i("login.passwordPlaceholder"),showClose:!0,duration:3e3});return}const e=(await T.post("/user/login",{username:r.username,password:r.password})).data;if(e.ok){const u=e.token;if(!u){_.error({message:i("login.networkError"),showClose:!0,duration:5e3});return}localStorage.removeItem("jwt_token"),localStorage.removeItem("userId"),r.rememberMe||(localStorage.removeItem("rememberedUsername"),localStorage.removeItem("rememberedPassword")),localStorage.setItem("userId",e.userId.toString()),localStorage.setItem("jwt_token",u),r.rememberMe&&(localStorage.setItem("rememberedUsername",r.username),localStorage.setItem("rememberedPassword",r.password)),s.info.userId=e.userId,s.info.userName=e.username||"",localStorage.setItem("userInfo",JSON.stringify(s.info)),await s.fetchProfile(),_.success({message:`欢迎回来，${e.username||"用户"}！`,showClose:!0,duration:2e3}),await w.push(n.value)}}catch{let e=i("login.error");_.error({message:e,showClose:!0,duration:5e3})}}}},D={class:"login-container"},A={class:"login-card"},H={class:"login-left"},J={class:"image-container"},O={class:"image-overlay"},$={class:"welcome-title"},G={class:"welcome-subtitle"},K={class:"login-right"},Q={class:"form-header"},W={class:"form-title"},X={class:"form-subtitle"},Y={class:"form-footer"},Z={class:"register-text"},ee=N({__name:"Login",setup(w){const f=S(),i=k(!1),{t:s,form:n,handleLogin:r}=q(),b=async()=>{i.value=!0;try{await r()}finally{i.value=!1}},v=()=>{f.push("/register")};return(d,e)=>{const u=c("el-icon"),I=c("el-input"),p=c("el-form-item"),y=c("el-checkbox"),V=c("el-button"),x=c("el-form"),C=c("el-link");return j(),E("div",D,[a("div",A,[a("div",H,[a("div",J,[e[3]||(e[3]=a("img",{src:L,alt:"宠物",class:"login-image"},null,-1)),a("div",O,[a("h1",$,m(o(s)("login.welcomeTitle")||"欢迎回来"),1),a("p",G,m(o(s)("login.welcomeSubtitle")||"登录您的账户，继续您的宠物之旅"),1)])])]),a("div",K,[a("div",Q,[a("h2",W,m(o(s)("login.title")),1),a("p",X,m(o(s)("login.subtitle")||"请输入您的账户信息"),1)]),t(x,{model:o(n),ref:"loginForm","label-width":"0",class:"login-form"},{default:l(()=>[t(p,null,{default:l(()=>[t(I,{modelValue:o(n).username,"onUpdate:modelValue":e[0]||(e[0]=g=>o(n).username=g),placeholder:o(s)("login.usernamePlaceholder"),size:"large"},{prefix:l(()=>[t(u,null,{default:l(()=>[t(o(z))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),t(p,null,{default:l(()=>[t(I,{modelValue:o(n).password,"onUpdate:modelValue":e[1]||(e[1]=g=>o(n).password=g),type:"password",placeholder:o(s)("login.passwordPlaceholder"),size:"large","show-password":""},{prefix:l(()=>[t(u,null,{default:l(()=>[t(o(B))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),t(p,{class:"remember-me-item"},{default:l(()=>[t(y,{modelValue:o(n).rememberMe,"onUpdate:modelValue":e[2]||(e[2]=g=>o(n).rememberMe=g),class:"remember-me-checkbox"},{default:l(()=>[h(m(o(s)("login.rememberMe")),1)]),_:1},8,["modelValue"])]),_:1}),t(p,null,{default:l(()=>[t(V,{type:"primary",onClick:b,size:"large",class:"submit-btn",loading:i.value},{default:l(()=>[h(m(o(s)("login.userLogin")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),a("div",Y,[a("p",Z,[h(m(o(s)("login.noAccount")||"还没有账户？")+" ",1),t(C,{type:"primary",onClick:v,underline:!1},{default:l(()=>[h(m(o(s)("login.registerLink")),1)]),_:1})])])])])])}}}),ae=F(ee,[["__scopeId","data-v-e63c4b5b"]]);export{ae as default};
