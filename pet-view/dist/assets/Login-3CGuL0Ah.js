import{_ as L}from"./dog-CLIpk0wi.js";import{u as M,h as S,i as P,j as U,E as _,k,d as N,c as T,o as j,a,t as i,l as o,e as t,w as n,r as m,g as h,m as z,p as B,_ as E}from"./index-BIX1Ehmq.js";import{u as F}from"./user-DQjmLxXu.js";import{s as R}from"./request-DUfzvZFe.js";const q=()=>{const w=k(),f=P(),{t:c}=M(),s=F(),l=S("/user");f.query.from&&(l.value=f.query.from);const r=U({username:"",password:"",rememberMe:!1});return(()=>{const d=localStorage.getItem("rememberedUsername"),e=localStorage.getItem("rememberedPassword");d&&e&&(r.username=d,r.password=e,r.rememberMe=!0)})(),{t:c,form:r,routerPath:l,handleLogin:async()=>{try{if(!r.username.trim()){_.warning({message:"请输入用户名",showClose:!0,duration:3e3});return}if(!r.password.trim()){_.warning({message:"请输入密码",showClose:!0,duration:3e3});return}const e=(await R.post("/user/login",{username:r.username,password:r.password})).data;if(e.ok){const u=e.token;if(!u){_.error({message:"登录失败：服务器响应异常，请稍后重试",showClose:!0,duration:5e3});return}localStorage.removeItem("jwt_token"),localStorage.removeItem("userId"),r.rememberMe||(localStorage.removeItem("rememberedUsername"),localStorage.removeItem("rememberedPassword")),localStorage.setItem("userId",e.userId.toString()),localStorage.setItem("jwt_token",u),r.rememberMe&&(localStorage.setItem("rememberedUsername",r.username),localStorage.setItem("rememberedPassword",r.password)),s.info.userId=e.userId,s.info.userName=e.userName||"",localStorage.setItem("userInfo",JSON.stringify(s.info)),console.log("登录成功，开始获取完整用户资料..."),await s.fetchProfile(),_.success({message:`欢迎回来，${e.userName||"用户"}！`,showClose:!0,duration:2e3}),await w.push(l.value),console.log(c("redirectSuccessTo"),l.value)}}catch(d){console.error("登录请求失败:",d),_.error({message:"用户名或密码错误，请检查后重新输入",showClose:!0,duration:5e3})}}}},D={class:"login-container"},A={class:"login-card"},H={class:"login-left"},J={class:"image-container"},O={class:"image-overlay"},$={class:"welcome-title"},G={class:"welcome-subtitle"},K={class:"login-right"},Q={class:"form-header"},W={class:"form-title"},X={class:"form-subtitle"},Y={class:"form-footer"},Z={class:"register-text"},ee=N({__name:"Login",setup(w){const f=k(),c=S(!1),{t:s,form:l,handleLogin:r}=q(),b=async()=>{c.value=!0;try{await r()}finally{c.value=!1}},v=()=>{f.push("/register")};return(d,e)=>{const u=m("el-icon"),I=m("el-input"),p=m("el-form-item"),y=m("el-checkbox"),V=m("el-button"),x=m("el-form"),C=m("el-link");return j(),T("div",D,[a("div",A,[a("div",H,[a("div",J,[e[3]||(e[3]=a("img",{src:L,alt:"宠物",class:"login-image"},null,-1)),a("div",O,[a("h1",$,i(o(s)("login.welcomeTitle")||"欢迎回来"),1),a("p",G,i(o(s)("login.welcomeSubtitle")||"登录您的账户，继续您的宠物之旅"),1)])])]),a("div",K,[a("div",Q,[a("h2",W,i(o(s)("login.title")),1),a("p",X,i(o(s)("login.subtitle")||"请输入您的账户信息"),1)]),t(x,{model:o(l),ref:"loginForm","label-width":"0",class:"login-form"},{default:n(()=>[t(p,null,{default:n(()=>[t(I,{modelValue:o(l).username,"onUpdate:modelValue":e[0]||(e[0]=g=>o(l).username=g),placeholder:o(s)("login.usernamePlaceholder"),size:"large"},{prefix:n(()=>[t(u,null,{default:n(()=>[t(o(z))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),t(p,null,{default:n(()=>[t(I,{modelValue:o(l).password,"onUpdate:modelValue":e[1]||(e[1]=g=>o(l).password=g),type:"password",placeholder:o(s)("login.passwordPlaceholder"),size:"large","show-password":""},{prefix:n(()=>[t(u,null,{default:n(()=>[t(o(B))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),t(p,{class:"remember-me-item"},{default:n(()=>[t(y,{modelValue:o(l).rememberMe,"onUpdate:modelValue":e[2]||(e[2]=g=>o(l).rememberMe=g),class:"remember-me-checkbox"},{default:n(()=>[h(i(o(s)("login.rememberMe")),1)]),_:1},8,["modelValue"])]),_:1}),t(p,null,{default:n(()=>[t(V,{type:"primary",onClick:b,size:"large",class:"submit-btn",loading:c.value},{default:n(()=>[h(i(o(s)("login.userLogin")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),a("div",Y,[a("p",Z,[h(i(o(s)("login.noAccount")||"还没有账户？")+" ",1),t(C,{type:"primary",onClick:v,underline:!1},{default:n(()=>[h(i(o(s)("login.registerLink")),1)]),_:1})])])])])])}}}),ae=E(ee,[["__scopeId","data-v-e63c4b5b"]]);export{ae as default};
