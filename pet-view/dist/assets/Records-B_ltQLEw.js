import{h as $,I as J,u as O,j as ye,E as F,J as ke,d as Me,v as we,a1 as Ee,c,o as r,a as t,z as w,O as Fe,t as i,l as e,N as D,Z as A,F as S,f as I,a0 as oe,g as se,n as V,U as Ce,$ as G,e as he,w as ge,a2 as fe,a3 as $e,a4 as me,_ as Te}from"./index-BIX1Ehmq.js";import{s as L}from"./request-DUfzvZFe.js";import{useThemeStore as De}from"./theme-cTCRAQz8.js";const Ue=async(l,o)=>{if(!l||l.length===0)return console.warn("æ²¡æœ‰æ–‡ä»¶éœ€è¦ä¸Šä¼ "),{success:!0,message:"æ²¡æœ‰æ–‡ä»¶éœ€è¦ä¸Šä¼ "};const p=new FormData;l.forEach(d=>{p.append("files",d)}),p.append("recordId",String(o)),p.append("batchUpload","true"),console.log(`å¼€å§‹æ‰¹é‡ä¸Šä¼  ${l.length} ä¸ªæ–‡ä»¶åˆ°è®°å½• ${o}`);try{const d=await L.post("/media/upload",p);return console.log("æ‰¹é‡ä¸Šä¼ å®Œæˆï¼Œå“åº”:",d),d}catch(d){throw console.error("æ‰¹é‡ä¸Šä¼ å¤±è´¥:",d),d}},xe=()=>{const{t:l}=O();return{getMoodEmoji:p=>{const d={[l("happy")]:"ðŸ˜Š",[l("angry")]:"ðŸ˜ ",[l("tired")]:"ðŸ˜´",[l("active")]:"ðŸ•"};return p&&d[p]||"ðŸ˜"}}},Pe=()=>{const{t:l}=O();return{getMoodClass:p=>({happy:p===l("happy"),angry:p===l("angry"),tired:p===l("tired"),active:p===l("active")})}},Se=()=>({formatDate:o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}),z={maxFileSize:52428800,supportedImageFormats:["image/jpeg","image/png","image/gif","image/webp","image/jpg"],supportedVideoFormats:["video/mp4","video/mpeg","video/quicktime","video/x-msvideo","video/webm"],thumbnailMaxWidth:200,thumbnailMaxHeight:200},Ie=l=>new Promise((o,p)=>{const d=new FileReader;d.onload=u=>{const n=new Image;n.onload=()=>{const m=document.createElement("canvas"),v=m.getContext("2d");if(!v){o(u.target?.result);return}let h=n.width,g=n.height;const f=z.thumbnailMaxWidth,_=z.thumbnailMaxHeight;h>g?h>f&&(g=g*f/h,h=f):g>_&&(h=h*_/g,g=_),m.width=h,m.height=g,v.drawImage(n,0,0,h,g),o(m.toDataURL("image/jpeg",.7))},n.onerror=()=>{o(u.target?.result)},n.src=u.target?.result},d.onerror=()=>p(new Error("æ— æ³•è¯»å–æ–‡ä»¶")),d.readAsDataURL(l)}),Ve=l=>{if(l.size>z.maxFileSize)return{valid:!1,error:`æ–‡ä»¶è¿‡å¤§ï¼Œæœ€å¤§æ”¯æŒ${z.maxFileSize/1024/1024}MB`};const o=z.supportedImageFormats.includes(l.type),p=z.supportedVideoFormats.includes(l.type);return!o&&!p?{valid:!1,error:"ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œä»…æ”¯æŒå¸¸è§çš„å›¾ç‰‡å’Œè§†é¢‘æ ¼å¼"}:{valid:!0}},Ae=()=>{const l=$([]);return{filePreviews:l,handleFileUpload:async v=>{const h=v.target,g=Array.from(h.files||[]);if(console.log(`ç”¨æˆ·é€‰æ‹©äº† ${g.length} ä¸ªæ–‡ä»¶`),l.value.length+g.length>5){F.error("æœ€å¤šåªèƒ½ä¸Šä¼ 5ä¸ªæ–‡ä»¶");return}for(const f of g){console.log(`å¤„ç†æ–‡ä»¶: ${f.name}, å¤§å°: ${f.size}, ç±»åž‹: ${f.type}`);const _=Ve(f);if(!_.valid){F.error(`æ–‡ä»¶ "${f.name}" éªŒè¯å¤±è´¥ï¼š${_.error}`);continue}try{const b=f.type.startsWith("image/")?"image":"video";let C=URL.createObjectURL(f),k=b==="image"?await Ie(f):C;l.value.push({file:f,previewUrl:C,thumbnailUrl:k,mediaType:b,isValid:!0}),console.log(`æ–‡ä»¶ "${f.name}" å·²æ·»åŠ åˆ°é¢„è§ˆåˆ—è¡¨`),F.success(`æ–‡ä»¶ "${f.name}" æ·»åŠ æˆåŠŸ`)}catch(b){console.error(`å¤„ç†æ–‡ä»¶ "${f.name}" å¤±è´¥:`,b),F.error(`æ–‡ä»¶ "${f.name}" å¤„ç†å¤±è´¥ï¼š${b instanceof Error?b.message:"æœªçŸ¥é”™è¯¯"}`)}}h.value="",console.log(`å½“å‰é¢„è§ˆåˆ—è¡¨ä¸­å…±æœ‰ ${l.value.length} ä¸ªæ–‡ä»¶`)},removeFile:v=>{const h=l.value[v];h&&h.previewUrl.startsWith("blob:")&&URL.revokeObjectURL(h.previewUrl),l.value.splice(v,1),F.success("æ–‡ä»¶å·²åˆ é™¤")},clearAllFiles:()=>{l.value.forEach(v=>{v.previewUrl.startsWith("blob:")&&URL.revokeObjectURL(v.previewUrl)}),l.value=[]},getUploadFiles:()=>{const v=l.value.map(h=>h.file);return console.log(`èŽ·å–ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨ï¼Œå…± ${v.length} ä¸ªæ–‡ä»¶`),v},getFileIcon:v=>v==="image"?"ðŸ–¼ï¸":v==="video"?"ðŸŽ¬":"ðŸ“„",formatFileSize:v=>{if(v===0)return"0 Bytes";const h=1024,g=["Bytes","KB","MB"],f=Math.floor(Math.log(v)/Math.log(h));return Math.round(v/Math.pow(h,f)*100)/100+" "+g[f]}}},Le=()=>{const l=$(!1),o=$([]),p=$(!1),d=$(0);return{showMediaModal:l,currentMediaList:o,mediaLoading:p,currentMediaIndex:d,openMediaModal:async(g,f)=>{if(d.value=0,f){p.value=!0;try{const _=await L.get(`/media/record/${f}`);if(_.code===200&&_.data){const b=Array.isArray(_.data)?_.data:[_.data];o.value=b.map(C=>({id:C.mid,media_url:`/api${C.filePath}`,media_type:C.mediaType,media_name:C.fileName,updated_at:C.updatedAt}))}else o.value=[]}catch(_){console.error("åŠ è½½åª’ä½“æ–‡ä»¶å¤±è´¥:",_),F.error("åŠ è½½åª’ä½“æ–‡ä»¶å¤±è´¥"),o.value=[]}finally{p.value=!1}}else o.value=g||[];l.value=!0},closeMediaModal:()=>{l.value=!1,o.value=[],d.value=0},nextMedia:()=>{o.value.length>1&&(d.value=(d.value+1)%o.value.length)},prevMedia:()=>{o.value.length>1&&(d.value=(d.value-1+o.value.length)%o.value.length)},selectMedia:g=>{g>=0&&g<o.value.length&&(d.value=g)}}},be=()=>{const{t:l}=O(),o=$([]),p=$(!1);return{events:o,loading:p,fetchEvents:async()=>{p.value=!0;try{const u=await L.get("/events");u.code===200&&u.data?o.value=u.data.map(n=>({record_id:n.eid,pid:n.pid,event_type:n.eventType,description:n.description,record_time:n.eventTime,mood:n.mood,location:n.location,pet_name:n.pet_name||"",created_at:n.createdAt||n.eventTime,updated_at:n.updatedAt||n.createdAt||n.eventTime,media_list:n.mediaList?n.mediaList.map(m=>({id:m.mid,media_url:`/api${m.filePath}`,media_type:m.mediaType,media_name:m.fileName,updated_at:m.updatedAt})):[]})):o.value=[]}catch(u){console.error("èŽ·å–äº‹ä»¶å¤±è´¥:",u),F.error(l("api.getEventsFailed")),o.value=[]}finally{p.value=!1}}}},je=()=>{const{t:l}=O(),o=$([]),p=$(!1);return{pets:o,loading:p,fetchPets:async()=>{p.value=!0;try{const n=await L.get("/user/adoptions",{params:{current_page:1,per_page:100}});n.code===200&&n.data?.records?o.value=n.data.records.map(m=>({pid:m.pid||m.id,name:m.name||m.petName,species:m.breed||m.species||"æœªçŸ¥",breed:m.breed||m.species||"æœªçŸ¥",type:"adoption",date:m.adoptionDate||m.adoptDate||m.date})):o.value=[]}catch(n){F.error(l("api.getPetsFailed")),console.error("Error fetching pets:",n),o.value=[]}finally{p.value=!1}},getPetName:(n,m)=>{const v=o.value.find(h=>h.pid===n);return v?v.name:m||l("api.unknownPet")}}},Be=l=>{const{t:o}=O(),{fetchEvents:p}=l||be();return{deleteEvent:async u=>{try{if(!u||u<=0){console.error("Invalid recordId:",u),F.error("æ— æ•ˆçš„è®°å½•ID");return}await ke.confirm(o("common.confirmDeleteEvent"),o("common.deleteConfirmation"),{confirmButtonText:o("common.confirm"),cancelButtonText:o("common.cancel"),type:"warning"}),await L.delete(`/events/${u}`),F.success(o("api.deleteSuccess")),await p()}catch(n){n!=="cancel"&&(F.error(o("api.deleteFailed")),console.error("Error deleting event:",n))}}}},Ne=l=>{const o=ye({selectedPet:"",selectedEventType:"",selectedMood:"",selectedDate:""}),p=J(()=>{let d=[...l.value];return o.selectedPet&&(d=d.filter(u=>u.pid===Number(o.selectedPet))),o.selectedEventType&&(d=d.filter(u=>u.event_type===o.selectedEventType)),o.selectedMood&&(d=d.filter(u=>u.mood===o.selectedMood)),o.selectedDate&&(d=d.filter(u=>new Date(u.record_time).toDateString()===new Date(o.selectedDate).toDateString())),d});return{filters:o,filteredEvents:p}},Re=l=>{const o=$("record_time"),p=J(()=>{const d=[...l.value];return d.sort((u,n)=>{switch(o.value){case"event_type":return u.event_type.localeCompare(n.event_type);case"mood":return(u.mood||"").localeCompare(n.mood||"");case"record_time":default:return new Date(n.record_time).getTime()-new Date(u.record_time).getTime()}}),d});return{sortBy:o,sortedEvents:p}},ze=l=>({groupedEvents:J(()=>{const p={};return l.value.forEach(d=>{const u=new Date(d.record_time).toDateString();p[u]||(p[u]=[]),p[u].push(d)}),p})}),Oe=()=>{const l=ye({record_id:"",pid:"",event_type:"",mood:"",description:"",location:"",record_time:""});return{formData:l,resetForm:()=>{Object.assign(l,{record_id:"",pid:"",event_type:"",mood:"",description:"",location:"",record_time:""})},populateForm:d=>{let u="";try{if(d.record_time){const n=d.record_time.replace(" ","T"),m=new Date(n);if(!isNaN(m.getTime()))u=m.toISOString().slice(0,16);else{const v=d.record_time.split(" ");v.length===2&&(u=`${v[0]}T${v[1].slice(0,5)}`)}}}catch(n){console.error("Error parsing date:",n,d.record_time)}Object.assign(l,{...d,record_time:u})}}},We=()=>{const{events:l,loading:o,fetchEvents:p}=be(),{pets:d,fetchPets:u,getPetName:n}=je(),{getMoodEmoji:m}=xe(),{getMoodClass:v}=Pe(),{formatDate:h}=Se(),{filePreviews:g,handleFileUpload:f,removeFile:_,clearAllFiles:b,getUploadFiles:C,getFileIcon:k,formatFileSize:ie}=Ae(),{showMediaModal:ae,currentMediaList:Z,mediaLoading:le,currentMediaIndex:de,openMediaModal:ne,closeMediaModal:W,nextMedia:q,prevMedia:H,selectMedia:U}=Le(),{filters:Q,filteredEvents:X}=Ne(l),{sortBy:re,sortedEvents:Y}=Re(X),{groupedEvents:K}=ze(Y),{formData:E,resetForm:j,populateForm:B}=Oe(),{deleteEvent:ce}=Be({fetchEvents:p}),N=$(!1),P=$(!1),ee=$("grid"),T=$(!1),_e=J(()=>l.value.length),a=J(()=>l.value.reduce((x,ue)=>x+(ue.media_list?.length||0),0)),s=x=>{B(x),P.value=!0},y=()=>{N.value=!1,P.value=!1,b(),j()};return{events:l,pets:d,loading:o,filters:Q,viewMode:ee,sortBy:re,isSubmitting:T,showAddModal:N,showEditModal:P,showMediaModal:ae,mediaLoading:le,currentMediaIndex:de,formData:E,filePreviews:g,currentMediaList:Z,totalEvents:_e,totalMedia:a,filteredEvents:X,sortedEvents:Y,groupedEvents:K,fetchEvents:p,fetchPets:u,getPetName:n,getMoodEmoji:m,getMoodClass:v,formatDate:h,handleFileUpload:f,removeFile:_,getFileIcon:k,formatFileSize:ie,openMediaModal:ne,closeMediaModal:W,nextMedia:q,prevMedia:H,selectMedia:U,editEvent:s,deleteEvent:ce,saveEvent:async()=>{if(T.value){F.warning("æ­£åœ¨ä¿å­˜ä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤");return}T.value=!0;try{const x=E.record_time,ue=x?x.replace("T"," ")+":00":"",ve={pid:E.pid,eventType:E.event_type,recordTime:ue,description:E.description,mood:E.mood||"",location:E.location||""};let te=null;if(P.value&&E.record_id?(await L.put(`/events/${E.record_id}`,ve),te=Number(E.record_id),F.success("äº‹ä»¶æ›´æ–°æˆåŠŸ")):(te=(await L.post("/events",ve)).data?.eid,F.success("äº‹ä»¶æ·»åŠ æˆåŠŸ")),te){const R=C();if(console.log(`å‡†å¤‡ä¸Šä¼ çš„æ–‡ä»¶æ•°é‡: ${R?R.length:0}`),R&&R.length>0)try{console.log("å¼€å§‹ä¸Šä¼ åª’ä½“æ–‡ä»¶...");const pe=await Ue(R,te);console.log("åª’ä½“æ–‡ä»¶ä¸Šä¼ ç»“æžœ:",pe),F.success("äº‹ä»¶ä¿å­˜æˆåŠŸï¼Œåª’ä½“æ–‡ä»¶ä¸Šä¼ å®Œæˆ")}catch(pe){console.warn("æµç¨‹è­¦å‘Šï¼šäº‹ä»¶ä¿å­˜æˆåŠŸï¼Œä½†åª’ä½“æ–‡ä»¶ä¸Šä¼ å¤±è´¥",pe),F.warning("äº‹ä»¶ä¿å­˜æˆåŠŸï¼Œä½†åª’ä½“æ–‡ä»¶ä¸Šä¼ å¤±è´¥")}else console.log("æ²¡æœ‰æ–‡ä»¶éœ€è¦ä¸Šä¼ ")}await p(),y()}catch(x){F.error(P.value?"äº‹ä»¶æ›´æ–°å¤±è´¥":"äº‹ä»¶æ·»åŠ å¤±è´¥"),console.error("Error saving event:",x)}finally{T.value=!1}},closeModal:y}},qe={class:"page-header"},He={class:"stats-grid"},Ke={class:"stat-card"},Ge={class:"stat-content"},Je={class:"stat-card"},Ze={class:"stat-content"},Qe={class:"stat-card"},Xe={class:"stat-content"},Ye={class:"controls-section"},et={class:"filter-group"},tt={style:{position:"relative"}},ot=["disabled"],st={value:""},it=["value"],at={key:0,style:{position:"absolute",top:"-20px",left:"0",color:"#666"}},lt={value:""},dt={value:"å–‚é£Ÿ"},nt={value:"æ´—æ¾¡"},rt={value:"æ•£æ­¥"},ct={value:"çœ‹å…½åŒ»"},ut={value:"çŽ©è€"},pt={value:"æ‰“ç–«è‹—"},mt={value:""},_t={value:"å¼€å¿ƒ"},vt={value:"ç”Ÿæ°”"},ht={value:"ç–²å€¦"},gt={value:"æ´»è·ƒ"},ft=["placeholder"],yt={class:"view-controls"},bt={class:"view-toggle"},kt={class:"sort-controls"},Mt={value:"record_time"},wt={value:"event_type"},Et={value:"mood"},Ft={class:"events-content"},Ct={key:0,class:"events-grid"},$t={class:"event-header"},Tt={class:"pet-info"},Dt={class:"event-type"},Ut={key:0,class:"event-mood"},xt={class:"mood-emoji"},Pt={class:"mood-text"},St={class:"event-content"},It={class:"description"},Vt={key:0,class:"location"},At={key:0,class:"event-media"},Lt={class:"media-preview"},jt=["src","alt","onClick"],Bt=["src","onClick"],Nt=["onClick"],Rt={class:"event-footer"},zt={class:"event-time"},Ot={class:"record-time"},Wt={class:"created-time"},qt={key:0,class:"updated-time"},Ht={class:"event-actions"},Kt=["onClick"],Gt=["onClick","disabled"],Jt={key:1,class:"events-list"},Zt={class:"list-header"},Qt={class:"col-pet"},Xt={class:"col-type"},Yt={class:"col-mood"},eo={class:"col-description"},to={class:"col-time"},oo={class:"col-actions"},so={class:"col-pet"},io={class:"pet-info"},ao={class:"col-type"},lo={class:"event-type-badge"},no={class:"col-mood"},ro={key:0,class:"mood-indicator"},co={class:"mood-emoji"},uo={class:"col-description"},po={class:"description-text"},mo={key:0,class:"location-small"},_o={class:"col-time"},vo={class:"time-text"},ho={class:"col-actions"},go=["onClick"],fo=["onClick","disabled"],yo={key:2,class:"timeline-view"},bo={class:"timeline"},ko={class:"timeline-date"},Mo={class:"timeline-items"},wo={class:"timeline-content"},Eo={class:"timeline-header"},Fo={class:"event-type-badge"},Co={key:0,class:"mood-indicator"},$o={class:"mood-emoji"},To={class:"description"},Do={key:0,class:"location"},Uo={class:"timeline-footer"},xo={class:"time-text"},Po={class:"timeline-actions"},So=["onClick"],Io=["onClick","disabled"],Vo={class:"modal-header"},Ao={class:"modal-form"},Lo={class:"form-group"},jo={value:""},Bo=["value"],No={class:"form-group"},Ro={value:""},zo={value:"å–‚é£Ÿ"},Oo={value:"æ´—æ¾¡"},Wo={value:"æ•£æ­¥"},qo={value:"çœ‹å…½åŒ»"},Ho={value:"çŽ©è€"},Ko={value:"æ‰“ç–«è‹—"},Go={class:"form-group"},Jo={value:""},Zo={value:"å¼€å¿ƒ"},Qo={value:"ç”Ÿæ°”"},Xo={value:"ç–²å€¦"},Yo={value:"æ´»è·ƒ"},es={class:"form-group"},ts={class:"form-group"},os=["placeholder"],ss={class:"form-group"},is=["placeholder"],as={class:"form-group"},ls={class:"media-upload"},ds={class:"upload-area"},ns={for:"media-file-input",class:"upload-label"},rs={class:"upload-text"},cs={class:"upload-hint"},us={key:0,class:"uploaded-files"},ps={class:"uploaded-files-title"},ms={class:"file-preview-grid"},_s={class:"preview-thumbnail"},vs=["src","alt"],hs={key:1,class:"preview-video-placeholder"},gs={class:"file-info-full"},fs={class:"file-name-container"},ys={class:"file-icon"},bs=["title"],ks={class:"file-size-type"},Ms={class:"file-size"},ws={class:"file-type"},Es=["onClick","title"],Fs={class:"upload-hint-text"},Cs={class:"modal-actions"},$s=["disabled"],Ts=["disabled"],Ds={key:0,class:"media-viewer-main"},Us=["aria-label"],xs={class:"media-display"},Ps=["src","alt"],Ss=["src"],Is=["aria-label"],Vs={key:1,class:"media-viewer-footer"},As={class:"media-info"},Ls={key:0},js={key:1},Bs={key:0,class:"media-thumbnails"},Ns=["onClick","aria-label"],Rs=["src","alt"],zs={key:1,class:"video-thumbnail"},Os={key:2,class:"media-empty"},Ws=Me({__name:"Records",setup(l){const{t:o}=O(),p=De(),{pets:d,filters:u,viewMode:n,sortBy:m,isSubmitting:v,showAddModal:h,showEditModal:g,showMediaModal:f,currentMediaIndex:_,formData:b,filePreviews:C,currentMediaList:k,totalEvents:ie,totalMedia:ae,sortedEvents:Z,groupedEvents:le,fetchEvents:de,fetchPets:ne,getPetName:W,getMoodEmoji:q,getMoodClass:H,formatDate:U,handleFileUpload:Q,removeFile:X,getFileIcon:re,formatFileSize:Y,openMediaModal:K,closeMediaModal:E,nextMedia:j,prevMedia:B,selectMedia:ce,editEvent:N,deleteEvent:P,saveEvent:ee,closeModal:T}=We();return we(async()=>{await ne(),await Ee(),await de()}),(_e,a)=>(r(),c("div",{class:V(["events-container",{"dark-theme":e(p).preferences.theme==="dark"}])},[t("div",qe,[t("h1",null,i(e(o)("records.pageTitle")),1),t("p",null,i(e(o)("records.pageSubtitle")),1)]),t("div",He,[t("div",Ke,[a[29]||(a[29]=t("div",{class:"stat-icon"},"ðŸ“…",-1)),t("div",Ge,[t("h3",null,i(e(ie)),1),t("p",null,i(e(o)("records.totalEvents")),1)])]),t("div",Je,[a[30]||(a[30]=t("div",{class:"stat-icon"},"ðŸ•",-1)),t("div",Ze,[t("h3",null,i(e(d).length),1),t("p",null,i(e(o)("records.totalPets")),1)])]),t("div",Qe,[a[31]||(a[31]=t("div",{class:"stat-icon"},"ðŸ“¸",-1)),t("div",Xe,[t("h3",null,i(e(ae)),1),t("p",null,i(e(o)("records.totalMedia")),1)])])]),t("div",Ye,[t("div",et,[t("div",tt,[D(t("select",{"onUpdate:modelValue":a[0]||(a[0]=s=>e(u).selectedPet=s),class:"filter-select",disabled:e(d).length===0},[t("option",st,i(e(d).length===0?e(o)("records.loading"):e(o)("records.allPets")),1),(r(!0),c(S,null,I(e(d),s=>(r(),c("option",{key:s.pid,value:s.pid},i(s.name),9,it))),128))],8,ot),[[A,e(u).selectedPet]]),e(d).length>0?(r(),c("small",at,i(e(o)("records.foundPets",{count:e(d).length})),1)):w("",!0)]),D(t("select",{"onUpdate:modelValue":a[1]||(a[1]=s=>e(u).selectedEventType=s),class:"filter-select"},[t("option",lt,i(e(o)("records.allEvents")),1),t("option",dt,i(e(o)("records.feeding")),1),t("option",nt,i(e(o)("records.bathing")),1),t("option",rt,i(e(o)("records.walking")),1),t("option",ct,i(e(o)("records.veterinary")),1),t("option",ut,i(e(o)("records.playing")),1),t("option",pt,i(e(o)("records.vaccination")),1)],512),[[A,e(u).selectedEventType]]),D(t("select",{"onUpdate:modelValue":a[2]||(a[2]=s=>e(u).selectedMood=s),class:"filter-select"},[t("option",mt,i(e(o)("records.allMood")),1),t("option",_t,i(e(o)("records.happy")),1),t("option",vt,i(e(o)("records.angry")),1),t("option",ht,i(e(o)("records.tired")),1),t("option",gt,i(e(o)("records.active")),1)],512),[[A,e(u).selectedMood]]),D(t("input",{type:"date","onUpdate:modelValue":a[3]||(a[3]=s=>e(u).selectedDate=s),class:"filter-input",placeholder:e(o)("records.selectDate")},null,8,ft),[[oe,e(u).selectedDate]])]),t("button",{class:"add-button",onClick:a[4]||(a[4]=s=>h.value=!0)},[a[32]||(a[32]=t("span",null,"+",-1)),se(" "+i(e(o)("records.addEvent")),1)])]),t("div",yt,[t("div",bt,[t("button",{class:V({active:e(n)==="grid"}),onClick:a[5]||(a[5]=s=>n.value="grid")},i(e(o)("records.gridView")),3),t("button",{class:V({active:e(n)==="list"}),onClick:a[6]||(a[6]=s=>n.value="list")},i(e(o)("records.listView")),3),t("button",{class:V({active:e(n)==="timeline"}),onClick:a[7]||(a[7]=s=>n.value="timeline")},i(e(o)("records.timeline")),3)]),t("div",kt,[D(t("select",{"onUpdate:modelValue":a[8]||(a[8]=s=>Ce(m)?m.value=s:null),class:"sort-select"},[t("option",Mt,i(e(o)("records.sortByTime")),1),t("option",wt,i(e(o)("records.sortByType")),1),t("option",Et,i(e(o)("records.sortByMood")),1)],512),[[A,e(m)]])])]),t("div",Ft,[e(n)==="grid"?(r(),c("div",Ct,[(r(!0),c(S,null,I(e(Z),s=>(r(),c("div",{key:s.record_id,class:V(["event-card",s.mood?e(H)(s.mood):{}])},[t("div",$t,[t("div",Tt,[t("h4",null,i(e(W)(s.pid,s.pet_name)),1),t("span",Dt,i(s.event_type),1)]),s.mood?(r(),c("div",Ut,[t("span",xt,i(e(q)(s.mood)),1),t("span",Pt,i(s.mood),1)])):w("",!0)]),t("div",St,[t("p",It,i(s.description),1),s.location?(r(),c("div",Vt,[a[33]||(a[33]=t("span",{class:"location-icon"},"ðŸ“",-1)),se(" "+i(s.location),1)])):w("",!0)]),s.media_list&&s.media_list.length>0?(r(),c("div",At,[t("div",Lt,[(r(!0),c(S,null,I(s.media_list.slice(0,3),y=>(r(),c("div",{key:y.id,class:"media-item"},[y.media_type==="image"?(r(),c("img",{key:0,src:y.media_url,alt:s.event_type,onClick:M=>e(K)([],s.record_id),style:{cursor:"pointer"}},null,8,jt)):y.media_type==="video"?(r(),c("video",{key:1,src:y.media_url,onClick:M=>e(K)([],s.record_id),style:{cursor:"pointer"}},null,8,Bt)):w("",!0)]))),128)),s.media_list.length>3?(r(),c("div",{key:0,class:"media-count",onClick:y=>e(K)([],s.record_id),style:{cursor:"pointer"}}," +"+i(s.media_list.length-3),9,Nt)):w("",!0)])])):w("",!0),t("div",Rt,[t("div",zt,[t("span",Ot,i(e(U)(s.record_time)),1),t("span",Wt,i(e(o)("records.recordedAt"))+" "+i(e(U)(s.created_at)),1),s.updated_at&&s.updated_at!==s.created_at?(r(),c("span",qt,i(e(o)("records.updatedAt"))+" "+i(e(U)(s.updated_at)),1)):w("",!0)]),t("div",Ht,[t("button",{class:"action-btn edit-btn",onClick:y=>e(N)(s)},i(e(o)("records.edit")),9,Kt),t("button",{class:"action-btn delete-btn",onClick:y=>e(P)(s.record_id),disabled:!s.record_id},i(e(o)("records.delete")),9,Gt)])])],2))),128))])):e(n)==="list"?(r(),c("div",Jt,[t("div",Zt,[t("div",Qt,i(e(o)("records.pet")),1),t("div",Xt,i(e(o)("records.eventType")),1),t("div",Yt,i(e(o)("records.mood")),1),t("div",eo,i(e(o)("records.description")),1),t("div",to,i(e(o)("records.time")),1),t("div",oo,i(e(o)("records.actions")),1)]),(r(!0),c(S,null,I(e(Z),s=>(r(),c("div",{key:s.record_id,class:V(["list-item",s.mood?e(H)(s.mood):{}])},[t("div",so,[t("div",io,[t("h4",null,i(e(W)(s.pid,s.pet_name)),1)])]),t("div",ao,[t("span",lo,i(s.event_type),1)]),t("div",no,[s.mood?(r(),c("span",ro,[t("span",co,i(e(q)(s.mood)),1),se(" "+i(s.mood),1)])):w("",!0)]),t("div",uo,[t("p",po,i(s.description),1),s.location?(r(),c("div",mo," ðŸ“ "+i(s.location),1)):w("",!0)]),t("div",_o,[t("span",vo,i(e(U)(s.record_time)),1)]),t("div",ho,[t("button",{class:"action-btn edit-btn",onClick:y=>e(N)(s)},i(e(o)("records.edit")),9,go),t("button",{class:"action-btn delete-btn",onClick:y=>e(P)(s.record_id),disabled:!s.record_id},i(e(o)("records.delete")),9,fo)])],2))),128))])):(r(),c("div",yo,[t("div",bo,[(r(!0),c(S,null,I(e(le),(s,y)=>(r(),c("div",{key:y,class:"timeline-group"},[t("div",ko,i(e(U)(y)),1),t("div",Mo,[(r(!0),c(S,null,I(s,M=>(r(),c("div",{key:M.record_id,class:V(["timeline-item",M.mood?e(H)(M.mood):{}])},[a[34]||(a[34]=t("div",{class:"timeline-marker"},null,-1)),t("div",wo,[t("div",Eo,[t("h4",null,i(e(W)(M.pid,M.pet_name)),1),t("span",Fo,i(M.event_type),1),M.mood?(r(),c("span",Co,[t("span",$o,i(e(q)(M.mood)),1),se(" "+i(M.mood),1)])):w("",!0)]),t("p",To,i(M.description),1),M.location?(r(),c("div",Do," ðŸ“ "+i(M.location),1)):w("",!0),t("div",Uo,[t("span",xo,i(e(U)(M.record_time)),1),t("div",Po,[t("button",{class:"action-btn edit-btn",onClick:x=>e(N)(M)},i(e(o)("records.edit")),9,So),t("button",{class:"action-btn delete-btn",onClick:x=>e(P)(M.record_id),disabled:!M.record_id},i(e(o)("records.delete")),9,Io)])])])],2))),128))])]))),128))])]))]),e(h)||e(g)?(r(),c("div",{key:0,class:"modal-overlay",onClick:a[20]||(a[20]=(...s)=>e(T)&&e(T)(...s))},[t("div",{class:"modal-content",onClick:a[19]||(a[19]=G(()=>{},["stop"]))},[t("div",Vo,[t("h3",null,i(e(g)?e(o)("records.editEvent"):e(o)("records.addEvent")),1),t("button",{class:"close-btn",onClick:a[9]||(a[9]=(...s)=>e(T)&&e(T)(...s))},"Ã—")]),t("form",Ao,[t("div",Lo,[t("label",null,i(e(o)("records.pet")),1),D(t("select",{"onUpdate:modelValue":a[10]||(a[10]=s=>e(b).pid=s),required:"",class:"form-select"},[t("option",jo,i(e(o)("records.selectPet")),1),(r(!0),c(S,null,I(e(d),s=>(r(),c("option",{key:s.pid,value:s.pid},i(s.name),9,Bo))),128))],512),[[A,e(b).pid]])]),t("div",No,[t("label",null,i(e(o)("records.eventType")),1),D(t("select",{"onUpdate:modelValue":a[11]||(a[11]=s=>e(b).event_type=s),required:"",class:"form-select"},[t("option",Ro,i(e(o)("records.selectType")),1),t("option",zo,i(e(o)("records.feeding")),1),t("option",Oo,i(e(o)("records.bathing")),1),t("option",Wo,i(e(o)("records.walking")),1),t("option",qo,i(e(o)("records.veterinary")),1),t("option",Ho,i(e(o)("records.playing")),1),t("option",Ko,i(e(o)("records.vaccination")),1)],512),[[A,e(b).event_type]])]),t("div",Go,[t("label",null,i(e(o)("records.mood")),1),D(t("select",{"onUpdate:modelValue":a[12]||(a[12]=s=>e(b).mood=s),class:"form-select"},[t("option",Jo,i(e(o)("records.selectMood")),1),t("option",Zo,i(e(o)("records.happy")),1),t("option",Qo,i(e(o)("records.angry")),1),t("option",Xo,i(e(o)("records.tired")),1),t("option",Yo,i(e(o)("records.active")),1)],512),[[A,e(b).mood]])]),t("div",es,[t("label",null,i(e(o)("records.eventTime")),1),D(t("input",{type:"datetime-local","onUpdate:modelValue":a[13]||(a[13]=s=>e(b).record_time=s),required:"",class:"form-input"},null,512),[[oe,e(b).record_time]])]),t("div",ts,[t("label",null,i(e(o)("records.location")),1),D(t("input",{type:"text","onUpdate:modelValue":a[14]||(a[14]=s=>e(b).location=s),placeholder:e(o)("records.locationOptional"),class:"form-input"},null,8,os),[[oe,e(b).location]])]),t("div",ss,[t("label",null,i(e(o)("records.detailedDescription")),1),D(t("textarea",{"onUpdate:modelValue":a[15]||(a[15]=s=>e(b).description=s),rows:"4",placeholder:e(o)("records.pleaseEnterDescription"),required:"",class:"form-textarea"},null,8,is),[[oe,e(b).description]])]),t("div",as,[t("label",null,i(e(o)("records.mediaFiles")),1),t("div",ls,[t("div",ds,[t("input",{type:"file",multiple:"",accept:"image/*,video/*",onChange:a[16]||(a[16]=(...s)=>e(Q)&&e(Q)(...s)),class:"file-input",id:"media-file-input"},null,32),t("label",ns,[a[35]||(a[35]=t("div",{class:"upload-icon"},"ðŸ“",-1)),t("div",rs,i(e(o)("records.clickToSelectOrDrag")),1),t("div",cs,i(e(o)("records.supportedFormats")),1)])])]),e(C).length>0?(r(),c("div",us,[t("div",ps,i(e(o)("records.uploadedFiles"))+" ("+i(e(C).length)+"/5)",1),t("div",ms,[(r(!0),c(S,null,I(e(C),(s,y)=>(r(),c("div",{key:y,class:"file-preview-item"},[t("div",_s,[s.mediaType==="image"?(r(),c("img",{key:0,src:s.thumbnailUrl,alt:s.file.name,class:"preview-image"},null,8,vs)):(r(),c("div",hs,[...a[36]||(a[36]=[t("span",{class:"video-icon"},"ðŸŽ¬",-1)])]))]),t("div",gs,[t("div",fs,[t("span",ys,i(e(re)(s.mediaType)),1),t("span",{class:"file-name",title:s.file.name},i(s.file.name),9,bs)]),t("div",ks,[t("span",Ms,i(e(Y)(s.file.size)),1),t("span",ws,i(s.mediaType==="image"?"(å›¾ç‰‡)":"(è§†é¢‘)"),1)])]),t("button",{type:"button",onClick:M=>e(X)(y),class:"remove-file-btn",title:e(o)("records.deleteFile")}," Ã— ",8,Es)]))),128))]),t("div",Fs,i(e(C).length>=5?"å·²åˆ°è¾¾æœ€å¤§æ–‡ä»¶æ•°é™åˆ¶":`è¿˜å¯ä¸Šä¼  ${5-e(C).length} ä¸ªæ–‡ä»¶`),1)])):w("",!0)]),t("div",Cs,[t("button",{type:"button",class:"cancel-btn",onClick:a[17]||(a[17]=(...s)=>e(T)&&e(T)(...s)),disabled:e(v)},i(e(o)("records.cancel")),9,$s),t("button",{type:"button",class:"save-btn",onClick:a[18]||(a[18]=(...s)=>e(ee)&&e(ee)(...s)),disabled:e(v)},i(e(v)?e(g)?e(o)("records.updating"):e(o)("records.saving"):e(g)?e(o)("records.update"):e(o)("records.save")),9,Ts)])])])])):w("",!0),(r(),Fe($e,{to:"body"},[he(fe,{name:"media-viewer"},{default:ge(()=>[e(f)?(r(),c("div",{key:0,class:"media-viewer-overlay",onClick:a[25]||(a[25]=(...s)=>e(E)&&e(E)(...s)),onKeydown:[a[26]||(a[26]=me((...s)=>e(E)&&e(E)(...s),["esc"])),a[27]||(a[27]=me((...s)=>e(B)&&e(B)(...s),["left"])),a[28]||(a[28]=me((...s)=>e(j)&&e(j)(...s),["right"]))],tabindex:"-1"},[t("div",{class:"media-viewer-content",onClick:a[24]||(a[24]=G(()=>{},["stop"]))},[t("button",{class:"media-viewer-close",onClick:a[21]||(a[21]=(...s)=>e(E)&&e(E)(...s))},"Ã—"),e(k).length>0?(r(),c("div",Ds,[e(k).length>1?(r(),c("button",{key:0,class:"media-nav-btn media-nav-prev",onClick:a[22]||(a[22]=G((...s)=>e(B)&&e(B)(...s),["stop"])),"aria-label":e(o)("records.previousMedia")}," â€¹ ",8,Us)):w("",!0),t("div",xs,[he(fe,{name:"media-fade",mode:"out-in"},{default:ge(()=>[e(k)[e(_)]?.media_type==="image"?(r(),c("img",{key:`img-${e(_)}`,src:e(k)[e(_)].media_url,alt:e(k)[e(_)].media_name||`åª’ä½“æ–‡ä»¶ ${e(_)+1}`,class:"media-image"},null,8,Ps)):e(k)[e(_)]?.media_type==="video"?(r(),c("video",{key:`video-${e(_)}`,src:e(k)[e(_)].media_url,controls:"",class:"media-video",autoplay:!0},null,8,Ss)):w("",!0)]),_:1})]),e(k).length>1?(r(),c("button",{key:1,class:"media-nav-btn media-nav-next",onClick:a[23]||(a[23]=G((...s)=>e(j)&&e(j)(...s),["stop"])),"aria-label":e(o)("records.nextMedia")}," â€º ",8,Is)):w("",!0)])):w("",!0),e(k).length>0?(r(),c("div",Vs,[t("div",As,[t("h4",null,i(e(k)[e(_)]?.media_name||`åª’ä½“æ–‡ä»¶ ${e(_)+1}`),1),e(k)[e(_)]?.created_at?(r(),c("p",Ls,i(e(o)("records.createdAt"))+": "+i(e(U)(e(k)[e(_)].created_at||"")),1)):w("",!0),e(k)[e(_)]?.updated_at&&e(k)[e(_)].updated_at!==(e(k)[e(_)].created_at||"")?(r(),c("p",js,i(e(o)("records.updatedAt"))+": "+i(e(U)(e(k)[e(_)].updated_at||"")),1)):w("",!0),t("p",null,i(e(o)("records.mediaIndex",{current:e(_)+1,total:e(k).length})),1)]),e(k).length>1?(r(),c("div",Bs,[(r(!0),c(S,null,I(e(k),(s,y)=>(r(),c("div",{key:y,class:V(["thumbnail-item",{active:y===e(_)}]),onClick:G(M=>e(ce)(y),["stop"]),"aria-label":`${e(o)("records.media")} ${y+1}`},[s.media_type==="image"?(r(),c("img",{key:0,src:s.media_url,alt:s.media_name||`åª’ä½“æ–‡ä»¶ ${y+1}`},null,8,Rs)):(r(),c("div",zs,[...a[37]||(a[37]=[t("span",{class:"video-icon"},"ðŸŽ¬",-1)])]))],10,Ns))),128))])):w("",!0)])):(r(),c("div",Os,[t("p",null,i(e(o)("records.noMediaFiles")),1)]))])],32)):w("",!0)]),_:1})]))],2))}}),Gs=Te(Ws,[["__scopeId","data-v-0fc9f9e6"]]);export{Gs as default};
