import{I,u as z,h as v,J as N,E as S,d as M,v as V,c as f,o as h,a as s,t as o,l as e,O as R,z as $,e as F,w as D,r as C,F as j,f as L,n as O,C as U,g as k}from"./index-DfLUD8D4.js";import{s as x}from"./request-G9cUwcFm.js";import{useThemeStore as G}from"./theme-DRVhYUr3.js";import{d as H}from"./dog-DzFJ_7DI.js";import{u as J,g as W}from"./index-DtYlnh7W.js";import{P as Y}from"./Pagination-G4ErK3Up.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./genderConverter-BYQQyR-S.js";const A=()=>{const{t:u}=z();return{deleteFoster:async(i,c,r,m,p)=>{try{const d=Number(i);if(await N.confirm(u("user.confirmDeleteFoster"),u("user.confirmDeleteFosterTitle"),{confirmButtonText:u("common.confirm"),cancelButtonText:u("common.cancel"),type:"warning"}),(await x.delete(`/fosters/delete/${d}`)).code===200){const l=c.value.findIndex(g=>g.id===d);l!==-1&&(c.value.splice(l,1),r.value=Math.max(0,r.value-1)),S.success(u("user.fosterDeleted")),c.value.length===0&&m.value>1&&m.value--,setTimeout(()=>p(),500)}}catch(d){console.error("删除寄养记录失败:",d)}}}},K=()=>{const{t:u}=z(),t=v([]),i=v(1),c=v(10),r=v(0),m=v(!1),p=async()=>{try{const g=(await x.get("/user/fosters",{params:{current_page:i.value,per_page:c.value}})).data;g.records&&g.total!==void 0?(r.value=g.total,t.value=g.records.map(n=>({id:n.fid||n.id,pet:{pid:n.pet?.pid||0,name:n.pet?.name||"",breed:n.pet?.breed||"",age:n.pet?.age||0,gender:n.pet?.gender||"",image:n.pet?.image?n.pet.image.startsWith("http")?n.pet.image:`/api/images/${n.pet.image}`:H},shelter:{sid:n.shelter?.sid||0,name:n.shelter?.name||"",location:n.shelter?.location||""},startDate:n.startDate||"",endDate:n.endDate||null,status:n.endDate?"ended":"ongoing"}))):t.value=[]}catch{t.value=[],r.value=0,S.error(u("user.loadFosterFailed"))}finally{m.value=!1}};return{fosters:t,loadFosters:p,currentPage:i,pageSize:c,total:r,loading:m,handlePageChange:l=>{i.value=l,p()},handleSizeChange:l=>{c.value=l,i.value=1,p()}}},Q=()=>{const{deleteFoster:u}=A(),{fosters:t,loadFosters:i,currentPage:c,pageSize:r,total:m,loading:p,handlePageChange:d,handleSizeChange:_}=K(),l=G(),g=I(()=>l.preferences.theme==="dark");return{fosters:t,isDark:g,currentPage:c,pageSize:r,total:m,loading:p,deleteFoster:u,loadFosters:i,handlePageChange:d,handleSizeChange:_,applyTheme:()=>{l.applyTheme()}}},X={class:"page-header"},Z={class:"fosters-content"},ee={key:0,class:"empty-state"},se={key:1,class:"fosters-list"},te={class:"pet-image"},ae=["src","alt"],ne={class:"foster-details"},oe={class:"pet-info"},le={class:"pet-breed"},re={class:"pet-age"},ie={class:"foster-info"},ce={class:"info-item"},de={class:"label"},ue={class:"value"},pe={class:"info-item"},ge={class:"label"},me={class:"value"},_e={class:"info-item"},he={class:"label"},ve={class:"value"},fe={class:"info-item"},ye={class:"label"},Fe={class:"foster-actions"},De=M({__name:"Fosters",setup(u){const{t}=z(),i=J().formatDate,{deleteFoster:c,fosters:r,isDark:m,loadFosters:p,currentPage:d,pageSize:_,total:l,handlePageChange:g,handleSizeChange:n,applyTheme:P}=Q(),w=async b=>{await c(b,r,l,d,p)};return V(()=>{p(),P()}),(b,y)=>{const T=C("el-icon"),B=C("el-tag"),E=C("el-button");return h(),f("div",{class:O(["fosters-container",{dark:e(m)}])},[s("div",X,[s("h1",null,o(e(t)("user.fosterRecords")),1),s("p",null,o(e(t)("user.viewFosterHistory")),1)]),s("div",Z,[e(r).length===0?(h(),f("div",ee,[F(T,null,{default:D(()=>[F(e(U))]),_:1}),s("h3",null,o(e(t)("user.noFosterRecords")),1),s("p",null,o(e(t)("user.noFosterYet")),1)])):(h(),f("div",se,[(h(!0),f(j,null,L(e(r),a=>(h(),f("div",{key:a.id,class:"foster-card"},[s("div",te,[s("img",{src:a.pet.image||"/src/assets/img/dog.jpg",alt:a.pet.name},null,8,ae)]),s("div",ne,[s("div",oe,[s("h3",null,o(a.pet.name),1),s("p",le,o(a.pet.breed),1),s("p",re,o(a.pet.age)+o(e(t)("user.yearsOld"))+" · "+o(e(W)(a.pet.gender)),1)]),s("div",ie,[s("div",ce,[s("span",de,o(e(t)("user.fosterStart"))+"：",1),s("span",ue,o(e(i)(a.startDate)),1)]),s("div",pe,[s("span",ge,o(e(t)("user.fosterEnd"))+"：",1),s("span",me,o(a.endDate?e(i)(a.endDate):e(t)("user.ongoing")),1)]),s("div",_e,[s("span",he,o(e(t)("user.shelter"))+"：",1),s("span",ve,o(a.shelter?.name||e(t)("user.unknown")),1)]),s("div",fe,[s("span",ye,o(e(t)("user.status"))+"：",1),F(B,{type:a.status==="ongoing"?"warning":"success"},{default:D(()=>[k(o(a.status==="ongoing"?e(t)("user.ongoing"):e(t)("user.fosterEnded")),1)]),_:2},1032,["type"])])]),s("div",Fe,[F(E,{type:"danger",size:"small",onClick:Ce=>w(a.id),disabled:!a.id||a.id===void 0||a.id===null},{default:D(()=>[k(o(e(t)("user.deleteRecord")),1)]),_:1},8,["onClick","disabled"])])])]))),128))])),e(l)>0?(h(),R(Y,{key:2,"current-page":e(d),"page-size":e(_),total:e(l),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper","onUpdate:currentPage":y[0]||(y[0]=a=>d.value=a),"onUpdate:pageSize":y[1]||(y[1]=a=>_.value=a),onPageChange:e(g),onSizeChange:e(n)},null,8,["current-page","page-size","total","onPageChange","onSizeChange"])):$("",!0)])],2)}}}),Be=q(De,[["__scopeId","data-v-06f1618c"]]);export{Be as default};
