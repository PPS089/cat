import{u as $,h as T,E as F,k as W,d as E,V as H,x as Y,O as M,o as _,w as f,l as e,U as q,r as y,N as J,P as K,c as C,e as g,F as R,f as I,a as t,z as j,t as s,g as w,C as Q,_ as U,v as X,n as Z,B as ee,W as te}from"./index-BrRsyrLM.js";import{s as L}from"./request-DVyWtN3q.js";import{useThemeStore as oe}from"./theme-nJHyLohD.js";import{u as O,g as se}from"./genderDisplay-DkcuqKsU.js";import{P as ne}from"./Pagination-0xkjxAsg.js";import"./genderConverter-CAxqKJGy.js";const G=()=>{const{t:l}=$(),o=T([]),r=T(!1),c=T(!1),m=T(null),h=T("");return{timeline:o,loading:r,dialogVisible:c,selectedPetId:m,selectedPetName:h,loadAdoptionTimeline:async(i,b)=>{try{r.value=!0,m.value=i,h.value=b;const p=await L.get(`/pets/${i}/adoption-timeline`);if(p.code===200&&p.data.timeline!==void 0){const u=p.data;o.value=u.timeline,c.value=!0}else F.error(p.message||l("user.loadTimelineFailed"))}catch{F.error(l("user.loadTimelineFailed"))}finally{r.value=!1}},closeDialog:()=>{c.value=!1,o.value=[],m.value=null,h.value=""},getActionTypeText:i=>({adopted:l("user.adopted"),fostered:l("user.fostered"),foster_ended:l("user.fosterEnded"),returned:l("user.returned")})[i]||i}},ae=()=>{const l=W();return{browsePets:()=>{l.push("/user/adoption-pets")}}},ie=()=>{const l=T([]),o=T(1),r=T(10),c=T(0),m=T(!1),{t:h}=$(),d=async(i=1,b=10)=>{try{o.value=i,r.value=b;const p=await L.get("/user/adoptions",{params:{current_page:i,per_page:b}});if(p.code==200){const u=p.data;c.value=u.total;const P=u.records.map(n=>({id:n.aid,adoptDate:n.adoptionDate,foster_status:"available",pet:{id:n.pid,name:n.name,breed:n.breed,age:n.age,gender:n.gender,image:n.image?n.image.startsWith("http")?n.image:`/api/images/${n.image}`:"/src/assets/img/dog.jpg",status:n.petStatus},shelter:{id:n.sid,name:n.sname,location:n.location}}));l.value=P}}catch{F.error(h("user.loadAdoptionsFailed"))}};return{adoptions:l,currentPage:o,pageSize:r,total:c,loading:m,loadAdoptions:d,handlePageChange:i=>{d(i,r.value)},handleSizeChange:i=>{d(1,i)}}},le=()=>{const{browsePets:l}=ae(),{adoptions:o,loadAdoptions:r,currentPage:c,pageSize:m,total:h,handlePageChange:d,handleSizeChange:k}=ie(),A=oe();return{adoptions:o,themeStore:A,currentPage:c,pageSize:m,total:h,browsePets:l,loadAdoptions:r,handlePageChange:d,handleSizeChange:k}},re={class:"timeline-container"},ce={key:0,class:"empty-state"},de={key:1,class:"timeline"},pe={class:"timeline-item-content"},ue={class:"item-header"},_e={class:"item-description"},ge={key:0,class:"item-shelter"},me={class:"dialog-footer"},he=E({__name:"Dialog",setup(l){const{t:o}=$(),r=O().formatDate,c=H("adoptionTimeline")||G(),{timeline:m,loading:h,dialogVisible:d,selectedPetName:k,closeDialog:A,getActionTypeText:i}=c;Y(d,u=>{console.log("弹窗状态变化:",u)});const b=u=>({adopted:"primary",fostered:"warning",foster_ended:"info",returned:"danger"})[u]||"info",p=u=>({adopted:"success",fostered:"warning",foster_ended:"info",returned:"danger"})[u]||"info";return(u,P)=>{const n=y("el-empty"),x=y("el-tag"),S=y("el-icon"),D=y("el-card"),N=y("el-timeline-item"),z=y("el-timeline"),V=y("el-button"),a=y("el-dialog"),B=K("loading");return _(),M(a,{modelValue:e(d),"onUpdate:modelValue":P[0]||(P[0]=v=>q(d)?d.value=v:null),title:`${e(o)("user.adoptionTimeline")} - ${e(k)}`,width:"60%","close-on-click-modal":!1,onClose:e(A)},{footer:f(()=>[t("span",me,[g(V,{onClick:e(A)},{default:f(()=>[w(s(e(o)("common.close")),1)]),_:1},8,["onClick"])])]),default:f(()=>[J((_(),C("div",re,[e(m).length===0?(_(),C("div",ce,[g(n,{description:e(o)("user.noTimelineRecords")},null,8,["description"])])):(_(),C("div",de,[g(z,null,{default:f(()=>[(_(!0),C(R,null,I(e(m),v=>(_(),M(N,{key:v.id,timestamp:e(r)(v.actionDate),type:b(v.action),placement:"top"},{default:f(()=>[g(D,null,{default:f(()=>[t("div",pe,[t("div",ue,[t("h4",null,s(e(i)(v.action)),1),g(x,{type:p(v.action),size:"small"},{default:f(()=>[w(s(v.status),1)]),_:2},1032,["type"])]),t("p",_e,s(v.description),1),v.shelterName?(_(),C("div",ge,[g(S,null,{default:f(()=>[g(e(Q))]),_:1}),t("span",null,s(v.shelterName),1)])):j("",!0)])]),_:2},1024)]),_:2},1032,["timestamp","type"]))),128))]),_:1})]))])),[[B,e(h)]])]),_:1},8,["modelValue","title","onClose"])}}}),fe=U(he,[["__scopeId","data-v-93afa61f"]]),ve={class:"page-header"},ye={class:"adoptions-content"},Te={key:0,class:"empty-state"},Ce={key:1,class:"adoptions-list"},Ae={class:"pet-image"},be=["src","alt"],De={class:"adoption-details"},ke={class:"pet-info"},Pe={class:"pet-breed"},Se={class:"pet-age"},we={class:"adoption-info"},ze={class:"info-item"},$e={class:"label"},xe={class:"value"},Ne={class:"info-item"},Ve={class:"label"},Fe={class:"value"},Me={class:"info-item"},Re={class:"label"},Be={class:"adoption-actions"},Ee=E({__name:"Adoptions",setup(l){const{t:o}=$(),r=O().formatDate,c=G(),{loadAdoptionTimeline:m}=c;te("adoptionTimeline",c);const{adoptions:h,themeStore:d,currentPage:k,pageSize:A,total:i,browsePets:b,loadAdoptions:p,handlePageChange:u,handleSizeChange:P}=le(),n=(S,D)=>{console.log(`点击查看领养时间线 - 宠物ID: ${S}, 名称: ${D}`),m(S,D)},x=S=>o(S==="FOSTERING"?"user.adoptionStatusFostering":"user.adoptionStatusNormal");return X(()=>{p()}),(S,D)=>{const N=y("el-icon"),z=y("el-button"),V=y("el-tag");return _(),C(R,null,[t("div",{class:Z(["adoptions-container",{dark:e(d).preferences.theme==="dark"}])},[t("div",ve,[t("h1",null,s(e(o)("user.adoptionRecords")),1),t("p",null,s(e(o)("user.viewAdoptionHistory")),1)]),t("div",ye,[e(h).length===0?(_(),C("div",Te,[g(N,null,{default:f(()=>[g(e(ee))]),_:1}),t("h3",null,s(e(o)("user.noAdoptionRecords")),1),t("p",null,s(e(o)("user.noAdoptionYet")),1),g(z,{type:"primary",onClick:e(b)},{default:f(()=>[w(s(e(o)("user.browseAdoptablePets")),1)]),_:1},8,["onClick"])])):(_(),C("div",Ce,[(_(!0),C(R,null,I(e(h),a=>(_(),C("div",{key:a.id,class:"adoption-card"},[t("div",Ae,[t("img",{src:a.pet.image||"/src/assets/img/dog.jpg",alt:a.pet.name},null,8,be)]),t("div",De,[t("div",ke,[t("h3",null,s(a.pet.name),1),t("p",Pe,s(a.pet.breed),1),t("p",Se,s(a.pet.age)+s(e(o)("user.yearsOld"))+" · "+s(e(se)(a.pet.gender)),1)]),t("div",we,[t("div",ze,[t("span",$e,s(e(o)("user.adoptionDate"))+"：",1),t("span",xe,s(e(r)(a.adoptDate)),1)]),t("div",Ne,[t("span",Ve,s(e(o)("user.shelter"))+"：",1),t("span",Fe,s(a.shelter.name),1)]),t("div",Me,[t("span",Re,s(e(o)("user.status"))+"：",1),g(V,{type:"warning"},{default:f(()=>[w(s(x(a.pet.status)),1)]),_:2},1024)])]),t("div",Be,[g(z,{type:"primary",size:"small",onClick:B=>n(a.pet.id,a.pet.name)},{default:f(()=>[w(s(e(o)("user.viewAdoptionTimeline")),1)]),_:1},8,["onClick"])])])]))),128)),e(i)>0?(_(),M(ne,{key:0,"current-page":e(k),"page-size":e(A),total:e(i),"page-sizes":[5,10,20,50],layout:"total, sizes, prev, pager, next, jumper","onUpdate:currentPage":D[0]||(D[0]=a=>k.value=a),"onUpdate:pageSize":D[1]||(D[1]=a=>A.value=a),onPageChange:e(u),onSizeChange:e(P)},null,8,["current-page","page-size","total","onPageChange","onSizeChange"])):j("",!0)]))])],2),g(fe)],64)}}}),We=U(Ee,[["__scopeId","data-v-48750fc3"]]);export{We as default};
