import{h as F,I as G,u as N,j as ce,E as M,J as pe,d as _e,k as me,a1 as ve,c,o as u,a as e,z as b,t as i,m as t,N as C,Z as S,F as U,f as $,a0 as Q,g as X,n as V,U as he,$ as de,_ as fe}from"./index-BSW2uGQz.js";import{s as I}from"./request-qgYNvrL7.js";import{useThemeStore as ge}from"./theme-B7pFg6HI.js";const ye=async(l,o)=>{const r=new FormData;return l.forEach(p=>{r.append("files",p)}),r.append("recordId",String(o)),I.post("/media/upload",r)},ke=()=>{const{t:l}=N();return{getMoodEmoji:r=>{const p={[l("happy")]:"ðŸ˜Š",[l("angry")]:"ðŸ˜ ",[l("tired")]:"ðŸ˜´",[l("active")]:"ðŸ•"};return r&&p[r]||"ðŸ˜"}}},be=()=>{const{t:l}=N();return{getMoodClass:r=>({happy:r===l("happy"),angry:r===l("angry"),tired:r===l("tired"),active:r===l("active")})}},Me=()=>({formatDate:o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}),B={maxFileSize:52428800,supportedImageFormats:["image/jpeg","image/png","image/gif","image/webp","image/jpg"],supportedVideoFormats:["video/mp4","video/mpeg","video/quicktime","video/x-msvideo","video/webm"],thumbnailMaxWidth:200,thumbnailMaxHeight:200},we=l=>new Promise((o,r)=>{const p=new FileReader;p.onload=n=>{const d=new Image;d.onload=()=>{const m=document.createElement("canvas"),_=m.getContext("2d");if(!_){o(n.target?.result);return}let v=d.width,f=d.height;const k=B.thumbnailMaxWidth,g=B.thumbnailMaxHeight;v>f?v>k&&(f=f*k/v,v=k):f>g&&(v=v*g/f,f=g),m.width=v,m.height=f,_.drawImage(d,0,0,v,f),o(m.toDataURL("image/jpeg",.7))},d.onerror=()=>{o(n.target?.result)},d.src=n.target?.result},p.onerror=()=>r(new Error("æ— æ³•è¯»å–æ–‡ä»¶")),p.readAsDataURL(l)}),Ee=l=>{if(l.size>B.maxFileSize)return{valid:!1,error:`æ–‡ä»¶è¿‡å¤§ï¼Œæœ€å¤§æ”¯æŒ${B.maxFileSize/1024/1024}MB`};const o=B.supportedImageFormats.includes(l.type),r=B.supportedVideoFormats.includes(l.type);return!o&&!r?{valid:!1,error:"ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œä»…æ”¯æŒå¸¸è§çš„å›¾ç‰‡å’Œè§†é¢‘æ ¼å¼"}:{valid:!0}},Fe=()=>{const l=F([]);return{filePreviews:l,handleFileUpload:async _=>{const v=_.target,f=Array.from(v.files||[]);if(l.value.length+f.length>5){M.error("æœ€å¤šåªèƒ½ä¸Šä¼ 5ä¸ªæ–‡ä»¶");return}for(const k of f){const g=Ee(k);if(!g.valid){M.error(`æ–‡ä»¶ "${k.name}" éªŒè¯å¤±è´¥ï¼š${g.error}`);continue}try{const w=k.type.startsWith("image/")?"image":"video";let P=URL.createObjectURL(k),R=w==="image"?await we(k):P;l.value.push({file:k,previewUrl:P,thumbnailUrl:R,mediaType:w,isValid:!0}),M.success(`æ–‡ä»¶ "${k.name}" æ·»åŠ æˆåŠŸ`)}catch(w){M.error(`æ–‡ä»¶ "${k.name}" å¤„ç†å¤±è´¥ï¼š${w instanceof Error?w.message:"æœªçŸ¥é”™è¯¯"}`)}}v.value=""},removeFile:_=>{const v=l.value[_];v&&v.previewUrl.startsWith("blob:")&&URL.revokeObjectURL(v.previewUrl),l.value.splice(_,1),M.success("æ–‡ä»¶å·²åˆ é™¤")},clearAllFiles:()=>{l.value.forEach(_=>{_.previewUrl.startsWith("blob:")&&URL.revokeObjectURL(_.previewUrl)}),l.value=[]},getUploadFiles:()=>l.value.map(_=>_.file),getFileIcon:_=>_==="image"?"ðŸ–¼ï¸":_==="video"?"ðŸŽ¬":"ðŸ“„",formatFileSize:_=>{if(_===0)return"0 Bytes";const v=1024,f=["Bytes","KB","MB"],k=Math.floor(Math.log(_)/Math.log(v));return Math.round(_/Math.pow(v,k)*100)/100+" "+f[k]}}},Ce=()=>{const l=F(!1),o=F([]),r=F(!1);return{showMediaModal:l,currentMediaList:o,mediaLoading:r,openMediaModal:async(d,m)=>{if(m){r.value=!0;try{const _=await I.get(`/media/record/${m}`);if(_.code===200&&_.data){const v=Array.isArray(_.data)?_.data:[_.data];o.value=v.map(f=>({id:f.mid,media_url:`/api${f.filePath}`,media_type:f.mediaType,media_name:f.fileName,updated_at:f.updatedAt}))}else o.value=[]}catch(_){console.error("åŠ è½½åª’ä½“æ–‡ä»¶å¤±è´¥:",_),M.error("åŠ è½½åª’ä½“æ–‡ä»¶å¤±è´¥"),o.value=[]}finally{r.value=!1}}else o.value=d||[];l.value=!0},closeMediaModal:()=>{l.value=!1,o.value=[]}}},ue=()=>{const{t:l}=N(),o=F([]),r=F(!1);return{events:o,loading:r,fetchEvents:async()=>{r.value=!0;try{const n=await I.get("/events");n.code===200&&n.data?o.value=n.data.map(d=>({record_id:d.eid,pid:d.pid,event_type:d.eventType,description:d.description,record_time:d.eventTime,mood:d.mood,location:d.location,pet_name:d.pet_name||"",created_at:d.createdAt||d.eventTime,updated_at:d.updatedAt||d.createdAt||d.eventTime,media_list:d.mediaList?d.mediaList.map(m=>({id:m.mid,media_url:`/api${m.filePath}`,media_type:m.mediaType,media_name:m.fileName,updated_at:m.updatedAt})):[]})):o.value=[]}catch(n){console.error("èŽ·å–äº‹ä»¶å¤±è´¥:",n),M.error(l("api.getEventsFailed")),o.value=[]}finally{r.value=!1}}}},Te=()=>{const{t:l}=N(),o=F([]),r=F(!1);return{pets:o,loading:r,fetchPets:async()=>{r.value=!0;try{const d=await I.get("/user/adoptions",{params:{current_page:1,per_page:100}});d.code===200&&d.data?.records?o.value=d.data.records.map(m=>({pid:m.pid||m.id,name:m.name||m.petName,species:m.breed||m.species||"æœªçŸ¥",breed:m.breed||m.species||"æœªçŸ¥",type:"adoption",date:m.adoptionDate||m.adoptDate||m.date})):o.value=[]}catch(d){M.error(l("api.getPetsFailed")),console.error("Error fetching pets:",d),o.value=[]}finally{r.value=!1}},getPetName:(d,m)=>{const _=o.value.find(v=>v.pid===d);return _?_.name:m||l("api.unknownPet")}}},De=l=>{const{t:o}=N(),{fetchEvents:r}=l||ue();return{deleteEvent:async n=>{try{if(!n||n<=0){console.error("Invalid recordId:",n),M.error("æ— æ•ˆçš„è®°å½•ID");return}await pe.confirm(o("common.confirmDeleteEvent"),o("common.deleteConfirmation"),{confirmButtonText:o("common.confirm"),cancelButtonText:o("common.cancel"),type:"warning"}),await I.delete(`/events/${n}`),M.success(o("api.deleteSuccess")),await r()}catch(d){d!=="cancel"&&(M.error(o("api.deleteFailed")),console.error("Error deleting event:",d))}}}},Ue=l=>{const o=ce({selectedPet:"",selectedEventType:"",selectedMood:"",selectedDate:""}),r=G(()=>{let p=[...l.value];return o.selectedPet&&(p=p.filter(n=>n.pid===Number(o.selectedPet))),o.selectedEventType&&(p=p.filter(n=>n.event_type===o.selectedEventType)),o.selectedMood&&(p=p.filter(n=>n.mood===o.selectedMood)),o.selectedDate&&(p=p.filter(n=>new Date(n.record_time).toDateString()===new Date(o.selectedDate).toDateString())),p});return{filters:o,filteredEvents:r}},$e=l=>{const o=F("record_time"),r=G(()=>{const p=[...l.value];return p.sort((n,d)=>{switch(o.value){case"event_type":return n.event_type.localeCompare(d.event_type);case"mood":return(n.mood||"").localeCompare(d.mood||"");case"record_time":default:return new Date(d.record_time).getTime()-new Date(n.record_time).getTime()}}),p});return{sortBy:o,sortedEvents:r}},xe=l=>({groupedEvents:G(()=>{const r={};return l.value.forEach(p=>{const n=new Date(p.record_time).toDateString();r[n]||(r[n]=[]),r[n].push(p)}),r})}),Pe=()=>{const l=ce({record_id:"",pid:"",event_type:"",mood:"",description:"",location:"",record_time:""});return{formData:l,resetForm:()=>{Object.assign(l,{record_id:"",pid:"",event_type:"",mood:"",description:"",location:"",record_time:""})},populateForm:p=>{let n="";try{if(p.record_time){const d=p.record_time.replace(" ","T"),m=new Date(d);if(!isNaN(m.getTime()))n=m.toISOString().slice(0,16);else{const _=p.record_time.split(" ");_.length===2&&(n=`${_[0]}T${_[1].slice(0,5)}`)}}}catch(d){console.error("Error parsing date:",d,p.record_time)}Object.assign(l,{...p,record_time:n})}}},Se=()=>{const{events:l,loading:o,fetchEvents:r}=ue(),{pets:p,fetchPets:n,getPetName:d}=Te(),{getMoodEmoji:m}=ke(),{getMoodClass:_}=be(),{formatDate:v}=Me(),{filePreviews:f,handleFileUpload:k,removeFile:g,clearAllFiles:w,getUploadFiles:P,getFileIcon:R,formatFileSize:Y}=Fe(),{showMediaModal:J,currentMediaList:ee,mediaLoading:te,openMediaModal:oe,closeMediaModal:z}=Ce(),{filters:O,filteredEvents:L}=Ue(l),{sortBy:T,sortedEvents:W}=$e(L),{groupedEvents:se}=xe(W),{formData:E,resetForm:ie,populateForm:q}=Pe(),{deleteEvent:j}=De({fetchEvents:r}),A=F(!1),D=F(!1),K=F("grid"),x=G(()=>l.value.length),le=G(()=>l.value.reduce((h,H)=>h+(H.media_list?.length||0),0)),a=h=>{q(h),D.value=!0},s=()=>{A.value=!1,D.value=!1,w(),ie()};return{events:l,pets:p,loading:o,filters:O,viewMode:K,sortBy:T,showAddModal:A,showEditModal:D,showMediaModal:J,mediaLoading:te,formData:E,filePreviews:f,currentMediaList:ee,totalEvents:x,totalMedia:le,filteredEvents:L,sortedEvents:W,groupedEvents:se,fetchEvents:r,fetchPets:n,getPetName:d,getMoodEmoji:m,getMoodClass:_,formatDate:v,handleFileUpload:k,removeFile:g,getFileIcon:R,formatFileSize:Y,openMediaModal:oe,closeMediaModal:z,editEvent:a,deleteEvent:j,saveEvent:async()=>{try{const h=E.record_time,H=h?h.replace("T"," ")+":00":"",ne={pid:E.pid,eventType:E.event_type,recordTime:H,description:E.description,mood:E.mood||"",location:E.location||""};let Z=null;D.value&&E.record_id?(await I.put(`/events/${E.record_id}`,ne),Z=Number(E.record_id),M.success("äº‹ä»¶æ›´æ–°æˆåŠŸ")):(Z=(await I.post("/events",ne)).data?.eid,M.success("äº‹ä»¶æ·»åŠ æˆåŠŸ"));const ae=P();if(ae&&ae.length>0&&Z)try{await ye(ae,Z),M.success("äº‹ä»¶ä¿å­˜æˆåŠŸï¼Œåª’ä½“æ–‡ä»¶ä¸Šä¼ å®Œæˆ")}catch(re){console.warn("æµç¨‹è­¦å‘Šï¼šäº‹ä»¶ä¿å­˜æˆåŠŸï¼Œä½†åª’ä½“æ–‡ä»¶ä¸Šä¼ å¤±è´¥",re),M.warning("äº‹ä»¶ä¿å­˜æˆåŠŸï¼Œä½†åª’ä½“æ–‡ä»¶ä¸Šä¼ å¤±è´¥")}setTimeout(async()=>{await r(),s()},500)}catch(h){M.error(D.value?"äº‹ä»¶æ›´æ–°å¤±è´¥":"äº‹ä»¶æ·»åŠ å¤±è´¥"),console.error("Error saving event:",h)}},closeModal:s}},Ve={class:"page-header"},Ie={class:"stats-grid"},Le={class:"stat-card"},je={class:"stat-content"},Ae={class:"stat-card"},Be={class:"stat-content"},Ne={class:"stat-card"},Re={class:"stat-content"},ze={class:"controls-section"},Oe={class:"filter-group"},We={style:{position:"relative"}},qe=["disabled"],He={value:""},Ge=["value"],Je={key:0,style:{position:"absolute",top:"-20px",left:"0",color:"#666"}},Ke={value:""},Ze={value:"å–‚é£Ÿ"},Qe={value:"æ´—æ¾¡"},Xe={value:"æ•£æ­¥"},Ye={value:"çœ‹å…½åŒ»"},et={value:"çŽ©è€"},tt={value:"æ‰“ç–«è‹—"},ot={value:""},st={value:"å¼€å¿ƒ"},it={value:"ç”Ÿæ°”"},at={value:"ç–²å€¦"},dt={value:"æ´»è·ƒ"},lt=["placeholder"],nt={class:"view-controls"},rt={class:"view-toggle"},ct={class:"sort-controls"},ut={value:"record_time"},pt={value:"event_type"},_t={value:"mood"},mt={class:"events-content"},vt={key:0,class:"events-grid"},ht={class:"event-header"},ft={class:"pet-info"},gt={class:"event-type"},yt={key:0,class:"event-mood"},kt={class:"mood-emoji"},bt={class:"mood-text"},Mt={class:"event-content"},wt={class:"description"},Et={key:0,class:"location"},Ft={key:0,class:"event-media"},Ct={class:"media-preview"},Tt=["src","alt","onClick"],Dt=["src","onClick"],Ut=["onClick"],$t={class:"event-footer"},xt={class:"event-time"},Pt={class:"record-time"},St={class:"created-time"},Vt={key:0,class:"updated-time"},It={class:"event-actions"},Lt=["onClick"],jt=["onClick","disabled"],At={key:1,class:"events-list"},Bt={class:"list-header"},Nt={class:"col-pet"},Rt={class:"col-type"},zt={class:"col-mood"},Ot={class:"col-description"},Wt={class:"col-time"},qt={class:"col-actions"},Ht={class:"col-pet"},Gt={class:"pet-info"},Jt={class:"col-type"},Kt={class:"event-type-badge"},Zt={class:"col-mood"},Qt={key:0,class:"mood-indicator"},Xt={class:"mood-emoji"},Yt={class:"col-description"},eo={class:"description-text"},to={key:0,class:"location-small"},oo={class:"col-time"},so={class:"time-text"},io={class:"col-actions"},ao=["onClick"],lo=["onClick","disabled"],no={key:2,class:"timeline-view"},ro={class:"timeline"},co={class:"timeline-date"},uo={class:"timeline-items"},po={class:"timeline-content"},_o={class:"timeline-header"},mo={class:"event-type-badge"},vo={key:0,class:"mood-indicator"},ho={class:"mood-emoji"},fo={class:"description"},go={key:0,class:"location"},yo={class:"timeline-footer"},ko={class:"time-text"},bo={class:"timeline-actions"},Mo=["onClick"],wo=["onClick","disabled"],Eo={class:"modal-header"},Fo={class:"form-group"},Co={value:""},To=["value"],Do={class:"form-group"},Uo={value:""},$o={value:"å–‚é£Ÿ"},xo={value:"æ´—æ¾¡"},Po={value:"æ•£æ­¥"},So={value:"çœ‹å…½åŒ»"},Vo={value:"çŽ©è€"},Io={value:"æ‰“ç–«è‹—"},Lo={class:"form-group"},jo={value:""},Ao={value:"å¼€å¿ƒ"},Bo={value:"ç”Ÿæ°”"},No={value:"ç–²å€¦"},Ro={value:"æ´»è·ƒ"},zo={class:"form-group"},Oo={class:"form-group"},Wo=["placeholder"],qo={class:"form-group"},Ho=["placeholder"],Go={class:"form-group"},Jo={class:"media-upload"},Ko={class:"upload-area"},Zo={for:"media-file-input",class:"upload-label"},Qo={class:"upload-text"},Xo={class:"upload-hint"},Yo={key:0,class:"uploaded-files"},es={class:"uploaded-files-title"},ts={class:"file-preview-grid"},os={class:"preview-thumbnail"},ss=["src","alt"],is={key:1,class:"preview-video-placeholder"},as={class:"file-info-full"},ds={class:"file-name-container"},ls={class:"file-icon"},ns=["title"],rs={class:"file-size-type"},cs={class:"file-size"},us={class:"file-type"},ps=["onClick","title"],_s={class:"upload-hint-text"},ms={class:"modal-actions"},vs={type:"submit",class:"save-btn"},hs={class:"media-modal-header"},fs={key:0,class:"media-loading"},gs={key:1,class:"media-empty"},ys={key:2,class:"media-carousel"},ks=["src","alt"],bs=["src"],Ms={class:"media-info"},ws={class:"media-name"},Es={class:"media-time"},Fs={key:0,class:"media-time"},Cs=_e({__name:"Records",setup(l){const{t:o}=N(),r=ge(),{pets:p,filters:n,viewMode:d,sortBy:m,showAddModal:_,showEditModal:v,showMediaModal:f,mediaLoading:k,formData:g,filePreviews:w,currentMediaList:P,totalEvents:R,totalMedia:Y,sortedEvents:J,groupedEvents:ee,fetchEvents:te,fetchPets:oe,getPetName:z,getMoodEmoji:O,getMoodClass:L,formatDate:T,handleFileUpload:W,removeFile:se,getFileIcon:E,formatFileSize:ie,openMediaModal:q,closeMediaModal:j,editEvent:A,deleteEvent:D,saveEvent:K,closeModal:x}=Se();return me(async()=>{await oe(),await ve(),await te()}),(le,a)=>(u(),c("div",{class:V(["events-container",{"dark-theme":t(r).preferences.theme==="dark"}])},[e("div",Ve,[e("h1",null,i(t(o)("records.pageTitle")),1),e("p",null,i(t(o)("records.pageSubtitle")),1)]),e("div",Ie,[e("div",Le,[a[24]||(a[24]=e("div",{class:"stat-icon"},"ðŸ“…",-1)),e("div",je,[e("h3",null,i(t(R)),1),e("p",null,i(t(o)("records.totalEvents")),1)])]),e("div",Ae,[a[25]||(a[25]=e("div",{class:"stat-icon"},"ðŸ•",-1)),e("div",Be,[e("h3",null,i(t(p).length),1),e("p",null,i(t(o)("records.totalPets")),1)])]),e("div",Ne,[a[26]||(a[26]=e("div",{class:"stat-icon"},"ðŸ“¸",-1)),e("div",Re,[e("h3",null,i(t(Y)),1),e("p",null,i(t(o)("records.totalMedia")),1)])])]),e("div",ze,[e("div",Oe,[e("div",We,[C(e("select",{"onUpdate:modelValue":a[0]||(a[0]=s=>t(n).selectedPet=s),class:"filter-select",disabled:t(p).length===0},[e("option",He,i(t(p).length===0?t(o)("records.loading"):t(o)("records.allPets")),1),(u(!0),c(U,null,$(t(p),s=>(u(),c("option",{key:s.pid,value:s.pid},i(s.name),9,Ge))),128))],8,qe),[[S,t(n).selectedPet]]),t(p).length>0?(u(),c("small",Je,i(t(o)("records.foundPets",{count:t(p).length})),1)):b("",!0)]),C(e("select",{"onUpdate:modelValue":a[1]||(a[1]=s=>t(n).selectedEventType=s),class:"filter-select"},[e("option",Ke,i(t(o)("records.allEvents")),1),e("option",Ze,i(t(o)("records.feeding")),1),e("option",Qe,i(t(o)("records.bathing")),1),e("option",Xe,i(t(o)("records.walking")),1),e("option",Ye,i(t(o)("records.veterinary")),1),e("option",et,i(t(o)("records.playing")),1),e("option",tt,i(t(o)("records.vaccination")),1)],512),[[S,t(n).selectedEventType]]),C(e("select",{"onUpdate:modelValue":a[2]||(a[2]=s=>t(n).selectedMood=s),class:"filter-select"},[e("option",ot,i(t(o)("records.allMood")),1),e("option",st,i(t(o)("records.happy")),1),e("option",it,i(t(o)("records.angry")),1),e("option",at,i(t(o)("records.tired")),1),e("option",dt,i(t(o)("records.active")),1)],512),[[S,t(n).selectedMood]]),C(e("input",{type:"date","onUpdate:modelValue":a[3]||(a[3]=s=>t(n).selectedDate=s),class:"filter-input",placeholder:t(o)("records.selectDate")},null,8,lt),[[Q,t(n).selectedDate]])]),e("button",{class:"add-button",onClick:a[4]||(a[4]=s=>_.value=!0)},[a[27]||(a[27]=e("span",null,"+",-1)),X(" "+i(t(o)("records.addEvent")),1)])]),e("div",nt,[e("div",rt,[e("button",{class:V({active:t(d)==="grid"}),onClick:a[5]||(a[5]=s=>d.value="grid")},i(t(o)("records.gridView")),3),e("button",{class:V({active:t(d)==="list"}),onClick:a[6]||(a[6]=s=>d.value="list")},i(t(o)("records.listView")),3),e("button",{class:V({active:t(d)==="timeline"}),onClick:a[7]||(a[7]=s=>d.value="timeline")},i(t(o)("records.timeline")),3)]),e("div",ct,[C(e("select",{"onUpdate:modelValue":a[8]||(a[8]=s=>he(m)?m.value=s:null),class:"sort-select"},[e("option",ut,i(t(o)("records.sortByTime")),1),e("option",pt,i(t(o)("records.sortByType")),1),e("option",_t,i(t(o)("records.sortByMood")),1)],512),[[S,t(m)]])])]),e("div",mt,[t(d)==="grid"?(u(),c("div",vt,[(u(!0),c(U,null,$(t(J),s=>(u(),c("div",{key:s.record_id,class:V(["event-card",s.mood?t(L)(s.mood):{}])},[e("div",ht,[e("div",ft,[e("h4",null,i(t(z)(s.pid,s.pet_name)),1),e("span",gt,i(s.event_type),1)]),s.mood?(u(),c("div",yt,[e("span",kt,i(t(O)(s.mood)),1),e("span",bt,i(s.mood),1)])):b("",!0)]),e("div",Mt,[e("p",wt,i(s.description),1),s.location?(u(),c("div",Et,[a[28]||(a[28]=e("span",{class:"location-icon"},"ðŸ“",-1)),X(" "+i(s.location),1)])):b("",!0)]),s.media_list&&s.media_list.length>0?(u(),c("div",Ft,[e("div",Ct,[(u(!0),c(U,null,$(s.media_list.slice(0,3),y=>(u(),c("div",{key:y.id,class:"media-item"},[y.media_type==="image"?(u(),c("img",{key:0,src:y.media_url,alt:s.event_type,onClick:h=>t(q)([],s.record_id),style:{cursor:"pointer"}},null,8,Tt)):y.media_type==="video"?(u(),c("video",{key:1,src:y.media_url,onClick:h=>t(q)([],s.record_id),style:{cursor:"pointer"}},null,8,Dt)):b("",!0)]))),128)),s.media_list.length>3?(u(),c("div",{key:0,class:"media-count",onClick:y=>t(q)([],s.record_id),style:{cursor:"pointer"}}," +"+i(s.media_list.length-3),9,Ut)):b("",!0)])])):b("",!0),e("div",$t,[e("div",xt,[e("span",Pt,i(t(T)(s.record_time)),1),e("span",St,i(t(o)("records.recordedAt"))+" "+i(t(T)(s.created_at)),1),s.updated_at&&s.updated_at!==s.created_at?(u(),c("span",Vt,i(t(o)("records.updatedAt"))+" "+i(t(T)(s.updated_at)),1)):b("",!0)]),e("div",It,[e("button",{class:"action-btn edit-btn",onClick:y=>t(A)(s)},i(t(o)("records.edit")),9,Lt),e("button",{class:"action-btn delete-btn",onClick:y=>t(D)(s.record_id),disabled:!s.record_id},i(t(o)("records.delete")),9,jt)])])],2))),128))])):t(d)==="list"?(u(),c("div",At,[e("div",Bt,[e("div",Nt,i(t(o)("records.pet")),1),e("div",Rt,i(t(o)("records.eventType")),1),e("div",zt,i(t(o)("records.mood")),1),e("div",Ot,i(t(o)("records.description")),1),e("div",Wt,i(t(o)("records.time")),1),e("div",qt,i(t(o)("records.actions")),1)]),(u(!0),c(U,null,$(t(J),s=>(u(),c("div",{key:s.record_id,class:V(["list-item",s.mood?t(L)(s.mood):{}])},[e("div",Ht,[e("div",Gt,[e("h4",null,i(t(z)(s.pid,s.pet_name)),1)])]),e("div",Jt,[e("span",Kt,i(s.event_type),1)]),e("div",Zt,[s.mood?(u(),c("span",Qt,[e("span",Xt,i(t(O)(s.mood)),1),X(" "+i(s.mood),1)])):b("",!0)]),e("div",Yt,[e("p",eo,i(s.description),1),s.location?(u(),c("div",to," ðŸ“ "+i(s.location),1)):b("",!0)]),e("div",oo,[e("span",so,i(t(T)(s.record_time)),1)]),e("div",io,[e("button",{class:"action-btn edit-btn",onClick:y=>t(A)(s)},i(t(o)("records.edit")),9,ao),e("button",{class:"action-btn delete-btn",onClick:y=>t(D)(s.record_id),disabled:!s.record_id},i(t(o)("records.delete")),9,lo)])],2))),128))])):(u(),c("div",no,[e("div",ro,[(u(!0),c(U,null,$(t(ee),(s,y)=>(u(),c("div",{key:y,class:"timeline-group"},[e("div",co,i(t(T)(y)),1),e("div",uo,[(u(!0),c(U,null,$(s,h=>(u(),c("div",{key:h.record_id,class:V(["timeline-item",h.mood?t(L)(h.mood):{}])},[a[29]||(a[29]=e("div",{class:"timeline-marker"},null,-1)),e("div",po,[e("div",_o,[e("h4",null,i(t(z)(h.pid,h.pet_name)),1),e("span",mo,i(h.event_type),1),h.mood?(u(),c("span",vo,[e("span",ho,i(t(O)(h.mood)),1),X(" "+i(h.mood),1)])):b("",!0)]),e("p",fo,i(h.description),1),h.location?(u(),c("div",go," ðŸ“ "+i(h.location),1)):b("",!0),e("div",yo,[e("span",ko,i(t(T)(h.record_time)),1),e("div",bo,[e("button",{class:"action-btn edit-btn",onClick:H=>t(A)(h)},i(t(o)("records.edit")),9,Mo),e("button",{class:"action-btn delete-btn",onClick:H=>t(D)(h.record_id),disabled:!h.record_id},i(t(o)("records.delete")),9,wo)])])])],2))),128))])]))),128))])]))]),t(_)||t(v)?(u(),c("div",{key:0,class:"modal-overlay",onClick:a[20]||(a[20]=(...s)=>t(x)&&t(x)(...s))},[e("div",{class:"modal-content",onClick:a[19]||(a[19]=de(()=>{},["stop"]))},[e("div",Eo,[e("h3",null,i(t(v)?t(o)("records.editEvent"):t(o)("records.addEvent")),1),e("button",{class:"close-btn",onClick:a[9]||(a[9]=(...s)=>t(x)&&t(x)(...s))},"Ã—")]),e("form",{onSubmit:a[18]||(a[18]=de((...s)=>t(K)&&t(K)(...s),["prevent"])),class:"modal-form"},[e("div",Fo,[e("label",null,i(t(o)("records.pet")),1),C(e("select",{"onUpdate:modelValue":a[10]||(a[10]=s=>t(g).pid=s),required:"",class:"form-select"},[e("option",Co,i(t(o)("records.selectPet")),1),(u(!0),c(U,null,$(t(p),s=>(u(),c("option",{key:s.pid,value:s.pid},i(s.name),9,To))),128))],512),[[S,t(g).pid]])]),e("div",Do,[e("label",null,i(t(o)("records.eventType")),1),C(e("select",{"onUpdate:modelValue":a[11]||(a[11]=s=>t(g).event_type=s),required:"",class:"form-select"},[e("option",Uo,i(t(o)("records.selectType")),1),e("option",$o,i(t(o)("records.feeding")),1),e("option",xo,i(t(o)("records.bathing")),1),e("option",Po,i(t(o)("records.walking")),1),e("option",So,i(t(o)("records.veterinary")),1),e("option",Vo,i(t(o)("records.playing")),1),e("option",Io,i(t(o)("records.vaccination")),1)],512),[[S,t(g).event_type]])]),e("div",Lo,[e("label",null,i(t(o)("records.mood")),1),C(e("select",{"onUpdate:modelValue":a[12]||(a[12]=s=>t(g).mood=s),class:"form-select"},[e("option",jo,i(t(o)("records.selectMood")),1),e("option",Ao,i(t(o)("records.happy")),1),e("option",Bo,i(t(o)("records.angry")),1),e("option",No,i(t(o)("records.tired")),1),e("option",Ro,i(t(o)("records.active")),1)],512),[[S,t(g).mood]])]),e("div",zo,[e("label",null,i(t(o)("records.eventTime")),1),C(e("input",{type:"datetime-local","onUpdate:modelValue":a[13]||(a[13]=s=>t(g).record_time=s),required:"",class:"form-input"},null,512),[[Q,t(g).record_time]])]),e("div",Oo,[e("label",null,i(t(o)("records.location")),1),C(e("input",{type:"text","onUpdate:modelValue":a[14]||(a[14]=s=>t(g).location=s),placeholder:t(o)("records.locationOptional"),class:"form-input"},null,8,Wo),[[Q,t(g).location]])]),e("div",qo,[e("label",null,i(t(o)("records.detailedDescription")),1),C(e("textarea",{"onUpdate:modelValue":a[15]||(a[15]=s=>t(g).description=s),rows:"4",placeholder:t(o)("records.pleaseEnterDescription"),required:"",class:"form-textarea"},null,8,Ho),[[Q,t(g).description]])]),e("div",Go,[e("label",null,i(t(o)("records.mediaFiles")),1),e("div",Jo,[e("div",Ko,[e("input",{type:"file",multiple:"",accept:"image/*,video/*",onChange:a[16]||(a[16]=(...s)=>t(W)&&t(W)(...s)),class:"file-input",id:"media-file-input"},null,32),e("label",Zo,[a[30]||(a[30]=e("div",{class:"upload-icon"},"ðŸ“",-1)),e("div",Qo,i(t(o)("records.clickToSelectOrDrag")),1),e("div",Xo,i(t(o)("records.supportedFormats")),1)])])]),t(w).length>0?(u(),c("div",Yo,[e("div",es,i(t(o)("records.uploadedFiles"))+" ("+i(t(w).length)+"/5)",1),e("div",ts,[(u(!0),c(U,null,$(t(w),(s,y)=>(u(),c("div",{key:y,class:"file-preview-item"},[e("div",os,[s.mediaType==="image"?(u(),c("img",{key:0,src:s.thumbnailUrl,alt:s.file.name,class:"preview-image"},null,8,ss)):(u(),c("div",is,[...a[31]||(a[31]=[e("span",{class:"video-icon"},"ðŸŽ¬",-1)])]))]),e("div",as,[e("div",ds,[e("span",ls,i(t(E)(s.mediaType)),1),e("span",{class:"file-name",title:s.file.name},i(s.file.name),9,ns)]),e("div",rs,[e("span",cs,i(t(ie)(s.file.size)),1),e("span",us,i(s.mediaType==="image"?"(å›¾ç‰‡)":"(è§†é¢‘)"),1)])]),e("button",{type:"button",onClick:h=>t(se)(y),class:"remove-file-btn",title:t(o)("records.deleteFile")}," Ã— ",8,ps)]))),128))]),e("div",_s,i(t(w).length>=5?"å·²åˆ°è¾¾æœ€å¤§æ–‡ä»¶æ•°é™åˆ¶":`è¿˜å¯ä¸Šä¼  ${5-t(w).length} ä¸ªæ–‡ä»¶`),1)])):b("",!0)]),e("div",ms,[e("button",{type:"button",class:"cancel-btn",onClick:a[17]||(a[17]=(...s)=>t(x)&&t(x)(...s))},i(t(o)("records.cancel")),1),e("button",vs,i(t(v)?t(o)("records.update"):t(o)("records.save")),1)])],32)])])):b("",!0),t(f)?(u(),c("div",{key:1,class:"media-modal-overlay",onClick:a[23]||(a[23]=(...s)=>t(j)&&t(j)(...s))},[e("div",{class:"media-modal-content",onClick:a[22]||(a[22]=de(()=>{},["stop"]))},[e("div",hs,[e("h3",null,i(t(o)("records.mediaViewer")),1),e("button",{class:"close-btn",onClick:a[21]||(a[21]=(...s)=>t(j)&&t(j)(...s))},"Ã—")]),t(k)?(u(),c("div",fs,[...a[32]||(a[32]=[e("p",null,"æ­£åœ¨åŠ è½½åª’ä½“æ–‡ä»¶...",-1)])])):t(P).length===0?(u(),c("div",gs,[...a[33]||(a[33]=[e("p",null,"æ­¤äº‹ä»¶æ²¡æœ‰åª’ä½“æ–‡ä»¶",-1)])])):(u(),c("div",ys,[(u(!0),c(U,null,$(t(P),(s,y)=>(u(),c("div",{key:y,class:"media-item"},[s.media_type==="image"?(u(),c("img",{key:0,src:s.media_url,alt:`Media ${y+1}`},null,8,ks)):s.media_type==="video"?(u(),c("video",{key:1,src:s.media_url,controls:""},null,8,bs)):b("",!0),e("div",Ms,[e("p",ws,i(s.media_name||`åª’ä½“æ–‡ä»¶ ${y+1}`),1),e("p",Es,"åˆ›å»ºæ—¶é—´: "+i(t(T)(s.created_at||"")),1),s.updated_at&&s.updated_at!==(s.created_at||"")?(u(),c("p",Fs,"æ›´æ–°æ—¶é—´: "+i(t(T)(s.updated_at||"")),1)):b("",!0)])]))),128))]))])])):b("",!0)],2))}}),$s=fe(Cs,[["__scopeId","data-v-847ca39e"]]);export{$s as default};
