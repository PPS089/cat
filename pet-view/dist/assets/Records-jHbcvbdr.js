import{h as T,I as J,u as j,j as fe,E as F,J as be,d as ke,v as Me,a1 as we,c,o as n,a as t,z as b,O as Fe,t as i,l as e,N as x,Z as A,F as P,f as I,a0 as oe,g as ie,n as V,U as Ee,$ as G,e as ve,w as he,a2 as ge,a3 as Ce,a4 as pe,_ as Te}from"./index-BrRsyrLM.js";import{s as L}from"./request-DVyWtN3q.js";import{useThemeStore as De}from"./theme-nJHyLohD.js";const xe=async(l,s)=>{if(!l||l.length===0)return console.warn("æ²¡æœ‰æ–‡ä»¶éœ€è¦ä¸Šä¼ "),{success:!0,message:"æ²¡æœ‰æ–‡ä»¶éœ€è¦ä¸Šä¼ "};const u=new FormData;l.forEach(d=>{u.append("files",d)}),u.append("recordId",String(s)),u.append("batchUpload","true");try{return await L.post("/media/upload",u)}catch(d){throw d}},Ue=()=>{const{t:l}=j();return{getMoodEmoji:u=>{const d={[l("happy")]:"ðŸ˜Š",[l("angry")]:"ðŸ˜ ",[l("tired")]:"ðŸ˜´",[l("active")]:"ðŸ•"};return u&&d[u]||"ðŸ˜"}}},$e=()=>{const{t:l}=j();return{getMoodClass:u=>({happy:u===l("happy"),angry:u===l("angry"),tired:u===l("tired"),active:u===l("active")})}},Se=()=>({formatDate:s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}),z={maxFileSize:52428800,supportedImageFormats:["image/jpeg","image/png","image/gif","image/webp","image/jpg"],supportedVideoFormats:["video/mp4","video/mpeg","video/quicktime","video/x-msvideo","video/webm"],thumbnailMaxWidth:200,thumbnailMaxHeight:200},Pe=l=>new Promise((s,u)=>{const d=new FileReader;d.onload=p=>{const r=new Image;r.onload=()=>{const _=document.createElement("canvas"),M=_.getContext("2d");if(!M){s(p.target?.result);return}let h=r.width,v=r.height;const C=z.thumbnailMaxWidth,m=z.thumbnailMaxHeight;h>v?h>C&&(v=v*C/h,h=C):v>m&&(h=h*m/v,v=m),_.width=h,_.height=v,M.drawImage(r,0,0,h,v),s(_.toDataURL("image/jpeg",.7))},r.onerror=()=>{s(p.target?.result)},r.src=p.target?.result},d.onerror=()=>u(new Error("æ— æ³•è¯»å–æ–‡ä»¶")),d.readAsDataURL(l)}),Ie=l=>{if(l.size>z.maxFileSize)return{valid:!1,error:`æ–‡ä»¶è¿‡å¤§ï¼Œæœ€å¤§æ”¯æŒ${z.maxFileSize/1024/1024}MB`};const s=z.supportedImageFormats.includes(l.type),u=z.supportedVideoFormats.includes(l.type);return!s&&!u?{valid:!1,error:"ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œä»…æ”¯æŒå¸¸è§çš„å›¾ç‰‡å’Œè§†é¢‘æ ¼å¼"}:{valid:!0}},Ve=()=>{const{t:l}=j(),s=T([]);return{filePreviews:s,handleFileUpload:async h=>{const v=h.target,C=Array.from(v.files||[]);if(s.value.length+C.length>5){F.error(l("common.maxFilesExceeded"));return}for(const m of C){const k=Ie(m);if(!k.valid){F.error(`${l("records.uploadFailed")}: ${k.error}`);continue}try{const E=m.type.startsWith("image/")?"image":"video";let f=URL.createObjectURL(m),O=E==="image"?await Pe(m):f;s.value.push({file:m,previewUrl:f,thumbnailUrl:O,mediaType:E,isValid:!0}),F.success(l("records.uploadSuccess"))}catch{F.error(l("records.uploadFailed"))}}v.value=""},removeFile:h=>{const v=s.value[h];v&&v.previewUrl.startsWith("blob:")&&URL.revokeObjectURL(v.previewUrl),s.value.splice(h,1),F.success(l("common.deleteSuccess"))},clearAllFiles:()=>{s.value.forEach(h=>{h.previewUrl.startsWith("blob:")&&URL.revokeObjectURL(h.previewUrl)}),s.value=[]},getUploadFiles:()=>s.value.map(v=>v.file),getFileIcon:h=>h==="image"?"ðŸ–¼ï¸":h==="video"?"ðŸŽ¬":"ðŸ“„",formatFileSize:h=>{if(h===0)return"0 Bytes";const v=1024,C=["Bytes","KB","MB"],m=Math.floor(Math.log(h)/Math.log(v));return Math.round(h/Math.pow(v,m)*100)/100+" "+C[m]}}},Ae=()=>{const l=T(!1),s=T([]),u=T(!1),d=T(0);return{showMediaModal:l,currentMediaList:s,mediaLoading:u,currentMediaIndex:d,openMediaModal:async(v,C)=>{if(d.value=0,C){u.value=!0;try{const m=await L.get(`/media/record/${C}`);if(m.code===200&&m.data){const k=Array.isArray(m.data)?m.data:[m.data];s.value=k.map(E=>({id:E.mid,media_url:`/api${E.filePath}`,media_type:E.mediaType,media_name:E.fileName,updated_at:E.updatedAt}))}else s.value=[]}catch{F.error("åŠ è½½åª’ä½“æ–‡ä»¶å¤±è´¥"),s.value=[]}finally{u.value=!1}}else s.value=v||[];l.value=!0},closeMediaModal:()=>{l.value=!1,s.value=[],d.value=0},nextMedia:()=>{s.value.length>1&&(d.value=(d.value+1)%s.value.length)},prevMedia:()=>{s.value.length>1&&(d.value=(d.value-1+s.value.length)%s.value.length)},selectMedia:v=>{v>=0&&v<s.value.length&&(d.value=v)}}},ye=()=>{const{t:l}=j(),s=T([]),u=T(!1);return{events:s,loading:u,fetchEvents:async()=>{u.value=!0;try{const p=await L.get("/events");p.code===200&&p.data?s.value=p.data.map(r=>({record_id:r.eid,pid:r.pid,event_type:r.eventType,description:r.description,record_time:r.eventTime,mood:r.mood,location:r.location,pet_name:r.pet_name||"",created_at:r.createdAt||r.eventTime,updated_at:r.updatedAt||r.createdAt||r.eventTime,media_list:r.mediaList?r.mediaList.map(_=>({id:_.mid,media_url:`/api${_.filePath}`,media_type:_.mediaType,media_name:_.fileName,updated_at:_.updatedAt})):[]})):s.value=[]}catch{F.error(l("api.getEventsFailed")),s.value=[]}finally{u.value=!1}}}},Le=()=>{const{t:l}=j(),s=T([]),u=T(!1);return{pets:s,loading:u,fetchPets:async()=>{u.value=!0;try{const r=await L.get("/user/adoptions",{params:{current_page:1,per_page:100}});r.code===200&&r.data?.records?s.value=r.data.records.map(_=>({pid:_.pid||_.id,name:_.name||_.petName,species:_.breed||_.species||"æœªçŸ¥",breed:_.breed||_.species||"æœªçŸ¥",type:"adoption",date:_.adoptionDate||_.adoptDate||_.date})):s.value=[]}catch{F.error(l("api.getPetsFailed")),s.value=[]}finally{u.value=!1}},getPetName:(r,_)=>{const M=s.value.find(h=>h.pid===r);return M?M.name:_||l("api.unknownPet")}}},je=l=>{const{t:s}=j(),{fetchEvents:u}=l||ye();return{deleteEvent:async p=>{try{if(!p||p<=0){F.error(s("common.operationFailed"));return}await be.confirm(s("common.confirmDeleteEvent"),s("common.deleteConfirmation"),{confirmButtonText:s("common.confirm"),cancelButtonText:s("common.cancel"),type:"warning"}),await L.delete(`/events/${p}`),F.success(s("api.deleteSuccess")),await u()}catch(r){r!=="cancel"&&F.error(s("api.deleteFailed"))}}}},Be=l=>{const s=fe({selectedPet:"",selectedEventType:"",selectedMood:"",selectedDate:""}),u=J(()=>{let d=[...l.value];return s.selectedPet&&(d=d.filter(p=>p.pid===Number(s.selectedPet))),s.selectedEventType&&(d=d.filter(p=>p.event_type===s.selectedEventType)),s.selectedMood&&(d=d.filter(p=>p.mood===s.selectedMood)),s.selectedDate&&(d=d.filter(p=>new Date(p.record_time).toDateString()===new Date(s.selectedDate).toDateString())),d});return{filters:s,filteredEvents:u}},Ne=l=>{const s=T("record_time"),u=J(()=>{const d=[...l.value];return d.sort((p,r)=>{switch(s.value){case"event_type":return p.event_type.localeCompare(r.event_type);case"mood":return(p.mood||"").localeCompare(r.mood||"");case"record_time":default:return new Date(r.record_time).getTime()-new Date(p.record_time).getTime()}}),d});return{sortBy:s,sortedEvents:u}},Re=l=>({groupedEvents:J(()=>{const u={};return l.value.forEach(d=>{const p=new Date(d.record_time).toDateString();u[p]||(u[p]=[]),u[p].push(d)}),u})}),ze=()=>{const l=fe({record_id:"",pid:"",event_type:"",mood:"",description:"",location:"",record_time:""});return{formData:l,resetForm:()=>{Object.assign(l,{record_id:"",pid:"",event_type:"",mood:"",description:"",location:"",record_time:""})},populateForm:d=>{let p="";try{if(d.record_time){const r=d.record_time.replace(" ","T"),_=new Date(r);if(!isNaN(_.getTime()))p=_.toISOString().slice(0,16);else{const M=d.record_time.split(" ");M.length===2&&(p=`${M[0]}T${M[1].slice(0,5)}`)}}}catch{}Object.assign(l,{...d,record_time:p})}}},Oe=()=>{const{events:l,loading:s,fetchEvents:u}=ye(),{pets:d,fetchPets:p,getPetName:r}=Le(),{getMoodEmoji:_}=Ue(),{getMoodClass:M}=$e(),{formatDate:h}=Se(),{filePreviews:v,handleFileUpload:C,removeFile:m,clearAllFiles:k,getUploadFiles:E,getFileIcon:f,formatFileSize:O}=Ve(),{showMediaModal:ae,currentMediaList:Z,mediaLoading:de,currentMediaIndex:le,openMediaModal:ne,closeMediaModal:W,nextMedia:q,prevMedia:H,selectMedia:U}=Ae(),{filters:Q,filteredEvents:X}=Be(l),{sortBy:re,sortedEvents:Y}=Ne(X),{groupedEvents:K}=Re(Y),{formData:w,resetForm:B,populateForm:N}=ze(),{deleteEvent:ce}=je({fetchEvents:u}),R=T(!1),$=T(!1),ee=T("grid"),D=T(!1),me=J(()=>l.value.length),a=J(()=>l.value.reduce((S,ue)=>S+(ue.media_list?.length||0),0)),o=S=>{N(S),$.value=!0},g=()=>{R.value=!1,$.value=!1,k(),B()};return{events:l,pets:d,loading:s,filters:Q,viewMode:ee,sortBy:re,isSubmitting:D,showAddModal:R,showEditModal:$,showMediaModal:ae,mediaLoading:de,currentMediaIndex:le,formData:w,filePreviews:v,currentMediaList:Z,totalEvents:me,totalMedia:a,filteredEvents:X,sortedEvents:Y,groupedEvents:K,fetchEvents:u,fetchPets:p,getPetName:r,getMoodEmoji:_,getMoodClass:M,formatDate:h,handleFileUpload:C,removeFile:m,getFileIcon:f,formatFileSize:O,openMediaModal:ne,closeMediaModal:W,nextMedia:q,prevMedia:H,selectMedia:U,editEvent:o,deleteEvent:ce,saveEvent:async()=>{if(D.value){F.warning("æ­£åœ¨ä¿å­˜ä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤");return}D.value=!0;try{const S=w.record_time,ue=S?S.replace("T"," ")+":00":"",_e={pid:w.pid,eventType:w.event_type,recordTime:ue,description:w.description,mood:w.mood||"",location:w.location||""};let te=null;if($.value&&w.record_id?(await L.put(`/events/${w.record_id}`,_e),te=Number(w.record_id),F.success("äº‹ä»¶æ›´æ–°æˆåŠŸ")):(te=(await L.post("/events",_e)).data?.eid,F.success("äº‹ä»¶æ·»åŠ æˆåŠŸ")),te){const se=E();if(se&&se.length>0)try{await xe(se,te),F.success("äº‹ä»¶ä¿å­˜æˆåŠŸï¼Œåª’ä½“æ–‡ä»¶ä¸Šä¼ å®Œæˆ")}catch{F.warning("äº‹ä»¶ä¿å­˜æˆåŠŸï¼Œä½†åª’ä½“æ–‡ä»¶ä¸Šä¼ å¤±è´¥")}}await u(),g()}catch{F.error($.value?"äº‹ä»¶æ›´æ–°å¤±è´¥":"äº‹ä»¶æ·»åŠ å¤±è´¥")}finally{D.value=!1}},closeModal:g}},We={class:"page-header"},qe={class:"stats-grid"},He={class:"stat-card"},Ke={class:"stat-content"},Ge={class:"stat-card"},Je={class:"stat-content"},Ze={class:"stat-card"},Qe={class:"stat-content"},Xe={class:"controls-section"},Ye={class:"filter-group"},et={style:{position:"relative"}},tt=["disabled"],st={value:""},ot=["value"],it={key:0,style:{position:"absolute",top:"-20px",left:"0",color:"#666"}},at={value:""},dt={value:"å–‚é£Ÿ"},lt={value:"æ´—æ¾¡"},nt={value:"æ•£æ­¥"},rt={value:"çœ‹å…½åŒ»"},ct={value:"çŽ©è€"},ut={value:"æ‰“ç–«è‹—"},pt={value:""},mt={value:"å¼€å¿ƒ"},_t={value:"ç”Ÿæ°”"},vt={value:"ç–²å€¦"},ht={value:"æ´»è·ƒ"},gt=["placeholder"],ft={class:"view-controls"},yt={class:"view-toggle"},bt={class:"sort-controls"},kt={value:"record_time"},Mt={value:"event_type"},wt={value:"mood"},Ft={class:"events-content"},Et={key:0,class:"events-grid"},Ct={class:"event-header"},Tt={class:"pet-info"},Dt={class:"event-type"},xt={key:0,class:"event-mood"},Ut={class:"mood-emoji"},$t={class:"mood-text"},St={class:"event-content"},Pt={class:"description"},It={key:0,class:"location"},Vt={key:0,class:"event-media"},At={class:"media-preview"},Lt=["src","alt","onClick"],jt=["src","onClick"],Bt=["onClick"],Nt={class:"event-footer"},Rt={class:"event-time"},zt={class:"record-time"},Ot={class:"created-time"},Wt={key:0,class:"updated-time"},qt={class:"event-actions"},Ht=["onClick"],Kt=["onClick","disabled"],Gt={key:1,class:"events-list"},Jt={class:"list-header"},Zt={class:"col-pet"},Qt={class:"col-type"},Xt={class:"col-mood"},Yt={class:"col-description"},es={class:"col-time"},ts={class:"col-actions"},ss={class:"col-pet"},os={class:"pet-info"},is={class:"col-type"},as={class:"event-type-badge"},ds={class:"col-mood"},ls={key:0,class:"mood-indicator"},ns={class:"mood-emoji"},rs={class:"col-description"},cs={class:"description-text"},us={key:0,class:"location-small"},ps={class:"col-time"},ms={class:"time-text"},_s={class:"col-actions"},vs=["onClick"],hs=["onClick","disabled"],gs={key:2,class:"timeline-view"},fs={class:"timeline"},ys={class:"timeline-date"},bs={class:"timeline-items"},ks={class:"timeline-content"},Ms={class:"timeline-header"},ws={class:"event-type-badge"},Fs={key:0,class:"mood-indicator"},Es={class:"mood-emoji"},Cs={class:"description"},Ts={key:0,class:"location"},Ds={class:"timeline-footer"},xs={class:"time-text"},Us={class:"timeline-actions"},$s=["onClick"],Ss=["onClick","disabled"],Ps={class:"modal-header"},Is={class:"modal-form"},Vs={class:"form-group"},As={value:""},Ls=["value"],js={class:"form-group"},Bs={value:""},Ns={value:"å–‚é£Ÿ"},Rs={value:"æ´—æ¾¡"},zs={value:"æ•£æ­¥"},Os={value:"çœ‹å…½åŒ»"},Ws={value:"çŽ©è€"},qs={value:"æ‰“ç–«è‹—"},Hs={class:"form-group"},Ks={value:""},Gs={value:"å¼€å¿ƒ"},Js={value:"ç”Ÿæ°”"},Zs={value:"ç–²å€¦"},Qs={value:"æ´»è·ƒ"},Xs={class:"form-group"},Ys={class:"form-group"},eo=["placeholder"],to={class:"form-group"},so=["placeholder"],oo={class:"form-group"},io={class:"media-upload"},ao={class:"upload-area"},lo={for:"media-file-input",class:"upload-label"},no={class:"upload-text"},ro={class:"upload-hint"},co={key:0,class:"uploaded-files"},uo={class:"uploaded-files-title"},po={class:"file-preview-grid"},mo={class:"preview-thumbnail"},_o=["src","alt"],vo={key:1,class:"preview-video-placeholder"},ho={class:"file-info-full"},go={class:"file-name-container"},fo={class:"file-icon"},yo=["title"],bo={class:"file-size-type"},ko={class:"file-size"},Mo={class:"file-type"},wo=["onClick","title"],Fo={class:"upload-hint-text"},Eo={class:"modal-actions"},Co=["disabled"],To=["disabled"],Do={key:0,class:"media-viewer-main"},xo=["aria-label"],Uo={class:"media-display"},$o=["src","alt"],So=["src"],Po=["aria-label"],Io={key:1,class:"media-viewer-footer"},Vo={class:"media-info"},Ao={key:0},Lo={key:1},jo={key:0,class:"media-thumbnails"},Bo=["onClick","aria-label"],No=["src","alt"],Ro={key:1,class:"video-thumbnail"},zo={key:2,class:"media-empty"},Oo=ke({__name:"Records",setup(l){const{t:s}=j(),u=De(),{pets:d,filters:p,viewMode:r,sortBy:_,isSubmitting:M,showAddModal:h,showEditModal:v,showMediaModal:C,currentMediaIndex:m,formData:k,filePreviews:E,currentMediaList:f,totalEvents:O,totalMedia:ae,sortedEvents:Z,groupedEvents:de,fetchEvents:le,fetchPets:ne,getPetName:W,getMoodEmoji:q,getMoodClass:H,formatDate:U,handleFileUpload:Q,removeFile:X,getFileIcon:re,formatFileSize:Y,openMediaModal:K,closeMediaModal:w,nextMedia:B,prevMedia:N,selectMedia:ce,editEvent:R,deleteEvent:$,saveEvent:ee,closeModal:D}=Oe();return Me(async()=>{await ne(),await we(),await le()}),(me,a)=>(n(),c("div",{class:V(["events-container",{"dark-theme":e(u).preferences.theme==="dark"}])},[t("div",We,[t("h1",null,i(e(s)("records.pageTitle")),1),t("p",null,i(e(s)("records.pageSubtitle")),1)]),t("div",qe,[t("div",He,[a[29]||(a[29]=t("div",{class:"stat-icon"},"ðŸ“…",-1)),t("div",Ke,[t("h3",null,i(e(O)),1),t("p",null,i(e(s)("records.totalEvents")),1)])]),t("div",Ge,[a[30]||(a[30]=t("div",{class:"stat-icon"},"ðŸ•",-1)),t("div",Je,[t("h3",null,i(e(d).length),1),t("p",null,i(e(s)("records.totalPets")),1)])]),t("div",Ze,[a[31]||(a[31]=t("div",{class:"stat-icon"},"ðŸ“¸",-1)),t("div",Qe,[t("h3",null,i(e(ae)),1),t("p",null,i(e(s)("records.totalMedia")),1)])])]),t("div",Xe,[t("div",Ye,[t("div",et,[x(t("select",{"onUpdate:modelValue":a[0]||(a[0]=o=>e(p).selectedPet=o),class:"filter-select",disabled:e(d).length===0},[t("option",st,i(e(d).length===0?e(s)("records.loading"):e(s)("records.allPets")),1),(n(!0),c(P,null,I(e(d),o=>(n(),c("option",{key:o.pid,value:o.pid},i(o.name),9,ot))),128))],8,tt),[[A,e(p).selectedPet]]),e(d).length>0?(n(),c("small",it,i(e(s)("records.foundPets",{count:e(d).length})),1)):b("",!0)]),x(t("select",{"onUpdate:modelValue":a[1]||(a[1]=o=>e(p).selectedEventType=o),class:"filter-select"},[t("option",at,i(e(s)("records.allEvents")),1),t("option",dt,i(e(s)("records.feeding")),1),t("option",lt,i(e(s)("records.bathing")),1),t("option",nt,i(e(s)("records.walking")),1),t("option",rt,i(e(s)("records.veterinary")),1),t("option",ct,i(e(s)("records.playing")),1),t("option",ut,i(e(s)("records.vaccination")),1)],512),[[A,e(p).selectedEventType]]),x(t("select",{"onUpdate:modelValue":a[2]||(a[2]=o=>e(p).selectedMood=o),class:"filter-select"},[t("option",pt,i(e(s)("records.allMood")),1),t("option",mt,i(e(s)("records.happy")),1),t("option",_t,i(e(s)("records.angry")),1),t("option",vt,i(e(s)("records.tired")),1),t("option",ht,i(e(s)("records.active")),1)],512),[[A,e(p).selectedMood]]),x(t("input",{type:"date","onUpdate:modelValue":a[3]||(a[3]=o=>e(p).selectedDate=o),class:"filter-input",placeholder:e(s)("records.selectDate")},null,8,gt),[[oe,e(p).selectedDate]])]),t("button",{class:"add-button",onClick:a[4]||(a[4]=o=>h.value=!0)},[a[32]||(a[32]=t("span",null,"+",-1)),ie(" "+i(e(s)("records.addEvent")),1)])]),t("div",ft,[t("div",yt,[t("button",{class:V({active:e(r)==="grid"}),onClick:a[5]||(a[5]=o=>r.value="grid")},i(e(s)("records.gridView")),3),t("button",{class:V({active:e(r)==="list"}),onClick:a[6]||(a[6]=o=>r.value="list")},i(e(s)("records.listView")),3),t("button",{class:V({active:e(r)==="timeline"}),onClick:a[7]||(a[7]=o=>r.value="timeline")},i(e(s)("records.timeline")),3)]),t("div",bt,[x(t("select",{"onUpdate:modelValue":a[8]||(a[8]=o=>Ee(_)?_.value=o:null),class:"sort-select"},[t("option",kt,i(e(s)("records.sortByTime")),1),t("option",Mt,i(e(s)("records.sortByType")),1),t("option",wt,i(e(s)("records.sortByMood")),1)],512),[[A,e(_)]])])]),t("div",Ft,[e(r)==="grid"?(n(),c("div",Et,[(n(!0),c(P,null,I(e(Z),o=>(n(),c("div",{key:o.record_id,class:V(["event-card",o.mood?e(H)(o.mood):{}])},[t("div",Ct,[t("div",Tt,[t("h4",null,i(e(W)(o.pid,o.pet_name)),1),t("span",Dt,i(o.event_type),1)]),o.mood?(n(),c("div",xt,[t("span",Ut,i(e(q)(o.mood)),1),t("span",$t,i(o.mood),1)])):b("",!0)]),t("div",St,[t("p",Pt,i(o.description),1),o.location?(n(),c("div",It,[a[33]||(a[33]=t("span",{class:"location-icon"},"ðŸ“",-1)),ie(" "+i(o.location),1)])):b("",!0)]),o.media_list&&o.media_list.length>0?(n(),c("div",Vt,[t("div",At,[(n(!0),c(P,null,I(o.media_list.slice(0,3),g=>(n(),c("div",{key:g.id,class:"media-item"},[g.media_type==="image"?(n(),c("img",{key:0,src:g.media_url,alt:o.event_type,onClick:y=>e(K)([],o.record_id),style:{cursor:"pointer"}},null,8,Lt)):g.media_type==="video"?(n(),c("video",{key:1,src:g.media_url,onClick:y=>e(K)([],o.record_id),style:{cursor:"pointer"}},null,8,jt)):b("",!0)]))),128)),o.media_list.length>3?(n(),c("div",{key:0,class:"media-count",onClick:g=>e(K)([],o.record_id),style:{cursor:"pointer"}}," +"+i(o.media_list.length-3),9,Bt)):b("",!0)])])):b("",!0),t("div",Nt,[t("div",Rt,[t("span",zt,i(e(U)(o.record_time)),1),t("span",Ot,i(e(s)("records.recordedAt"))+" "+i(e(U)(o.created_at)),1),o.updated_at&&o.updated_at!==o.created_at?(n(),c("span",Wt,i(e(s)("records.updatedAt"))+" "+i(e(U)(o.updated_at)),1)):b("",!0)]),t("div",qt,[t("button",{class:"action-btn edit-btn",onClick:g=>e(R)(o)},i(e(s)("records.edit")),9,Ht),t("button",{class:"action-btn delete-btn",onClick:g=>e($)(o.record_id),disabled:!o.record_id},i(e(s)("records.delete")),9,Kt)])])],2))),128))])):e(r)==="list"?(n(),c("div",Gt,[t("div",Jt,[t("div",Zt,i(e(s)("records.pet")),1),t("div",Qt,i(e(s)("records.eventType")),1),t("div",Xt,i(e(s)("records.mood")),1),t("div",Yt,i(e(s)("records.description")),1),t("div",es,i(e(s)("records.time")),1),t("div",ts,i(e(s)("records.actions")),1)]),(n(!0),c(P,null,I(e(Z),o=>(n(),c("div",{key:o.record_id,class:V(["list-item",o.mood?e(H)(o.mood):{}])},[t("div",ss,[t("div",os,[t("h4",null,i(e(W)(o.pid,o.pet_name)),1)])]),t("div",is,[t("span",as,i(o.event_type),1)]),t("div",ds,[o.mood?(n(),c("span",ls,[t("span",ns,i(e(q)(o.mood)),1),ie(" "+i(o.mood),1)])):b("",!0)]),t("div",rs,[t("p",cs,i(o.description),1),o.location?(n(),c("div",us," ðŸ“ "+i(o.location),1)):b("",!0)]),t("div",ps,[t("span",ms,i(e(U)(o.record_time)),1)]),t("div",_s,[t("button",{class:"action-btn edit-btn",onClick:g=>e(R)(o)},i(e(s)("records.edit")),9,vs),t("button",{class:"action-btn delete-btn",onClick:g=>e($)(o.record_id),disabled:!o.record_id},i(e(s)("records.delete")),9,hs)])],2))),128))])):(n(),c("div",gs,[t("div",fs,[(n(!0),c(P,null,I(e(de),(o,g)=>(n(),c("div",{key:g,class:"timeline-group"},[t("div",ys,i(e(U)(g)),1),t("div",bs,[(n(!0),c(P,null,I(o,y=>(n(),c("div",{key:y.record_id,class:V(["timeline-item",y.mood?e(H)(y.mood):{}])},[a[34]||(a[34]=t("div",{class:"timeline-marker"},null,-1)),t("div",ks,[t("div",Ms,[t("h4",null,i(e(W)(y.pid,y.pet_name)),1),t("span",ws,i(y.event_type),1),y.mood?(n(),c("span",Fs,[t("span",Es,i(e(q)(y.mood)),1),ie(" "+i(y.mood),1)])):b("",!0)]),t("p",Cs,i(y.description),1),y.location?(n(),c("div",Ts," ðŸ“ "+i(y.location),1)):b("",!0),t("div",Ds,[t("span",xs,i(e(U)(y.record_time)),1),t("div",Us,[t("button",{class:"action-btn edit-btn",onClick:S=>e(R)(y)},i(e(s)("records.edit")),9,$s),t("button",{class:"action-btn delete-btn",onClick:S=>e($)(y.record_id),disabled:!y.record_id},i(e(s)("records.delete")),9,Ss)])])])],2))),128))])]))),128))])]))]),e(h)||e(v)?(n(),c("div",{key:0,class:"modal-overlay",onClick:a[20]||(a[20]=(...o)=>e(D)&&e(D)(...o))},[t("div",{class:"modal-content",onClick:a[19]||(a[19]=G(()=>{},["stop"]))},[t("div",Ps,[t("h3",null,i(e(v)?e(s)("records.editEvent"):e(s)("records.addEvent")),1),t("button",{class:"close-btn",onClick:a[9]||(a[9]=(...o)=>e(D)&&e(D)(...o))},"Ã—")]),t("form",Is,[t("div",Vs,[t("label",null,i(e(s)("records.pet")),1),x(t("select",{"onUpdate:modelValue":a[10]||(a[10]=o=>e(k).pid=o),required:"",class:"form-select"},[t("option",As,i(e(s)("records.selectPet")),1),(n(!0),c(P,null,I(e(d),o=>(n(),c("option",{key:o.pid,value:o.pid},i(o.name),9,Ls))),128))],512),[[A,e(k).pid]])]),t("div",js,[t("label",null,i(e(s)("records.eventType")),1),x(t("select",{"onUpdate:modelValue":a[11]||(a[11]=o=>e(k).event_type=o),required:"",class:"form-select"},[t("option",Bs,i(e(s)("records.selectType")),1),t("option",Ns,i(e(s)("records.feeding")),1),t("option",Rs,i(e(s)("records.bathing")),1),t("option",zs,i(e(s)("records.walking")),1),t("option",Os,i(e(s)("records.veterinary")),1),t("option",Ws,i(e(s)("records.playing")),1),t("option",qs,i(e(s)("records.vaccination")),1)],512),[[A,e(k).event_type]])]),t("div",Hs,[t("label",null,i(e(s)("records.mood")),1),x(t("select",{"onUpdate:modelValue":a[12]||(a[12]=o=>e(k).mood=o),class:"form-select"},[t("option",Ks,i(e(s)("records.selectMood")),1),t("option",Gs,i(e(s)("records.happy")),1),t("option",Js,i(e(s)("records.angry")),1),t("option",Zs,i(e(s)("records.tired")),1),t("option",Qs,i(e(s)("records.active")),1)],512),[[A,e(k).mood]])]),t("div",Xs,[t("label",null,i(e(s)("records.eventTime")),1),x(t("input",{type:"datetime-local","onUpdate:modelValue":a[13]||(a[13]=o=>e(k).record_time=o),required:"",class:"form-input"},null,512),[[oe,e(k).record_time]])]),t("div",Ys,[t("label",null,i(e(s)("records.location")),1),x(t("input",{type:"text","onUpdate:modelValue":a[14]||(a[14]=o=>e(k).location=o),placeholder:e(s)("records.locationOptional"),class:"form-input"},null,8,eo),[[oe,e(k).location]])]),t("div",to,[t("label",null,i(e(s)("records.detailedDescription")),1),x(t("textarea",{"onUpdate:modelValue":a[15]||(a[15]=o=>e(k).description=o),rows:"4",placeholder:e(s)("records.pleaseEnterDescription"),required:"",class:"form-textarea"},null,8,so),[[oe,e(k).description]])]),t("div",oo,[t("label",null,i(e(s)("records.mediaFiles")),1),t("div",io,[t("div",ao,[t("input",{type:"file",multiple:"",accept:"image/*,video/*",onChange:a[16]||(a[16]=(...o)=>e(Q)&&e(Q)(...o)),class:"file-input",id:"media-file-input"},null,32),t("label",lo,[a[35]||(a[35]=t("div",{class:"upload-icon"},"ðŸ“",-1)),t("div",no,i(e(s)("records.clickToSelectOrDrag")),1),t("div",ro,i(e(s)("records.supportedFormats")),1)])])]),e(E).length>0?(n(),c("div",co,[t("div",uo,i(e(s)("records.uploadedFiles"))+" ("+i(e(E).length)+"/5)",1),t("div",po,[(n(!0),c(P,null,I(e(E),(o,g)=>(n(),c("div",{key:g,class:"file-preview-item"},[t("div",mo,[o.mediaType==="image"?(n(),c("img",{key:0,src:o.thumbnailUrl,alt:o.file.name,class:"preview-image"},null,8,_o)):(n(),c("div",vo,[...a[36]||(a[36]=[t("span",{class:"video-icon"},"ðŸŽ¬",-1)])]))]),t("div",ho,[t("div",go,[t("span",fo,i(e(re)(o.mediaType)),1),t("span",{class:"file-name",title:o.file.name},i(o.file.name),9,yo)]),t("div",bo,[t("span",ko,i(e(Y)(o.file.size)),1),t("span",Mo,i(o.mediaType==="image"?"(å›¾ç‰‡)":"(è§†é¢‘)"),1)])]),t("button",{type:"button",onClick:y=>e(X)(g),class:"remove-file-btn",title:e(s)("records.deleteFile")}," Ã— ",8,wo)]))),128))]),t("div",Fo,i(e(E).length>=5?e(s)("common.maxFilesExceeded"):e(s)("records.supportedFormats")),1)])):b("",!0)]),t("div",Eo,[t("button",{type:"button",class:"cancel-btn",onClick:a[17]||(a[17]=(...o)=>e(D)&&e(D)(...o)),disabled:e(M)},i(e(s)("records.cancel")),9,Co),t("button",{type:"button",class:"save-btn",onClick:a[18]||(a[18]=(...o)=>e(ee)&&e(ee)(...o)),disabled:e(M)},i(e(M)?e(v)?e(s)("records.updating"):e(s)("records.saving"):e(v)?e(s)("records.update"):e(s)("records.save")),9,To)])])])])):b("",!0),(n(),Fe(Ce,{to:"body"},[ve(ge,{name:"media-viewer"},{default:he(()=>[e(C)?(n(),c("div",{key:0,class:"media-viewer-overlay",onClick:a[25]||(a[25]=(...o)=>e(w)&&e(w)(...o)),onKeydown:[a[26]||(a[26]=pe((...o)=>e(w)&&e(w)(...o),["esc"])),a[27]||(a[27]=pe((...o)=>e(N)&&e(N)(...o),["left"])),a[28]||(a[28]=pe((...o)=>e(B)&&e(B)(...o),["right"]))],tabindex:"-1"},[t("div",{class:"media-viewer-content",onClick:a[24]||(a[24]=G(()=>{},["stop"]))},[t("button",{class:"media-viewer-close",onClick:a[21]||(a[21]=(...o)=>e(w)&&e(w)(...o))},"Ã—"),e(f).length>0?(n(),c("div",Do,[e(f).length>1?(n(),c("button",{key:0,class:"media-nav-btn media-nav-prev",onClick:a[22]||(a[22]=G((...o)=>e(N)&&e(N)(...o),["stop"])),"aria-label":e(s)("records.previousMedia")}," â€¹ ",8,xo)):b("",!0),t("div",Uo,[ve(ge,{name:"media-fade",mode:"out-in"},{default:he(()=>[e(f)[e(m)]?.media_type==="image"?(n(),c("img",{key:`img-${e(m)}`,src:e(f)[e(m)].media_url,alt:e(f)[e(m)].media_name||`${e(s)("records.media")} ${e(m)+1}`,class:"media-image"},null,8,$o)):e(f)[e(m)]?.media_type==="video"?(n(),c("video",{key:`video-${e(m)}`,src:e(f)[e(m)].media_url,controls:"",class:"media-video",autoplay:!0},null,8,So)):b("",!0)]),_:1})]),e(f).length>1?(n(),c("button",{key:1,class:"media-nav-btn media-nav-next",onClick:a[23]||(a[23]=G((...o)=>e(B)&&e(B)(...o),["stop"])),"aria-label":e(s)("records.nextMedia")}," â€º ",8,Po)):b("",!0)])):b("",!0),e(f).length>0?(n(),c("div",Io,[t("div",Vo,[t("h4",null,i(e(f)[e(m)]?.media_name||`${e(s)("records.media")} ${e(m)+1}`),1),e(f)[e(m)]?.created_at?(n(),c("p",Ao,i(e(s)("records.createdAt"))+": "+i(e(U)(e(f)[e(m)].created_at||"")),1)):b("",!0),e(f)[e(m)]?.updated_at&&e(f)[e(m)].updated_at!==(e(f)[e(m)].created_at||"")?(n(),c("p",Lo,i(e(s)("records.updatedAt"))+": "+i(e(U)(e(f)[e(m)].updated_at||"")),1)):b("",!0),t("p",null,i(e(s)("records.mediaIndex",{current:e(m)+1,total:e(f).length})),1)]),e(f).length>1?(n(),c("div",jo,[(n(!0),c(P,null,I(e(f),(o,g)=>(n(),c("div",{key:g,class:V(["thumbnail-item",{active:g===e(m)}]),onClick:G(y=>e(ce)(g),["stop"]),"aria-label":`${e(s)("records.media")} ${g+1}`},[o.media_type==="image"?(n(),c("img",{key:0,src:o.media_url,alt:o.media_name||`${e(s)("records.media")} ${g+1}`},null,8,No)):(n(),c("div",Ro,[...a[37]||(a[37]=[t("span",{class:"video-icon"},"ðŸŽ¬",-1)])]))],10,Bo))),128))])):b("",!0)])):(n(),c("div",zo,[t("p",null,i(e(s)("records.noMediaFiles")),1)]))])],32)):b("",!0)]),_:1})]))],2))}}),Go=Te(Oo,[["__scopeId","data-v-90dc1c8a"]]);export{Go as default};
