import{O as I,u as S,i as v,P as N,s as P,E as z,d as U,l as G,c as F,o as h,a as t,t as l,p as e,T as M,H as V,e as y,w as D,r as C,F as R,f as $,n as j,K as H,g as k,_ as L}from"./index-vX8o4tFx.js";import{useThemeStore as O}from"./theme-BuSJrrmb.js";import{u as A,g as K}from"./genderDisplay-Go8gYC-j.js";import{P as W}from"./Pagination-D5dvJ28X.js";import"./genderConverter-CAxqKJGy.js";const Y=()=>{const{t:r}=S();return{deleteFoster:async(d,c,i,_,p)=>{try{const u=Number(d);if(await N.confirm(r("user.confirmDeleteFoster"),r("user.confirmDeleteFosterTitle"),{confirmButtonText:r("confirm"),cancelButtonText:r("cancel"),type:"warning"}),(await P.delete(`/fosters/delete/${u}`)).code===200){const n=c.value.findIndex(g=>g.id===u);n!==-1&&(c.value.splice(n,1),i.value=Math.max(0,i.value-1)),z.success(r("user.fosterDeleted")),c.value.length===0&&_.value>1&&_.value--,setTimeout(()=>p(),500)}}catch(u){console.error(r("user.deleteFosterFailed"),u),z.error(r("user.deleteFosterFailed"))}}}},q=()=>{const{t:r}=S(),s=v([]),d=v(1),c=v(10),i=v(0),_=v(!1),p=async()=>{try{const n=await P.get("/user/fosters",{params:{current_page:d.value,per_page:c.value}});console.log("DEBUG: API响应数据:",n),console.log("DEBUG: response.data:",n.data);let g=n.data;g.records&&g.total!==void 0?(i.value=g.total,s.value=g.records.map(o=>({id:o.fid||o.id,pet:{pid:o.pet?.pid,name:o.pet?.name,breed:o.pet?.breed,age:o.pet?.age,gender:o.pet?.gender,image:o.pet?.image?o.pet.image.startsWith("http")?o.pet.image:`http://localhost:8082/api/images/${o.pet.image}`:"/src/assets/img/dog.jpg"},startDate:o.startDate,endDate:o.endDate,status:o.endDate?"ended":"ongoing"})),console.log("DEBUG: 转换后的数据:",s.value)):s.value=[]}catch{s.value=[],i.value=0,z.error(r("user.loadFosterFailed"))}finally{_.value=!1}};return{fosters:s,loadFosters:p,currentPage:d,pageSize:c,total:i,loading:_,handlePageChange:n=>{d.value=n,p()},handleSizeChange:n=>{c.value=n,d.value=1,p()}}},J=()=>{const{deleteFoster:r}=Y(),{fosters:s,loadFosters:d,currentPage:c,pageSize:i,total:_,loading:p,handlePageChange:u,handleSizeChange:m}=q(),n=O(),g=I(()=>n.preferences.theme==="dark");return{fosters:s,isDark:g,currentPage:c,pageSize:i,total:_,loading:p,deleteFoster:r,loadFosters:d,handlePageChange:u,handleSizeChange:m,applyTheme:()=>{n.applyTheme()}}},Q={class:"page-header"},X={class:"fosters-content"},Z={key:0,class:"empty-state"},ee={key:1,class:"fosters-list"},te={class:"pet-image"},se=["src","alt"],ae={class:"foster-details"},ne={class:"pet-info"},oe={class:"pet-breed"},le={class:"pet-age"},re={class:"foster-info"},ie={class:"info-item"},de={class:"label"},ce={class:"value"},ue={class:"info-item"},pe={class:"label"},ge={class:"value"},_e={class:"info-item"},me={class:"label"},he={class:"foster-actions"},ve=U({__name:"Fosters",setup(r){const{t:s}=S(),d=A().formatDate,{deleteFoster:c,fosters:i,isDark:_,loadFosters:p,currentPage:u,pageSize:m,total:n,handlePageChange:g,handleSizeChange:o,applyTheme:x}=J(),T=async b=>{await c(b,i,n,u,p)};return G(()=>{p(),x()}),(b,f)=>{const B=C("el-icon"),w=C("el-tag"),E=C("el-button");return h(),F("div",{class:j(["fosters-container",{dark:e(_)}])},[t("div",Q,[t("h1",null,l(e(s)("user.fosterRecords")),1),t("p",null,l(e(s)("user.viewFosterHistory")),1)]),t("div",X,[e(i).length===0?(h(),F("div",Z,[y(B,null,{default:D(()=>[y(e(H))]),_:1}),t("h3",null,l(e(s)("user.noFosterRecords")),1),t("p",null,l(e(s)("user.noFosterYet")),1)])):(h(),F("div",ee,[(h(!0),F(R,null,$(e(i),a=>(h(),F("div",{key:a.id,class:"foster-card"},[t("div",te,[t("img",{src:a.pet.image,alt:a.pet.name},null,8,se)]),t("div",ae,[t("div",ne,[t("h3",null,l(a.pet.name),1),t("p",oe,l(a.pet.breed),1),t("p",le,l(a.pet.age)+l(e(s)("user.yearsOld"))+" · "+l(e(K)(a.pet.gender)),1)]),t("div",re,[t("div",ie,[t("span",de,l(e(s)("user.fosterStart"))+"：",1),t("span",ce,l(e(d)(a.startDate)),1)]),t("div",ue,[t("span",pe,l(e(s)("user.fosterEnd"))+"：",1),t("span",ge,l(a.endDate?e(d)(a.endDate):e(s)("user.ongoing")),1)]),t("div",_e,[t("span",me,l(e(s)("user.status"))+"：",1),y(w,{type:a.status==="ongoing"?"warning":"success"},{default:D(()=>[k(l(a.status==="ongoing"?e(s)("user.ongoing"):e(s)("user.fosterEnded")),1)]),_:2},1032,["type"])])]),t("div",he,[y(E,{type:"danger",size:"small",onClick:Fe=>T(a.id),disabled:!a.id||a.id===void 0||a.id===null},{default:D(()=>[k(l(e(s)("user.deleteRecord")),1)]),_:1},8,["onClick","disabled"])])])]))),128))])),e(n)>0?(h(),M(W,{key:2,"current-page":e(u),"page-size":e(m),total:e(n),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper","onUpdate:currentPage":f[0]||(f[0]=a=>u.value=a),"onUpdate:pageSize":f[1]||(f[1]=a=>m.value=a),onPageChange:e(g),onSizeChange:e(o)},null,8,["current-page","page-size","total","onPageChange","onSizeChange"])):V("",!0)])],2)}}}),Se=L(ve,[["__scopeId","data-v-95de9914"]]);export{Se as default};
